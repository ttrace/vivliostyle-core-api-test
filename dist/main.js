/*
 * ATTENTION: The "eval" devtool has been used (maybe by default in mode: "development").
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
/******/ (() => { // webpackBootstrap
/******/ 	"use strict";
/******/ 	var __webpack_modules__ = ({

/***/ "./node_modules/@vivliostyle/core/lib/vivliostyle.js":
/*!***********************************************************!*\
  !*** ./node_modules/@vivliostyle/core/lib/vivliostyle.js ***!
  \***********************************************************/
/***/ ((module) => {

eval("var mg=Object.create;var Ao=Object.defineProperty;var Cg=Object.getOwnPropertyDescriptor;var bg=Object.getOwnPropertyNames;var yg=Object.getPrototypeOf,xg=Object.prototype.hasOwnProperty;var Eg=(r,t,e)=>t in r?Ao(r,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):r[t]=e;var Sg=(r,t)=>()=>(t||r((t={exports:{}}).exports,t),t.exports),Ng=(r,t)=>{for(var e in t)Ao(r,e,{get:t[e],enumerable:!0})},yp=(r,t,e,n)=>{if(t&&typeof t==\"object\"||typeof t==\"function\")for(let s of bg(t))!xg.call(r,s)&&s!==e&&Ao(r,s,{get:()=>t[s],enumerable:!(n=Cg(t,s))||n.enumerable});return r};var vg=(r,t,e)=>(e=r!=null?mg(yg(r)):{},yp(t||!r||!r.__esModule?Ao(e,\"default\",{value:r,enumerable:!0}):e,r)),Tg=r=>yp(Ao({},\"__esModule\",{value:!0}),r);var d=(r,t,e)=>Eg(r,typeof t!=\"symbol\"?t+\"\":t,e);var Eh=Sg((Mb,xh)=>{var xt=-1,tt=1,Me=0;function qo(r,t,e,n,s){if(r===t)return r?[[Me,r]]:[];if(e!=null){var o=Hm(r,t,e);if(o)return o}var i=Tc(r,t),a=r.substring(0,i);r=r.substring(i),t=t.substring(i),i=Fr(r,t);var l=r.substring(r.length-i);r=r.substring(0,r.length-i),t=t.substring(0,t.length-i);var c=Vm(r,t);return a&&c.unshift([Me,a]),l&&c.push([Me,l]),wc(c,s),n&&Om(c),c}function Vm(r,t){var e;if(!r)return[[tt,t]];if(!t)return[[xt,r]];var n=r.length>t.length?r:t,s=r.length>t.length?t:r,o=n.indexOf(s);if(o!==-1)return e=[[tt,n.substring(0,o)],[Me,s],[tt,n.substring(o+s.length)]],r.length>t.length&&(e[0][0]=e[2][0]=xt),e;if(s.length===1)return[[xt,r],[tt,t]];var i=Bm(r,t);if(i){var a=i[0],l=i[1],c=i[2],u=i[3],p=i[4],h=qo(a,c),f=qo(l,u);return h.concat([[Me,p]],f)}return Fm(r,t)}function Fm(r,t){for(var e=r.length,n=t.length,s=Math.ceil((e+n)/2),o=s,i=2*s,a=new Array(i),l=new Array(i),c=0;c<i;c++)a[c]=-1,l[c]=-1;a[o+1]=0,l[o+1]=0;for(var u=e-n,p=u%2!==0,h=0,f=0,g=0,m=0,E=0;E<s;E++){for(var C=-E+h;C<=E-f;C+=2){var b=o+C,y;C===-E||C!==E&&a[b-1]<a[b+1]?y=a[b+1]:y=a[b-1]+1;for(var N=y-C;y<e&&N<n&&r.charAt(y)===t.charAt(N);)y++,N++;if(a[b]=y,y>e)f+=2;else if(N>n)h+=2;else if(p){var S=o+u-C;if(S>=0&&S<i&&l[S]!==-1){var w=e-l[S];if(y>=w)return dh(r,t,y,N)}}}for(var A=-E+g;A<=E-m;A+=2){var S=o+A,w;A===-E||A!==E&&l[S-1]<l[S+1]?w=l[S+1]:w=l[S-1]+1;for(var I=w-A;w<e&&I<n&&r.charAt(e-w-1)===t.charAt(n-I-1);)w++,I++;if(l[S]=w,w>e)m+=2;else if(I>n)g+=2;else if(!p){var b=o+u-A;if(b>=0&&b<i&&a[b]!==-1){var y=a[b],N=o+y-b;if(w=e-w,y>=w)return dh(r,t,y,N)}}}}return[[xt,r],[tt,t]]}function dh(r,t,e,n){var s=r.substring(0,e),o=t.substring(0,n),i=r.substring(e),a=t.substring(n),l=qo(s,o),c=qo(i,a);return l.concat(c)}function Tc(r,t){if(!r||!t||r.charAt(0)!==t.charAt(0))return 0;for(var e=0,n=Math.min(r.length,t.length),s=n,o=0;e<s;)r.substring(o,s)==t.substring(o,s)?(e=s,o=e):n=s,s=Math.floor((n-e)/2+e);return mh(r.charCodeAt(s-1))&&s--,s}function ph(r,t){var e=r.length,n=t.length;if(e==0||n==0)return 0;e>n?r=r.substring(e-n):e<n&&(t=t.substring(0,e));var s=Math.min(e,n);if(r==t)return s;for(var o=0,i=1;;){var a=r.substring(s-i),l=t.indexOf(a);if(l==-1)return o;i+=l,(l==0||r.substring(s-i)==t.substring(0,i))&&(o=i,i++)}}function Fr(r,t){if(!r||!t||r.slice(-1)!==t.slice(-1))return 0;for(var e=0,n=Math.min(r.length,t.length),s=n,o=0;e<s;)r.substring(r.length-s,r.length-o)==t.substring(t.length-s,t.length-o)?(e=s,o=e):n=s,s=Math.floor((n-e)/2+e);return Ch(r.charCodeAt(r.length-s))&&s--,s}function Bm(r,t){var e=r.length>t.length?r:t,n=r.length>t.length?t:r;if(e.length<4||n.length*2<e.length)return null;function s(f,g,m){for(var E=f.substring(m,m+Math.floor(f.length/4)),C=-1,b=\"\",y,N,S,w;(C=g.indexOf(E,C+1))!==-1;){var A=Tc(f.substring(m),g.substring(C)),I=Fr(f.substring(0,m),g.substring(0,C));b.length<I+A&&(b=g.substring(C-I,C)+g.substring(C,C+A),y=f.substring(0,m-I),N=f.substring(m+A),S=g.substring(0,C-I),w=g.substring(C+A))}return b.length*2>=f.length?[y,N,S,w,b]:null}var o=s(e,n,Math.ceil(e.length/4)),i=s(e,n,Math.ceil(e.length/2)),a;if(!o&&!i)return null;i?o?a=o[4].length>i[4].length?o:i:a=i:a=o;var l,c,u,p;r.length>t.length?(l=a[0],c=a[1],u=a[2],p=a[3]):(u=a[0],p=a[1],l=a[2],c=a[3]);var h=a[4];return[l,c,u,p,h]}function Om(r){for(var t=!1,e=[],n=0,s=null,o=0,i=0,a=0,l=0,c=0;o<r.length;)r[o][0]==Me?(e[n++]=o,i=l,a=c,l=0,c=0,s=r[o][1]):(r[o][0]==tt?l+=r[o][1].length:c+=r[o][1].length,s&&s.length<=Math.max(i,a)&&s.length<=Math.max(l,c)&&(r.splice(e[n-1],0,[xt,s]),r[e[n-1]+1][0]=tt,n--,n--,o=n>0?e[n-1]:-1,i=0,a=0,l=0,c=0,s=null,t=!0)),o++;for(t&&wc(r),_m(r),o=1;o<r.length;){if(r[o-1][0]==xt&&r[o][0]==tt){var u=r[o-1][1],p=r[o][1],h=ph(u,p),f=ph(p,u);h>=f?(h>=u.length/2||h>=p.length/2)&&(r.splice(o,0,[Me,p.substring(0,h)]),r[o-1][1]=u.substring(0,u.length-h),r[o+1][1]=p.substring(h),o++):(f>=u.length/2||f>=p.length/2)&&(r.splice(o,0,[Me,u.substring(0,f)]),r[o-1][0]=tt,r[o-1][1]=p.substring(0,p.length-f),r[o+1][0]=xt,r[o+1][1]=u.substring(f),o++),o++}o++}}var hh=/[^a-zA-Z0-9]/,fh=/\\s/,gh=/[\\r\\n]/,Dm=/\\n\\r?\\n$/,Mm=/^\\r?\\n\\r?\\n/;function _m(r){function t(f,g){if(!f||!g)return 6;var m=f.charAt(f.length-1),E=g.charAt(0),C=m.match(hh),b=E.match(hh),y=C&&m.match(fh),N=b&&E.match(fh),S=y&&m.match(gh),w=N&&E.match(gh),A=S&&f.match(Dm),I=w&&g.match(Mm);return A||I?5:S||w?4:C&&!y&&N?3:y||N?2:C||b?1:0}for(var e=1;e<r.length-1;){if(r[e-1][0]==Me&&r[e+1][0]==Me){var n=r[e-1][1],s=r[e][1],o=r[e+1][1],i=Fr(n,s);if(i){var a=s.substring(s.length-i);n=n.substring(0,n.length-i),s=a+s.substring(0,s.length-i),o=a+o}for(var l=n,c=s,u=o,p=t(n,s)+t(s,o);s.charAt(0)===o.charAt(0);){n+=s.charAt(0),s=s.substring(1)+o.charAt(0),o=o.substring(1);var h=t(n,s)+t(s,o);h>=p&&(p=h,l=n,c=s,u=o)}r[e-1][1]!=l&&(l?r[e-1][1]=l:(r.splice(e-1,1),e--),r[e][1]=c,u?r[e+1][1]=u:(r.splice(e+1,1),e--))}e++}}function wc(r,t){r.push([Me,\"\"]);for(var e=0,n=0,s=0,o=\"\",i=\"\",a;e<r.length;){if(e<r.length-1&&!r[e][1]){r.splice(e,1);continue}switch(r[e][0]){case tt:s++,i+=r[e][1],e++;break;case xt:n++,o+=r[e][1],e++;break;case Me:var l=e-s-n-1;if(t){if(l>=0&&yh(r[l][1])){var c=r[l][1].slice(-1);if(r[l][1]=r[l][1].slice(0,-1),o=c+o,i=c+i,!r[l][1]){r.splice(l,1),e--;var u=l-1;r[u]&&r[u][0]===tt&&(s++,i=r[u][1]+i,u--),r[u]&&r[u][0]===xt&&(n++,o=r[u][1]+o,u--),l=u}}if(bh(r[e][1])){var c=r[e][1].charAt(0);r[e][1]=r[e][1].slice(1),o+=c,i+=c}}if(e<r.length-1&&!r[e][1]){r.splice(e,1);break}if(o.length>0||i.length>0){o.length>0&&i.length>0&&(a=Tc(i,o),a!==0&&(l>=0?r[l][1]+=i.substring(0,a):(r.splice(0,0,[Me,i.substring(0,a)]),e++),i=i.substring(a),o=o.substring(a)),a=Fr(i,o),a!==0&&(r[e][1]=i.substring(i.length-a)+r[e][1],i=i.substring(0,i.length-a),o=o.substring(0,o.length-a)));var p=s+n;o.length===0&&i.length===0?(r.splice(e-p,p),e=e-p):o.length===0?(r.splice(e-p,p,[tt,i]),e=e-p+1):i.length===0?(r.splice(e-p,p,[xt,o]),e=e-p+1):(r.splice(e-p,p,[xt,o],[tt,i]),e=e-p+2)}e!==0&&r[e-1][0]===Me?(r[e-1][1]+=r[e][1],r.splice(e,1)):e++,s=0,n=0,o=\"\",i=\"\";break}}r[r.length-1][1]===\"\"&&r.pop();var h=!1;for(e=1;e<r.length-1;)r[e-1][0]===Me&&r[e+1][0]===Me&&(r[e][1].substring(r[e][1].length-r[e-1][1].length)===r[e-1][1]?(r[e][1]=r[e-1][1]+r[e][1].substring(0,r[e][1].length-r[e-1][1].length),r[e+1][1]=r[e-1][1]+r[e+1][1],r.splice(e-1,1),h=!0):r[e][1].substring(0,r[e+1][1].length)==r[e+1][1]&&(r[e-1][1]+=r[e+1][1],r[e][1]=r[e][1].substring(r[e+1][1].length)+r[e+1][1],r.splice(e+1,1),h=!0)),e++;h&&wc(r,t)}function mh(r){return r>=55296&&r<=56319}function Ch(r){return r>=56320&&r<=57343}function bh(r){return Ch(r.charCodeAt(0))}function yh(r){return mh(r.charCodeAt(r.length-1))}function Um(r){for(var t=[],e=0;e<r.length;e++)r[e][1].length>0&&t.push(r[e]);return t}function vc(r,t,e,n){return yh(r)||bh(n)?null:Um([[Me,r],[xt,t],[tt,e],[Me,n]])}function Hm(r,t,e){var n=typeof e==\"number\"?{index:e,length:0}:e.oldRange,s=typeof e==\"number\"?null:e.newRange,o=r.length,i=t.length;if(n.length===0&&(s===null||s.length===0)){var a=n.index,l=r.slice(0,a),c=r.slice(a),u=s?s.index:null;e:{var p=a+i-o;if(u!==null&&u!==p||p<0||p>i)break e;var h=t.slice(0,p),f=t.slice(p);if(f!==c)break e;var g=Math.min(a,p),m=l.slice(0,g),E=h.slice(0,g);if(m!==E)break e;var C=l.slice(g),b=h.slice(g);return vc(m,C,b,c)}e:{if(u!==null&&u!==a)break e;var y=a,h=t.slice(0,y),f=t.slice(y);if(h!==l)break e;var N=Math.min(o-y,i-y),S=c.slice(c.length-N),w=f.slice(f.length-N);if(S!==w)break e;var C=c.slice(0,c.length-N),b=f.slice(0,f.length-N);return vc(l,C,b,S)}}if(n.length>0&&s&&s.length===0)e:{var m=r.slice(0,n.index),S=r.slice(n.index+n.length),g=m.length,N=S.length;if(i<g+N)break e;var E=t.slice(0,g),w=t.slice(i-N);if(m!==E||S!==w)break e;var C=r.slice(g,o-N),b=t.slice(g,i-N);return vc(m,C,b,S)}return null}function Br(r,t,e,n){return qo(r,t,e,n,!0)}Br.INSERT=tt;Br.DELETE=xt;Br.EQUAL=Me;xh.exports=Br});var yb={};Ng(yb,{CoreViewer:()=>zi,HOOKS:()=>ft,Navigation:()=>ug,PageProgression:()=>Jn,PageSide:()=>Lo,PageViewMode:()=>Cb,Profiler:()=>ji,ReadyState:()=>pl,UserAgentBaseCss:()=>pc,UserAgentPageCss:()=>dc,UserAgentTocCss:()=>hc,UserAgentXml:()=>uc,ValidationTxt:()=>cc,VivliostylePolyfillCss:()=>fc,VivliostyleViewportCss:()=>lc,VivliostyleViewportScreenCss:()=>ac,ZoomType:()=>mb,getHooksForName:()=>$e,isDebug:()=>Qn,pageProgressionOf:()=>dl,plugin:()=>wg,printHTML:()=>bb,profile:()=>Lg,profiler:()=>Ye,registerHook:()=>_e,removeHook:()=>xp,setDebug:()=>ul});module.exports=Tg(yb);var Qn=!1;function ul(r){Qn=r}var Jn=(e=>(e.LTR=\"ltr\",e.RTL=\"rtl\",e))(Jn||{});function dl(r){switch(r){case\"ltr\":return\"ltr\";case\"rtl\":return\"rtl\";default:throw new Error(`unknown PageProgression: ${r}`)}}var Lo=(e=>(e.LEFT=\"left\",e.RIGHT=\"right\",e))(Lo||{}),pl=(n=>(n.LOADING=\"loading\",n.INTERACTIVE=\"interactive\",n.COMPLETE=\"complete\",n))(pl||{});var fl=(s=>(s[s.DEBUG=1]=\"DEBUG\",s[s.INFO=2]=\"INFO\",s[s.WARN=3]=\"WARN\",s[s.ERROR=4]=\"ERROR\",s))(fl||{}),hl=class{constructor(t){this.opt_console=t;d(this,\"listeners\",{})}consoleDebug(t){this.opt_console?this.opt_console.debug?this.opt_console.debug(...t):this.opt_console.log(...t):console.debug(...t)}consoleInfo(t){this.opt_console?this.opt_console.info?this.opt_console.info(...t):this.opt_console.log(...t):console.info(...t)}consoleWarn(t){this.opt_console?this.opt_console.warn?this.opt_console.warn(...t):this.opt_console.log(...t):console.warn(...t)}consoleError(t){this.opt_console?this.opt_console.error?this.opt_console.error(...t):this.opt_console.log(...t):console.error(...t)}triggerListeners(t,e){let n=this.listeners[t];n&&n(e)}addListener(t,e){this.listeners[t]=e}debug(...t){let e=Wi(arguments);this.consoleDebug($i(e)),this.triggerListeners(1,e)}info(...t){let e=Wi(arguments);this.consoleInfo($i(e)),this.triggerListeners(2,e)}warn(...t){let e=Wi(arguments);this.consoleWarn($i(e)),this.triggerListeners(3,e)}error(...t){let e=Wi(arguments);this.consoleError($i(e)),this.triggerListeners(4,e)}};function Wi(r){let t=Array.from(r),e=null;return t[0]instanceof Error&&(e=t.shift()),{error:e,messages:t}}function $i(r){let t=r.error,e=t&&(t.frameTrace||t.stack),n=[].concat(r.messages);return t&&(n.length>0&&(n=n.concat([`\n`])),n=n.concat([t.toString()]),e&&(n=n.concat([`\n`]).concat(e))),n}var V=new hl;var ft=(u=>(u.SIMPLE_PROPERTY=\"SIMPLE_PROPERTY\",u.PREPROCESS_SINGLE_DOCUMENT=\"PREPROCESS_SINGLE_DOCUMENT\",u.PREPROCESS_TEXT_CONTENT=\"PREPROCESS_TEXT_CONTENT\",u.PREPROCESS_ELEMENT_STYLE=\"PREPROCESS_ELEMENT_STYLE\",u.POLYFILLED_INHERITED_PROPS=\"POLYFILLED_INHERITED_PROPS\",u.CONFIGURATION=\"CONFIGURATION\",u.RESOLVE_TEXT_NODE_BREAKER=\"RESOLVE_TEXT_NODE_BREAKER\",u.RESOLVE_FORMATTING_CONTEXT=\"RESOLVE_FORMATTING_CONTEXT\",u.RESOLVE_LAYOUT_PROCESSOR=\"RESOLVE_LAYOUT_PROCESSOR\",u.POST_LAYOUT_BLOCK=\"POST_LAYOUT_BLOCK\",u))(ft||{}),Xi={};function _e(r,t,e){if(!ft[r])V.warn(new Error(`Skipping unknown plugin hook '${r}'.`));else{let n=Xi[r];n||(n=Xi[r]=[]),e?n.unshift(t):n.push(t)}}function xp(r,t){if(!ft[r])V.warn(new Error(`Ignoring unknown plugin hook '${r}'.`));else{let e=Xi[r];if(e){let n=e.indexOf(t);n>=0&&e.splice(n,1)}}}function $e(r){return Xi[r]||[]}var wg={registerHook:_e,removeHook:xp};var ji=class{constructor(t){this.performanceInstance=t;d(this,\"timestamps\",{});d(this,\"registerTiming\");d(this,\"registerStartTiming\");d(this,\"registerEndTiming\");this.registerTiming=Os,this.registerStartTiming=this.registerStartTiming=Os,this.registerEndTiming=this.registerEndTiming=Os}forceRegisterStartTiming(t,e){gl.call(this,t,\"start\",e)}forceRegisterEndTiming(t,e){gl.call(this,t,\"end\",e)}printTimings(){let t=this.timestamps,e=\"\";Object.keys(t).forEach(n=>{let s=t[n],o=s.length;for(let i=0;i<o;i++){let a=s[i];e+=n,o>1&&(e+=`(${i})`),e+=` => start: ${a.start}, end: ${a.end}, duration: ${a.end-a.start}\n`}}),V.info(e)}disable(){this.registerTiming=Os,this.registerStartTiming=this.registerStartTiming=Os,this.registerEndTiming=this.registerEndTiming=Os}enable(){this.registerTiming=gl,this.registerStartTiming=this.registerStartTiming=Ep,this.registerEndTiming=this.registerEndTiming=Pg}isEnabled(){return this.registerStartTiming===Ep}};function Os(){}function gl(r,t,e){e||(e=this.performanceInstance.now());let n=this.timestamps[r];n||(n=this.timestamps[r]=[]);let s,o=n.length;for(let i=o-1;i>=0&&(s=n[i],!(s&&!s[t]));i--)s=null;s||(s={},n.push(s)),s[t]=e}function Ep(r,t){this.registerTiming(r,\"start\",t)}function Pg(r,t){this.registerTiming(r,\"end\",t)}var kg={now:Date.now},Ag=window&&window.performance,Ye=new ji(Ag||kg);Ye.forceRegisterStartTiming(\"load_vivliostyle\");var Lg={profiler:{registerStartTiming:Ye.registerStartTiming,registerEndTiming:Ye.registerEndTiming,printTimings:Ye.printTimings,disable:Ye.disable,enable:Ye.enable}};var Io=/^[\\s\\p{Zs}\\p{P}\\p{Mn}]*[\\p{L}\\p{N}]\\p{Mn}*(?:[\\s\\p{Zs}]*\\p{P}\\p{Mn}*)*/u,Vt=\"data-adapt-eloff\",Np={};function Ms(r){return JSON.parse(r)}function wt(r){let t=r.match(/^([^#]*)/);return t?t[1]:r}function Rg(r){let t=r.match(/^([^#?]*)/);return t?t[1]:r}var nn=window.location.href;function Cl(r){nn=r}var Wt=window.location.href;function bl(r){Wt=r}function J(r,t){if(/^data:/i.test(t))return r||t;if(!t||r.match(/^\\w{2,}:/))return r.toLowerCase().match(\"^javascript:\")?\"#\":(r.match(/^\\w{2,}:\\/\\/[^\\/]+$/)&&(r=`${r}/`),r);t.match(/^\\w{2,}:\\/\\/[^\\/]+$/)&&(t=`${t}/`);let e;if(r.match(/^\\/\\//))return e=t.match(/^(\\w{2,}:)\\/\\//),e?e[1]+r:r;if(r.match(/^\\//))return e=t.match(/^(\\w{2,}:\\/\\/[^\\/]+)\\//),e?e[1]+r:r;if(r.match(/^\\.(\\/|$)/)&&(r=r.substr(2)),t=Rg(t),r.match(/^#/))return t+r;let n=t.lastIndexOf(\"/\");if(n<0)return r;let s=t.substr(0,n+1)+r,o=\"\";for(e=s.match(/^([^?#]*)([?#].*)$/),e&&(s=e[1],o=e[2]);n=s.indexOf(\"/../\"),!(n<=0);){let i=s.lastIndexOf(\"/\",n-1);if(i<=0)break;s=s.substr(0,i)+s.substr(n+3)}return s.replace(/\\/(\\.\\/)+/g,\"/\")+o}function vn(r){let t;return(t=/^(https?:)\\/\\/github\\.com\\/([^/]+\\/[^/]+)\\/(blob\\/|tree\\/|raw\\/)?(.*)$/.exec(r))?r=`${t[1]}//raw.githubusercontent.com/${t[2]}/${t[3]?\"\":\"master/\"}${t[4]}`:(t=/^(https?:)\\/\\/www\\.aozora\\.gr\\.jp\\/(cards\\/[^/]+\\/files\\/[^/.]+\\.html)$/.exec(r))?r=`${t[1]}//raw.githubusercontent.com/aozorabunko/aozorabunko/master/${t[2]}`:(t=/^(https?:)\\/\\/gist\\.github\\.com\\/([^/]+\\/\\w+)(\\/|$)(raw(\\/|$))?(.*)$/.exec(r))?r=`${t[1]}//gist.githubusercontent.com/${t[2]}/raw/${t[6]}`:(t=/^(https?:)\\/\\/(?:[^/.]+\\.)?jsbin\\.com\\/(?!(?:blog|help)\\b)(\\w+)((\\/\\d+)?).*$/.exec(r))&&(r=`${t[1]}//output.jsbin.com/${t[2]}${t[3]}/`),r}function yl(r){return r==null?r:r.toString()}var Yi=class{constructor(){d(this,\"queue\",[null])}length(){return this.queue.length-1}add(t){let e=this.queue.length;for(;e>1;){let n=Math.floor(e/2),s=this.queue[n];if(s.compare(t)>0){this.queue[e]=t;return}this.queue[e]=s,e=n}this.queue[1]=t}peek(){return this.queue[1]}remove(){let t=this.queue[1],e=this.queue.pop(),n=this.queue.length;if(n>1){let s=1;for(;;){let o=s*2;if(o>=n)break;if(this.queue[o].compare(e)>0)o+1<n&&this.queue[o+1].compare(this.queue[o])>0&&o++;else if(o+1<n&&this.queue[o+1].compare(e)>0)o++;else break;this.queue[s]=this.queue[o],s=o}this.queue[s]=e}return t}},xl=[\"\",\"-webkit-\",\"-moz-\"],Ds={};function ml(r,t){return CSS.supports(r+t,\"unset\")}function El(r){let t=Ds[r];if(t||t===null)return t;switch(r){case\"behavior\":case\"template\":case\"ua-list-item-count\":case\"x-first-pseudo\":return Ds[r]=null,null;case\"text-combine-upright\":if(ml(\"-webkit-\",\"text-combine\")&&!ml(\"\",\"text-combine-upright\"))return Ds[r]=[\"-webkit-text-combine\"],[\"-webkit-text-combine\"];break}for(let e of xl)if(ml(e,r))return t=[e+r],Ds[r]=t,t;return V.warn(\"Property not supported by the browser: \",r),Ds[r]=null,null}function T(r,t,e){let n=r==null?void 0:r.style;if(!n)return;if(t.startsWith(\"--\")){n.setProperty(t,e||\" \");return}let s=El(t);if(s)for(let o of s){switch(o){case\"-webkit-text-combine\":switch(e){case\"all\":e=\"horizontal\";break}break;case\"text-combine-upright\":switch(e){case\"all\":n.setProperty(\"text-indent\",\"0\");break}break}n.setProperty(o,e)}}function Tn(r,t,e){try{let n=Ds[t];return r.style.getPropertyValue(n?n[0]:t)}catch(n){}return e||\"\"}function Vo(r){let t=r.getAttributeNS(\"http://www.w3.org/XML/1998/namespace\",\"lang\");return!t&&r.namespaceURI==\"http://www.w3.org/1999/xhtml\"&&(t=r.getAttribute(\"lang\")),t}var je=class{constructor(){d(this,\"list\",[])}append(t){return this.list.push(t),this}clear(){this.list=[]}toString(){let t=this.list.join(\"\");return this.list=[t],t}};function vp(r){return`\\\\${r.charCodeAt(0).toString(16)} `}function $t(r){return r.replace(/[^-_a-zA-Z0-9\\u0080-\\uFFFF]/g,vp)}function es(r){return r.replace(/[\\u0000-\\u001F\"\\\\]/g,vp)}function Sl(r){return r.replace(/[\\s+&?=#\\u007F-\\uFFFF]+/g,encodeURIComponent)}function Nl(r){return!!r.match(/^[a-zA-Z\\u009E\\u009F\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u024F\\u037B-\\u037D\\u0386\\u0388-\\u0482\\u048A-\\u0527]$/)}function Ig(r,t){return t=typeof t==\"string\"?t:\"\\\\u\",t+(65536|r.charCodeAt(0)).toString(16).substr(1)}function vl(r,t){function e(n){return Ig(n,t)}return r.replace(/[^-a-zA-Z0-9_]/g,e)}function sn(r){return vl(r)}function Vg(r,t){return t=typeof t==\"string\"?t:\"\\\\u\",r.indexOf(t)===0?String.fromCharCode(parseInt(r.substring(t.length),16)):r}function Tp(r,t){t=typeof t==\"string\"?t:\"\\\\u\";function e(s){return Vg(s,t)}let n=new RegExp(`${sn(t)}[0-9a-fA-F]{4}`,\"g\");return r.replace(n,e)}function gt(r,t){let e=0,n=r;for(;;){if(e<=n,e==0||t(e-1),n==r||t(n),e==n)return e;let s=e+n>>1;t(s)?n=s:e=s+1}}function Ki(r,t){return r-t}function Tl(r,t){let e={};for(let n of r){let s=t(n);s&&!e[s]&&(e[s]=n)}return e}function wp(r){let t={};for(let e=0;e<r.length;e++)t[r[e]]=!0;return t}function qi(r,t){let e={};for(let n of r){let s=t(n);s&&(e[s]?e[s].push(n):e[s]=[n])}return e}function Pp(r,t){let e={};for(let n in r)e[n]=t(r[n],n);return e}var Nn=class{constructor(){d(this,\"listeners\",{})}dispatchEvent(t){let e=this.listeners[t.type];if(e){t.target=this,t.currentTarget=this;for(let n=0;n<e.length;n++)e[n](t)}}addEventListener(t,e,n){if(n)return;let s=this.listeners[t];s?s.includes(e)||s.push(e):this.listeners[t]=[e]}removeEventListener(t,e,n){if(n)return;let s=this.listeners[t];if(s){let o=s.indexOf(e);o>=0&&s.splice(o,1)}}},Xt={audio:!0,canvas:!0,embed:!0,iframe:!0,img:!0,math:!0,object:!0,picture:!0,svg:!0,video:!0};function Lp(r){if(r.nodeType==1){let t=r.getAttribute(\"id\");if(t)return t}return null}function Fg(r){return`^${r}`}function kp(r){return r.replace(/[\\[\\]\\(\\),=;^]/g,Fg)}function Bg(r){return r.substr(1)}function wl(r){return r&&r.replace(/\\^[\\[\\]\\(\\),=;^]/g,Bg)}function Og(r){let t=[];do{let e=r.match(/^(\\^,|[^,])*/),n=wl(e[0]);if(r=r.substr(e[0].length+1),!r&&!t.length)return n;t.push(n)}while(r);return t}function Ap(r){let t={};for(;r;){let e=r.match(/^;([^;=]+)=(([^;]|\\^;)*)/);if(!e)return t;t[e[1]]=Og(e[2]),r=r.substr(e[0].length)}return t}var Zi=class{appendTo(t){t.append(\"!\")}applyTo(t){return!1}},Qi=class{constructor(t,e,n){this.index=t;this.id=e;this.sideBias=n}appendTo(t){t.append(\"/\"),t.append(this.index.toString()),(this.id||this.sideBias)&&(t.append(\"[\"),this.id&&t.append(this.id),this.sideBias&&(t.append(\";s=\"),t.append(this.sideBias)),t.append(\"]\"))}applyTo(t){if(t.node.nodeType!=1)throw new Error(\"E_CFI_NOT_ELEMENT\");let e=t.node,n=e.children,s=n.length,o,i=Math.floor(this.index/2)-1;if(i<0||s==0)o=e.firstChild,t.node=o||e;else{if(o=n[Math.min(i,s-1)],this.index&1){let a=o.nextSibling;!a||a.nodeType==1?t.after=!0:o=a}t.node=o}if(this.id&&(t.after||this.id!=Lp(t.node))){let a=e.ownerDocument.getElementById(this.id);a?t.node=a:V.warn(\"E_CFI_ID_MISMATCH:\",this.id)}return t.sideBias=this.sideBias,!0}},Ji=class{constructor(t,e,n,s){this.offset=t;this.textBefore=e;this.textAfter=n;this.sideBias=s}applyTo(t){if(this.offset>0&&!t.after){let e=this.offset,n=t.node;for(;;){let s=n.nodeType;if(s==1)break;let o=n.nextSibling;if(3<=s&&s<=5){let i=n.textContent.length;if(e<=i)break;if(!o){e=i;break}e-=i}if(!o){e=0;break}n=o}t.node=n,t.offset=e}return t.sideBias=this.sideBias,!0}appendTo(t){t.append(\":\"),t.append(this.offset.toString()),(this.textBefore||this.textAfter||this.sideBias)&&(t.append(\"[\"),(this.textBefore||this.textAfter)&&(this.textBefore&&t.append(kp(this.textBefore)),t.append(\",\"),this.textAfter&&t.append(kp(this.textAfter))),this.sideBias&&(t.append(\";s=\"),t.append(this.sideBias)),t.append(\"]\"))}},Fo=class r{constructor(){d(this,\"steps\",null)}fromString(t){let e=t.match(/^#?epubcfi\\((.*)\\)$/);if(!e)throw new Error(\"E_CFI_NOT_CFI\");let n=decodeURIComponent(e[1]),s=0,o=[];for(;;){let i;switch(n.charAt(s)){case\"/\":{if(s++,e=n.substr(s).match(/^(0|[1-9][0-9]*)(\\[(.*?)(;([^\\]]|\\^\\])*)?\\])?/),!e)throw new Error(\"E_CFI_NUMBER_EXPECTED\");s+=e[0].length;let a=parseInt(e[1],10),l=e[3];i=Ap(e[4]),o.push(new Qi(a,l,yl(i.s)));break}case\":\":{if(s++,e=n.substr(s).match(/^(0|[1-9][0-9]*)(\\[((([^\\];,]|\\^[\\];,])*)(,(([^\\];,]|\\^[\\];,])*))?)(;([^]]|\\^\\])*)?\\])?/),!e)throw new Error(\"E_CFI_NUMBER_EXPECTED\");s+=e[0].length;let a=parseInt(e[1],10),l=e[4];l&&(l=wl(l));let c=e[7];c&&(c=wl(c)),i=Ap(e[10]),o.push(new Ji(a,l,c,yl(i.s)));break}case\"!\":s++,o.push(new Zi);break;case\"~\":case\"@\":case\"\":this.steps=o;return;default:throw new Error(\"E_CFI_PARSE_ERROR\")}}}navigate(t){let e={node:t.documentElement,offset:0,after:!1,sideBias:null,ref:null};for(let n=0;n<this.steps.length;n++)if(!this.steps[n].applyTo(e)){e.ref=new r,e.ref.steps=this.steps.slice(n+1);break}return e}trim(t,e){return t.replace(/\\s+/g,\" \").match(e?/^[ -\\uD7FF\\uE000-\\uFFFF]{0,8}/:/[ -\\uD7FF\\uE000-\\uFFFF]{0,8}$/)[0].replace(/^\\s/,\"\").replace(/\\s$/,\"\")}prependPathFromNode(t,e,n,s){let o=[],i=t.parentNode,a=\"\",l=\"\";for(;t;){switch(t.nodeType){case 3:case 4:case 5:{let c=t.textContent,u=c.length;n?(e+=u,a||(a=c)):(e>u&&(e=u),n=!0,a=c.substr(0,e),l=c.substr(e)),t=t.previousSibling;continue}case 8:t=t.previousSibling;continue}break}for((e>0||a||l)&&(a=this.trim(a,!1),l=this.trim(l,!0),o.push(new Ji(e,a,l,s)),s=null);i&&!(!i||i.nodeType==9);){let c=n?null:Lp(t),u=n?1:0;for(;t;)t.nodeType==1&&(u+=2),t=t.previousSibling;o.push(new Qi(u,c,s)),s=null,t=i,i=i.parentNode,n=!1}o.reverse(),this.steps?(o.push(new Zi),this.steps=o.concat(this.steps)):this.steps=o}toString(){if(!this.steps)return\"\";let t=new je;t.append(\"epubcfi(\");for(let e=0;e<this.steps.length;e++)this.steps[e].appendTo(t);return t.append(\")\"),t.toString().replace(/%/g,\"%25\")}};function kl(){return{fontFamily:\"serif\",lineHeight:1.25,margin:8,hyphenate:!1,columnWidth:25,horizontal:!1,nightMode:!1,spreadView:!1,pageBorder:1,enabledMediaTypes:{vivliostyle:!0,print:!0},defaultPaperSize:void 0}}function hr(r){return{fontFamily:r.fontFamily,lineHeight:r.lineHeight,margin:r.margin,hyphenate:r.hyphenate,columnWidth:r.columnWidth,horizontal:r.horizontal,nightMode:r.nightMode,spreadView:r.spreadView,pageBorder:r.pageBorder,enabledMediaTypes:Object.assign({},r.enabledMediaTypes),defaultPaperSize:r.defaultPaperSize?Object.assign({},r.defaultPaperSize):void 0}}var Mg=kl(),Rp={PENDING:{}};function Al(r,t,e,n){let s=Math.min((r-0)/e,(t-0)/n);return`matrix(${s},0,0,${s},0,0)`}function Pl(r){return`\"${es(`${r}`)}\"`}function _g(r){return $t(`${r}`)}function zo(r,t){return r?`${$t(r)}.${$t(t)}`:$t(t)}var Ip=0,ts=class{constructor(t,e){this.parent=t;this.resolver=e;d(this,\"scopeKey\");d(this,\"children\",[]);d(this,\"zero\");d(this,\"one\");d(this,\"_true\");d(this,\"_false\");d(this,\"values\",{});d(this,\"funcs\",{});d(this,\"builtIns\",{});if(this.scopeKey=`S${Ip++}`,this.zero=new se(this,0),this.one=new se(this,1),this._true=new se(this,!0),this._false=new se(this,!1),t&&t.children.push(this),!t){let n=this.builtIns;n.floor=Math.floor,n.ceil=Math.ceil,n.round=Math.round,n.sqrt=Math.sqrt,n.min=Math.min,n.max=Math.max,n.letterbox=Al,n[\"css-string\"]=Pl,n[\"css-name\"]=_g,n.typeof=s=>typeof s,this.defineBuiltInName(\"page-width\",function(){return this.pageWidth()}),this.defineBuiltInName(\"page-height\",function(){return this.pageHeight()}),this.defineBuiltInName(\"pref-font-family\",function(){return this.pref.fontFamily}),this.defineBuiltInName(\"pref-night-mode\",function(){return this.pref.nightMode}),this.defineBuiltInName(\"pref-hyphenate\",function(){return this.pref.hyphenate}),this.defineBuiltInName(\"pref-margin\",function(){return this.pref.margin}),this.defineBuiltInName(\"pref-line-height\",function(){return this.pref.lineHeight}),this.defineBuiltInName(\"pref-column-width\",function(){return this.pref.columnWidth*this.fontSize}),this.defineBuiltInName(\"pref-horizontal\",function(){return this.pref.horizontal}),this.defineBuiltInName(\"pref-spread-view\",function(){return this.pref.spreadView}),this.defineBuiltInName(\"pub-title\",function(){return Pl(this.pubTitle?this.pubTitle:\"\")}),this.defineBuiltInName(\"doc-title\",function(){return Pl(this.docTitle?this.docTitle:\"\")})}}defineBuiltInName(t,e){this.values[t]=new oe(this,e,t)}defineName(t,e){this.values[t]=e}defineFunc(t,e){this.funcs[t]=e}defineBuiltIn(t,e){this.builtIns[t]=e}};function Vp(r){switch(r==null?void 0:r.toLowerCase()){case\"px\":case\"in\":case\"pt\":case\"pc\":case\"cm\":case\"mm\":case\"q\":return!0;default:return!1}}function Ll(r){switch(r==null?void 0:r.toLowerCase()){case\"vw\":case\"vh\":case\"vi\":case\"vb\":case\"vmin\":case\"vmax\":case\"pvw\":case\"pvh\":case\"pvi\":case\"pvb\":case\"pvmin\":case\"pvmax\":return!0;default:return!1}}function Fp(r){switch(r==null?void 0:r.toLowerCase()){case\"em\":case\"ex\":case\"rem\":case\"lh\":case\"rlh\":return!0;default:return!1}}function Bp(r){switch(r==null?void 0:r.toLowerCase()){case\"rem\":case\"rlh\":return!0;default:return!1}}var $={px:1,in:96,pt:4/3,pc:96/6,cm:96/2.54,mm:96/25.4,q:96/2.54/40,em:16,rem:16,ex:8,lh:20,rlh:20,dppx:1,dpi:1/96,dpcm:2.54/96};function fr(r){switch(r){case\"q\":return!CSS.supports(\"font-size\",\"1q\");case\"lh\":return!CSS.supports(\"line-height\",\"1lh\");case\"rem\":case\"rlh\":return!0;default:return!1}}var _s=class{constructor(t,e,n,s){this.rootScope=t;this.viewportWidth=e;this.viewportHeight=n;d(this,\"actualPageWidth\",null);d(this,\"pageWidth\");d(this,\"actualPageHeight\",null);d(this,\"pageHeight\");d(this,\"initialFontSize\");d(this,\"rootFontSize\",null);d(this,\"isRelativeRootFontSize\",null);d(this,\"fontSize\");d(this,\"rootLineHeight\",null);d(this,\"pref\");d(this,\"scopes\",{});d(this,\"pageAreaWidth\",null);d(this,\"pageAreaHeight\",null);d(this,\"pageVertical\",null);d(this,\"pubTitle\",null);d(this,\"docTitle\",null);this.pageWidth=function(){return this.actualPageWidth?this.actualPageWidth:this.pref.spreadView?Math.floor(e/2)-this.pref.pageBorder:e},this.pageHeight=function(){return this.actualPageHeight?this.actualPageHeight:n},this.initialFontSize=s,this.fontSize=function(){return this.rootFontSize?this.rootFontSize:s},this.pref=Mg}getScopeContext(t){let e=this.scopes[t.scopeKey];return e||(e={},this.scopes[t.scopeKey]=e),e}clearScope(t){this.scopes[t.scopeKey]={};for(let e=0;e<t.children.length;e++)this.clearScope(t.children[e])}queryUnitSize(t,e,n){if(Ll(t)){let s=this.pageWidth()/100,o=this.pageHeight()/100,i=this.pageAreaWidth!=null?this.pageAreaWidth/100:s,a=this.pageAreaHeight!=null?this.pageAreaHeight/100:o,l=n!=null?n:this.pageVertical;switch(t){case\"vw\":return i;case\"vh\":return a;case\"vi\":return l?a:i;case\"vb\":return l?i:a;case\"vmin\":return i<a?i:a;case\"vmax\":return i>a?i:a;case\"pvw\":return s;case\"pvh\":return o;case\"pvi\":return l?o:s;case\"pvb\":return l?s:o;case\"pvmin\":return s<o?s:o;case\"pvmax\":return s>o?s:o}}return t==\"em\"||t==\"rem\"?e?this.initialFontSize:this.fontSize():t==\"ex\"?$.ex*(e?this.initialFontSize:this.fontSize())/$.em:t==\"lh\"||t==\"rlh\"?this.rootLineHeight:$[t]}evalName(t,e){do{let n=t.values[e];if(n||t.resolver&&(n=t.resolver.call(this,e,!1),n))return n;t=t.parent}while(t);throw new Error(`Name '${e}' is undefined`)}evalCall(t,e,n,s){do{let o=t.funcs[e];if(o||t.resolver&&(o=t.resolver.call(this,e,!0),o))return o;let i=t.builtIns[e];if(i){if(s)return t.zero;let a=Array(n.length);for(let l=0;l<n.length;l++)a[l]=n[l].evaluate(this);return new se(t,i.apply(this,a))}t=t.parent}while(t);throw new Error(`Function '${e}' is undefined`)}evalMediaName(t,e){let n=t===\"all\"||!!this.pref.enabledMediaTypes[t];return e?!n:n}evalMediaTest(t,e){let n=\"\",s=t.match(/^(min|max)-(.*)$/);s&&(n=s[1],t=s[2]);let o=null,i=null;switch(t){case\"width\":case\"height\":case\"device-width\":case\"device-height\":case\"color\":e&&(o=e.evaluate(this));break}switch(t){case\"width\":i=this.pageWidth();break;case\"height\":i=this.pageHeight();break;case\"device-width\":i=window.screen.availWidth;break;case\"device-height\":i=window.screen.availHeight;break;case\"color\":i=window.screen.pixelDepth;break}if(i!=null&&o!=null)switch(n){case\"min\":return i>=Number(o);case\"max\":return i<=Number(o);default:return i==o}else if(i!=null&&e==null)return i!==0;return!1}evalSupportsTest(t,e,n){return!1}queryVal(t,e){let n=t&&this.scopes[t.scopeKey];return n?n[e]:void 0}storeVal(t,e,n){this.getScopeContext(t)[e]=n}},rt=class{constructor(t){this.scope=t;d(this,\"key\");this.scope=t,this.key=`_${Ip++}`}toString(){let t=new je;return this.appendTo(t,0),t.toString()}appendTo(t,e){throw new Error(\"F_ABSTRACT\")}evaluateCore(t){throw new Error(\"F_ABSTRACT\")}expand(t,e){return this}dependCore(t,e,n){return t===this}dependOuter(t,e,n){let s=n[this.key];if(s!=null)return s===Rp.PENDING?!1:s;{n[this.key]=Rp.PENDING;let o=this.dependCore(t,e,n);return n[this.key]=o,o}}depend(t,e){return this.dependOuter(t,e,{})}evaluate(t){let e=t.queryVal(this.scope,this.key);return typeof e!=\"undefined\"||(e=this.evaluateCore(t),this.scope&&t.storeVal(this.scope,this.key,e)),e}isMediaName(){return!1}},er=class extends rt{constructor(e,n){super(e);this.val=n}getOp(){throw new Error(\"F_ABSTRACT\")}evalPrefix(e){throw new Error(\"F_ABSTRACT\")}evaluateCore(e){let n=this.val.evaluate(e);return this.evalPrefix(n)}dependCore(e,n,s){return e===this||this.val.dependOuter(e,n,s)}appendTo(e,n){10<n&&e.append(\"(\"),e.append(this.getOp()),this.val.appendTo(e,10),10<n&&e.append(\")\")}expand(e,n){let s=this.val.expand(e,n);return s===this.val?this:new this.constructor(this.scope,s)}},Us=class extends rt{constructor(e,n,s){super(e);this.lhs=n;this.rhs=s}getPriority(){throw new Error(\"F_ABSTRACT\")}getOp(){throw new Error(\"F_ABSTRACT\")}evalInfix(e,n){throw new Error(\"F_ABSTRACT\")}evaluateCore(e){let n=this.lhs.evaluate(e),s=this.rhs.evaluate(e);return this.evalInfix(n,s)}dependCore(e,n,s){return e===this||this.lhs.dependOuter(e,n,s)||this.rhs.dependOuter(e,n,s)}appendTo(e,n){let s=this.getPriority();s<=n&&e.append(\"(\"),this.lhs.appendTo(e,s),e.append(this.getOp()),this.rhs.appendTo(e,s),s<=n&&e.append(\")\")}expand(e,n){let s=this.lhs.expand(e,n),o=this.rhs.expand(e,n);return s===this.lhs&&o===this.rhs?this:new this.constructor(this.scope,s,o)}},tr=class extends Us{constructor(t,e,n){super(t,e,n)}getPriority(){return 1}},wn=class extends Us{constructor(t,e,n){super(t,e,n)}getPriority(){return 2}},nr=class extends Us{constructor(t,e,n){super(t,e,n)}getPriority(){return 3}},Bo=class extends Us{constructor(t,e,n){super(t,e,n)}getPriority(){return 4}},mt=class extends er{constructor(t,e){super(t,e)}getOp(){return\"!\"}evalPrefix(t){return!t}},sr=class extends mt{constructor(t,e){super(t,e)}getOp(){return\"not \"}},Oo=class extends er{constructor(t,e){super(t,e)}getOp(){return\"-\"}evalPrefix(t){return-t}},Hs=class extends tr{constructor(t,e,n){super(t,e,n)}getOp(){return\"&&\"}evaluateCore(t){return this.lhs.evaluate(t)&&this.rhs.evaluate(t)}},or=class extends Hs{constructor(t,e,n){super(t,e,n)}getOp(){return\" and \"}},zs=class extends tr{constructor(t,e,n){super(t,e,n)}getOp(){return\"||\"}evaluateCore(t){return this.lhs.evaluate(t)||this.rhs.evaluate(t)}},ir=class extends zs{constructor(t,e,n){super(t,e,n)}getOp(){return\", \"}},rr=class extends zs{constructor(t,e,n){super(t,e,n)}getOp(){return\" or \"}},ar=class extends wn{constructor(t,e,n){super(t,e,n)}getOp(){return\"<\"}evalInfix(t,e){return t<e}},lr=class extends wn{constructor(t,e,n){super(t,e,n)}getOp(){return\"<=\"}evalInfix(t,e){return t<=e}},cr=class extends wn{constructor(t,e,n){super(t,e,n)}getOp(){return\">\"}evalInfix(t,e){return t>e}},ns=class extends wn{constructor(t,e,n){super(t,e,n)}getOp(){return\">=\"}evalInfix(t,e){return t>=e}},Pn=class extends wn{constructor(t,e,n){super(t,e,n)}getOp(){return\"==\"}evalInfix(t,e){return t==e}},ur=class extends wn{constructor(t,e,n){super(t,e,n)}getOp(){return\"!=\"}evalInfix(t,e){return t!=e}},Do=class extends nr{constructor(t,e,n){super(t,e,n)}getOp(){return\"+\"}evalInfix(t,e){return t+e}},Mo=class extends nr{constructor(t,e,n){super(t,e,n)}getOp(){return\" - \"}evalInfix(t,e){return t-e}},ss=class extends Bo{constructor(t,e,n){super(t,e,n)}getOp(){return\"*\"}evalInfix(t,e){return t*e}},_o=class extends Bo{constructor(t,e,n){super(t,e,n)}getOp(){return\"/\"}evalInfix(t,e){return t/e}},Gs=class extends Bo{constructor(t,e,n){super(t,e,n)}getOp(){return\"%\"}evalInfix(t,e){return t%e}},at=class extends rt{constructor(e,n,s){var o;super(e);this.num=n;d(this,\"unit\");this.unit=(o=s==null?void 0:s.toLowerCase())!=null?o:\"\"}appendTo(e,n){e.append(this.num.toString()),e.append($t(this.unit))}evaluateCore(e){return this.num*e.queryUnitSize(this.unit,!1)}},le=class extends rt{constructor(e,n){super(e);this.qualifiedName=n}appendTo(e,n){e.append(this.qualifiedName)}evaluateCore(e){return e.evalName(this.scope,this.qualifiedName).evaluate(e)}dependCore(e,n,s){return e===this||n.evalName(this.scope,this.qualifiedName).dependOuter(e,n,s)}},Uo=class extends rt{constructor(e,n,s){super(e);this.not=n;this.name=s}appendTo(e,n){this.not&&e.append(\"not \"),e.append($t(this.name))}evaluateCore(e){return e.evalMediaName(this.name,this.not)}isMediaName(){return!0}},oe=class extends rt{constructor(e,n,s){super(e);this.fn=n;this.str=s}appendTo(e,n){e.append(this.str)}evaluateCore(e){return this.fn.call(e)}};function Ug(r,t){r.append(\"(\");for(let e=0;e<t.length;e++)e&&r.append(\",\"),t[e].appendTo(r,0);r.append(\")\")}function Hg(r,t,e){let n=t;for(let s=0;s<t.length;s++){let o=t[s].expand(r,e);if(t!==n)n[s]=o;else if(o!==t[s]){n=Array(t.length);for(let i=0;i<s;i++)n[i]=t[i];n[s]=o}}return n}var on=class r extends rt{constructor(e,n,s){super(e);this.qualifiedName=n;this.params=s}appendTo(e,n){e.append(this.qualifiedName),Ug(e,this.params)}evaluateCore(e){return e.evalCall(this.scope,this.qualifiedName,this.params,!1).expand(e,this.params).evaluate(e)}dependCore(e,n,s){if(e===this)return!0;for(let i=0;i<this.params.length;i++)if(this.params[i].dependOuter(e,n,s))return!0;return n.evalCall(this.scope,this.qualifiedName,this.params,!0).dependOuter(e,n,s)}expand(e,n){let s=Hg(e,this.params,n);return s===this.params?this:new r(this.scope,this.qualifiedName,s)}},dr=class r extends rt{constructor(e,n,s,o){super(e);this.cond=n;this.ifTrue=s;this.ifFalse=o}appendTo(e,n){n>0&&e.append(\"(\"),this.cond.appendTo(e,0),e.append(\"?\"),this.ifTrue.appendTo(e,0),e.append(\":\"),this.ifFalse.appendTo(e,0),n>0&&e.append(\")\")}evaluateCore(e){return this.cond.evaluate(e)?this.ifTrue.evaluate(e):this.ifFalse.evaluate(e)}dependCore(e,n,s){return e===this||this.cond.dependOuter(e,n,s)||this.ifTrue.dependOuter(e,n,s)||this.ifFalse.dependOuter(e,n,s)}expand(e,n){let s=this.cond.expand(e,n),o=this.ifTrue.expand(e,n),i=this.ifFalse.expand(e,n);return s===this.cond&&o===this.ifTrue&&i===this.ifFalse?this:new r(this.scope,s,o,i)}},se=class extends rt{constructor(e,n){super(e);this.val=n}appendTo(e,n){switch(typeof this.val){case\"number\":case\"boolean\":e.append(this.val.toString());break;case\"string\":e.append('\"'),e.append(es(this.val)),e.append('\"');break;default:throw new Error(\"F_UNEXPECTED_STATE\")}}evaluateCore(e){return this.val}},Ho=class r extends rt{constructor(e,n,s){super(e);this.name=n;this.value=s}appendTo(e,n){e.append(\"(\"),e.append(es(this.name.name)),e.append(\":\"),this.value.appendTo(e,0),e.append(\")\")}evaluateCore(e){return e.evalMediaTest(this.name.name,this.value)}dependCore(e,n,s){return e===this||this.value.dependOuter(e,n,s)}expand(e,n){let s=this.value.expand(e,n);return s===this.value?this:new r(this.scope,this.name,s)}},pr=class extends rt{constructor(e,n,s,o){super(e);this.name=n;this.value=s;this.isFunc=o}appendTo(e,n){this.isFunc&&e.append(this.name),e.append(\"(\"),!this.isFunc&&this.name&&(e.append(this.name),e.append(\":\")),e.append(this.value),e.append(\")\")}evaluateCore(e){return e.evalSupportsTest(this.name,this.value,this.isFunc)}},Ws=class extends rt{constructor(e,n){super(e);this.index=n}appendTo(e,n){e.append(\"$\"),e.append(this.index.toString())}expand(e,n){let s=n[this.index];if(!s)throw new Error(`Parameter missing: ${this.index}`);return s}};function Je(r,t,e){return t===r._false||t===r.zero||e==r._false||e==r.zero?r._false:t===r._true||t===r.one?e:e===r._true||e===r.one?t:new Hs(r,t,e)}function H(r,t,e){return t===r.zero?e:e===r.zero?t:new Do(r,t,e)}function K(r,t,e){return t===r.zero?new Oo(r,e):e===r.zero?t:new Mo(r,t,e)}function $s(r,t,e){return t===r.zero||e===r.zero?r.zero:t===r.one?e:e===r.one?t:new ss(r,t,e)}function Go(r,t,e){return t===r.zero?r.zero:e===r.one?t:new _o(r,t,e)}var lt=class{visitValues(t){for(let e=0;e<t.length;e++)t[e].visit(this);return null}visitEmpty(t){return null}visitSlash(t){return null}visitStr(t){return null}visitIdent(t){return null}visitNumeric(t){return null}visitNum(t){return null}visitInt(t){return this.visitNum(t)}visitHexColor(t){return null}visitURL(t){return null}visitURange(t){return null}visitSpaceList(t){return this.visitValues(t.values),null}visitCommaList(t){return this.visitValues(t.values),null}visitFunc(t){return this.visitValues(t.values),null}visitExpr(t){return null}},jt=class extends lt{constructor(){super();d(this,\"error\",!1)}visitValues(e){let n=null;for(let s=0;s<e.length;s++){let o=e[s],i=o.visit(this);if(this.error)return[];if(n)n[s]=i;else if(o!==i){n=new Array(e.length);for(let a=0;a<s;a++)n[a]=e[a];n[s]=i}}return n||e}visitEmpty(e){return e}visitStr(e){return e}visitIdent(e){return e}visitSlash(e){return e}visitNumeric(e){return e}visitNum(e){return e}visitInt(e){return e}visitHexColor(e){return e}visitURL(e){return e}visitURange(e){return e}visitSpaceList(e){let n=this.visitValues(e.values);return this.error?O:n===e.values?e:new q(n)}visitCommaList(e){let n=this.visitValues(e.values);return this.error?O:n===e.values?e:new ge(n)}visitFunc(e){let n=this.visitValues(e.values);return this.error?O:n===e.values?e:new Pt(e.name,n)}visitExpr(e){return e}},Se=class{toString(){let t=new je;return this.appendTo(t,!0),t.toString()}stringValue(){let t=new je;return this.appendTo(t,!1),t.toString()}toExpr(t,e){return null}appendTo(t,e){t.append(\"[error]\")}isExpr(){return!1}isNumeric(){return!1}isNum(){return!1}isIdent(){return!1}isSpaceList(){return!1}visit(t){return this}},gr=class gr extends Se{static get instance(){return this.empty||(this.empty=new gr),this.empty}constructor(){super()}toExpr(t,e){return new se(t,\"\")}appendTo(t,e){}visit(t){return t.visitEmpty(this)}};d(gr,\"empty\");var Rl=gr,O=Rl.instance,mr=class mr extends Se{static get instance(){return this.slash||(this.slash=new mr),this.slash}constructor(){super()}toExpr(t,e){return new se(t,\"/\")}appendTo(t,e){t.append(\"/\")}visit(t){return t.visitSlash(this)}};d(mr,\"slash\");var Il=mr,js=Il.instance,ce=class extends Se{constructor(e){super();this.str=e}toExpr(e,n){return new se(e,this.str)}appendTo(e,n){n?(e.append('\"'),e.append(es(this.str)),e.append('\"')):e.append(this.str)}visit(e){return e.visitStr(this)}},Vl={},Be=class extends Se{constructor(e){super();this.name=e;if(Vl[e])throw new Error(\"E_INVALID_CALL\");Vl[e]=this}toExpr(e,n){return new se(e,this.name)}appendTo(e,n){n?e.append($t(this.name)):e.append(this.name)}visit(e){return e.visitIdent(this)}isIdent(){return!0}};function L(r){let t=Vl[r];return t||(t=new Be(r)),t}var P=class extends Se{constructor(e,n){var s;super();this.num=e;d(this,\"unit\");this.unit=(s=n==null?void 0:n.toLowerCase())!=null?s:\"\"}toExpr(e,n){return this.num==0?e.zero:n&&this.unit==\"%\"?this.num==100?n:new ss(e,n,new se(e,this.num/100)):new at(e,this.num,this.unit)}appendTo(e,n){e.append(this.num.toString()),e.append(this.unit)}visit(e){return e.visitNumeric(this)}isNumeric(){return!0}},et=class extends Se{constructor(e){super();this.num=e}toExpr(e,n){return this.num==0?e.zero:this.num==1?e.one:new se(e,this.num)}appendTo(e,n){e.append(this.num.toString())}visit(e){return e.visitNum(this)}isNum(){return!0}},ct=class extends et{constructor(t){super(t)}visit(t){return t.visitInt(this)}},Xs=class extends Se{constructor(e){super();this.hex=e}appendTo(e,n){e.append(\"#\"),e.append(this.hex)}visit(e){return e.visitHexColor(this)}},Ue=class extends Se{constructor(e){super();this.url=e}appendTo(e,n){e.append('url(\"'),e.append(es(this.url)),e.append('\")')}visit(e){return e.visitURL(this)}},Wo=class extends Se{constructor(e){super();this.urangeText=e}appendTo(e,n){e.append(this.urangeText)}visit(e){return e.visitURange(this)}};function Fl(r,t,e,n){var o,i;let s=t.length;if(s>0){(o=t[0])==null||o.appendTo(r,n);for(let a=1;a<s;a++)r.append(e),(i=t[a])==null||i.appendTo(r,n)}}var q=class extends Se{constructor(e){super();this.values=e}appendTo(e,n){Fl(e,this.values,\" \",n)}visit(e){return e.visitSpaceList(this)}isSpaceList(){return!0}},ge=class extends Se{constructor(e){super();this.values=e}appendTo(e,n){Fl(e,this.values,\",\",n)}visit(e){return e.visitCommaList(this)}},Pt=class extends Se{constructor(e,n){super();this.name=e;this.values=n}appendTo(e,n){e.append($t(this.name)),e.append(\"(\"),Fl(e,this.values,\",\",n),e.append(\")\")}visit(e){return e.visitFunc(this)}},F=class extends Se{constructor(e){super();this.expr=e}toExpr(){return this.expr}appendTo(e,n){this.expr instanceof se||this.expr instanceof at?this.expr.appendTo(e,0):(e.append(\"-epubx-expr(\"),this.expr.appendTo(e,0),e.append(\")\"))}visit(e){return e.visitExpr(this)}isExpr(){return!0}},kn=class extends Se{constructor(e){super();this.text=e}appendTo(e,n){e.append(this.text||\" \")}};function Ae(r,t){if(r){if(r.isNumeric()){let e=r;return t.queryUnitSize(e.unit,!1)*e.num}if(r.isNum())return r.num}return 0}function Cr(r,t){return new P(Ae(r,t),\"px\")}var x={absolute:L(\"absolute\"),all:L(\"all\"),always:L(\"always\"),anywhere:L(\"anywhere\"),auto:L(\"auto\"),avoid:L(\"avoid\"),balance:L(\"balance\"),balance_all:L(\"balance-all\"),block:L(\"block\"),block_end:L(\"block-end\"),block_start:L(\"block-start\"),both:L(\"both\"),bottom:L(\"bottom\"),border_box:L(\"border-box\"),break_all:L(\"break-all\"),break_word:L(\"break-word\"),clip:L(\"clip\"),crop:L(\"crop\"),cross:L(\"cross\"),column:L(\"column\"),discard:L(\"discard\"),exclusive:L(\"exclusive\"),_false:L(\"false\"),fixed:L(\"fixed\"),flex:L(\"flex\"),flow_root:L(\"flow-root\"),footnote:L(\"footnote\"),footer:L(\"footer\"),grid:L(\"grid\"),header:L(\"header\"),hidden:L(\"hidden\"),horizontal_tb:L(\"horizontal-tb\"),inherit:L(\"inherit\"),initial:L(\"initial\"),inline:L(\"inline\"),inline_block:L(\"inline-block\"),inline_end:L(\"inline-end\"),inline_start:L(\"inline-start\"),keep:L(\"keep\"),landscape:L(\"landscape\"),left:L(\"left\"),line:L(\"line\"),list_item:L(\"list-item\"),ltr:L(\"ltr\"),manual:L(\"manual\"),max_content:L(\"max-content\"),min_content:L(\"min-content\"),none:L(\"none\"),normal:L(\"normal\"),oeb_page_foot:L(\"oeb-page-foot\"),oeb_page_head:L(\"oeb-page-head\"),padding_box:L(\"padding-box\"),page:L(\"page\"),relative:L(\"relative\"),revert:L(\"revert\"),right:L(\"right\"),same:L(\"same\"),scale:L(\"scale\"),snap_block:L(\"snap-block\"),snap_inline:L(\"snap-inline\"),solid:L(\"solid\"),spread:L(\"spread\"),_static:L(\"static\"),rtl:L(\"rtl\"),table:L(\"table\"),table_caption:L(\"table-caption\"),table_cell:L(\"table-cell\"),table_footer_group:L(\"table-footer-group\"),table_header_group:L(\"table-header-group\"),table_row:L(\"table-row\"),top:L(\"top\"),transparent:L(\"transparent\"),unset:L(\"unset\"),vertical_lr:L(\"vertical-lr\"),vertical_rl:L(\"vertical-rl\"),visible:L(\"visible\"),_true:L(\"true\")},Bl=new P(100,\"%\"),rn=new P(100,\"pvw\"),an=new P(100,\"pvh\"),X=new P(0,\"px\"),Dp=new Wo(\"U+0-10FFFF\"),Op={\"font-size\":1,\"line-height\":2,color:3};function U(r){return r===x.inherit||r===x.initial||r===x.revert||r===x.unset}function Ol(r,t){let e=Op[r]||Number.MAX_VALUE,n=Op[t]||Number.MAX_VALUE;return e-n}function bt(r){return(r==null?void 0:r.length)>2&&r.startsWith(\"--\")}var He=class{constructor(t,e,n,s){this.x1=t;this.y1=e;this.x2=n;this.y2=s}},Ft=class{constructor(t,e){this.x=t;this.y=e}},Ks=class{constructor(t,e,n,s){this.left=t;this.top=e;this.right=n;this.bottom=s}},br=class{constructor(t,e,n,s){this.low=t;this.high=e;this.winding=n;this.shapeId=s}},Bt=class{constructor(t,e,n,s){this.y1=t;this.y2=e;this.x1=n;this.x2=s;d(this,\"left\",null);d(this,\"right\",null)}};function zg(r,t){return r.low.y-t.low.y||r.low.x-t.low.x}var os=class r{constructor(t){this.points=t}addSegments(t,e){let n=this.points,s=n.length,o=n[s-1];for(let i=0;i<s;i++){let a=n[i],l;o.y<a.y?l=new br(o,a,1,e):l=new br(a,o,-1,e),t.push(l),o=a}}withOffset(t,e){let n=[];for(let s of this.points)n.push(new Ft(s.x+t,s.y+e));return new r(n)}};function Dl(r,t,e,n){let o=[];for(let i=0;i<20;i++){let a=i*2*Math.PI/20;o.push(new Ft(r+e*Math.sin(a),t+n*Math.cos(a)))}return new os(o)}function $o(r,t,e,n){return new os([new Ft(r,t),new Ft(e,t),new Ft(e,n),new Ft(r,n)])}var Ys=class{constructor(t,e,n,s){this.x=t;this.winding=e;this.shapeId=n;this.lowOrHigh=s}};function Mp(r,t){let e=r.low.x+(r.high.x-r.low.x)*(t-r.low.y)/(r.high.y-r.low.y);if(isNaN(e))throw new Error(\"Bad intersection\");return e}function Gg(r,t,e,n){let s,o,i,a;t.high.y<e&&V.warn(\"Error: inconsistent segment (1)\"),t.low.y<=e?(s=Mp(t,e),o=t.winding):(s=t.low.x,o=0),t.high.y>=n?(i=Mp(t,n),a=t.winding):(i=t.high.x,a=0),s<i?(r.push(new Ys(s,o,t.shapeId,-1)),r.push(new Ys(i,a,t.shapeId,1))):(r.push(new Ys(i,a,t.shapeId,-1)),r.push(new Ys(s,o,t.shapeId,1)))}function Wg(r,t,e){let n=t+e,s=Array(n),o=Array(n),i;for(i=0;i<=n;i++)s[i]=0,o[i]=0;let a=[],l=!1,c=r.length;for(let u=0;u<c;u++){let p=r[u];s[p.shapeId]+=p.winding,o[p.shapeId]+=p.lowOrHigh;let h=!1;for(i=0;i<t;i++)if(s[i]&&!o[i]){h=!0;break}if(h){for(i=t;i<=n;i++)if(s[i]||o[i]){h=!1;break}}l!=h&&(a.push(p.x),l=h)}return a}function $g(r,t){return t?Math.ceil(r/t)*t:r}function _p(r,t){return t?Math.floor(r/t)*t:r}function Xg(r){return new Ft(r.y,-r.x)}function qs(r){return new He(r.y1,-r.x2,r.y2,-r.x1)}function yr(r){return new He(-r.y2,r.x1,-r.y1,r.x2)}function Up(r){return new os(r.points.map(t=>Xg(t)))}function Hp(r,t,e,n,s,o){o&&(r=qs(r),t=t.map(b=>Up(b)),e=e.map(b=>Up(b)));let i=t.length,a=e?e.length:0,l=[],c=[],u,p,h;for(u=0;u<i;u++)t[u].addSegments(c,u);for(u=0;u<a;u++)e[u].addSegments(c,u+i);let f=c.length;c.sort(zg);let g=0;for(;c[g].shapeId>=i;)g++;let m=c[g].low.y;m>r.y1&&l.push(new Bt(r.y1,m,r.x2,r.x2));let E=0,C=[];for(;E<f&&(h=c[E]).low.y<m;)h.high.y>m&&C.push(h),E++;for(;E<f||C.length>0;){let b=r.y2,y=Math.min($g(Math.ceil(m+n),s),r.y2);for(p=0;p<C.length&&b>y;p++)h=C[p],h.low.x==h.high.x?h.high.y<b&&(b=Math.max(_p(h.high.y,s),y)):h.low.x!=h.high.x&&(b=y);for(b>r.y2&&(b=r.y2);E<f&&(h=c[E]).low.y<b;){if(h.high.y<m){E++;continue}if(h.low.y<y)h.low.y==h.high.y&&h.low.y==m||(C.push(h),b=y),E++;else{let w=_p(h.low.y,s);w<b&&(b=w);break}}let N=[];for(p=0;p<C.length;p++)Gg(N,C[p],m,b);N.sort((w,A)=>w.x-A.x||w.lowOrHigh-A.lowOrHigh);let S=Wg(N,i,a);if(S.length==0)l.push(new Bt(m,b,r.x2,r.x2));else{let w=0,A=r.x1;for(p=0;p<S.length;p+=2){let I=Math.max(r.x1,S[p]),_=Math.min(r.x2,S[p+1])-I;_>w&&(w=_,A=I)}w==0?l.push(new Bt(m,b,r.x2,r.x2)):l.push(new Bt(m,b,Math.max(A,r.x1),Math.min(A+w,r.x2)))}if(b==r.y2)break;for(m=b,p=C.length-1;p>=0;p--)C[p].high.y<=b&&C.splice(p,1)}return zp(r,l),l}function zp(r,t){let e=t.length-1,n=new Bt(r.y2,r.y2,r.x1,r.x2);for(;e>=0;){let s=n;n=t[e],(n.y2-n.y1<1||n.x1==s.x1&&n.x2==s.x2)&&(s.y1=n.y1,t.splice(e,1),n=s),e--}}function Gp(r,t){let e=0,n=r.length;for(;e<n;){let s=Math.floor((e+n)/2);t>=r[s].y2?e=s+1:n=s}return e}function Wp(r,t){if(!r.length)return t;let e=t.y1,n,s;for(s=0;s<r.length&&(n=r[s],!(n.y2>t.y1&&n.x1-.1<=t.x1&&n.x2+.1>=t.x2));s++)e=Math.max(e,n.y2);let o=e;for(;s<r.length&&(n=r[s],!(n.y1>=t.y2||n.x1-.1>t.x1||n.x2+.1<t.x2));s++)o=n.y2;return s===r.length?o=t.y2:o=Math.min(o,t.y2),o<=e?null:new He(t.x1,e,t.x2,o)}function $p(r,t){if(!r.length)return t;let e=t.y2,n,s;for(s=r.length-1;s>=0&&(n=r[s],!(s===r.length-1&&n.y2<t.y2));s--){if(n.y1<t.y2&&n.x1-.1<=t.x1&&n.x2+.1>=t.x2)break;e=Math.min(e,n.y1)}let o=Math.min(e,n.y2);for(;s>=0&&(n=r[s],!(n.y2<=t.y1||n.x1-.1>t.x1||n.x2+.1<t.x2));s--)o=n.y1;return o=Math.max(o,t.y1),e<=o?null:new He(t.x1,o,t.x2,e)}function Xp(r,t,e,n){let s=e.y1,o=e.x2-e.x1,i=e.y2-e.y1,a=Gp(t,s);for(;;){let l=s+i;if(l>r.y2)return!1;let c=r.x1,u=r.x2;for(let p=a;p<t.length&&t[p].y1<l;p++){let h=t[p];h.x1>c&&(c=h.x1),h.x2<u&&(u=h.x2)}if(c+o<=u||a>=t.length)return n==\"left\"?(e.x1=c,e.x2=c+o):(e.x1=u-o,e.x2=u),e.y2+=s-e.y1,e.y1=s,!0;s=t[a].y2,a++}}function jp(r,t,e,n,s){for(n||(n=[new Bt(e.y1,e.y2,e.x1,e.x2)]);n.length>0&&n[0].y2<=r.y1;)n.shift();if(n.length==0)return;n[0].y1<r.y1&&(n[0].y1=r.y1);let o,i=t.length==0?r.y1:t[t.length-1].y2;i<r.y2&&t.push(new Bt(i,r.y2,r.x1,r.x2));let a=Gp(t,n[0].y1);for(let l of n){if(a==t.length)break;for(t[a].y1<l.y1&&(o=t[a],a++,t.splice(a,0,new Bt(l.y1,o.y2,o.x1,o.x2)),o.y2=l.y1);a<t.length&&(o=t[a++],o.y2>l.y2&&(t.splice(a,0,new Bt(l.y2,o.y2,o.x1,o.x2)),o.y2=l.y2),l.x1!=l.x2&&(s==\"left\"?o.x1=Math.min(l.x2,r.x2):o.x2=Math.max(l.x1,r.x1)),o.y2!=l.y2););}zp(r,t)}var Ml=class extends lt{constructor(){super();d(this,\"propSet\",{})}visitIdent(e){return this.propSet[e.name]=!0,e}visitSpaceList(e){return this.visitValues(e.values),e}};function Yp(r){if(r){let t=new Ml;try{return r.visit(t),t.propSet}catch(e){V.warn(e,\"toSet:\")}}return{}}var _l=class extends lt{constructor(e){super();this.value=e}visitInt(e){return this.value=e.num,e}};function zl(r,t){if(r){let e=new _l(t);try{return r.visit(e),e.value}catch(n){V.warn(n,\"toInt: \")}}return t}var Ul=class extends lt{constructor(){super();d(this,\"collect\",!1);d(this,\"coords\",[]);d(this,\"name\",null)}visitNumeric(e){return this.collect&&this.coords.push(e),null}visitNum(e){return this.collect&&e.num==0&&this.coords.push(new P(0,\"px\")),null}visitSpaceList(e){return this.visitValues(e.values),null}visitFunc(e){return this.collect||(this.collect=!0,this.visitValues(e.values),this.collect=!1,this.name=e.name.toLowerCase()),null}getShape(e,n,s,o,i){if(this.coords.length>0){let a=[];switch(this.coords.forEach((l,c)=>{if(l.unit==\"%\"){let u=c%2==0?s:o;c==3&&this.name==\"circle\"&&(u=Math.sqrt((s*s+o*o)/2)),a.push(l.num*u/100)}else a.push(l.num*i.queryUnitSize(l.unit,!1))}),this.name){case\"polygon\":if(a.length%2==0){let l=[];for(let c=0;c<a.length;c+=2)l.push(new Ft(e+a[c],n+a[c+1]));return new os(l)}break;case\"rectangle\":if(a.length==4)return $o(e+a[0],n+a[1],e+a[0]+a[2],n+a[1]+a[3]);break;case\"ellipse\":if(a.length==4)return Dl(e+a[0],n+a[1],a[2],a[3]);break;case\"circle\":if(a.length==3)return Dl(e+a[0],n+a[1],a[2],a[2]);break}}return null}};function Sr(r,t,e,n,s,o){if(r){let i=new Ul;try{return r.visit(i),i.getShape(t,e,n,s,o)}catch(a){V.warn(a,\"toShape:\")}}return $o(t,e,t+n,e+s)}var Hl=class extends lt{constructor(e){super();this.reset=e;d(this,\"counters\",{});d(this,\"name\",null)}visitIdent(e){return this.name=e.toString(),this.reset?this.counters[this.name]=0:this.counters[this.name]=(this.counters[this.name]||0)+1,e}visitInt(e){return this.name&&(this.counters[this.name]+=e.num-(this.reset?0:1)),e}visitSpaceList(e){return this.visitValues(e.values),e}};function is(r,t){let e=new Hl(t);try{r.visit(e)}catch(n){V.warn(n,\"toCounters:\")}return e.counters}var Er=class extends jt{constructor(e,n){super();this.baseUrl=e;this.transformer=n}visitURL(e){return new Ue(this.transformer.transformURL(e.url,this.baseUrl))}};function Gl(r){let t={};return Object.keys(r).forEach(e=>{t[e]=Array.from(r[e])}),t}var jl=class{constructor(t,e){this.targetId=t;this.resolved=e;d(this,\"pageCounters\",null);d(this,\"spineIndex\",-1);d(this,\"pageIndex\",-1)}equals(t){return this===t?!0:t?this.targetId===t.targetId&&this.resolved===t.resolved&&this.spineIndex===t.spineIndex&&this.pageIndex===t.pageIndex:!1}isResolved(){return this.resolved}resolve(){this.resolved=!0}unresolve(){this.resolved=!1}},Yl=class{constructor(t,e){this.counterStore=t;this.baseURL=e}countersOfId(t,e){t=this.counterStore.documentURLTransformer.transformFragment(t,this.baseURL),this.counterStore.countersById[t]=e}getExprContentListener(){return this.counterStore.getExprContentListener()}},Kl=class{constructor(t,e,n,s){this.counterStore=t;this.baseURL=e;this.rootScope=n;this.pageScope=s;d(this,\"styler\",null);d(this,\"namedStringValues\",{});d(this,\"runningElements\",{})}setStyler(t){this.styler=t}getFragment(t){let e=t.match(/^[^#]*#(.*)$/);return e?e[1]:null}getTransformedId(t){let e=this.counterStore.documentURLTransformer.transformURL(J(t,this.baseURL),this.baseURL);return e.charAt(0)===\"#\"&&(e=e.substring(1)),e}getPageCounterVal(t,e){let n=()=>{let i=this.counterStore.currentPageCounters[t];return i&&i.length?i[i.length-1]:null},s=new oe(this.pageScope,()=>e(n()),`page-counter-${t}`),o=i=>e(i[i.length-1]);return this.counterStore.registerPageCounterExpr(t,o,s),s}getPageCountersVal(t,e){let n=()=>this.counterStore.currentPageCounters[t]||[],s=new oe(this.pageScope,()=>e(n()),`page-counters-${t}`);return this.counterStore.registerPageCounterExpr(t,e,s),s}getTargetCounters(t,e,n){let s=this.counterStore.countersById[e];return!s&&n&&t&&(this.styler.styleUntilIdIsReached(t),s=this.counterStore.countersById[e]),s||null}getTargetPageCounters(t){return this.counterStore.currentPage.elementsById[t]?this.counterStore.currentPageCounters:this.counterStore.pageCountersById[t]||null}getTargetCounterVal(t,e,n){let s=this.getFragment(t),o=this.getTransformedId(t),i=this.getTargetCounters(s,o,!1);if(i&&i[e]){let l=i[e];return new se(this.rootScope,n(l[l.length-1]||null))}let a=new oe(this.pageScope,()=>{if(i=this.getTargetCounters(s,o,!0),i)if(i[e]){let l=i[e];return n(l[l.length-1]||null)}else{let l=this.getTargetPageCounters(o);if(l)if(this.counterStore.resolveReference(o),l[e]){let c=l[e];return n(c[c.length-1]||null)}else return n(0);else return this.counterStore.saveReferenceOfCurrentPage(o,!1),\"??\"}else return this.counterStore.saveReferenceOfCurrentPage(o,!1),\"??\"},`target-counter-${e}-of-${t}`);return this.counterStore.registerTargetCounterExpr(e,n,a,o),a}getTargetCountersVal(t,e,n){let s=this.getFragment(t),o=this.getTransformedId(t);return new oe(this.pageScope,()=>{let i=this.getTargetPageCounters(o);if(i){this.counterStore.resolveReference(o);let a=i[e]||[],c=this.getTargetCounters(s,o,!0)[e]||[];return n(a.concat(c))}else return this.counterStore.saveReferenceOfCurrentPage(o,!1),\"??\"},`target-counters-${e}-of-${t}`)}getNamedStringVal(t,e){return new oe(this.pageScope,()=>this.getRunningValue(this.namedStringValues,t,e),`named-string-${e}-${t}`)}getRunningElementVal(t,e){return new oe(this.pageScope,()=>this.getRunningValue(this.runningElements,t,e),`running-element-${e}-${t}`)}getRunningValue(t,e,n){let s=t[e];if(!s)return\"\";let o=Object.keys(s).map(g=>parseInt(g,10)).sort(Ki),i=this.counterStore.currentPage,a=i.isBlankPage?i.offset-1:i.offset,l=i.isBlankPage?a:Math.max(a,...Array.from(i.container.querySelectorAll(`[${Vt}]`)).map(g=>parseInt(g.getAttribute(Vt),10))),c=-1,u=-1,p=-1,h=-1;for(let g=0;g<o.length;g++){let m=o[g],E=g>0?o[g-1]:-1,C=g<o.length-1?o[g+1]:-1;if(m>l)break;if(m>=a){if(c<0&&(c=m,h=-1),u<0)if(m===a)u=m;else{E<c&&(u=E);let b=i.container.querySelector(`[${Vt}=\"${m}\"]`);if(!b)u<0&&(u=m);else{let y=i.container.querySelector(`[${Vt}=\"${a}\"]`);if(y||(y=i.container.querySelector(`[${Vt}=\"0\"]`)),y){for(let N=y;N;N=N.firstElementChild)if(N===b){u=m;break}}}}p=m}else(C>l||C<0)&&(c=u=p=h=m)}return s[{first:c,start:u,last:p,\"first-except\":h}[n]]||\"\"}setNamedString(t,e,n){let s=this.namedStringValues[t]||(this.namedStringValues[t]={});s[n]=e}setRunningElement(t,e){let n=this.runningElements[t]||(this.runningElements[t]={});n[e]=String(e)}},Nr=class{constructor(t){this.documentURLTransformer=t;d(this,\"countersById\",{});d(this,\"pageCountersById\",{});d(this,\"currentPageCounters\",{});d(this,\"previousPageCounters\",{});d(this,\"currentPageCountersStack\",[]);d(this,\"pageIndicesById\",{});d(this,\"currentPage\",null);d(this,\"newReferencesOfCurrentPage\",[]);d(this,\"referencesToSolve\",[]);d(this,\"referencesToSolveStack\",[]);d(this,\"unresolvedReferences\",{});d(this,\"resolvedReferences\",{});d(this,\"pagesCounterExprs\",[]);d(this,\"pageCounterExprs\",[]);d(this,\"targetCounterExprs\",[]);this.currentPageCounters.page=[0]}createCounterListener(t){return new Yl(this,t)}createCounterResolver(t,e,n){return new Kl(this,t,e,n)}setCurrentPage(t){this.currentPage=t}definePageCounter(t,e){this.currentPageCounters[t]?this.currentPageCounters[t].push(e):this.currentPageCounters[t]=[e]}forceSetPageCounter(t){let e=this.currentPageCounters.page;!e||!e.length?this.currentPageCounters.page=[t]:e[e.length-1]=t}updatePageCounters(t,e){this.previousPageCounters=Gl(this.currentPageCounters);let n,s=t[\"counter-reset\"];if(s){let a=s.evaluate(e);a&&(n=is(a,!0))}if(n)for(let a in n)this.definePageCounter(a,n[a]);let o,i=t[\"counter-increment\"];if(i){let a=i.evaluate(e);a&&(o=is(a,!1))}o?\"page\"in o||(o.page=1):(o={},o.page=1);for(let a in o){this.currentPageCounters[a]||this.definePageCounter(a,0);let l=this.currentPageCounters[a];l[l.length-1]+=o[a]}}pushPageCounters(t){this.currentPageCountersStack.push(this.currentPageCounters),this.currentPageCounters=Gl(t)}popPageCounters(){this.currentPageCounters=this.currentPageCountersStack.pop()}resolveReference(t){let e=this.unresolvedReferences[t],n=this.resolvedReferences[t];n||(n=this.resolvedReferences[t]=[]);let s=!1;for(let o=0;o<this.referencesToSolve.length;){let i=this.referencesToSolve[o];if(i.targetId===t){if(i.resolve(),this.referencesToSolve.splice(o,1),e){let a=e.indexOf(i);a>=0&&e.splice(a,1)}n.push(i),s=!0}else o++}s||this.saveReferenceOfCurrentPage(t,!0)}saveReferenceOfCurrentPage(t,e){if(!this.newReferencesOfCurrentPage.some(n=>n.targetId===t)){let n=new jl(t,e);this.newReferencesOfCurrentPage.push(n)}}finishPage(t,e){let n=Object.keys(this.currentPage.elementsById);if(n.length>0){let i=Gl(this.currentPageCounters);n.forEach(a=>{this.pageCountersById[a]=i;let l=this.pageIndicesById[a];if(l&&l.pageIndex<e){let c=this.resolvedReferences[a];if(c){let u=this.unresolvedReferences[a];u||(u=this.unresolvedReferences[a]=[]);let p;for(;p=c.shift();)p.unresolve(),u.push(p)}}this.pageIndicesById[a]={spineIndex:t,pageIndex:e}})}let s=this.previousPageCounters,o;for(;o=this.newReferencesOfCurrentPage.shift();){o.pageCounters=s,o.spineIndex=t,o.pageIndex=e;let i;o.isResolved()?(i=this.resolvedReferences[o.targetId],i||(i=this.resolvedReferences[o.targetId]=[])):(i=this.unresolvedReferences[o.targetId],i||(i=this.unresolvedReferences[o.targetId]=[])),i.every(a=>!o.equals(a))&&i.push(o)}this.currentPage=null}getUnresolvedRefsToPage(t){let e=[];Object.keys(t.elementsById).forEach(i=>{let a=this.unresolvedReferences[i];a&&(e=e.concat(a))}),e.sort((i,a)=>i.spineIndex-a.spineIndex||i.pageIndex-a.pageIndex);let s=[],o=null;return e.forEach(i=>{!o||o.spineIndex!==i.spineIndex||o.pageIndex!==i.pageIndex?(o={spineIndex:i.spineIndex,pageIndex:i.pageIndex,pageCounters:i.pageCounters,refs:[i]},s.push(o)):o.refs.push(i)}),s}pushReferencesToSolve(t){this.referencesToSolveStack.push(this.referencesToSolve),this.referencesToSolve=t}popReferencesToSolve(){this.referencesToSolve=this.referencesToSolveStack.pop()}registerPageCounterExpr(t,e,n){t===\"pages\"?this.pagesCounterExprs.push({expr:n,format:e}):this.pageCounterExprs.push({expr:n,format:e})}registerTargetCounterExpr(t,e,n,s){this.targetCounterExprs.push({name:t,expr:n,format:e,transformedId:s})}getExprContentListener(){return this.exprContentListener.bind(this)}exprContentListener(t,e,n){if(t instanceof oe){if(t.str==\"viv-leader\"){let i=n.createElementNS(\"http://www.w3.org/1999/xhtml\",\"span\");return i.textContent=e,i.setAttribute(\"data-viv-leader\",t.key),i.setAttribute(\"data-viv-leader-value\",e),i}else if(t.str.startsWith(\"running-element-\")){let i=e&&n.querySelectorAll(`[${Vt}=\"${e}\"]`);if(!i||i.length===0)return null;let l=i[i.length-1].cloneNode(!0);return this.fixPageCounterInRunningElement(l),l.style.position=\"\",l.style.visibility=\"\",l}else if(t.str.startsWith(\"target-counter-\")){let i=n.createElementNS(\"http://www.w3.org/1999/xhtml\",\"span\");return i.textContent=e,i.setAttribute(Xl,t.key),i}}let s=this.pagesCounterExprs.findIndex(i=>i.expr===t)>=0,o=!s&&this.pageCounterExprs.findIndex(i=>i.expr===t)>=0;if(s||o){let i=n.createElementNS(\"http://www.w3.org/1999/xhtml\",\"span\");return i.textContent=e,i.setAttribute(s?Wl:$l,t.key),i}else return null}fixPageCounterInRunningElement(t){let e=t.querySelectorAll(`[${$l}]`);for(let s of e){let o=s.getAttribute($l),i=this.pageCounterExprs.find(u=>u.expr.key===o),a=(i==null?void 0:i.expr).str,l=a==null?void 0:a.replace(/^page-counters?-/,\"\"),c=this.currentPageCounters[l];c&&(s.textContent=i.format(c))}let n=t.querySelectorAll(`[${Xl}]`);for(let s of n)s.setAttribute(Kp,!0)}finishLastPage(t){let e=t.root.querySelectorAll(`[${Wl}]`),n=t.contentContainer.childElementCount;for(let o of e){let i=o.getAttribute(Wl),a=this.pagesCounterExprs.findIndex(l=>l.expr.key===i);a>=0,o.textContent=this.pagesCounterExprs[a].format([n])}let s=t.root.querySelectorAll(`[${Kp}]`);for(let o of s){let i=o.getAttribute(Xl),a=this.targetCounterExprs.find(l=>l.expr.key===i);if(a&&a.transformedId){let l=this.pageCountersById[a.transformedId];if(l){let c=l[a.name];c&&(o.textContent=a.format(c[c.length-1]))}}}}createLayoutConstraint(t){return new ql(this,t)}},Wl=\"data-vivliostyle-pages-counter\",$l=\"data-vivliostyle-page-counter\",Xl=\"data-vivliostyle-target-counter\",Kp=\"data-vivliostyle-target-counter-in-running\",ql=class{constructor(t,e){this.counterStore=t;this.pageIndex=e}allowLayout(t){if(!t||t.after)return!0;let e=t.viewNode;if(!e||e.nodeType!==1)return!0;let n=e.getAttribute(\"data-vivliostyle-id\")||e.getAttribute(\"id\")||e.getAttribute(\"name\");if(!n||!this.counterStore.resolvedReferences[n]&&!this.counterStore.unresolvedReferences[n])return!0;let s=this.counterStore.pageIndicesById[n];return s?this.pageIndex>=s.pageIndex:!0}};function Yg(r){if(r=r.substr(1),r.match(/^[^0-9a-fA-F\\n\\r]$/))return r;let t=parseInt(r,16);return isNaN(t)?\"\":t===0||t>=55296&&t<=57343||t>1114111?\"\\uFFFD\":String.fromCodePoint(t)}function rs(r){return r.replace(/\\\\([0-9a-fA-F]{1,6}(\\r\\n|[ \\n\\r\\t\\f])?|[^0-9a-fA-F\\n\\r])/g,Yg)}var Ql=class{constructor(){d(this,\"type\");d(this,\"precededBySpace\",!1);d(this,\"num\",0);d(this,\"text\",\"\");d(this,\"position\",0);this.type=0}toString(){switch(this.type){case 10:return\"(\";case 11:return\")\";case 12:return\"{\";case 13:return\"}\";case 14:return\"[\";case 15:return\"]\";case 16:return\",\";case 17:return\";\";case 18:return\":\";case 19:return\"/\";case 21:return\"%\";case 22:return\"?\";case 23:return\"+\";case 24:return\"-\";case 25:return\"||\";case 26:return\"&&\";case 31:return\"!\";case 32:return\"$\";case 33:return\"^\";case 34:return\"|\";case 35:return\"~\";case 36:return\"*\";case 37:return\">\";case 38:return\"<\";case 39:return\"=\";case 41:return\"!=\";case 42:return\"$=\";case 43:return\"^=\";case 44:return\"|=\";case 45:return\"~=\";case 46:return\"*=\";case 47:return\">=\";case 48:return\"<=\";case 49:return\"==\";case 50:return\"::\";case 51:return\"<!--\";case 52:return\"-->\";case 3:return this.num.toString()+this.text;case 4:case 5:return this.num.toString();case 20:return\"@\"+this.text;case 7:return\"#\"+this.text;case 6:return this.text+\"(\";case 9:return\".\"+this.text;case 0:return\"/*EOF*/\";default:return this.text}}};function Pe(r,t){let e=Array(128),n;for(n=0;n<128;n++)e[n]=r;for(e[NaN]=r==35?35:72,n=0;n<t.length;n+=2)e[t[n]]=t[n+1];return e}var ln=[72,72,72,72,72,72,72,72,72,1,1,72,1,1,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,1,4,34,6,7,8,9,33,10,11,12,13,14,15,16,17,2,2,2,2,2,2,2,2,2,2,18,19,20,21,22,23,24,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,25,29,26,30,3,72,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,3,27,31,28,32,72];ln[NaN]=80;var Yt=[43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,43,52,43,43,43,43,39,43,43,39,39,39,39,39,39,39,39,39,39,43,43,43,43,43,43,43,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,43,44,43,43,39,43,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,43,43,43,43,43];Yt[NaN]=43;var Kg=[72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,72,78,59,72,59,59,59,59,59,59,59,59,59,59,72,72,72,72,72,72,72,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,72,61,72,72,78,72,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,78,72,72,72,72,72];Yt[NaN]=43;var Zp=[35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,35,57,59,35,58,58,58,58,58,58,58,58,58,58,35,35,35,35,35,35,35,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,35,61,35,35,60,35,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,60,35,35,35,35,35];Zp[NaN]=35;var Qp=[45,45,45,45,45,45,45,45,45,73,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,45,73,45,45,45,45,45,45,45,53,45,45,45,45,45,45,45,39,39,39,39,39,39,39,39,39,39,45,45,45,45,45,45,45,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,45,44,45,45,39,45,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,39,45,45,45,45,45];Qp[NaN]=45;var Jl=[37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,37,41,37,37,37,37,37,37,37,37,42,37,39,39,39,39,39,39,39,39,39,39,37,37,37,37,37,37,37,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,37,37,37,37,40,37,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,37,37,37,37,37];Jl[NaN]=37;var ec=[38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,38,41,38,38,38,38,38,38,38,38,38,38,39,39,39,39,39,39,39,39,39,39,38,38,38,38,38,38,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,38,38,38,38,40,38,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,40,38,38,38,38,38];ec[NaN]=38;var as=Pe(35,[61,36]),qg=Pe(35,[58,77]),Zg=Pe(35,[61,36,124,50]),Qg=Pe(35,[38,51]),Jg=Pe(35,[42,54]),em=Pe(39,[42,55]),tm=Pe(54,[42,55,47,56]),nm=Pe(62,[62,82]),sm=Pe(35,[61,36,33,70]),om=Pe(62,[45,71]),im=Pe(63,[45,81]),Zl=Pe(76,[10,72,13,72]),rm=Pe(39,[39,46,10,72,13,72,92,48]),am=Pe(39,[34,46,10,72,13,72,92,49]),lm=Pe(39,[39,47,10,74,13,74,92,48]),cm=Pe(39,[34,47,10,74,13,74,92,49]),qp=Pe(64,[9,39,32,39,34,66,39,65,41,72,10,39,13,39]),um=Pe(39,[41,67,9,79,10,79,13,79,32,79,92,75,40,72,91,72,93,72,123,72,125,72,NaN,67]),dm=Pe(39,[39,68,10,74,13,74,92,75,NaN,67]),pm=Pe(39,[34,68,10,74,13,74,92,75,NaN,67]),hm=Pe(72,[9,39,10,39,13,39,32,39,41,69]),fm=15,Oe=class{constructor(t,e){this.input=t;this.handler=e;d(this,\"indexMask\");d(this,\"buffer\");d(this,\"tail\",0);d(this,\"curr\",0);d(this,\"position\",0);this.indexMask=fm,this.buffer=Array(this.indexMask+1);for(let n=0;n<=this.indexMask;n++)this.buffer[n]=new Ql}token(){return this.tail==this.curr&&this.fillBuffer(),this.buffer[this.curr]}nthToken(t){return(this.tail-this.curr&this.indexMask)<=t&&this.fillBuffer(),this.buffer[this.curr+t&this.indexMask]}consume(){this.curr=this.curr+1&this.indexMask}fillBuffer(){let t=this.tail,e=this.curr,n=this.indexMask;if(t>=e?e+=n:e--,e==t)throw new Error(\"F_CSSTOK_INTERNAL\");let s=ln,o=this.input,i=this.position,a=this.buffer,l=0,c=0,u=\"\",p=0,h=!1,f=a[t],g=-9;for(;;){let m=o.charCodeAt(i);switch(s[m]||s[65]){case 72:u=o.substring(c,i),isNaN(m)?l=0:l=54,s=ln;break;case 1:i++,h=!0;continue;case 2:c=i++,s=Jl;continue;case 3:l=1,c=i++,s=Yt;continue;case 4:c=i++,l=31,s=as;continue;case 33:l=2,c=++i,s=rm;continue;case 34:l=2,c=++i,s=am;continue;case 6:c=++i,l=7,s=Yt;continue;case 7:c=i++,l=32,s=as;continue;case 8:c=i++,l=21;break;case 9:c=i++,l=32,s=Qg;continue;case 10:c=i++,l=10;break;case 11:c=i++,l=11;break;case 12:c=i++,l=36,s=as;continue;case 13:c=i++,l=23;break;case 14:c=i++,l=16;break;case 15:l=24,c=i++,s=Zp;continue;case 16:c=i++,s=Kg;continue;case 78:c=i++,l=9,s=Yt;continue;case 17:c=i++,l=19,s=Jg;continue;case 18:c=i++,l=18,s=qg;continue;case 77:i++,l=50;break;case 19:c=i++,l=17;break;case 20:c=i++,l=38,s=sm;continue;case 21:c=i++,l=39,s=as;continue;case 22:c=i++,l=37,s=as;continue;case 23:c=i++,l=22;break;case 24:c=++i,l=20,s=Yt;continue;case 25:c=i++,l=14;break;case 26:c=i++,l=15;break;case 27:c=i++,l=12;break;case 28:c=i++,l=13;break;case 29:c=i++,g=c,l=1,s=Zl;continue;case 30:c=i++,l=33,s=as;continue;case 31:c=i++,l=34,s=Zg;continue;case 32:c=i++,l=35,s=as;continue;case 35:break;case 36:i++,l=l+41-31;break;case 37:l=5,p=parseInt(o.substring(c,i),10);break;case 38:l=4,p=parseFloat(o.substring(c,i));break;case 39:i++;continue;case 40:l=3,p=parseFloat(o.substring(c,i)),c=i++,s=Yt;continue;case 41:l=3,p=parseFloat(o.substring(c,i)),u=\"%\",c=i++;break;case 42:i++,s=ec;continue;case 43:if(u=rs(o.substring(c,i)),l===27&&m===63||l===1&&u.toLowerCase()===\"u\"&&/^(\\bu\\+[?0-9a-f]+(-[?0-9a-f]+)?|,|\\s+|\\/\\*([^*]|\\*[^/])*\\*\\/)+[;}]/i.test(o.substring(i-1))){l=27,i++;continue}break;case 44:g=i++,s=Zl;continue;case 45:u=rs(o.substring(c,i));break;case 46:u=o.substring(c,i),i++;break;case 47:u=rs(o.substring(c,i)),i++;break;case 48:g=i,i+=2,s=lm;continue;case 49:g=i,i+=2,s=cm;continue;case 50:i++,l=25;break;case 51:i++,l=26;break;case 52:if(u=o.substring(c,i),l==1){if(i++,u.toLowerCase()==\"url\"){s=qp;continue}l=6}break;case 53:if(u=rs(o.substring(c,i)),l==1){if(i++,u.toLowerCase()==\"url\"){s=qp;continue}l=6}break;case 54:s=em,i++;continue;case 55:s=tm,i++;continue;case 56:s=ln,i++;continue;case 57:s=nm,i++,o[i]!==\">\"&&(l=1,s=Yt);continue;case 81:l=51,u=o.substring(c,++i),s=ln;break;case 82:l=52,u=o.substring(c,++i),s=ln;break;case 58:l=5,s=Jl,i++;continue;case 59:l=4,s=ec,i++;continue;case 60:l=1,s=Yt,i++;continue;case 61:l=1,s=Zl,g=i++;continue;case 62:i--;break;case 63:i-=2;break;case 64:c=i++,s=um;continue;case 65:c=++i,s=dm;continue;case 66:c=++i,s=pm;continue;case 67:l=8,u=rs(o.substring(c,i)),i++;break;case 69:i++;break;case 70:s=om,i++;continue;case 71:s=im,i++;continue;case 79:if(i-g<8&&o.substring(g+1,i+1).match(/^[0-9a-fA-F]{0,6}(\\r\\n|[\\n\\r])|[ \\t]$/)){i++;continue}case 68:l=8,u=rs(o.substring(c,i)),i++,s=hm;continue;case 74:if(i++,i-g<9&&o.substring(g+1,i).match(/^[0-9a-fA-F]{0,6}(\\r\\n|[\\n\\r])$/))continue;l=54,u=\"E_CSS_UNEXPECTED_NEWLINE\",s=ln;break;case 73:if(i-g<9&&o.substring(g+1,i+1).match(/^[0-9a-fA-F]{0,6}[ \\t]$/)){i++,s=Yt;continue}u=rs(o.substring(c,i));break;case 75:g=i++;continue;case 76:i++,s=Qp;continue;default:if(s!==ln){l=54,u=\"E_CSS_UNEXPECTED_STATE\";break}c=i,l=0}if(f.type=l,f.precededBySpace=h,f.num=p,f.text=u,f.position=c,t++,t>=e)break;s=ln,h=!1,f=a[t&n]}this.position=i,this.tail=t&n}};var Ne=null,tc=null;function jo(){return Ne}function k(r){if(!Ne)throw new Error(\"E_TASK_NO_CONTEXT\");Ne.name||(Ne.name=r);let t=Ne,e=new Js(t,t.top,r);return t.top=e,e.state=1,e}function gm(r){return new sc(r||new nc)}function v(r){return new Xo(r)}function cn(r,t,e){let n=k(r);n.handler=e;try{t(n)}catch(s){n.task.raise(s,n)}return n.result()}function Jp(r,t){return(Ne?Ne.getScheduler():tc||gm()).run(r,t)}var nc=class{currentTime(){return new Date().valueOf()}setTimeout(t,e){return setTimeout(t,e)}clearTimeout(t){clearTimeout(t)}},sc=class{constructor(t){this.timer=t;d(this,\"timeout\",1);d(this,\"slice\",25);d(this,\"sliceOverTime\",0);d(this,\"queue\");d(this,\"wakeupTime\",null);d(this,\"timeoutToken\",null);d(this,\"inTimeSlice\",!1);d(this,\"order\",0);this.queue=new Yi,tc||(tc=this)}setSlice(t){this.slice=t}setTimeout(t){this.timeout=t}isTimeSliceOver(){return this.timer.currentTime()>=this.sliceOverTime}arm(){if(this.inTimeSlice)return;let e=this.queue.peek().scheduledTime,n=this.timer.currentTime();if(this.timeoutToken!=null){if(n+this.timeout>this.wakeupTime)return;this.timer.clearTimeout(this.timeoutToken)}let s=e-n;s<=this.timeout&&(s=this.timeout),this.wakeupTime=n+s,this.timeoutToken=this.timer.setTimeout(()=>{this.timeoutToken=null,this.doTimeSlice()},s)}schedule(t,e){let n=t,s=this.timer.currentTime();n.order=this.order++,n.scheduledTime=s+(e||0),this.queue.add(n),this.arm()}doTimeSlice(){this.timeoutToken!=null&&(this.timer.clearTimeout(this.timeoutToken),this.timeoutToken=null),this.inTimeSlice=!0;try{let t=this.timer.currentTime();for(this.sliceOverTime=t+this.slice;this.queue.length();){let e=this.queue.peek();if(e.scheduledTime>t||(this.queue.remove(),e.canceled||e.resumeInternal(),t=this.timer.currentTime(),t>=this.sliceOverTime))break}}catch(t){V.error(t)}this.inTimeSlice=!1,this.queue.length()&&this.arm()}run(t,e){let n=new oc(this,e||\"\");n.top=new Js(n,null,\"bootstrap\"),n.top.state=1,n.top.then(()=>{let o=()=>{n.running=!1;for(let i of n.callbacks)try{i()}catch(a){V.error(a)}};try{t().then(i=>{n.result=i,o()})}catch(i){n.raise(i),o()}});let s=Ne;return Ne=n,this.schedule(n.top.suspend(\"bootstrap\")),Ne=s,n}},vr=class{constructor(t){this.task=t;d(this,\"scheduledTime\",0);d(this,\"order\",0);d(this,\"result\",null);d(this,\"canceled\",!1)}compare(t){let e=t;return e.scheduledTime-this.scheduledTime||e.order-this.order}getTask(){return this.task}schedule(t,e){this.result=t,this.task.scheduler.schedule(this,e)}resumeInternal(){let t=this.task;if(this.task=null,t&&t.continuation==this){t.continuation=null;let e=Ne;return Ne=t,t.top.finish(this.result),Ne=e,!0}return!1}cancel(){this.canceled=!0}},oc=class{constructor(t,e){this.scheduler=t;this.name=e;d(this,\"callbacks\",[]);d(this,\"exception\",null);d(this,\"running\",!0);d(this,\"result\",null);d(this,\"waitTarget\",null);d(this,\"top\",null);d(this,\"continuation\",null)}getName(){return this.name}interrupt(t){if(this.raise(t||new Error(\"E_TASK_INTERRUPT\")),this!==Ne&&this.continuation){this.continuation.cancel();let e=new vr(this);this.waitTarget=\"interrupt\",this.continuation=e,this.scheduler.schedule(e)}}getScheduler(){return this.scheduler}isRunning(){return this.running}whenDone(t){this.callbacks.push(t)}join(){let t=k(\"Task.join\");if(!this.running)t.finish(this.result);else{let e=t.suspend(this);this.whenDone(()=>{e.schedule(this.result)})}return t.result()}unwind(){for(;this.top&&!this.top.handler;)this.top=this.top.parent;if(this.top&&this.top.handler&&this.exception){let t=this.exception;this.exception=null,this.top.handler(this.top,t)}else this.exception&&V.error(this.exception,\"Unhandled exception in task\",this.name)}raise(t,e){if(this.fillStack(t),e){let n=this.top;for(;n&&n!=e;)n=n.parent;n==e&&(this.top=n)}this.exception=t,this.unwind()}fillStack(t){let e=t.frameTrace;if(!e){e=t.stack?`${t.stack}\n\t---- async ---\n`:\"\";for(let n=this.top;n;n=n.parent)e+=\"\t\",e+=n.getName(),e+=`\n`;t.frameTrace=e}}},Xo=class r{constructor(t){this.value=t}then(t){t(this.value)}thenAsync(t){return t(this.value)}thenReturn(t){return new r(t)}thenFinish(t){t.finish(this.value)}isPending(){return!1}get(){return this.value}},ic=class{constructor(t){this.frame=t}then(t){this.frame.then(t)}thenAsync(t){if(this.isPending()){let e=new Js(this.frame.task,this.frame.parent,\"AsyncResult.thenAsync\");return e.state=1,this.frame.parent=e,this.frame.then(n=>{t(n).then(s=>{e.finish(s)})}),e.result()}else return t(this.frame.res)}thenReturn(t){return this.isPending()?this.thenAsync(()=>new Xo(t)):new Xo(t)}thenFinish(t){this.isPending()?this.then(e=>{t.finish(e)}):t.finish(this.frame.res)}isPending(){return this.frame.state==1}get(){if(this.isPending())throw new Error(\"Result is pending\");return this.frame.res}},Js=class{constructor(t,e,n){this.task=t;this.parent=e;this.name=n;d(this,\"res\",null);d(this,\"state\");d(this,\"callback\",null);d(this,\"handler\",null);this.state=0}checkEnvironment(){if(!Ne)throw new Error(\"F_TASK_NO_CONTEXT\");if(this!==Ne.top)throw new Error(\"F_TASK_NOT_TOP_FRAME\")}result(){return new ic(this)}finish(t){this.checkEnvironment(),Ne&&!Ne.exception&&(this.res=t),this.state=2;let e=this.parent;if(Ne&&(Ne.top=e),this.callback){try{this.callback(t)}catch(n){this.task.raise(n,e)}this.state=3}}getTask(){return this.task}getName(){return this.name}getScheduler(){return this.task.scheduler}then(t){switch(this.state){case 1:if(this.callback)throw new Error(\"F_TASK_FRAME_ALREADY_HAS_CALLBACK\");this.callback=t;break;case 2:{let e=this.task,n=this.parent;try{t(this.res),this.state=3}catch(s){this.state=3,e.raise(s,n)}break}case 3:throw new Error(\"F_TASK_DEAD_FRAME\");default:throw new Error(`F_TASK_UNEXPECTED_FRAME_STATE ${this.state}`)}}timeSlice(){let t=k(\"Frame.timeSlice\");return t.getScheduler().isTimeSliceOver()?(V.debug(\"-- time slice --\"),t.suspend().schedule(!0)):t.finish(!0),t.result()}sleep(t){let e=k(\"Frame.sleep\");return e.suspend().schedule(!0,t),e.result()}loop(t){let e=k(\"Frame.loop\"),n=s=>{try{for(;s;){let o=t();if(o.isPending()){o.then(n);return}else o.then(i=>{s=i})}e.finish(!0)}catch(o){e.task.raise(o,e)}};return n(!0),e.result()}loopWithFrame(t){let e=Ne;if(!e)throw new Error(\"E_TASK_NO_CONTEXT\");return this.loop(()=>{let n;do{let s=new rc(e,e.top);e.top=s,s.state=1,t(s),n=s.result()}while(!n.isPending()&&n.get());return n})}suspend(t){if(this.checkEnvironment(),this.task.continuation)throw new Error(\"E_TASK_ALREADY_SUSPENDED\");let e=new vr(this.task);return this.task.continuation=e,Ne=null,this.task.waitTarget=t||null,e}},rc=class extends Js{constructor(t,e){super(t,e,\"loop\")}continueLoop(){this.finish(!0)}breakLoop(){this.finish(!1)}};var Kt=class{constructor(t,e){this.fetch=t;d(this,\"name\");d(this,\"arrived\",!1);d(this,\"resource\",null);d(this,\"task\",null);d(this,\"piggybacks\",[]);this.name=e}start(){this.task||(this.task=jo().getScheduler().run(()=>{let t=k(\"Fetcher.run\");return this.fetch().then(e=>{let n=this.piggybacks;if(this.arrived=!0,this.resource=e,this.task=null,this.piggybacks=[],n)for(let s=0;s<n.length;s++)try{n[s](e)}catch(o){V.error(o,\"Error:\")}t.finish(e)}),t.result()},this.name))}piggyback(t){this.arrived?t(this.resource):this.piggybacks.push(t)}get(){return this.arrived?v(this.resource):(this.start(),this.task.join())}hasArrived(){return this.arrived}},An=r=>{if(r.length==0)return v(!0);if(r.length==1)return r[0].get().thenReturn(!0);let t=k(\"waitForFetches\"),e=0;return t.loop(()=>{for(;e<r.length;){let n=r[e++];if(!n.hasArrived())return n.get().thenReturn(!0)}return v(!1)}).then(()=>{t.finish(!0)}),t.result()};var ac=`\n@media screen {\n  [data-vivliostyle-viewer-viewport] {\n    background: #aaaaaa;\n  }\n\n  [data-vivliostyle-page-container] {\n    background: white;\n    z-index: 0;\n  }\n\n  [data-vivliostyle-viewer-viewport] {\n    box-sizing: border-box;\n    display: flex;\n    overflow: auto;\n    position: relative;\n  }\n\n  [data-vivliostyle-outer-zoom-box] {\n    margin: auto;\n    overflow: hidden;\n    flex: none;\n  }\n\n  [data-vivliostyle-viewer-viewport] [data-vivliostyle-spread-container] {\n    display: flex;\n    flex: none;\n    justify-content: center;\n    transform-origin: left top;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-page-progression=\"ltr\"]\n    [data-vivliostyle-spread-container] {\n    flex-direction: row;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-page-progression=\"rtl\"]\n    [data-vivliostyle-spread-container] {\n    flex-direction: row-reverse;\n  }\n\n  [data-vivliostyle-viewer-viewport] [data-vivliostyle-page-container] {\n    margin: 0 auto;\n    flex: none;\n    transform-origin: center top;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view=\"true\"]\n    [data-vivliostyle-page-container][data-vivliostyle-page-side=\"left\"] {\n    margin-right: 1px;\n    transform-origin: right top;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view=\"true\"]\n    [data-vivliostyle-page-container][data-vivliostyle-page-side=\"right\"] {\n    margin-left: 1px;\n    transform-origin: left top;\n  }\n\n  [data-vivliostyle-viewer-viewport][data-vivliostyle-spread-view=\"true\"]\n    [data-vivliostyle-page-container][data-vivliostyle-unpaired-page=\"true\"] {\n    margin-left: auto;\n    margin-right: auto;\n    transform-origin: center top;\n  }\n}\n`,lc=`\n[data-vivliostyle-layout-box] {\n  position: absolute;\n  left: 0;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  overflow: hidden;\n  z-index: -1;\n  transform-origin: left top;\n}\n\n[data-vivliostyle-debug] [data-vivliostyle-layout-box] {\n  right: auto;\n  bottom: auto;\n  overflow: visible;\n  z-index: auto;\n}\n\n[data-vivliostyle-spread-container] {\n  transform: scale(var(--viv-outputScale,1));\n  transform-origin: left top;\n}\n\n/* Emulate high pixel ratio using zoom & transform:scale() */\n@supports (zoom: 8) {\n  [data-vivliostyle-layout-box] {\n    zoom: calc(var(--viv-outputPixelRatio,1) / var(--viv-devicePixelRatio,1));\n    transform: scale(calc(var(--viv-devicePixelRatio,1) / var(--viv-outputPixelRatio,1)));\n  }\n  [data-vivliostyle-spread-container] {\n    zoom: calc(var(--viv-outputPixelRatio,1) / var(--viv-devicePixelRatio,1));\n    transform: scale(calc(var(--viv-outputScale,1) * var(--viv-devicePixelRatio,1) / var(--viv-outputPixelRatio,1)));\n  }\n  /* Workaround for Chromium's default border etc. widths not zoomed but scaled down */\n  [data-vivliostyle-spread-container] :where([style*=border],[style*=outline],[style*=rule]) {\n    border-width: medium;\n    outline-width: medium;\n    column-rule-width: medium;\n  }\n  [data-vivliostyle-spread-container] ::-webkit-scrollbar {\n    width: 8px;\n    height: 8px;\n  }\n  [data-vivliostyle-spread-container] ::-webkit-scrollbar-track {\n    background-color: #f4f4f4;\n  }\n  [data-vivliostyle-spread-container] ::-webkit-scrollbar-thumb {\n    border-radius: 4px;\n    background: #c7c7c7;\n  }\n  [data-vivliostyle-spread-container] ::-webkit-scrollbar-thumb:hover {\n    background: #7d7d7d;\n  }\n}\n\n[data-vivliostyle-page-container] {\n  position: relative;\n}\n\n[data-vivliostyle-bleed-box] {\n  position: absolute;\n  overflow: hidden;\n  background-origin: content-box !important;\n  box-sizing: border-box;\n}\n\n[data-vivliostyle-page-box] ~ [data-vivliostyle-page-box] {\n  display: none;\n}\n\n[data-vivliostyle-toc-box] {\n  position: absolute;\n  left: 3px;\n  top: 3px;\n  overflow: scroll;\n  overflow-x: hidden;\n  background: rgba(248, 248, 248, 0.9);\n  border-radius: 2px;\n  box-shadow: 1px 1px 2px rgba(0, 0, 0, 0.4);\n}\n\n@media print {\n  [data-vivliostyle-toc-box] {\n    display: none;\n  }\n\n  [data-vivliostyle-outer-zoom-box],\n  [data-vivliostyle-spread-container] {\n    width: 100% !important;\n    height: 100% !important;\n  }\n\n  [data-vivliostyle-spread-container] {\n    --viv-outputScale: 1 !important;\n    --viv-devicePixelRatio: 1 !important;\n    zoom: normal !important;\n    transform: none !important;\n  }\n\n  @supports (zoom: 8) {\n    [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {\n      zoom: var(--viv-outputPixelRatio,1);\n      transform: scale(calc(1 / var(--viv-outputPixelRatio,1)));\n      transform-origin: left top;\n    }\n  }\n\n  [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {\n    display: block !important;\n    max-height: 100vh;\n  }\n\n  [data-vivliostyle-spread-container] [data-vivliostyle-page-container]:not(:last-child) {\n    break-after: page;\n  }\n\n  /* Gecko-only hack, see https://bugzilla.mozilla.org/show_bug.cgi?id=267029#c17 */\n  @-moz-document url-prefix()  {\n    [data-vivliostyle-spread-container] [data-vivliostyle-page-container]:nth-last-child(n + 2) {\n      top: -1px;\n      margin-top: 1px;\n      margin-bottom: -1px;\n    }\n    /* Workaround Gecko problem on page break */\n    [data-vivliostyle-spread-container] [data-vivliostyle-page-container] {\n      break-after: auto !important;\n      height: 100% !important;\n    }\n  }\n}\n`,cc=`\n/*\n * Copyright 2013 Google, Inc.\n * Copyright 2015 Daishinsha Inc.\n * Copyright 2019 Vivliostyle Foundation\n *\n * CSS property validation.\n */\nNUM = POS_NUM | ZERO | NEGATIVE;\nNNEG_NUM = POS_NUM | ZERO;\nINT = POS_INT | ZERO | NEGATIVE;\nNNEG_INT = POS_INT | ZERO;\nPERCENTAGE = POS_PERCENTAGE | ZERO | NEGATIVE;\nSTRICT_PERCENTAGE = POS_PERCENTAGE | ZERO_PERCENTAGE | NEGATIVE;\nNNEG_PERCENTAGE = POS_PERCENTAGE | ZERO;\nLENGTH = POS_LENGTH | ZERO | NEGATIVE;\nNNEG_LENGTH = POS_LENGTH | ZERO;\nPLENGTH = LENGTH | PERCENTAGE;\nPPLENGTH = POS_LENGTH | ZERO | POS_PERCENTAGE;\nALENGTH = LENGTH | auto;\nAPLENGTH = PLENGTH | auto;\nPAPLENGTH = PPLENGTH | auto;\nANGLE = POS_ANGLE | ZERO | NEGATIVE;\nLENGTH_OR_NUM = LENGTH | NUM;\nANGLE_OR_NUM = ANGLE | NUM;\nMIN_MAX_FIT_CONTENT = min-content | max-content | fit-content;\nBG_POSITION_TERM = PLENGTH | left | center | right | top | bottom;\nURI_OR_NONE = URI | none;\nIMAGE = URI | IMAGE_FUNCTION | none;\nbackground-attachment = COMMA( [scroll | fixed | local]+ );\nbackground-color = COLOR;\nbackground-image = COMMA( IMAGE+ );\nbackground-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */\nbackground-repeat = COMMA( [repeat | repeat-x | repeat-y | no-repeat]+ );\nborder-collapse = collapse | separate;\nBORDER_SIDE_COLOR = COLOR;\nBORDER_SIDE_STYLE = none | hidden | dotted | dashed | solid | double | groove | ridge | inset | outset;\nBORDER_SIDE_WIDTH = thin: 1px | medium: 3px | thick: 5px | NNEG_LENGTH;\nborder-spacing = LENGTH LENGTH?;\nborder-top-color = BORDER_SIDE_COLOR;\nborder-right-color = BORDER_SIDE_COLOR;\nborder-bottom-color = BORDER_SIDE_COLOR;\nborder-left-color = BORDER_SIDE_COLOR;\nborder-top-style = BORDER_SIDE_STYLE;\nborder-right-style = BORDER_SIDE_STYLE;\nborder-bottom-style = BORDER_SIDE_STYLE;\nborder-left-style = BORDER_SIDE_STYLE;\nborder-top-width = BORDER_SIDE_WIDTH;\nborder-right-width = BORDER_SIDE_WIDTH;\nborder-bottom-width = BORDER_SIDE_WIDTH;\nborder-left-width = BORDER_SIDE_WIDTH;\nBORDER_RADIUS = PLENGTH{1,2};\nborder-top-left-radius = BORDER_RADIUS;\nborder-top-right-radius = BORDER_RADIUS;\nborder-bottom-right-radius = BORDER_RADIUS;\nborder-bottom-left-radius = BORDER_RADIUS;\nborder-image-source = IMAGE;\nborder-image-slice = [NUM | PERCENTAGE]{1,4} || fill; /* relaxed */\nborder-image-width = [NUM | PLENGTH | auto]{1,4};\nborder-image-outset = [NUM | LENGTH]{1,4};\nborder-image-repeat = [ stretch | repeat | round | space ]{1,2};\nbottom = APLENGTH;\ncaption-side = top | bottom;\nclear = none | left | right | top | bottom | inline-start | inline-end | block-start | block-end | both | all | same;\nclip = rect(ALENGTH{4}) | rect(SPACE(ALENGTH{4})) | auto;\ncolor = COLOR;\nLIST_STYLE_TYPE = IDENT;\nTYPE_OR_UNIT_IN_ATTR = string | color | url | integer | number | length | angle | time | frequency;\nATTR = attr(SPACE(IDENT TYPE_OR_UNIT_IN_ATTR?) [ STRING | IDENT | COLOR | INT | NUM | PLENGTH | ANGLE | POS_TIME | FREQUENCY]?);\nCONTENT_LIST = [ STRING | URI | counter(IDENT LIST_STYLE_TYPE?) |\n    counters(IDENT STRING LIST_STYLE_TYPE?) | ATTR |\n    target-counter([ STRING | URI ] IDENT LIST_STYLE_TYPE?) |\n    target-counter(ATTR IDENT LIST_STYLE_TYPE?) |\n    target-counters([ STRING | URI ] IDENT STRING LIST_STYLE_TYPE?) |\n    target-counters(ATTR IDENT STRING LIST_STYLE_TYPE?) |\n    leader([ dotted | solid | space ] | STRING ) |\n    open-quote | close-quote | no-open-quote | no-close-quote |\n    content([ text | before | after | first-letter ]?) |\n    string(IDENT [first | start | last | first-except]?) |\n    element(IDENT [first | start | last | first-except]?) ]+;\nCONTENT = normal | none | CONTENT_LIST;\ncontent = CONTENT;\nCOUNTER = [ IDENT INT? ]+ | none;\ncounter-increment = COUNTER;\ncounter-reset = COUNTER;\ncounter-set = COUNTER;\ncursor = COMMA(URI* [ auto | crosshair | default | pointer | move | e-resize | ne-resize | nw-resize |\n    n-resize | se-resize | sw-resize | s-resize | w-resize | text | wait | help | progress ]);\ndirection = ltr | rtl;\ndisplay = inline | block | list-item | inline-block | table | inline-table | table-row-group |\n    table-header-group | table-footer-group | table-row | table-column-group | table-column |\n    table-cell | table-caption | none | oeb-page-head | oeb-page-foot | flex | inline-flex |\n    ruby | ruby-base | ruby-text | ruby-base-container | ruby-text-container | run-in | compact | marker |\n    flow-root | grid | inline-grid | contents;\nempty-cells = show | hide;\nFAMILY = SPACE(IDENT+) | STRING;\nFAMILY_LIST = COMMA( FAMILY+ );\nfont-family = FAMILY_LIST;\nfont-size = xx-small | x-small | small | medium | large | x-large | xx-large | larger | smaller | PPLENGTH;\nfont-style = normal | italic | oblique;\nfont-weight = normal | bold | bolder | lighter | POS_NUM;\nheight = PAPLENGTH | MIN_MAX_FIT_CONTENT;\nleft = APLENGTH;\nletter-spacing = normal | LENGTH_OR_NUM;\nline-height = normal | POS_NUM | PPLENGTH;\nlist-style-image = IMAGE;\nlist-style-position = inside | outside;\nlist-style-type = LIST_STYLE_TYPE;\nmargin-right = APLENGTH;\nmargin-left = APLENGTH;\nmargin-top = APLENGTH;\nmargin-bottom = APLENGTH;\nNPLENGTH = none | PLENGTH;\nmax-height = NPLENGTH | MIN_MAX_FIT_CONTENT;\nmax-width = NPLENGTH | MIN_MAX_FIT_CONTENT;\nmin-height = APLENGTH | MIN_MAX_FIT_CONTENT;\nmin-width = APLENGTH | MIN_MAX_FIT_CONTENT;\norphans = POS_INT;\noutline-offset = LENGTH;\noutline-color = COLOR | invert;\noutline-style = BORDER_SIDE_STYLE;\noutline-width = BORDER_SIDE_WIDTH;\noverflow = visible | hidden | scroll | auto | clip;\npadding-right = PPLENGTH;\npadding-left = PPLENGTH;\npadding-top = PPLENGTH;\npadding-bottom = PPLENGTH;\nPAGE_BREAK = auto | always | avoid | left | right | recto | verso;\npage-break-after = PAGE_BREAK;\npage-break-before = PAGE_BREAK;\npage-break-inside = avoid | auto;\nposition = static | relative | absolute | fixed | running(IDENT);\nquotes = [STRING STRING]+ | none | auto;\nright = APLENGTH;\ntable-layout = auto | fixed;\ntext-align = left | right | center | justify | start | end;\ntext-indent = PLENGTH;\ntext-transform = capitalize | uppercase | lowercase | none;\ntop = APLENGTH;\nvertical-align = baseline | sub | super | top | text-top | middle | bottom | text-bottom | PLENGTH;\nvisibility = visible | hidden | collapse;\nwhite-space = normal | pre | nowrap | pre-wrap | pre-line | break-spaces;\nwidows = POS_INT;\nwidth = PAPLENGTH | MIN_MAX_FIT_CONTENT;\nword-spacing = normal | LENGTH_OR_NUM;\nz-index = auto | INT;\n\n[epub,moz,webkit]hyphens = auto | manual | none;\n[webkit]hyphenate-character = auto | STRING;\n\n/* css-logical */\nmargin-block-start = APLENGTH;\nmargin-block-end = APLENGTH;\nmargin-inline-start = APLENGTH;\nmargin-inline-end = APLENGTH;\npadding-block-start = APLENGTH;\npadding-block-end = APLENGTH;\npadding-inline-start = APLENGTH;\npadding-inline-end = APLENGTH;\nborder-block-start-color = BORDER_SIDE_COLOR;\nborder-block-end-color = BORDER_SIDE_COLOR;\nborder-inline-start-color = BORDER_SIDE_COLOR;\nborder-inline-end-color = BORDER_SIDE_COLOR;\nborder-block-start-style = BORDER_SIDE_STYLE;\nborder-block-end-style = BORDER_SIDE_STYLE;\nborder-inline-start-style = BORDER_SIDE_STYLE;\nborder-inline-end-style = BORDER_SIDE_STYLE;\nborder-block-start-width = BORDER_SIDE_WIDTH;\nborder-block-end-width = BORDER_SIDE_WIDTH;\nborder-inline-start-width = BORDER_SIDE_WIDTH;\nborder-inline-end-width = BORDER_SIDE_WIDTH;\nblock-start = APLENGTH;\nblock-end = APLENGTH;\ninline-start = APLENGTH;\ninline-end = APLENGTH;\nblock-size = PAPLENGTH | MIN_MAX_FIT_CONTENT;\ninline-size = PAPLENGTH | MIN_MAX_FIT_CONTENT;\nmax-block-size = NPLENGTH | MIN_MAX_FIT_CONTENT;\nmax-inline-size = NPLENGTH | MIN_MAX_FIT_CONTENT;\nmin-block-size = APLENGTH | MIN_MAX_FIT_CONTENT;\nmin-inline-size = APLENGTH | MIN_MAX_FIT_CONTENT;\n\nSHAPE = auto | rectangle( PLENGTH{4} ) |  ellipse( PLENGTH{4} ) |  circle( PLENGTH{3} ) |\n    polygon( SPACE(PLENGTH+)+ );\n[epubx]shape-inside = SHAPE;\n[epubx,webkit]shape-outside = SHAPE;\n[epubx]wrap-flow = auto | both | start | end | maximum | clear | around /* epub al */;\n\nTRANSFORM_FUNCTION = matrix(NUM{6}) | translate(PLENGTH{1,2}) | translateX(PLENGTH) | translateY(PLENGTH) |\n scale(NUM{1,2}) | scaleX(NUM) | scaleY(NUM) | rotate(ANGLE) | skewX(ANGLE) | skewY(ANGLE);\n[epub]transform = none | TRANSFORM_FUNCTION+;\n[epub]transform-origin = [[[ top | bottom | left | right] PLENGTH?] | center | PLENGTH]{1,2}; /* relaxed */\n\nBOX = border-box | padding-box | content-box;\nSHADOW = SPACE(inset || LENGTH{2,4} || COLOR); /* relaxed */\n[webkit]background-size = COMMA( SPACE( [PLENGTH | auto ]{1,2} | cover | contain)+ );\n[webkit]background-origin = COMMA( BOX+ );\n[webkit]background-clip = COMMA( BOX+ );\n[webkit]box-shadow = none | COMMA( SHADOW+ );\ntext-shadow = none |  COMMA( SHADOW+ );\n[webkit]box-decoration-break = slice | clone;\nFILTER_FUNCTION = blur(LENGTH) | brightness(NUM | PERCENTAGE) | contrast(NUM | PERCENTAGE) | drop-shadow(SPACE(LENGTH{2,3} COLOR?))\n                | grayscale(NUM | PERCENTAGE) | hue-rotate(ANGLE) | invert(NUM | PERCENTAGE) | opacity(NUM | PERCENTAGE)\n                | saturate(NUM | PERCENTAGE) | sepia(NUM | PERCENTAGE);\nFILTER_FUNCTION_LIST = FILTER_FUNCTION+;\n[webkit]filter = none | FILTER_FUNCTION_LIST;\n\nopacity = NUM;\n\n[moz,webkit]column-width = LENGTH | auto;\n[moz,webkit]column-count = INT | auto;\n[moz,webkit]column-gap = LENGTH | normal;\n[moz,webkit]column-rule-color = COLOR;\n[moz,webkit]column-rule-style = BORDER_SIDE_STYLE;\n[moz,webkit]column-rule-width = BORDER_SIDE_WIDTH;\nBREAK = auto | avoid | avoid-page | page | left | right | recto | verso | avoid-column | column | avoid-region | region;\nbreak-before = BREAK;\nbreak-after = BREAK;\nbreak-inside = auto | avoid | avoid-page | avoid-column | avoid-region;\n[webkit]column-span = none | auto | all;\n[moz]column-fill = auto | balance | balance-all;\nmargin-break = auto | keep | discard;\n\nsrc = COMMA([SPACE(URI format(STRING+)?) | local(FAMILY)]+); /* for font-face */\n\n[epubx,webkit]flow-from = IDENT;\n[epubx,webkit]flow-into = IDENT;\n[epubx]flow-linger = INT | none;\n[epubx]flow-priority = INT;\n[epubx]flow-options = none | [ exclusive || last || static ];\n[epubx]page = INT | auto | IDENT; /* page: IDENT is for CSS Paged Media */\n[epubx]min-page-width = LENGTH;\n[epubx]min-page-height = LENGTH;\n[epubx]required = true | false;\n[epubx]enabled = true | false;\n[epubx]conflicting-partitions = COMMA(IDENT+);\n[epubx]required-partitions = COMMA(IDENT+);\n[epubx]snap-height = LENGTH | none;\n[epubx]snap-width = LENGTH | none;\n[epubx]flow-consume = all | some;\n[epubx]utilization = NUM;\n[epubx]text-zoom = font-size | scale;\n\n[adapt]template = URI_OR_NONE | footnote;\n[adapt]behavior = IDENT;\n\n/* CSS Fonts */\nCOMMON_LIG_VALUES        = [ common-ligatures | no-common-ligatures ];\nDISCRETIONARY_LIG_VALUES = [ discretionary-ligatures | no-discretionary-ligatures ];\nHISTORICAL_LIG_VALUES    = [ historical-ligatures | no-historical-ligatures ];\nCONTEXTUAL_ALT_VALUES    = [ contextual | no-contextual ];\nfont-variant-ligatures = normal | none | [ COMMON_LIG_VALUES || DISCRETIONARY_LIG_VALUES || HISTORICAL_LIG_VALUES || CONTEXTUAL_ALT_VALUES ];\nfont-variant-caps = normal | small-caps | all-small-caps | petite-caps | all-petite-caps | unicase | titling-caps;\nNUMERIC_FIGURE_VALUES   = [ lining-nums | oldstyle-nums ];\nNUMERIC_SPACING_VALUES  = [ proportional-nums | tabular-nums ];\nNUMERIC_FRACTION_VALUES = [ diagonal-fractions | stacked-fractions ];\nfont-variant-numeric = normal | [ NUMERIC_FIGURE_VALUES || NUMERIC_SPACING_VALUES || NUMERIC_FRACTION_VALUES || ordinal || slashed-zero ];\nEAST_ASIAN_VARIANT_VALUES = [ jis78 | jis83 | jis90 | jis04 | simplified | traditional ];\nEAST_ASIAN_WIDTH_VALUES   = [ full-width | proportional-width ];\nfont-variant-east-asian = normal | [ EAST_ASIAN_VARIANT_VALUES || EAST_ASIAN_WIDTH_VALUES || ruby ];\nfont-variant_css2 = normal | small-caps; /* for font shorthand */\nfont-size-adjust = none | NNEG_NUM;\n[webkit]font-kerning = auto | normal | none;\nfont-feature-settings = COMMA( normal | SPACE( STRING [ on | off | INT ]? )+ );\nFONT_STRETCH_CSS3_VALUES = normal | wider | narrower | ultra-condensed | extra-condensed | condensed | semi-condensed | semi-expanded | expanded | extra-expanded | ultra-expanded;\nfont-stretch = FONT_STRETCH_CSS3_VALUES | PERCENTAGE;\nfont-stretch_css3 = FONT_STRETCH_CSS3_VALUES; /* for font shorthand */\nfont-display = [ auto | block | swap | fallback | optional ];\nunicode-range = COMMA( URANGE+ );\n\n/* CSS Images */\nimage-resolution = RESOLUTION;\nobject-fit = fill | contain | cover | none | scale-down;\nobject-position = COMMA( SPACE(BG_POSITION_TERM{1,4})+ ); /* relaxed */\n\n/* CSS Paged Media */\nPAGE_SIZE = a10 | a9 | a8 | a7 | a6 | a5 | a4 | a3 | a2 | a1 | a0\n          | b10 | b9 | b8 | b7 | b6 | b5 | b4 | b3 | b2 | b1 | b0\n          | c10 | c9 | c8 | c7 | c6 | c5 | c4 | c3 | c2 | c1 | c0\n          | jis-b10 | jis-b9 | jis-b8 | jis-b7 | jis-b6 | jis-b5 | jis-b4 | jis-b3 | jis-b2 | jis-b1 | jis-b0\n          | letter | legal | ledger;\nbleed = auto | LENGTH;\nmarks = none | [ crop || cross ];\nsize = POS_LENGTH{1,2} | auto | [ PAGE_SIZE || [ portrait | landscape ] ];\ncrop-offset = auto | LENGTH;\n\n/* CSS Page Floats */\nfloat-reference = inline | column | region | page;\nfloat = none | footnote | [ block-start || block-end || inline-start || inline-end || snap-block || snap-inline || left || right || top || bottom ];\nfloat-min-wrap-block = PPLENGTH;\n\n/* CSS Ruby */\nruby-align = start | center | space-between | space-around;\nruby-position = over | under | inter-character;\n\n/* CSS Size Adjust */\n[moz,webkit]text-size-adjust = auto | none | POS_PERCENTAGE;\n\n/* CSS Text */\n[webkit]line-break = auto | loose | normal | strict | anywhere;\noverflow-wrap = normal | break-word | anywhere;\n[moz]tab-size = NNEG_INT | NNEG_LENGTH;\n[moz]text-align-last = auto | start | end | left | right | center | justify;\ntext-justify = auto | none | inter-word | inter-character;\nword-break = normal | keep-all | break-all | break-word;\ntext-spacing-trim = auto | normal | space-all | trim-both | trim-auto |\n    [[ trim-start | space-start | space-first ] ||\n     [ trim-end | space-end | allow-end ] ||\n     [ trim-adjacent | space-adjacent ]];\ntext-autospace = normal | auto | no-autospace |\n    [[ ideograph-alpha || ideograph-numeric || punctuation ] || [ insert | replace ]];\nhanging-punctuation = none | [ first || [ force-end | allow-end ] || last ];\n\n/* CSS Text Decoration */\n[webkit]text-decoration-color = COLOR;\n[webkit]text-decoration-line = none | [ underline || overline || line-through || blink ];\n[webkit]text-decoration-skip = none | [ objects || spaces || ink || edges || box-decoration ];\n[webkit]text-decoration-style = solid | double | dotted | dashed | wavy;\n[webkit]text-decoration-thickness = from-font | APLENGTH;\n[epub,webkit]text-emphasis-color = COLOR;\n[webkit]text-emphasis-position = [ over | under ] [ right | left ];\n[epub,webkit]text-emphasis-style = none | [[ filled | open ] || [ dot | circle | double-circle | triangle | sesame ]] | STRING;\n[webkit]text-underline-position = auto | [ under || [ left | right ]];\n\n/* CSS Transforms */\n[webkit]backface-visibility = visible | hidden;\n\n/* CSS UI */\n[moz,webkit]box-sizing = content-box | padding-box | border-box;\ntext-overflow = [clip | ellipsis | STRING]{1,2};\n\n/* CSS Writing Modes */\n[epub,webkit]text-combine = none | horizontal;\ntext-combine-upright = none | all; /* relaxed */\n[epub,webkit]text-orientation = mixed | upright | sideways-right | sideways-left | sideways | use-glyph-orientation /* the following values are kept for backward-compatibility */ | vertical-right | rotate-right | rotate-left | rotate-normal | auto;\nunicode-bidi = normal | embed | isolate | bidi-override | isolate-override | plaintext;\n[epub,webkit]writing-mode = horizontal-tb | vertical-rl | lr-tb | rl-tb | tb-rl | lr | rl | tb;\n\n/* CSS Flex box */\nFLEX_BASIS = content | PAPLENGTH;\nflex-direction = row | row-reverse | column | column-reverse;\nflex-wrap = nowrap | wrap | wrap-reverse;\norder = INT;\nflex-grow = NNEG_NUM;\nflex-shrink = NNEG_NUM;\nflex-basis = FLEX_BASIS;\nflex = none | [ [ NNEG_NUM NNEG_NUM? ] || FLEX_BASIS ];\njustify-content = flex-start | flex-end | center | space-between | space-around;\nalign-items = flex-start | flex-end | center | baseline | stretch;\nalign-self = auto | flex-start | flex-end | center | baseline | stretch;\nalign-content = flex-start | flex-end | center | space-between | space-around | stretch;\n\n/* Pointer Events */\ntouch-action = auto | none | [ pan-x || pan-y ] | manipulation;\n\n/* SVG 2 */\nOPACITY_VALUE = NUM | PERCENTAGE;\nDASH_ARRAY = COMMA( SPACE( [ LENGTH | PERCENTAGE | NUM ]+ )+ );\nPAINT = none | child | child(INT) | COLOR | SPACE( URI [none | COLOR]? ) | context-fill | context-stroke;\ncolor-interpolation = auto | sRGB | linearRGB;\ncolor-rendering = auto | optimizeSpeed | optimizeQuality;\nfill = PAINT;\nfill-opacity = OPACITY_VALUE;\nfill-rule = nonzero | evenodd;\nglyph-orientation-vertical = auto | NUM | ANGLE;\nimage-rendering = auto | optimizeSpeed | optimizeQuality | crisp-edges | pixelated;\nmarker-start = none | URI;\nmarker-mid = none | URI;\nmarker-end = none | URI;\npointer-events = bounding-box | visiblePainted | visibleFill | visibleStroke | visible | painted | fill | stroke | all | none;\npaint-order = normal | [ fill || stroke || markers ];\nshape-rendering = auto | optimizeSpeed | crispEdges | geometricPrecision;\nstop-color = COLOR;\nstop-opacity = OPACITY_VALUE;\nstroke = PAINT;\nstroke-dasharray = none | DASH_ARRAY;\nstroke-dashoffset = PERCENTAGE | LENGTH_OR_NUM;\nstroke-linecap = butt | round | square;\nstroke-linejoin = miter | round | bevel;\nstroke-miterlimit = NUM;\nstroke-opacity = OPACITY_VALUE;\nstroke-width = PERCENTAGE | LENGTH_OR_NUM;\ntext-anchor = start | middle | end;\ntext-rendering = auto | optimizeSpeed | optimizeLegibility | geometricPrecision;\nvector-effect = none | SPACE( [ non-scaling-stroke | non-scaling-size | non-rotation | fixed-position ]+ [ viewport | screen ]? );\n\n/* SVG 1.1 */\nalignment-baseline = auto | baseline | before-edge | text-before-edge | middle | central | after-edge | text-after-edge | ideographic | alphabetic | hanging | mathematical;\nbaseline-shift = baseline | sub | super | PERCENTAGE | LENGTH_OR_NUM;\ndominant-baseline = auto | use-script | no-change | reset-size | ideographic | alphabetic | hanging | mathematical | central | middle | text-after-edge | text-before-edge;\nmask = none | URI;\n\n/* css-masking-1 */\nSHAPE_RADIUS = PLENGTH | closest-side | farthest-side;\nFILL_RULE = nonzero | evenodd;\nSHAPE_BOX = BOX | margin-box;\nGEOMETRY_BOX = SHAPE_BOX | fill-box | stroke-box | view-box;\nBASIC_SHAPE =\n    inset( SPACE( PLENGTH{1,4} [ round PLENGTH{1,4} [ SLASH PLENGTH{1,4} ]? ]? ) )\n  | circle(  SPACE( [SHAPE_RADIUS]?    [at BG_POSITION_TERM{1,4}]? ) )\n  | ellipse( SPACE( SHAPE_RADIUS{2}? [at BG_POSITION_TERM{1,4}]? ) )\n  | polygon( FILL_RULE? COMMA( SPACE( PLENGTH{2} )+ )+ );\n[webkit]clip-path = none | URI | [ BASIC_SHAPE || GEOMETRY_BOX ];\nclip-rule = nonzero | evenodd;\n\n/* filters */\nflood-color = COLOR;\nflood-opacity = OPACITY_VALUE;\nlighting-color = COLOR;\n\n/* compositing-1 */\nBLEND_MODE = normal | multiply | screen | overlay | darken | lighten | color-dodge | color-burn | hard-light | soft-light | difference | exclusion | hue | saturation | color | luminosity;\nmix-blend-mode = BLEND_MODE;\nisolation = auto | isolate;\nbackground-blend-mode = COMMA( BLEND_MODE+ );\n\n/* CSS GCPM */\nstring-set = COMMA( SPACE( IDENT CONTENT_LIST )+ | none );\nfootnote-policy = auto | line;\n\n/* CSS Repeated Headers and Footers */\n[viv]repeat-on-break = auto | none | header | footer;\n\n/* Compatibility */\n[webkit]text-fill-color = COLOR;\n[webkit]text-stroke-color = COLOR;\n[webkit]text-stroke-width = BORDER_SIDE_WIDTH;\n\nDEFAULTS\n\nbackground-attachment: scroll;\nbackground-color: transparent;\nbackground-image: none;\nbackground-repeat: repeat;\nbackground-position: 0% 0%;\nbackground-clip: border-box;\nbackground-origin: padding-box;\nbackground-size: auto;\nborder-top-color: currentColor;\nborder-right-color: currentColor;\nborder-bottom-color: currentColor;\nborder-left-color: currentColor;\nborder-top-style: none;\nborder-right-style: none;\nborder-bottom-style: none;\nborder-left-style: none;\nborder-top-width: 3px;\nborder-right-width: 3px;\nborder-bottom-width: 3px;\nborder-left-width: 3px;\nborder-top-left-radius: 0;\nborder-top-right-radius: 0;\nborder-bottom-right-radius: 0;\nborder-bottom-left-radius: 0;\nborder-image-source: none;\nborder-image-slice: 100%;\nborder-image-width: 1;\nborder-image-outset: 0;\nborder-image-repeat: stretch;\ncolumn-count: auto;\ncolumn-gap: normal;\ncolumn-width: auto;\ncolumn-rule-color: currentColor;\ncolumn-rule-style: none;\ncolumn-rule-width: 3px;\ncolumn-fill: balance;\noutline-color: currentColor;\noutline-style: none;\noutline-width: 3px;\nflex-direction: row;\nflex-wrap: nowrap;\nfont-family: serif;\nfont-style: normal;\nfont-size: medium;\nfont-size-adjust: none;\nfont-kerning: auto;\nfont-feature-settings: normal;\nfont-variant-ligatures: normal;\nfont-variant-caps: normal;\nfont-variant-numeric: normal;\nfont-variant-east-asian: normal;\nfont-weight: normal;\nfont-stretch: normal;\nline-height: normal;\nlist-style-image: none;\nlist-style-position: outside;\nlist-style-type: disc;\nmargin-bottom: auto;\nmargin-left: auto;\nmargin-right: auto;\nmargin-top: auto;\npadding-bottom: auto;\npadding-left: auto;\npadding-right: auto;\npadding-top: auto;\ntext-autospace: normal;\ntext-emphasis-color: currentColor;\ntext-emphasis-style: none;\ntext-spacing-trim: normal;\ntext-stroke-color: currentColor;\ntext-stroke-width: 0;\nmarker-start: none;\nmarker-mid: none;\nmarker-end: none;\n\n/* css-logical */\nborder-block-start-color: currentColor;\nborder-block-end-color: currentColor;\nborder-inline-start-color: currentColor;\nborder-inline-end-color: currentColor;\nborder-block-start-style: none;\nborder-block-end-style: none;\nborder-inline-start-style: none;\nborder-inline-end-style: none;\nborder-block-start-width: 3px;\nborder-block-end-width: 3px;\nborder-inline-start-width: 3px;\nborder-inline-end-width: 3px;\n\nSHORTHANDS\n\nall = ALL;\nbackground = COMMA background-image [background-position [ / background-size ]] background-repeat\n     background-attachment [background-origin background-clip] background-color; /* background-color is a special case, see the code */\nborder-top = border-top-width border-top-style border-top-color;\nborder-right = border-right-width border-right-style border-right-color;\nborder-bottom = border-bottom-width border-bottom-style border-bottom-color;\nborder-left = border-left-width border-left-style border-left-color;\nborder-width = INSETS border-top-width border-right-width border-bottom-width border-left-width;\nborder-style = INSETS border-top-style border-right-style border-bottom-style border-left-style;\nborder-color = INSETS border-top-color border-right-color border-bottom-color border-left-color;\nborder = border-width border-style border-color;\nborder-image = border-image-source border-image-slice [ / border-image-width [ / border-image-outset ] ]\n     border-image-repeat;\nborder-radius = INSETS_SLASH border-top-left-radius border-top-right-radius\n     border-bottom-right-radius border-bottom-left-radius;\n[moz,webkit]columns = column-width column-count;\n[moz,webkit]column-rule = column-rule-width column-rule-style column-rule-color;\nflex-flow = flex-direction flex-wrap;\noeb-column-number = column-count;\noutline = outline-width outline-style outline-color;\nlist-style = list-style-position list-style-type list-style-image;\nmargin = INSETS margin-top margin-right margin-bottom margin-left;\npadding = INSETS padding-top padding-right padding-bottom padding-left;\nfont = FONT font-style font-variant_css2 font-weight font-stretch_css3 /* font-size line-height font-family are special-cased */;\nfont-variant = font-variant-ligatures font-variant-caps font-variant-numeric font-variant-east-asian;\n[epub,webkit]text-emphasis = text-emphasis-style text-emphasis-color;\nmarker = INSETS marker-start marker-mid marker-end;\n[webkit]text-stroke = text-stroke-width text-stroke-color;\ntext-decoration = text-decoration-line text-decoration-color text-decoration-style text-decoration-thickness;\ntext-spacing = TEXT_SPACING text-autospace text-spacing-trim;\n\n/* css-logical */\nmargin-block = INSETS margin-block-start margin-block-end;\nmargin-inline = INSETS margin-inline-start margin-inline-end;\npadding-block = INSETS padding-block-start padding-block-end;\npadding-inline = INSETS padding-inline-start padding-inline-end;\nborder-block-width = INSETS border-block-start-width border-block-end-width;\nborder-block-style = INSETS border-block-start-style border-block-end-style;\nborder-block-color = INSETS border-block-start-color border-block-end-color;\nborder-inline-width = INSETS border-inline-start-width border-inline-end-width;\nborder-inline-style = INSETS border-inline-start-style border-inline-end-style;\nborder-inline-color = INSETS border-inline-start-color border-inline-end-color;\nborder-block = border-block-width border-block-style border-block-color;\nborder-inline = border-inline-width border-inline-style border-inline-color;\nborder-block-start = border-block-start-width border-block-start-style border-block-start-color;\nborder-block-end = border-block-end-width border-block-end-style border-block-end-color;\nborder-inline-start = border-inline-start-width border-inline-start-style border-inline-start-color;\nborder-inline-end = border-inline-end-width border-inline-end-style border-inline-end-color;\ninset-block-start = block-start;\ninset-block-end = block-end;\ninset-inline-start = inline-start;\ninset-inline-end = inline-end;\ninset-block = INSETS block-start block-end;\ninset-inline = INSETS inline-start inline-end;\ninset = INSETS top right bottom left;\n\n/* old names  */\nword-wrap = overflow-wrap;\n[adapt,webkit]margin-before = margin-block-start;\n[adapt,webkit]margin-after = margin-block-end;\n[adapt,webkit]margin-start = margin-inline-start;\n[adapt,webkit]margin-end = margin-inline-end;\n[adapt,webkit]padding-before = padding-block-start;\n[adapt,webkit]padding-after = padding-block-end;\n[adapt,webkit]padding-start = padding-inline-start;\n[adapt,webkit]padding-end = padding-inline-end;\n[adapt,webkit]border-before-color = border-block-start-color;\n[adapt,webkit]border-after-color = border-block-end-color;\n[adapt,webkit]border-start-color = border-inline-start-color;\n[adapt,webkit]border-end-color = border-inline-end-color;\n[adapt,webkit]border-before-style = border-block-start-style;\n[adapt,webkit]border-after-style = border-block-end-style;\n[adapt,webkit]border-start-style = border-inline-start-style;\n[adapt,webkit]border-end-style = border-inline-end-style;\n[adapt,webkit]border-before-width = border-block-start-width;\n[adapt,webkit]border-after-width = border-block-end-width;\n[adapt,webkit]border-start-width = border-inline-start-width;\n[adapt,webkit]border-end-width = border-inline-end-width;\n[adapt,webkit]before = block-start;\n[adapt,webkit]after = block-end;\n[adapt,webkit]start = inline-start;\n[adapt,webkit]end = inline-end;\n\n`,uc=`\n<!DOCTYPE html>\n<html xmlns=\"http://www.w3.org/1999/xhtml\" xmlns:s=\"http://www.pyroxy.com/ns/shadow\">\n<head>\n<style><![CDATA[\n\n.-vivliostyle-footnote-content {\n  float: footnote;\n}\n\n.-vivliostyle-table-cell-container {\n  display: block;\n}\n\n]]></style>\n</head>\n<body>\n\n<s:template id=\"footnote\"><s:content/><s:include class=\"-vivliostyle-footnote-content\"/></s:template>\n\n<s:template id=\"table-cell\"><div data-vivliostyle-flow-root=\"true\" class=\"-vivliostyle-table-cell-container\"><s:content/></div></s:template>\n\n</body>\n</html>`,dc=`\n@namespace \"http://www.w3.org/1999/xhtml\";\n\n:root {\n  hyphens: -epubx-expr(pref-hyphenate? \"auto\": \"manual\");\n}\n:root[data-vivliostyle-epub-spine-properties~=\"page-spread-left\"] {\n  break-before: left;\n}\n:root[data-vivliostyle-epub-spine-properties~=\"page-spread-right\"] {\n  break-before: right;\n}\n\n@-adapt-footnote-area {\n  display: block;\n  margin-block-start: 0.5em;\n  margin-block-end: 0.5em;\n}\n\n@-adapt-footnote-area ::before {\n  display: block;\n  border-block-start-width: 1px;\n  border-block-start-style: solid;\n  border-block-start-color: black;\n  margin-block-end: 0.4em;\n  margin-inline-start: 0;\n  margin-inline-end: 60%;\n}\n\n/* default page master */\n@-epubx-page-master :background-host {\n  @-epubx-partition :layout-host {\n    -epubx-flow-from: body;\n    top: -epubx-expr(header.margin-bottom-edge);\n    bottom: -epubx-expr(page-height - footer.margin-top-edge);\n    left: 0px;\n    right: 0px;\n    column-width: 25em;\n  }\n  @-epubx-partition footer :oeb-page-foot {\n    writing-mode: horizontal-tb;\n    -epubx-flow-from: oeb-page-foot;\n    bottom: 0px;\n    left: 0px;\n    right: 0px;\n  }\n  @-epubx-partition header :oeb-page-head {\n    writing-mode: horizontal-tb;\n    -epubx-flow-from: oeb-page-head;\n    top: 0px;\n    left: 0px;\n    right: 0px;\n  }\n}\n\n@page {\n  @top-left-corner {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @top-left {\n    text-align: left;\n    vertical-align: middle;\n  }\n  @top-center {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @top-right {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @top-right-corner {\n    text-align: left;\n    vertical-align: middle;\n  }\n  @left-top {\n    text-align: center;\n    vertical-align: top;\n  }\n  @left-middle {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @left-bottom {\n    text-align: center;\n    vertical-align: bottom;\n  }\n  @right-top {\n    text-align: center;\n    vertical-align: top;\n  }\n  @right-middle {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @right-bottom {\n    text-align: center;\n    vertical-align: bottom;\n  }\n  @bottom-left-corner {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @bottom-left {\n    text-align: left;\n    vertical-align: middle;\n  }\n  @bottom-center {\n    text-align: center;\n    vertical-align: middle;\n  }\n  @bottom-right {\n    text-align: right;\n    vertical-align: middle;\n  }\n  @bottom-right-corner {\n    text-align: left;\n    vertical-align: middle;\n  }\n}\n\n@media print {\n  @page {\n    margin: 10%;\n  }\n}\n`,pc=`\n@namespace \"http://www.w3.org/1999/xhtml\";\n@namespace m \"http://www.w3.org/1998/Math/MathML\";\n@namespace epub \"http://www.idpf.org/2007/ops\";\n\nhtml,\naddress,\nblockquote,\nbody,\ndd,\ndiv,\ndl,\ndt,\nfieldset,\nform,\nframe,\nframeset,\nh1,\nh2,\nh3,\nh4,\nh5,\nh6,\nnoframes,\nol,\np,\nul,\ncenter,\ndir,\nhr,\nmenu,\npre,\ndetails,\ndialog,\nlegend,\nlisting,\noptgroup,\noption,\nplaintext,\nsearch,\nxmp,\narticle,\nsection,\nnav,\naside,\nhgroup,\nfooter,\nheader,\nfigure,\nfigcaption,\nmain {\n  display: block;\n}\nli {\n  display: list-item;\n}\nhead {\n  display: none !important;\n}\ntable {\n  display: table;\n}\ntr {\n  display: table-row;\n}\nthead {\n  display: table-header-group;\n  break-after: avoid;\n}\ntbody {\n  display: table-row-group;\n}\ntfoot {\n  display: table-footer-group;\n  break-before: avoid;\n}\ncol {\n  display: table-column;\n}\ncolgroup {\n  display: table-column-group;\n}\ntd,\nth {\n  display: table-cell;\n}\ncaption {\n  display: table-caption;\n  text-align: center;\n}\nth {\n  font-weight: bolder;\n  text-align: center;\n}\n*[hidden],\nlink,\nstyle,\nscript {\n  display: none;\n}\nh1 {\n  font-size: 2em;\n  margin-block: 0.67em;\n}\nh2 {\n  font-size: 1.5em;\n  margin-block: 0.83em;\n}\nh3 {\n  font-size: 1.17em;\n  margin-block: 1em;\n}\nh4 {\n  font-size: 1em;\n  margin-block: 1.33em;\n}\nh5 {\n  font-size: 0.83em;\n  margin-block: 1.67em;\n}\nh6 {\n  font-size: 0.67em;\n  margin-block: 2.33em;\n}\nh1,\nh2,\nh3,\nh4,\nh5,\nh6 {\n  font-weight: bold;\n  break-after: avoid;\n}\np,\nblockquote,\nfigure,\nul,\nol,\ndl,\ndir,\nmenu {\n  margin-block: 1em;\n}\nb,\nstrong {\n  font-weight: bolder;\n}\nblockquote,\nfigure {\n  margin-inline: 40px;\n}\ni,\ncite,\ndfn,\nem,\nvar,\naddress {\n  font-style: italic;\n}\npre,\ntt,\ncode,\nkbd,\nsamp {\n  font-family: monospace;\n  text-spacing: none;\n  hanging-punctuation: none;\n}\nlisting,\nplaintext,\nxmp,\npre {\n  white-space: pre;\n}\npre[wrap] {\n  white-space: pre-wrap;\n}\nbutton,\ntextarea,\ninput,\nselect {\n  display: inline-block;\n}\nbig {\n  font-size: 1.17em;\n}\nsmall,\nsub,\nsup {\n  font-size: 0.83em;\n}\nsub {\n  vertical-align: sub;\n}\nsup {\n  vertical-align: super;\n}\ntable {\n  box-sizing: border-box;\n  border-spacing: 2px;\n  border-collapse: separate;\n  text-indent: initial;\n}\nthead,\ntbody,\ntfoot,\ntable > tr {\n  vertical-align: middle;\n}\ntr,\ntd,\nth {\n  vertical-align: inherit;\n}\ns,\nstrike,\ndel {\n  text-decoration: line-through;\n}\nhr {\n  border-style: inset;\n  border-width: 1px;\n  margin-block: 0.5em;\n}\nhr[color],\nhr[noshade] {\n  border-style: solid;\n}\nol,\nul,\ndir,\nmenu {\n  padding-inline-start: 40px;\n}\ndd {\n  margin-inline-start: 40px;\n}\nol ul,\nul ol,\nul ul,\nol ol {\n  margin-block: 0;\n}\nu,\nins {\n  text-decoration: underline;\n}\ncenter {\n  text-align: center;\n}\nq::before {\n  content: open-quote;\n}\nq::after {\n  content: close-quote;\n}\n\nruby {\n  display: ruby;\n}\nrp {\n  display: none;\n}\nrbc {\n  display: ruby-base-container;\n}\nrtc {\n  display: ruby-text-container;\n}\nrb {\n  display: ruby-base;\n  white-space: nowrap;\n}\nrt {\n  display: ruby-text;\n}\nrtc,\nrt {\n  text-emphasis: none;\n  white-space: nowrap;\n  line-height: 1;\n}\nrtc,\nrt {\n  font-size: 50%;\n}\nrtc:lang(zh-TW),\nrt:lang(zh-TW) {\n  font-size: 30%;\n}\nrtc > rt,\nrtc > rt:lang(zh-TW) {\n  font-size: 100%;\n}\n\n/* Bidi settings */\nbdo[dir=\"ltr\"] {\n  direction: ltr;\n  unicode-bidi: bidi-override;\n}\nbdo[dir=\"rtl\"] {\n  direction: rtl;\n  unicode-bidi: bidi-override;\n}\n*[dir=\"ltr\"] {\n  direction: ltr;\n  unicode-bidi: isolate;\n}\n*[dir=\"rtl\"] {\n  direction: rtl;\n  unicode-bidi: isolate;\n}\n\n/* MathML */\nm|math[display=\"block\"] {\n  display: block;\n  display: block math;\n}\n\n/*------------------ epub-specific ---------------------*/\n\na[epub|type=\"noteref\"],\na[epub\\\\:type=\"noteref\"] {\n  font-size: 0.75em;\n  vertical-align: super;\n  line-height: 0.01;\n}\n\na[epub|type=\"noteref\"]:href-epub-type(footnote, aside),\na[epub\\\\:type=\"noteref\"]:href-epub-type(footnote, aside) {\n  -adapt-template: footnote;\n  text-decoration: none;\n}\n\naside[epub|type=\"footnote\"],\naside[epub\\\\:type=\"footnote\"] {\n  display: none;\n}\n\naside[epub|type=\"footnote\"]:footnote-content,\naside[epub\\\\:type=\"footnote\"]:footnote-content {\n  display: block;\n  margin: 0.25em;\n  font-size: 1.2em;\n  line-height: 1.2;\n}\n\nepub|trigger {\n  display: none;\n}\n\nepub|switch {\n  display: inline;\n}\n\nepub|default {\n  display: inline;\n}\n\nepub|case {\n  display: none;\n}\n\nepub|case[required-namespace::supported] {\n  display: inline;\n}\n\nepub|case[required-namespace::supported] ~ epub|case {\n  display: none;\n}\n\nepub|case[required-namespace::supported] ~ epub|default {\n  display: none;\n}\n`,hc=`\n@namespace \"http://www.w3.org/1999/xhtml\";\n\n*:not([data-vivliostyle-role=doc-toc],\n  [data-vivliostyle-role=doc-toc] *,\n  :has([data-vivliostyle-role=doc-toc]),\n  :is(h1,h2,h3,h4,h5,h6):has(+:not(nav)[data-vivliostyle-role=doc-toc])) {\n  display: none;\n}\n\n[hidden] {\n  display: revert;\n}\n\n[data-vivliostyle-role=doc-toc] li a {\n  -adapt-behavior: toc-node-anchor;\n}\n\n[data-vivliostyle-role=doc-toc] li {\n  -adapt-behavior: toc-node;\n}\n\n[data-vivliostyle-role=doc-toc] li > :not(ul,ol):first-child {\n  -adapt-behavior: toc-node-first-child;\n}\n\n[data-vivliostyle-role=doc-toc] :is(ol,ul),\n[data-vivliostyle-role=doc-toc]:is(ol,ul) {\n  -adapt-behavior: toc-container;\n}\n`,fc=`\n[data-viv-margin-discard~=\"block-start\"] {\n  margin-block-start: 0 !important;\n}\n[data-viv-margin-discard~=\"block-end\"] {\n  margin-block-end: 0 !important;\n}\n[data-viv-margin-discard~=\"inline-start\"] {\n  margin-inline-start: 0 !important;\n}\n[data-viv-margin-discard~=\"inline-end\"] {\n  margin-inline-end: 0 !important;\n}\n\n[data-viv-box-break~=\"inline-start\"]:not([data-viv-box-break~=\"clone\"]) {\n  margin-inline-start: 0 !important;\n  padding-inline-start: 0 !important;\n  border-inline-start-width: 0 !important;\n  border-start-start-radius: 0 !important;\n  border-end-start-radius: 0 !important;\n}\n[data-viv-box-break~=\"inline-end\"]:not([data-viv-box-break~=\"clone\"]) {\n  margin-inline-end: 0 !important;\n  padding-inline-end: 0 !important;\n  border-inline-end-width: 0 !important;\n  border-start-end-radius: 0 !important;\n  border-end-end-radius: 0 !important;\n}\n[data-viv-box-break~=\"block-start\"]:not([data-viv-box-break~=\"clone\"]):not(table[style*=\"border-collapse: collapse\"]:has(>thead)) {\n  margin-block-start: 0 !important;\n  padding-block-start: 0 !important;\n  border-block-start-width: 0 !important;\n  border-start-start-radius: 0 !important;\n  border-start-end-radius: 0 !important;\n}\n[data-viv-box-break~=\"block-end\"]:not([data-viv-box-break~=\"clone\"]):not(table[style*=\"border-collapse: collapse\"]:has(>tfoot)) {\n  margin-block-end: 0 !important;\n  padding-block-end: 0 !important;\n  border-block-end-width: 0 !important;\n  border-end-start-radius: 0 !important;\n  border-end-end-radius: 0 !important;\n}\n[data-viv-box-break~=\"block-start\"][data-viv-box-break~=\"text-start\"] {\n  text-indent: 0 !important;\n}\n[data-viv-box-break~=\"block-end\"][data-viv-box-break~=\"text-end\"][data-viv-box-break~=\"justify\"] {\n  text-align-last: justify !important;\n}\n[data-viv-box-break~=\"block-end\"][data-viv-box-break~=\"text-end\"][data-viv-box-break~=\"justify\"] > * {\n  text-align-last: auto;\n}\n[data-viv-box-break~=\"block-end\"][data-viv-box-break~=\"text-end\"]:not([data-viv-box-break~=\"justify\"]) {\n  text-align-last: auto !important;\n}\n\nspan.viv-anonymous-block {\n  display: block;\n}\n\n[data-vivliostyle-page-container] {\n  text-spacing-trim: space-all;\n  text-autospace: no-autospace;\n}\nviv-ts-open.viv-ts-auto > viv-ts-inner,\nviv-ts-open.viv-ts-trim > viv-ts-inner {\n  margin-inline-start: -0.5em;\n}\nviv-ts-close.viv-ts-auto > viv-ts-inner,\nviv-ts-close.viv-ts-trim > viv-ts-inner {\n  letter-spacing: -0.5em;\n}\nviv-ts-close.viv-hang-end > viv-ts-inner,\nviv-ts-close.viv-hang-last > viv-ts-inner {\n  letter-spacing: -1em;\n}\nviv-ts-open.viv-ts-auto::before,\nviv-ts-close.viv-ts-auto::after,\nviv-ts-close.viv-hang-end::after {\n  content: \" \";\n  font-family: Courier, monospace;\n  word-spacing: normal;\n  letter-spacing: -0.11em;\n  line-height: 0;\n  text-orientation: mixed;\n  visibility: hidden;\n}\nviv-ts-close.viv-hang-end:not(.viv-hang-hw)::after {\n  letter-spacing: 0.4em;\n}\nviv-ts-close.viv-hang-hw > viv-ts-inner {\n  letter-spacing: -0.5em;\n}\nviv-ts-open.viv-hang-first > viv-ts-inner {\n  display: inline-block;\n  line-height: 1;\n  inline-size: 1em;\n  text-indent: 0;\n  text-align: end;\n  text-align-last: end;\n  margin-inline-start: -1em;\n}\nviv-ts-thin-sp::after {\n  content: \" \";\n  font-family: Times, serif;\n  word-spacing: normal;\n  letter-spacing: -0.125em;\n  line-height: 0;\n  text-orientation: mixed;\n  visibility: hidden;\n}\n[style*=text-decoration] :is(viv-ts-thin-sp, viv-ts-close.viv-ts-auto)::after {\n  visibility: visible;\n}\n\nspan[data-viv-leader] {\n  text-combine-upright: none;\n  text-orientation: mixed;\n  white-space: pre;\n}\n`;function cs(r,t,e,n,s){let o=k(\"ajax\"),i=new XMLHttpRequest,a=o.suspend(i),l={status:0,statusText:\"\",url:r,contentType:null,responseText:null,responseXML:null,responseBlob:null};i.open(e||\"GET\",r,!0),t&&(i.responseType=t),i.onreadystatechange=()=>{if(i.readyState===4){if(l.status=i.status,l.url=i.responseURL,l.statusText=i.statusText||i.status==404&&\"Not Found\"||\"\",l.status==200||l.status==0)if((!t||t===\"document\")&&i.responseXML&&i.responseXML.documentElement.localName!=\"parsererror\")l.responseXML=i.responseXML,l.contentType=i.responseXML.contentType;else if((!t||t===\"document\")&&i.response instanceof Document)l.responseXML=i.response,l.contentType=i.response.contentType;else{let c=i.response;(!t||t===\"text\")&&typeof c==\"string\"?l.responseText=c:c?typeof c==\"string\"?l.responseBlob=gc([c]):l.responseBlob=c:V.warn(\"Unexpected empty success response for\",r);let u=i.getResponseHeader(\"Content-Type\");u&&(l.contentType=u.replace(/(.*);.*$/,\"$1\"))}a.schedule(l)}};try{n?(i.setRequestHeader(\"Content-Type\",s||\"text/plain; charset=UTF-8\"),i.send(n)):(/^file:|^https?:\\/\\/[^/]+\\.githubusercontent\\.com|\\.(xhtml|xht|opf)$/i.test(r)?/\\/aozorabunko\\/[^/]+\\/cards\\/[^/]+\\/files\\/[^/.]+\\.html$/.test(r)?i.overrideMimeType(\"text/html; charset=Shift_JIS\"):/\\.(html|htm)$/i.test(r)?i.overrideMimeType(\"text/html; charset=UTF-8\"):/\\.(xhtml|xht|xml|opf)$/i.test(r)?i.overrideMimeType(\"application/xml; charset=UTF-8\"):/\\.(txt|css)$/i.test(r)?i.overrideMimeType(\"text/plain; charset=UTF-8\"):i.overrideMimeType(\"text/html; charset=UTF-8\"):/^data:,(<|%3c)/i.test(r)?i.overrideMimeType(\"text/html; charset=UTF-8\"):/^data:,/i.test(r)&&i.overrideMimeType(\"text/plain; charset=UTF-8\"),i.send(null))}catch(c){V.warn(c,`Error fetching ${r}`),a.schedule(l)}return o.result()}function gc(r,t){let e=t||\"application/octet-stream\";return new Blob(r,{type:e})}function eh(r){let t=k(\"readBlob\"),e=new FileReader,n=t.suspend(e);return e.addEventListener(\"load\",()=>{n.schedule(e.result)},!1),e.readAsArrayBuffer(r),t.result()}function th(r){return URL.createObjectURL(r)}var ls=class{constructor(t,e){this.parser=t;this.type=e;d(this,\"resources\",{});d(this,\"fetchers\",{})}load(t,e,n){t=wt(t);let s=this.resources[t];return typeof s!=\"undefined\"?v(s):this.fetch(t,e,n).get()}fetchInner(t,e,n){let s=k(\"fetch\"),o=t.endsWith(\"?viv-toc-box\");o&&(t=t.replace(\"?viv-toc-box\",\"\"));let i=J(\"user-agent.xml\",Wt),a=!o&&t===i;return a&&(t=`data:application/xml,${encodeURIComponent(uc)}`),cs(t,this.type).then(l=>{if(l.status>=400&&e)throw new Error((n||`Failed to fetch required resource: ${t}`)+` (${l.status}${l.statusText?\" \"+l.statusText:\"\"})`);o?(t+=\"?viv-toc-box\",l.url+=\"?viv-toc-box\"):a&&(l.url=t=i),this.parser(l,this).then(c=>{delete this.fetchers[t],this.resources[t]=c,s.finish(c)})}),s.result()}fetch(t,e,n){if(t=wt(t),this.resources[t])return null;let o=this.fetchers[t];return o||(o=new Kt(()=>this.fetchInner(t,e,n),`Fetch ${t}`),this.fetchers[t]=o,o.start()),o}get(t){return this.resources[wt(t)]}delete(t){delete this.resources[wt(t)]}};function mm(r,t){let e=r.responseText;return v(e?Ms(e):null)}function nh(){return new ls(mm,\"text\")}function Ln(r,t,e){let n=new Kt(()=>{let s=k(\"loadElement\"),o=s.suspend(r),i=!1,a=l=>{i||(i=!0,o.schedule(l?l.type:\"timeout\"))};return r.addEventListener(\"load\",a,!1),r.addEventListener(\"error\",a,!1),r.addEventListener(\"abort\",a,!1),r.namespaceURI==\"http://www.w3.org/2000/svg\"?(t&&r.setAttributeNS(\"http://www.w3.org/1999/xlink\",\"xlink:href\",t),setTimeout(a,300)):r.localName===\"script\"?setTimeout(a,3e3):t&&(r.src=t,e&&(r.alt=e)),s.result()},`loadElement ${t||r.localName}`);return n.start(),n}var sh=0,Cm=16777216,mc=33554432,Ar=50331648,Lr=67108864,bm=83886080,ym=100663296;var Yo=class{constructor(t){this.scope=t;d(this,\"flavor\");this.flavor=\"Author\"}getCurrentToken(){return null}getScope(){return this.scope}error(t,e){}startStylesheet(t){this.flavor=t}tagSelector(t,e){}classSelector(t){}pseudoclassSelector(t,e){}pseudoelementSelector(t,e){}idSelector(t){}attributeSelector(t,e,n,s){}descendantSelector(){}childSelector(){}adjacentSiblingSelector(){}followingSiblingSelector(){}nextSelector(){}startSelectorRule(){}startFontFaceRule(){}startFootnoteRule(t){}startViewportRule(){}startDefineRule(){}startRegionRule(){}startPageRule(){}startPageMarginBoxRule(t){}startWhenRule(t){}startMediaRule(t){this.startWhenRule(t)}startFlowRule(t){}startPageTemplateRule(){}startPageMasterRule(t,e,n){}startPartitionRule(t,e,n){}startPartitionGroupRule(t,e,n){}startRuleBody(){}property(t,e,n){}endRule(){}startFuncWithSelector(t){}endFuncWithSelector(){}pushSelectorText(t){}getImportantSpecificity(){switch(this.flavor){case\"UA\":return sh;case\"User\":return ym;default:return bm}}getBaseSpecificity(){switch(this.flavor){case\"UA\":return sh;case\"User\":return Cm;default:return mc}}},wr=class extends Yo{constructor(){super(null);d(this,\"stack\",[]);d(this,\"tokenizer\",null);d(this,\"slave\",null)}pushHandler(e){this.stack.push(this.slave),this.slave=e}popHandler(){this.slave=this.stack.pop()}getCurrentToken(){return this.tokenizer?this.tokenizer.token():null}getScope(){return this.slave.getScope()}error(e,n){this.slave.error(e,n)}errorMsg(e,n){var s;V.warn(e,(s=n==null?void 0:n.toString())!=null?s:\"\")}startStylesheet(e){super.startStylesheet(e),this.stack.length>0&&(this.slave=this.stack[0],this.stack=[]),this.slave.startStylesheet(e)}tagSelector(e,n){this.slave.tagSelector(e,n)}classSelector(e){this.slave.classSelector(e)}pseudoclassSelector(e,n){this.slave.pseudoclassSelector(e,n)}pseudoelementSelector(e,n){this.slave.pseudoelementSelector(e,n)}idSelector(e){this.slave.idSelector(e)}attributeSelector(e,n,s,o){this.slave.attributeSelector(e,n,s,o)}descendantSelector(){this.slave.descendantSelector()}childSelector(){this.slave.childSelector()}adjacentSiblingSelector(){this.slave.adjacentSiblingSelector()}followingSiblingSelector(){this.slave.followingSiblingSelector()}nextSelector(){this.slave.nextSelector()}startSelectorRule(){this.slave.startSelectorRule()}startFontFaceRule(){this.slave.startFontFaceRule()}startFootnoteRule(e){this.slave.startFootnoteRule(e)}startViewportRule(){this.slave.startViewportRule()}startDefineRule(){this.slave.startDefineRule()}startRegionRule(){this.slave.startRegionRule()}startPageRule(){this.slave.startPageRule()}startPageMarginBoxRule(e){this.slave.startPageMarginBoxRule(e)}startWhenRule(e){this.slave.startWhenRule(e)}startFlowRule(e){this.slave.startFlowRule(e)}startPageTemplateRule(){this.slave.startPageTemplateRule()}startPageMasterRule(e,n,s){this.slave.startPageMasterRule(e,n,s)}startPartitionRule(e,n,s){this.slave.startPartitionRule(e,n,s)}startPartitionGroupRule(e,n,s){this.slave.startPartitionGroupRule(e,n,s)}startRuleBody(){this.slave.startRuleBody()}property(e,n,s){this.slave.property(e,n,s)}endRule(){this.slave.endRule()}startFuncWithSelector(e){this.slave.startFuncWithSelector(e)}endFuncWithSelector(){this.slave.endFuncWithSelector()}pushSelectorText(e){this.slave.pushSelectorText(e)}},Pr=class extends Yo{constructor(e,n,s){super(e);this.owner=n;this.topLevel=s;d(this,\"depth\",0);n&&(this.flavor=n.flavor)}getCurrentToken(){var e;return(e=this.owner)==null?void 0:e.getCurrentToken()}error(e,n){var s;(s=this.owner)==null||s.errorMsg(e,n)}startRuleBody(){this.depth++}endRule(){--this.depth==0&&!this.topLevel&&this.owner.popHandler()}},qt=class extends Pr{constructor(t,e,n){super(t,e,n)}report(t){this.error(t,this.getCurrentToken())}reportAndSkip(t){this.report(t),this.owner.pushHandler(new Pr(this.scope,this.owner,!1))}startSelectorRule(){this.reportAndSkip(\"E_CSS_UNEXPECTED_SELECTOR\")}startFontFaceRule(){this.reportAndSkip(\"E_CSS_UNEXPECTED_FONT_FACE\")}startFootnoteRule(t){this.reportAndSkip(\"E_CSS_UNEXPECTED_FOOTNOTE\")}startViewportRule(){this.reportAndSkip(\"E_CSS_UNEXPECTED_VIEWPORT\")}startDefineRule(){this.reportAndSkip(\"E_CSS_UNEXPECTED_DEFINE\")}startRegionRule(){this.reportAndSkip(\"E_CSS_UNEXPECTED_REGION\")}startPageRule(){this.reportAndSkip(\"E_CSS_UNEXPECTED_PAGE\")}startWhenRule(t){this.reportAndSkip(\"E_CSS_UNEXPECTED_WHEN\")}startFlowRule(t){this.reportAndSkip(\"E_CSS_UNEXPECTED_FLOW\")}startPageTemplateRule(){this.reportAndSkip(\"E_CSS_UNEXPECTED_PAGE_TEMPLATE\")}startPageMasterRule(t,e,n){this.reportAndSkip(\"E_CSS_UNEXPECTED_PAGE_MASTER\")}startPartitionRule(t,e,n){this.reportAndSkip(\"E_CSS_UNEXPECTED_PARTITION\")}startPartitionGroupRule(t,e,n){this.reportAndSkip(\"E_CSS_UNEXPECTED_PARTITION_GROUP\")}startFuncWithSelector(t){this.reportAndSkip(\"E_CSS_UNEXPECTED_SELECTOR_FUNC\")}endFuncWithSelector(){this.reportAndSkip(\"E_CSS_UNEXPECTED_END_SELECTOR_FUNC\")}property(t,e,n){this.error(\"E_CSS_UNEXPECTED_PROPERTY\",this.getCurrentToken())}},me=[],kr=[],ie=[],xe=[],kt=[],ut=[],ye=[],ke=[],ne=[],Ie=[],qe=[],Re=[],be=[];var to=55,no=56,Tr=57;me[1]=28,me[36]=29,me[7]=29,me[9]=29,me[14]=29,me[18]=29,me[50]=29,me[20]=30,me[13]=27,me[0]=200,kr[1]=46,kr[0]=200,ut[1]=2,ut[36]=4,ut[7]=6,ut[9]=8,ut[14]=10,ut[18]=14,ut[50]=42,ie[37]=11,ie[23]=12,ie[35]=56,ie[1]=1,ie[36]=3,ie[7]=5,ie[9]=7,ie[14]=9,ie[12]=13,ie[18]=55,ie[50]=58,ie[16]=41,xe[37]=11,xe[23]=12,xe[35]=56,xe[1]=1,xe[36]=3,xe[7]=5,xe[9]=7,xe[14]=9,xe[18]=55,kt[1]=2,kt[36]=4,kt[7]=6,kt[9]=8,kt[18]=14,kt[50]=42,kt[14]=10,kt[12]=13,ye[1]=15,ye[7]=16,ye[4]=17,ye[5]=18,ye[3]=19,ye[2]=20,ye[8]=21,ye[27]=57,ye[16]=22,ye[19]=23,ye[6]=24,ye[11]=25,ye[17]=26,ye[13]=48,ye[31]=47,ye[23]=54,ye[0]=44,ke[1]=31,ke[4]=32,ke[5]=32,ke[3]=33,ke[2]=34,ke[10]=40,ke[6]=38,ke[31]=36,ke[24]=36,ke[32]=35,ne[1]=45,ne[16]=37,ne[37]=37,ne[38]=37,ne[47]=37,ne[48]=37,ne[39]=37,ne[49]=37,ne[41]=37,ne[26]=37,ne[25]=37,ne[23]=37,ne[24]=37,ne[19]=37,ne[21]=37,ne[36]=37,ne[18]=37,ne[22]=37,ne[11]=39,ne[12]=43,ne[17]=49,Ie[0]=200,Ie[12]=50,Ie[13]=51,Ie[14]=50,Ie[15]=51,Ie[10]=50,Ie[11]=51,Ie[17]=53,qe[0]=200,qe[12]=50,qe[13]=52,qe[14]=50,qe[15]=51,qe[10]=50,qe[11]=51,qe[17]=53,Re[0]=200,Re[12]=50,Re[13]=51,Re[14]=50,Re[15]=51,Re[10]=50,Re[11]=51,be[11]=0,be[16]=0,be[22]=1,be[18]=1,be[26]=2,be[25]=2,be[38]=3,be[37]=3,be[48]=3,be[47]=3,be[39]=3,be[49]=3,be[41]=3,be[23]=4,be[24]=4,be[36]=5,be[19]=5,be[21]=5,be[0]=6,be[to]=2,be[no]=2;var Rn=class{constructor(t,e,n,s){this.actions=t;this.tokenizer=e;this.handler=n;this.baseURL=s;d(this,\"valStack\",[]);d(this,\"namespacePrefixToURI\",{});d(this,\"defaultNamespaceURI\",null);d(this,\"propName\",null);d(this,\"propImportant\",!1);d(this,\"exprContext\");d(this,\"result\",null);d(this,\"importReady\",!1);d(this,\"importURL\",null);d(this,\"importCondition\",null);d(this,\"errorBrackets\",[]);d(this,\"ruleStack\",[]);d(this,\"regionRule\",!1);d(this,\"pageRule\",!1);d(this,\"inStyleDeclaration\",!1);this.exprContext=2}extractVals(t,e){let n=[],s=this.valStack;for(;e<s.length&&(n.push(s[e++]),e!==s.length);){if(s[e++]!==t)throw new Error(\"Unexpected state\");e===s.length&&n.push(O)}return n}valStackReduce(t,e){let n=this.valStack,s=n.length,o=0,i;do if(i=n[--s],t===\")\"&&i instanceof kn){if(i.text===\")\")o++;else if(i.text===\"(\"){if(o===0)return null;o--}}while(typeof i!=\"undefined\"&&typeof i!=\"string\");let a=n.length-(s+1);if(a>1&&n.splice(s+1,a,new q(n.slice(s+1,n.length))),t==\",\")return null;s++;do i=n[--s];while(typeof i!=\"undefined\"&&(typeof i!=\"string\"||i==\",\"));if(a=n.length-(s+1),i==\"(\"){t!=\")\"&&e.type!==0&&(this.handler.error(\"E_CSS_MISMATCHED_C_PAR\",e),this.actions=qe);let c=new Pt(n[s-1],this.extractVals(\",\",s+1));if(n.splice(s-1,a+2,c),c.name===\"var\"){let u=c.values[0]instanceof Be&&c.values[0].name;(!bt(u)||u===this.propName)&&(this.handler.error(`E_CSS_INVALID_VAR ${c.toString()}`,e),this.actions=qe)}return c}if(t!=\";\"||s>=0)return this.handler.error(\"E_CSS_UNEXPECTED_VAL_END\",e),this.actions=qe,null;if(a>1)return new ge(this.extractVals(\",\",s+1));let l=n[0];return l instanceof Se?l:l?new kn(l.toString()):O}exprError(t,e){this.actions=this.propName?qe:Ie,V.warn(t,e.toString())}exprStackReduce(t,e){let n=this.valStack,s=this.handler,o=n.pop(),i;for(;;){let a=n.pop();if(t==11){let l=[o];for(;a==16;)l.unshift(n.pop()),a=n.pop();if(typeof a==\"string\"){if(a==\"{\"){for(;l.length>=2;){let c=l.shift(),u=l.shift(),p=new ir(s.getScope(),c,u);l.unshift(p)}return n.push(new F(l[0])),!0}else if(a==\"(\"){let c=n.pop(),u=n.pop();o=new on(s.getScope(),zo(u,c),l),t=0;continue}}if(a==10){o.isMediaName()&&(o=new Ho(s.getScope(),o,null)),t=0;continue}}else if(typeof a==\"string\"){n.push(a);break}if(a<0)if(a==-31)o=new mt(s.getScope(),o);else if(a==-24)o=new Oo(s.getScope(),o);else if(a==-Tr)o=new sr(s.getScope(),o);else return this.exprError(\"F_UNEXPECTED_STATE\",e),!1;else{if(be[t]>be[a]){n.push(a);break}switch(i=n.pop(),a){case 26:o=new Hs(s.getScope(),i,o);break;case to:o=new or(s.getScope(),i,o);break;case no:o=new rr(s.getScope(),i,o);break;case 25:o=new zs(s.getScope(),i,o);break;case 38:o=new ar(s.getScope(),i,o);break;case 37:o=new cr(s.getScope(),i,o);break;case 48:o=new lr(s.getScope(),i,o);break;case 47:o=new ns(s.getScope(),i,o);break;case 39:case 49:o=new Pn(s.getScope(),i,o);break;case 41:o=new ur(s.getScope(),i,o);break;case 23:o=new Do(s.getScope(),i,o);break;case 24:o=new Mo(s.getScope(),i,o);break;case 36:o=new ss(s.getScope(),i,o);break;case 19:o=new _o(s.getScope(),i,o);break;case 21:o=new Gs(s.getScope(),i,o);break;case 18:if(n.length>1)switch(n[n.length-1]){case 22:n.pop(),o=new dr(s.getScope(),n.pop(),i,o);break;case 10:if(i.isMediaName())o=new Ho(s.getScope(),i,o);else return this.exprError(\"E_CSS_MEDIA_TEST\",e),!1;break}else return this.exprError(\"E_CSS_EXPR_COND\",e),!1;break;case 22:if(t!=18)return this.exprError(\"E_CSS_EXPR_COND\",e),!1;case 10:return n.push(i),n.push(a),n.push(o),!1;default:return this.exprError(\"F_UNEXPECTED_STATE\",e),!1}}}return n.push(o),!1}readSupportsTest(t){let e=t.type===6,n=this.tokenizer,s,o;if(e)o=t.text,s=t.position+o.length+1;else if(t.type===10){let h=n.nthToken(1),f=n.nthToken(2);if(h.type===1&&f.type===18)n.consume(),n.consume(),o=h.text,s=f.position+1;else{if(h.type===10||h.type===6||h.type===1&&h.text.toLowerCase()===\"not\"&&(f.type===10||f.type===6))return null;s=t.position+1}}else return null;let i=0,a,l=0;for(;i>=0;)switch(n.consume(),a=n.token(),a.type){case 11:i--;break;case 10:case 6:i++;break;case 16:i===0&&l++;break;case 0:return this.exprError(\"E_CSS_UNEXPECTED_EOF\",a),null}n.consume();let c=a.position,u=e&&o===\"selector\"&&l>0?\"\":n.input.substring(s,c).trim();return new pr(this.handler.getScope(),o,u,e)}readPseudoParams(){let t=[];for(;;){let e=this.tokenizer.token();switch(e.type){case 1:t.push(e.text);break;case 23:t.push(\"+\");break;case 4:case 5:t.push(e.num);break;default:return t}this.tokenizer.consume()}}readNthPseudoParams(){let t=!1,e=this.tokenizer.token();if(e.type===23)t=!0,this.tokenizer.consume(),e=this.tokenizer.token();else if(e.type===1&&(e.text===\"even\"||e.text===\"odd\"))return this.tokenizer.consume(),[2,e.text===\"odd\"?1:0];switch(e.type){case 3:if(t&&e.num<0)return null;case 1:if(t&&e.text.charAt(0)===\"-\")return null;if(e.text===\"n\"||e.text===\"-n\"){if(t&&e.precededBySpace)return null;let n=e.text===\"-n\"?-1:1;e.type===3&&(n=e.num);let s=0;this.tokenizer.consume(),e=this.tokenizer.token();let o=e.type===24,i=e.type===23||o;if(i&&(this.tokenizer.consume(),e=this.tokenizer.token()),e.type===5){if(s=e.num,1/s===-1/0){if(s=0,i)return null}else if(s<0){if(i)return null}else if(s>=0&&!i)return null;this.tokenizer.consume()}else if(i)return null;return[n,o&&s>0?-s:s]}else if(e.text===\"n-\"||e.text===\"-n-\"){if(t&&e.precededBySpace)return null;let n=e.text===\"-n-\"?-1:1;if(e.type===3&&(n=e.num),this.tokenizer.consume(),e=this.tokenizer.token(),e.type===5)return e.num<0||1/e.num===-1/0?null:(this.tokenizer.consume(),[n,e.num])}else{let n=e.text.match(/^n(-[0-9]+)$/);if(n)return t&&e.precededBySpace?null:(this.tokenizer.consume(),[e.type===3?e.num:1,parseInt(n[1],10)]);if(n=e.text.match(/^-n(-[0-9]+)$/),n)return this.tokenizer.consume(),[-1,parseInt(n[1],10)]}return null;case 5:return t&&(e.precededBySpace||e.num<0)?null:(this.tokenizer.consume(),[0,e.num])}return null}makeCondition(t,e){let n=this.handler.getScope();if(!n)return null;if(e=e||n._true,t){let s=t.split(/\\s+/);for(let o of s)switch(o){case\"vertical\":e=Je(n,e,new mt(n,new le(n,\"pref-horizontal\")));break;case\"horizontal\":e=Je(n,e,new le(n,\"pref-horizontal\"));break;case\"day\":e=Je(n,e,new mt(n,new le(n,\"pref-night-mode\")));break;case\"night\":e=Je(n,e,new le(n,\"pref-night-mode\"));break;default:e=n._false}}return e===n._true?null:new F(e)}isInsidePropertyOnlyRule(){switch(this.ruleStack[this.ruleStack.length-1]){case\"[selector]\":case\"font-face\":case\"-epubx-flow\":case\"-epubx-viewport\":case\"-epubx-define\":case\"-adapt-footnote-area\":return!0}return!1}runParser(t,e,n,s,o,i){let a=this.handler,l=this.tokenizer,c=this.valStack,u,p,h,f,g,m,E,C=null;for(n&&(this.inStyleDeclaration=!0),s&&(this.exprContext=2,this.valStack.push(\"{\"));t>0;--t){if(u=l.token(),o&&C===null&&(C=u.position-1,l.input[C]===\"(\"&&C++),this.actions===ye&&this.errorBrackets.length>0&&(u.type===this.errorBrackets[this.errorBrackets.length-1]||u.type===17||u.type===31)){if(u.type===this.errorBrackets[this.errorBrackets.length-1]&&(this.errorBrackets.pop(),u.type===11&&this.valStackReduce(\")\",u))){l.consume();continue}c.push(new kn(u.toString())),l.consume();continue}switch(this.actions[u.type]){case 28:if(!this.inStyleDeclaration||l.nthToken(1).type!=18){this.isInsidePropertyOnlyRule()?(a.error(\"E_CSS_COLON_EXPECTED\",l.nthToken(1)),this.actions=qe):(this.actions=ut,a.startSelectorRule());continue}this.propName=u.text,this.propImportant=!1,l.consume(),l.consume(),this.actions=ye,c.splice(0,c.length);continue;case 46:if(l.nthToken(1).type!=18){this.actions=qe,a.error(\"E_CSS_COLON_EXPECTED\",l.nthToken(1));continue}this.propName=u.text,this.propImportant=!1,l.consume(),l.consume(),this.actions=ye,c.splice(0,c.length);continue;case 29:this.actions=ut,a.startSelectorRule();continue;case 1:if(!u.precededBySpace){this.actions=Re,a.error(\"E_CSS_SPACE_EXPECTED\",u);continue}a.descendantSelector();case 2:if(l.nthToken(1).type==34)if(l.consume(),l.consume(),h=this.namespacePrefixToURI[u.text],h!=null)switch(u=l.token(),u.type){case 1:a.tagSelector(h,u.text),o?this.actions=xe:this.actions=ie,l.consume();break;case 36:a.tagSelector(h,null),o?this.actions=xe:this.actions=ie,l.consume();break;default:this.actions=Ie,a.error(\"E_CSS_NAMESPACE\",u)}else this.actions=Ie,a.error(\"E_CSS_UNDECLARED_PREFIX\",u);else a.tagSelector(this.defaultNamespaceURI,u.text),o?this.actions=xe:this.actions=ie,l.consume();continue;case 3:if(!u.precededBySpace){this.actions=Re,a.error(\"E_CSS_SPACE_EXPECTED\",u);continue}a.descendantSelector();case 4:if(l.nthToken(1).type==34)switch(l.consume(),l.consume(),u=l.token(),u.type){case 1:a.tagSelector(null,u.text),o?this.actions=xe:this.actions=ie,l.consume();break;case 36:a.tagSelector(null,null),o?this.actions=xe:this.actions=ie,l.consume();break;default:this.actions=Ie,a.error(\"E_CSS_NAMESPACE\",u)}else a.tagSelector(this.defaultNamespaceURI,null),o?this.actions=xe:this.actions=ie,l.consume();continue;case 5:u.precededBySpace&&a.descendantSelector();case 6:if(!u.text){a.error(\"E_CSS_SYNTAX\",u),l.consume();continue}a.idSelector(u.text),o?this.actions=xe:this.actions=ie,l.consume();continue;case 7:u.precededBySpace&&a.descendantSelector();case 8:a.classSelector(u.text),o?this.actions=xe:this.actions=ie,l.consume();continue;case 55:u.precededBySpace&&a.descendantSelector();case 14:l.consume(),u=l.token();e:switch(u.type){case 1:a.pseudoclassSelector(u.text,null),l.consume(),o?this.actions=xe:this.actions=ie;continue;case 6:switch(f=u.text,l.consume(),f){case\"is\":case\"not\":case\"where\":case\"has\":this.actions=ut,a.startFuncWithSelector(f),this.runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!0,f===\"has\")?this.actions=ie:this.actions=Re;continue;case\"lang\":case\"href-epub-type\":if(u=l.token(),u.type===1){E=[u.text],l.consume(),f===\"href-epub-type\"&&l.token().type===16&&(l.consume(),u=l.token(),u.type===1&&(E.push(u.text),l.consume()));break}else break e;case\"nth-child\":case\"nth-of-type\":case\"nth-last-child\":case\"nth-last-of-type\":case\"nth\":if(E=this.readNthPseudoParams(),E)break;break e;default:E=this.readPseudoParams()}if(u=l.token(),u.type==11){a.pseudoclassSelector(f,E),l.consume(),o?this.actions=xe:this.actions=ie;continue}break}a.error(\"E_CSS_PSEUDOCLASS_SYNTAX\",u),this.actions=Ie;continue;case 58:u.precededBySpace&&a.descendantSelector();case 42:switch(l.consume(),u=l.token(),u.type){case 1:a.pseudoelementSelector(u.text,null),o?this.actions=xe:this.actions=ie,l.consume();continue;case 6:if(f=u.text,l.consume(),f==\"nth-fragment\"){if(E=this.readNthPseudoParams(),E===null)break}else E=this.readPseudoParams();if(u=l.token(),u.type==11){a.pseudoelementSelector(f,E),o?this.actions=xe:this.actions=ie,l.consume();continue}break}a.error(\"E_CSS_PSEUDOELEM_SYNTAX\",u),this.actions=Ie;continue;case 9:u.precededBySpace&&a.descendantSelector();case 10:if(l.consume(),u=l.token(),u.type==1)f=u.text,l.consume();else if(u.type==36)f=null,l.consume();else if(u.type==34)f=\"\";else{this.actions=Re,a.error(\"E_CSS_ATTR\",u),l.consume();continue}if(u=l.token(),u.type==34){if(h=f&&this.namespacePrefixToURI[f],h===void 0){this.actions=Re,a.error(\"E_CSS_UNDECLARED_PREFIX\",u),l.consume();continue}if(l.consume(),u=l.token(),u.type!=1){this.actions=Re,a.error(\"E_CSS_ATTR_NAME_EXPECTED\",u);continue}f=u.text,l.consume(),u=l.token()}else h=\"\";switch(u.type){case 39:case 45:case 44:case 43:case 42:case 46:case 50:g=u.type,l.consume(),u=l.token();break;case 15:a.attributeSelector(h,f,0,null),o?this.actions=xe:this.actions=ie,l.consume();continue;default:this.actions=Re,a.error(\"E_CSS_ATTR_OP_EXPECTED\",u);continue}switch(u.type){case 1:case 2:a.attributeSelector(h,f,g,u.text),l.consume(),u=l.token();break;default:this.actions=Re,a.error(\"E_CSS_ATTR_VAL_EXPECTED\",u);continue}if(u.type!=15){this.actions=Re,a.error(\"E_CSS_ATTR\",u);continue}o?this.actions=xe:this.actions=ie,l.consume();continue;case 11:a.childSelector(),this.actions=kt,l.consume();continue;case 12:a.adjacentSiblingSelector(),this.actions=kt,l.consume();continue;case 56:a.followingSiblingSelector(),this.actions=kt,l.consume();continue;case 13:this.regionRule?(this.ruleStack.push(\"-epubx-region\"),this.regionRule=!1):this.pageRule?(this.ruleStack.push(\"page\"),this.pageRule=!1,this.inStyleDeclaration=!0):(this.ruleStack.push(\"[selector]\"),this.inStyleDeclaration=!0),a.startRuleBody(),this.actions=me,l.consume();continue;case 41:a.nextSelector(),this.actions=ut,l.consume();continue;case 15:c.push(L(u.text)),l.consume();continue;case 16:g=parseInt(u.text,16),c.push(new Xs(u.text)),l.consume();continue;case 17:c.push(new et(u.num)),l.consume();continue;case 18:c.push(new ct(u.num)),l.consume();continue;case 19:c.push(new P(u.num,u.text)),l.consume();continue;case 20:c.push(new ce(u.text)),l.consume();continue;case 21:c.push(new Ue(J(u.text,this.baseURL))),l.consume();continue;case 57:c.push(new Wo(u.text)),l.consume();continue;case 22:this.valStackReduce(\",\",u),c.push(\",\"),l.consume();continue;case 23:c.push(js),l.consume();continue;case 24:f=u.text.toLowerCase(),f==\"-epubx-expr\"||f==\"env\"?(this.actions=ke,this.exprContext=0,c.push(\"{\")):(c.push(f),c.push(\"(\"),this.errorBrackets.length>0&&this.errorBrackets.push(11)),l.consume();continue;case 25:this.valStackReduce(\")\",u),l.consume();continue;case 47:if(l.consume(),u=l.token(),p=l.nthToken(1),u.type==1&&u.text.toLowerCase()==\"important\"&&(p.type==17||p.type==0||p.type==13)){l.consume(),this.propImportant=!0;continue}this.exprError(\"E_CSS_SYNTAX\",u);continue;case 54:switch(p=l.nthToken(1),p.type){case 4:case 3:case 5:if(!p.precededBySpace){l.consume();continue}}c.push(new kn(\"+\")),l.consume();continue;case 26:l.consume();case 48:m=this.valStackReduce(\";\",u),m&&this.propName&&a.property(this.propName,m,this.propImportant),this.actions=n?kr:me;continue;case 44:for(l.consume();c.length>0;){let b=c.length;if(m=this.valStackReduce(\";\",u),!m||c.length===b)break}return e?(this.result=m,!0):(this.propName&&m&&a.property(this.propName,m,this.propImportant),!0);case 31:if(p=l.nthToken(1),p.type==9)l.nthToken(2).type==10&&!l.nthToken(2).precededBySpace?(c.push(u.text,p.text,\"(\"),l.consume()):(c.push(new le(a.getScope(),zo(u.text,p.text))),this.actions=ne),l.consume();else{if(this.exprContext==2||this.exprContext==3)u.text.toLowerCase()==\"not\"?(l.consume(),c.push(new Uo(a.getScope(),!0,p.text))):(u.text.toLowerCase()==\"only\"&&(l.consume(),u=p),c.push(new Uo(a.getScope(),!1,u.text)));else if(this.exprContext===4&&u.text.toLowerCase()===\"not\"&&c[c.length-1]!==to&&c[c.length-1]!==no&&(p.type===10||p.type===6)){c.push(-Tr),l.consume();continue}else c.push(new le(a.getScope(),u.text));this.actions=ne}l.consume();continue;case 38:if(this.exprContext===4){c.push(this.readSupportsTest(u)),this.actions=ne;continue}c.push(null,u.text,\"(\"),l.consume();continue;case 32:c.push(new se(a.getScope(),u.num)),l.consume(),this.actions=ne;continue;case 33:f=u.text,f==\"%\"&&(this.propName&&this.propName.match(/height|^(top|bottom)$/)?f=\"vh\":f=\"vw\"),c.push(new at(a.getScope(),u.num,f)),l.consume(),this.actions=ne;continue;case 34:c.push(new se(a.getScope(),u.text)),l.consume(),this.actions=ne;continue;case 35:l.consume(),u=l.token(),u.type!=5||u.precededBySpace?this.exprError(\"E_CSS_SYNTAX\",u):(c.push(new Ws(a.getScope(),u.num)),l.consume(),this.actions=ne);continue;case 36:c.push(-u.type),l.consume();continue;case 37:this.actions=ke,this.exprStackReduce(u.type,u),c.push(u.type),l.consume();continue;case 45:u.text.toLowerCase()===\"and\"&&c[c.length-2]!==no&&c[c.length-2]!==-Tr?(this.actions=ke,this.exprStackReduce(to,u),c.push(to),l.consume()):u.text.toLowerCase()===\"or\"&&c[c.length-2]!==to&&c[c.length-2]!==-Tr?(this.actions=ke,this.exprStackReduce(no,u),c.push(no),l.consume()):this.exprError(\"E_CSS_SYNTAX\",u);continue;case 39:this.exprStackReduce(u.type,u)&&(this.actions=ye),l.consume();continue;case 43:this.exprStackReduce(11,u)&&(this.propName||this.exprContext==3?this.exprError(\"E_CSS_UNEXPECTED_BRC\",u):(this.exprContext==1?a.startWhenRule(c.pop()):a.startMediaRule(c.pop()),this.ruleStack.push(\"media\"),a.startRuleBody(),this.actions=me)),l.consume();continue;case 49:if(this.exprStackReduce(11,u))return this.propName||this.exprContext!=3?(this.exprError(\"E_CSS_UNEXPECTED_SEMICOL\",u),this.actions=me,l.consume(),!1):(this.importCondition=c.pop(),this.importReady=!0,this.actions=me,l.consume(),!1);l.consume();continue;case 40:if(this.exprContext===4){let b=this.readSupportsTest(u);if(b){c.push(b),this.actions=ne;continue}}c.push(u.type),l.consume();continue;case 27:if(this.actions=me,l.consume(),a.endRule(),this.inStyleDeclaration=!1,this.ruleStack.length)switch(this.ruleStack.pop(),this.ruleStack[this.ruleStack.length-1]){case\"page\":case\"-epubx-page-master\":case\"-epubx-partition-group\":this.inStyleDeclaration=!0}continue;case 30:switch(f=u.text.toLowerCase(),f){case\"import\":if(l.consume(),u=l.token(),u.type==2||u.type==8){if(this.importURL=u.text,l.consume(),u=l.token(),u.type==17||u.type==0)return this.importReady=!0,l.consume(),!1;this.propName=null,this.exprContext=3,this.actions=ke,c.push(\"{\");continue}a.error(\"E_CSS_IMPORT_SYNTAX\",u),this.actions=Ie;continue;case\"namespace\":switch(l.consume(),u=l.token(),u.type){case 1:if(f=u.text,l.consume(),u=l.token(),(u.type==2||u.type==8)&&l.nthToken(1).type==17){this.namespacePrefixToURI[f]=u.text,l.consume(),l.consume();continue}break;case 2:case 8:if(l.nthToken(1).type==17){this.defaultNamespaceURI=u.text,l.consume(),l.consume();continue}break}a.error(\"E_CSS_NAMESPACE_SYNTAX\",u),this.actions=Ie;continue;case\"charset\":if(l.consume(),u=l.token(),u.type==2&&l.nthToken(1).type==17){f=u.text.toLowerCase(),f!=\"utf-8\"&&f!=\"utf-16\"&&a.error(`E_CSS_UNEXPECTED_CHARSET ${f}`,u),l.consume(),l.consume();continue}a.error(\"E_CSS_CHARSET_SYNTAX\",u),this.actions=Ie;continue;case\"font-face\":case\"-epubx-page-template\":case\"-epubx-define\":case\"-epubx-viewport\":if(l.nthToken(1).type==12){switch(l.consume(),l.consume(),f){case\"font-face\":a.startFontFaceRule(),this.inStyleDeclaration=!0;break;case\"-epubx-page-template\":a.startPageTemplateRule();break;case\"-epubx-define\":a.startDefineRule(),this.inStyleDeclaration=!0;break;case\"-epubx-viewport\":a.startViewportRule(),this.inStyleDeclaration=!0;break}this.ruleStack.push(f),a.startRuleBody();continue}break;case\"-adapt-footnote-area\":switch(l.consume(),u=l.token(),u.type){case 12:l.consume(),a.startFootnoteRule(null),this.ruleStack.push(f),a.startRuleBody(),this.inStyleDeclaration=!0;continue;case 50:if(l.consume(),u=l.token(),u.type==1&&l.nthToken(1).type==12){f=u.text,l.consume(),l.consume(),a.startFootnoteRule(f),this.ruleStack.push(\"-adapt-footnote-area\"),a.startRuleBody(),this.inStyleDeclaration=!0;continue}break}break;case\"-epubx-region\":l.consume(),a.startRegionRule(),this.regionRule=!0,this.actions=ut;continue;case\"page\":l.consume(),a.startPageRule(),this.pageRule=!0,this.actions=kt;continue;case\"top-left-corner\":case\"top-left\":case\"top-center\":case\"top-right\":case\"top-right-corner\":case\"right-top\":case\"right-middle\":case\"right-bottom\":case\"bottom-right-corner\":case\"bottom-right\":case\"bottom-center\":case\"bottom-left\":case\"bottom-left-corner\":case\"left-bottom\":case\"left-middle\":case\"left-top\":if(l.consume(),u=l.token(),u.type==12){l.consume(),a.startPageMarginBoxRule(f),this.ruleStack.push(f),a.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case\"-epubx-when\":l.consume(),this.propName=null,this.exprContext=1,this.actions=ke,c.push(\"{\");continue;case\"media\":l.consume(),this.propName=null,this.exprContext=2,this.actions=ke,c.push(\"{\");continue;case\"supports\":l.consume(),this.propName=null,this.exprContext=4,this.actions=ke,c.push(\"{\");continue;case\"-epubx-flow\":if(l.nthToken(1).type==1&&l.nthToken(2).type==12){a.startFlowRule(l.nthToken(1).text),l.consume(),l.consume(),l.consume(),this.ruleStack.push(f),a.startRuleBody(),this.inStyleDeclaration=!0;continue}break;case\"-epubx-page-master\":case\"-epubx-partition\":case\"-epubx-partition-group\":{l.consume(),u=l.token();let b=null,y=null,N=[];for(u.type==1&&(b=u.text,l.consume(),u=l.token()),u.type==18&&l.nthToken(1).type==1&&(y=l.nthToken(1).text,l.consume(),l.consume(),u=l.token());u.type==6&&u.text.toLowerCase()==\"class\"&&l.nthToken(1).type==1&&l.nthToken(2).type==11;)N.push(l.nthToken(1).text),l.consume(),l.consume(),l.consume(),u=l.token();if(u.type==12){switch(l.consume(),f){case\"-epubx-page-master\":a.startPageMasterRule(b,y,N);break;case\"-epubx-partition\":a.startPartitionRule(b,y,N);break;case\"-epubx-partition-group\":a.startPartitionGroupRule(b,y,N);break}this.ruleStack.push(f),a.startRuleBody(),this.inStyleDeclaration=!0;continue}break}case\"\":a.error(`E_CSS_UNEXPECTED_AT${f}`,u),this.actions=Re;continue;default:a.error(`E_CSS_AT_UNKNOWN ${f}`,u),this.actions=Ie;continue}a.error(`E_CSS_AT_SYNTAX ${f}`,u),this.actions=Ie;continue;case 50:this.errorBrackets.push(u.type+1),l.consume();continue;case 52:if(this.errorBrackets.length==0){this.actions=me;continue}case 51:if(o&&this.errorBrackets.length==0&&u.type==11)return l.consume(),a.endFuncWithSelector(),!0;this.errorBrackets.length>0&&this.errorBrackets[this.errorBrackets.length-1]==u.type&&this.errorBrackets.pop(),this.errorBrackets.length==0&&u.type==13&&(this.actions=me),l.consume();continue;case 53:this.errorBrackets.length==0&&(this.actions=me),l.consume();continue;case 200:return!0;default:if(s)return this.exprStackReduce(11,u)?(this.result=c.pop(),!0):!1;if(o){switch(u.type){case 16:case 11:if(this.actions===ut)a.error(\"E_CSS_SYNTAX\",u);else{let b=l.input.substring(C,u.position);a.pushSelectorText(b),C=u.position+1}if(u.type===16){a.nextSelector(),this.actions=ut,l.consume();continue}else return a.endFuncWithSelector(),l.consume(),!0;case 37:case 23:case 35:if(i){this.actions=ie;continue}break;case 12:case 14:case 10:this.errorBrackets.push(u.type+1);break}a.error(\"E_CSS_SYNTAX\",u),l.consume(),this.actions=Re;continue}if(this.actions!==Ie&&this.actions!==Re&&this.actions!==qe){if(u.type==54)a.error(\"E_CSS_SYNTAX\",u);else if(this.actions===ye){switch(u.type){case 10:case 12:case 14:this.errorBrackets.push(u.type+1);break}c.push(new kn(u.toString())),l.consume();continue}else if(u.type===12&&this.actions==ke&&c.length>0){a.startMediaRule(c.pop()),this.ruleStack.push(\"media\"),a.startRuleBody(),this.actions=me,l.consume();continue}else{if(u.type===17&&this.actions==ke)return this.actions=me,l.consume(),!1;a.error(\"E_CSS_SYNTAX\",u)}this.isInsidePropertyOnlyRule()?this.actions=qe:this.actions=Re;continue}l.consume();continue}}return!1}},Ko=class extends Yo{constructor(e){super(null);this.scope=e}error(e,n){V.warn(e,n.toString())}getScope(){return this.scope}};function xm(r,t,e,n,s){let o=k(\"parseStylesheet\"),i=new Rn(me,r,t,e),a=null;return s&&(a=Em(new Oe(s,t),t,e)),a=i.makeCondition(n,a&&a.toExpr()),a&&(t.startMediaRule(a),t.startRuleBody()),o.loop(()=>{for(;!i.runParser(100,!1,!1,!1,!1);){if(i.importReady){let c=J(i.importURL,e);i.importCondition&&(t.startMediaRule(i.importCondition),t.startRuleBody());let u=k(\"parseStylesheet.import\");return Cc(c,t,null,null).then(()=>{i.importCondition&&t.endRule(),i.importReady=!1,i.importURL=null,i.importCondition=null,u.finish(!0)}),u.result()}let l=o.timeSlice();if(l.isPending)return l}return v(!1)}).then(()=>{a&&t.endRule(),o.finish(!0)}),o.result()}function Rr(r,t,e,n,s){return cn(\"parseStylesheetFromText\",o=>{let i=new Oe(r,t);xm(i,t,e,n,s).thenFinish(o)},(o,i)=>{V.warn(i,`Failed to parse stylesheet text: ${r}`),o.finish(!1)})}function Cc(r,t,e,n){return cn(\"parseStylesheetFromURL\",s=>{cs(r).then(o=>{o.responseText?Rr(o.responseText,t,r,e,n).then(i=>{i||V.warn(`Failed to parse stylesheet from ${r}`),s.finish(!0)}):s.finish(!0)})},(s,o)=>{V.warn(o,\"Exception while fetching and parsing:\",r),s.finish(!0)})}function Zt(r,t,e){let n=new Rn(ye,t,new Ko(r),e);return n.runParser(Number.POSITIVE_INFINITY,!0,!1,!1,!1),n.result}function ih(r,t,e){new Rn(kr,r,t,e).runParser(Number.POSITIVE_INFINITY,!1,!0,!1,!1)}function Em(r,t,e){let n=new Rn(ke,r,t,e);return n.runParser(Number.POSITIVE_INFINITY,!1,!1,!0,!1),n.result}var Sm={\"z-index\":!0,\"column-count\":!0,\"flow-linger\":!0,opacity:!0,page:!0,\"flow-priority\":!0,utilization:!0};function Nm(r){return!!Sm[r]}function rh(r,t,e){let n=t.evaluate(r);switch(typeof n){case\"number\":return Nm(e)?n==Math.round(n)?new ct(n):new et(n):new P(n,\"px\");case\"string\":return n?Zt(t.scope,new Oe(n,null),\"\"):O;case\"boolean\":return n?x._true:x._false;case\"undefined\":return O}throw new Error(\"E_UNEXPECTED\")}function ah(r,t){let e={};return Object.keys(r).forEach(n=>{let s=e[n]={},o=r[n];Object.keys(o).forEach(i=>{s[i]=o[i].map(a=>{let l=t?a.logical:a.physical,c=t?a.physical:a.logical;return{regexp:new RegExp(`(-?)${l}(-?)`),to:`$1${c}$2`}})})}),e}function lh(r,t,e,n){let s=n[t];if(!s)throw new Error(`unknown writing-mode: ${t}`);let o=s[e||\"ltr\"];if(!o)throw new Error(`unknown direction: ${e}`);for(let i of o){let a=r.replace(i.regexp,i.to);if(a!==r)return a}return r}var ch={\"horizontal-tb\":{ltr:[{logical:\"inline-start\",physical:\"left\"},{logical:\"inline-end\",physical:\"right\"},{logical:\"block-start\",physical:\"top\"},{logical:\"block-end\",physical:\"bottom\"},{logical:\"inline-size\",physical:\"width\"},{logical:\"block-size\",physical:\"height\"}],rtl:[{logical:\"inline-start\",physical:\"right\"},{logical:\"inline-end\",physical:\"left\"},{logical:\"block-start\",physical:\"top\"},{logical:\"block-end\",physical:\"bottom\"},{logical:\"inline-size\",physical:\"width\"},{logical:\"block-size\",physical:\"height\"}]},\"vertical-rl\":{ltr:[{logical:\"inline-start\",physical:\"top\"},{logical:\"inline-end\",physical:\"bottom\"},{logical:\"block-start\",physical:\"right\"},{logical:\"block-end\",physical:\"left\"},{logical:\"inline-size\",physical:\"height\"},{logical:\"block-size\",physical:\"width\"}],rtl:[{logical:\"inline-start\",physical:\"bottom\"},{logical:\"inline-end\",physical:\"top\"},{logical:\"block-start\",physical:\"right\"},{logical:\"block-end\",physical:\"left\"},{logical:\"inline-size\",physical:\"height\"},{logical:\"block-size\",physical:\"width\"}]},\"vertical-lr\":{ltr:[{logical:\"inline-start\",physical:\"top\"},{logical:\"inline-end\",physical:\"bottom\"},{logical:\"block-start\",physical:\"left\"},{logical:\"block-end\",physical:\"right\"},{logical:\"inline-size\",physical:\"height\"},{logical:\"block-size\",physical:\"width\"}],rtl:[{logical:\"inline-start\",physical:\"bottom\"},{logical:\"inline-end\",physical:\"top\"},{logical:\"block-start\",physical:\"left\"},{logical:\"block-end\",physical:\"right\"},{logical:\"inline-size\",physical:\"height\"},{logical:\"block-size\",physical:\"width\"}]}},vm=ah(ch,!0);function bc(r,t,e){return lh(r,t,e||null,vm)}var Tm=ah(ch,!1);function yc(r,t,e){return lh(r,t,e||null,Tm)}var wm={\"horizontal-tb\":[{logical:\"line-left\",physical:\"left\"},{logical:\"line-right\",physical:\"right\"},{logical:\"over\",physical:\"top\"},{logical:\"under\",physical:\"bottom\"}],\"vertical-rl\":[{logical:\"line-left\",physical:\"top\"},{logical:\"line-right\",physical:\"bottom\"},{logical:\"over\",physical:\"right\"},{logical:\"under\",physical:\"left\"}],\"vertical-lr\":[{logical:\"line-left\",physical:\"top\"},{logical:\"line-right\",physical:\"bottom\"},{logical:\"over\",physical:\"right\"},{logical:\"under\",physical:\"left\"}]};function uh(r,t){let e=wm[t];if(!e)throw new Error(`unknown writing-mode: ${t}`);for(let n=0;n<e.length;n++)if(e[n].physical===r)return e[n].logical;return r}function so(r,t,e){let n={display:t.style.display,position:t.style.position,width:t.style.width,maxWidth:t.style.maxWidth,minWidth:t.style.minWidth,height:t.style.height,maxHeight:t.style.maxHeight,minHeight:t.style.minHeight,top:t.style.top,right:t.style.right,bottom:t.style.bottom,left:t.style.left},s=t.ownerDocument,o=t.parentNode,i=s.createElement(\"div\");T(i,\"position\",n.position),o.insertBefore(i,t),i.appendChild(t),T(t,\"width\",\"auto\"),T(t,\"max-width\",\"none\"),T(t,\"min-width\",\"0\"),T(t,\"height\",\"auto\"),T(t,\"max-height\",\"none\"),T(t,\"min-height\",\"0\");function a(N){return r.getElementComputedStyle(t).getPropertyValue(N)}let l=El(\"writing-mode\"),c=(l?a(l[0]):null)||a(\"writing-mode\"),u=c===\"vertical-rl\"||c===\"tb-rl\"||c===\"vertical-lr\"||c===\"tb-lr\",p=u?\"height\":\"width\",h=u?\"width\":\"height\";function f(){(n.position===\"absolute\"||n.position===\"fixed\")&&(T(i,\"width\",n.width),T(i,\"height\",n.height),T(i,\"top\",n.top),T(i,\"right\",n.right),T(i,\"bottom\",n.bottom),T(i,\"left\",n.left)),T(t,\"display\",\"block\"),T(t,\"position\",\"static\");let N=a(p);return T(i,\"width\",\"\"),T(i,\"height\",\"\"),T(i,\"top\",\"\"),T(i,\"right\",\"\"),T(i,\"bottom\",\"\"),T(i,\"left\",\"\"),N}function g(){T(t,\"display\",\"inline-block\"),T(i,p,\"99999999px\");let N=a(p);return T(i,p,\"\"),N}function m(){T(t,\"display\",\"inline-block\"),T(i,p,\"0\");let N=a(p);return T(i,p,\"\"),N}function E(){let N=f(),S=m(),w=parseFloat(N);if(w<=parseFloat(S))return S;{let A=g();return w<=parseFloat(A)?N:A}}function C(){return a(h)}function b(){throw new Error(\"Getting fill-available block size is not implemented\")}let y={};return e.forEach(N=>{var w;let S;switch(N){case\"fill-available inline size\":S=f();break;case\"max-content inline size\":S=g();break;case\"min-content inline size\":S=m();break;case\"fit-content inline size\":S=E();break;case\"fill-available block size\":S=b();break;case\"max-content block size\":case\"min-content block size\":case\"fit-content block size\":S=C();break;case\"fill-available width\":S=u?b():f();break;case\"fill-available height\":S=u?f():b();break;case\"max-content width\":S=u?C():g();break;case\"max-content height\":S=u?g():C();break;case\"min-content width\":S=u?C():m();break;case\"min-content height\":S=u?m():C();break;case\"fit-content width\":S=u?C():E();break;case\"fit-content height\":S=u?E():C();break}S===\"0px\"&&t.childNodes.length===1&&((w=t.firstElementChild)==null?void 0:w.localName)===\"img\"&&!t.firstElementChild.complete&&(S=\"1px\"),y[N]=parseFloat(S),T(t,\"position\",n.position),T(t,\"display\",n.display)}),T(t,\"width\",n.width),T(t,\"max-width\",n.maxWidth),T(t,\"min-width\",n.minWidth),T(t,\"height\",n.height),T(t,\"max-height\",n.maxHeight),T(t,\"min-height\",n.minHeight),o.insertBefore(t,i),o.removeChild(i),y}function ps(r){var t,e;return((t=r==null?void 0:r.style)==null?void 0:t[\"box-decoration-break\"])===\"clone\"||((e=r==null?void 0:r.style)==null?void 0:e[\"-webkit-box-decoration-break\"])===\"clone\"}function Ec(r){let t=r.getAttribute(\"data-viv-box-break\");return t?t.split(\" \"):[]}function Sc(r,t){r.setAttribute(\"data-viv-box-break\",t.join(\" \"))}function dt(r,t){let e=Ec(r);e.includes(t)||(e.push(t),Sc(r,e))}function km(r){let t=r.getAttribute(\"data-viv-margin-discard\");return t?t.split(\" \"):[]}function Am(r,t){r.setAttribute(\"data-viv-margin-discard\",t.join(\" \"))}function Ir(r,t){let e=km(r);e.includes(t)||(e.push(t),Am(r,e))}function Lm(r){let t=r.name,e=r.value;switch(t){case\"page-break-before\":case\"page-break-after\":case\"page-break-inside\":return{name:t.replace(/^page-/,\"\"),value:e===x.always?x.page:e,important:r.important};default:return r}}var Vr={page:!0,left:!0,right:!0,recto:!0,verso:!0,column:!0,region:!0};function De(r){return!!Vr[r]}var Rm={left:!0,right:!0,recto:!0,verso:!0};function In(r){return!!Rm[r]}var Im={avoid:!0,\"avoid-page\":!0,\"avoid-column\":!0,\"avoid-region\":!0};function oo(r){return!!Im[r]}function Ve(r,t){if(r)if(t){if(In(t))return t;if(In(r))return r;{let e=De(r),n=De(t);if(e&&n)switch(t){case\"column\":return r;case\"region\":return r===\"column\"?t:r;default:return t}else return n?t:e?r:oo(t)?t:oo(r)?r:t}}else return r;else return t}function Nc(r){return De(r)?r:\"auto\"}_e(\"SIMPLE_PROPERTY\",Lm);var io=vg(Eh());function Sh(r,t){return(0,io.default)(r,t,0)}function Pc(r){return r.reduce((t,e)=>e[0]===io.default.DELETE?t:t+e[1],\"\")}function Nh(r,t){return Th(r,t,1)}function vh(r,t){return Th(r,t,-1)}function Th(r,t,e){let n=0,s=0;return r.some(o=>{for(let i=0;i<o[1].length;i++){switch(o[0]*e){case io.default.INSERT:n++;break;case io.default.DELETE:n--,s++;break;case io.default.EQUAL:s++;break}if(s>t)return!0}return!1}),Math.max(Math.min(t,s-1)+n,0)}var Or;(t=>{function r(e){return e&&e.formattingContextType===\"Block\"}t.isInstanceOfBlockFormattingContext=r})(Or||(Or={}));var Vn;(t=>{let r;(i=>(i.INLINE=\"inline\",i.COLUMN=\"column\",i.REGION=\"region\",i.PAGE=\"page\"))(r=t.FloatReference||(t.FloatReference={}))})(Vn||(Vn={}));var Zo;(t=>{function r(e){return e&&e.flagmentLayoutConstraintType==\"AfterIfContinue\"}t.isInstanceOfAfterIfContinuesLayoutConstraint=r})(Zo||(Zo={}));var Qt;(e=>{function r(n){return n?n.formattingContextType===\"RepetitiveElementsOwner\"||Ot.isInstanceOfTableFormattingContext(n):!1}e.isInstanceOfRepetitiveElementsOwnerFormattingContext=r;function t(n){return n?n.flagmentLayoutConstraintType===\"RepetitiveElementsOwner\"||Ot.isInstanceOfTableRowLayoutConstraint(n):!1}e.isInstanceOfRepetitiveElementsOwnerLayoutConstraint=t})(Qt||(Qt={}));var Ot;(e=>{function r(n){return n&&n.formattingContextType===\"Table\"}e.isInstanceOfTableFormattingContext=r;function t(n){return n&&n.flagmentLayoutConstraintType===\"TableRow\"}e.isInstanceOfTableRowLayoutConstraint=t})(Ot||(Ot={}));var At;(e=>{let r;(i=>(i[i.IGNORE=0]=\"IGNORE\",i[i.NEWLINE=1]=\"NEWLINE\",i[i.PRESERVE=2]=\"PRESERVE\"))(r=e.Whitespace||(e.Whitespace={}));let t;(a=>(a[a.NONE=0]=\"NONE\",a[a.CONTENT=1]=\"CONTENT\",a[a.ROOTLESS=2]=\"ROOTLESS\",a[a.ROOTED=3]=\"ROOTED\"))(t=e.ShadowType||(e.ShadowType={}))})(At||(At={}));var wh={transform:!0,\"transform-origin\":!0},Ph={top:!0,bottom:!0,left:!0,right:!0},Bn=class{constructor(t,e,n){this.target=t;this.name=e;this.value=n}},zm={show:function(r){r.style.visibility=\"visible\"},hide:function(r){r.style.visibility=\"hidden\"},play:function(r){r.currentTime=0,r.play()},pause:function(r){r.pause()},resume:function(r){r.play()},mute:function(r){r.muted=!0},unmute:function(r){r.muted=!1}};function Gm(r,t){let e=zm[t];return e?()=>{for(let n=0;n<r.length;n++)try{e(r[n])}catch(s){}}:null}var Fn=class Fn extends Nn{constructor(e,n){super();this.container=e;this.bleedBox=n;d(this,\"pageAreaElement\",null);d(this,\"delayedItems\",[]);d(this,\"hrefHandler\");d(this,\"elementsById\",{});d(this,\"dimensions\",{width:0,height:0});d(this,\"isFirstPage\",!1);d(this,\"isLastPage\",!1);d(this,\"isBlankPage\",!1);d(this,\"isAutoPageWidth\",!0);d(this,\"isAutoPageHeight\",!0);d(this,\"spineIndex\",0);d(this,\"position\",null);d(this,\"offset\",-1);d(this,\"side\",null);d(this,\"fetchers\",[]);d(this,\"marginBoxes\",{top:{},bottom:{},left:{},right:{}});d(this,\"pageType\",null);this.hrefHandler=s=>{let o=s.currentTarget,i=o.getAttribute(\"href\")||o.getAttributeNS(\"http://www.w3.org/1999/xlink\",\"href\");if(i){let a={type:\"hyperlink\",target:null,currentTarget:null,anchorElement:o,href:i,preventDefault(){s.preventDefault()}};this.dispatchEvent(a)}}}setAutoPageWidth(e){this.isAutoPageWidth=e,e?this.container.setAttribute(Fn.AUTO_PAGE_WIDTH_ATTRIBUTE,\"true\"):this.container.removeAttribute(Fn.AUTO_PAGE_WIDTH_ATTRIBUTE)}setAutoPageHeight(e){this.isAutoPageHeight=e,e?this.container.setAttribute(Fn.AUTO_PAGE_HEIGHT_ATTRIBUTE,\"true\"):this.container.removeAttribute(Fn.AUTO_PAGE_HEIGHT_ATTRIBUTE)}registerElementWithId(e,n){let s=this.elementsById[n];s?s.push(e):this.elementsById[n]=[e]}finish(e,n){Object.keys(this.elementsById).forEach(i=>{let a=this.elementsById[i];for(let l=0;l<a.length;)this.container.contains(a[l])?l++:a.splice(l,1);a.length===0&&delete this.elementsById[i]});let s=this.delayedItems;for(let i=0;i<s.length;i++){let a=s[i];a.target===this.container&&a.name===\"transform\"&&!this.isAutoPageWidth&&!this.isAutoPageHeight||T(a.target,a.name,a.value.toString())}let o=n.getElementClientRect(this.container);this.dimensions.width=o.width,this.dimensions.height=o.height;for(let i=0;i<e.length;i++){let a=e[i],l=this.elementsById[a.ref],c=this.elementsById[a.observer];if(l&&c){let u=Gm(l,a.action);if(u)for(let p=0;p<c.length;p++)c[p].addEventListener(a.event,u,!1)}}}};d(Fn,\"AUTO_PAGE_WIDTH_ATTRIBUTE\",\"data-vivliostyle-auto-page-width\"),d(Fn,\"AUTO_PAGE_HEIGHT_ATTRIBUTE\",\"data-vivliostyle-auto-page-height\");var ro=Fn,Mt=\"data-adapt-spec\",Ze=At.Whitespace;function Gr(r){switch(r){case\"normal\":case\"nowrap\":return Ze.IGNORE;case\"pre-line\":return Ze.NEWLINE;case\"pre\":case\"pre-wrap\":case\"break-spaces\":return Ze.PRESERVE;default:return null}}function he(r,t){if(!r)return!0;if(r.nodeType==1)return!1;let e=r.textContent;switch(t){case Ze.PRESERVE:return e.length==0;case Ze.NEWLINE:return!!e.match(/^[ \\t]*$/);case Ze.IGNORE:default:return!!e.match(/^[ \\t\\r\\n\\f]*$/)}}var Dr=class{constructor(t,e){this.flowName=t;this.parentFlowName=e;d(this,\"forcedBreakOffsets\",[]);d(this,\"formattingContext\",null)}},Mr=class{constructor(t,e,n,s,o,i,a,l,c){this.flowName=t;this.element=e;this.startOffset=n;this.priority=s;this.linger=o;this.exclusive=i;this.repeated=a;this.last=l;this.breakBefore=c;d(this,\"startPage\",-1)}isBetter(t){return this.exclusive?!t.exclusive||this.priority>t.priority?!0:this.last:!1}};function kh(r,t){return r.top-t.top}function Ah(r,t){return t.right-r.right}function Lh(r,t){var e,n;return r===t?!0:!r||!t?!1:(r.node===t.node||!!r.shadowContext&&!!t.shadowContext&&r.shadowType===At.ShadowType.ROOTLESS&&t.shadowType===At.ShadowType.ROOTLESS&&((e=r.node)==null?void 0:e.outerHTML)===((n=t.node)==null?void 0:n.outerHTML))&&r.shadowType===t.shadowType&&Ac(r.shadowContext,t.shadowContext)&&Ac(r.nodeShadow,t.nodeShadow)&&Lh(r.shadowSibling,t.shadowSibling)}function Dt(r,t){if(r===t)return!0;if(!r||!t||r.offsetInNode!==t.offsetInNode||r.after!==t.after||r.steps.length!==t.steps.length)return!1;for(let e=0;e<r.steps.length;e++)if(!Lh(r.steps[e],t.steps[e]))return!1;return!0}function Rh(r){return{steps:[{node:r,shadowType:Et.NONE,shadowContext:null,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:0}],offsetInNode:0,after:!1,preprocessedTextContent:null}}function gs(r,t){return{steps:[{node:r.sourceNode,shadowType:Et.NONE,shadowContext:r.shadowContext,nodeShadow:null,shadowSibling:null,formattingContext:null,fragmentIndex:t!=null?t:r.fragmentIndex}],offsetInNode:0,after:!1,preprocessedTextContent:r.preprocessedTextContent}}function lo(r,t){let e=new On(r.node,t,0);return e.shadowType=r.shadowType,e.shadowContext=r.shadowContext,e.nodeShadow=r.nodeShadow,e.shadowSibling=r.shadowSibling?lo(r.shadowSibling,t.copy()):null,e.formattingContext=r.formattingContext,e.fragmentIndex=r.fragmentIndex+1,e}var Et=At.ShadowType,fs=class{constructor(t,e,n,s,o,i,a){this.owner=t;this.root=e;this.xmldoc=n;this.parentShadow=s;this.type=i;this.styler=a;d(this,\"subShadow\",null);o&&(o.subShadow=this)}equals(t){return t?this.owner===t.owner&&this.xmldoc===t.xmldoc&&this.type===t.type&&Ac(this.parentShadow,t.parentShadow):!1}};function Ac(r,t){return r===t||!!r&&!!t&&r.equals(t)}var _r=class{constructor(t,e){this.outer=t;this.count=e}},On=class r{constructor(t,e,n){this.sourceNode=t;this.parent=e;this.boxOffset=n;d(this,\"offsetInNode\",0);d(this,\"after\",!1);d(this,\"shadowType\");d(this,\"shadowContext\");d(this,\"nodeShadow\",null);d(this,\"shadowSibling\",null);d(this,\"shared\",!1);d(this,\"inline\",!0);d(this,\"overflow\",!1);d(this,\"breakPenalty\");d(this,\"display\",null);d(this,\"floatReference\");d(this,\"floatSide\",null);d(this,\"clearSide\",null);d(this,\"floatMinWrapBlock\",null);d(this,\"columnSpan\",null);d(this,\"verticalAlign\",\"baseline\");d(this,\"captionSide\",\"top\");d(this,\"inlineBorderSpacing\",0);d(this,\"blockBorderSpacing\",0);d(this,\"flexContainer\",!1);d(this,\"whitespace\");d(this,\"hyphenateCharacter\");d(this,\"breakWord\");d(this,\"establishesBFC\",!1);d(this,\"containingBlockForAbsolute\",!1);d(this,\"breakBefore\",null);d(this,\"breakAfter\",null);d(this,\"viewNode\",null);d(this,\"clearSpacer\",null);d(this,\"inheritedProps\");d(this,\"vertical\");d(this,\"direction\");d(this,\"firstPseudo\");d(this,\"lang\",null);d(this,\"preprocessedTextContent\",null);d(this,\"formattingContext\");d(this,\"repeatOnBreak\",null);d(this,\"pluginProps\",{});d(this,\"fragmentIndex\",1);d(this,\"afterIfContinues\",null);d(this,\"footnotePolicy\",null);d(this,\"pageType\");this.shadowType=Et.NONE,this.shadowContext=e?e.shadowContext:null,this.breakPenalty=e?e.breakPenalty:0,this.floatReference=Vn.FloatReference.INLINE,this.whitespace=e?e.whitespace:Ze.IGNORE,this.hyphenateCharacter=e?e.hyphenateCharacter:null,this.breakWord=e?e.breakWord:!1,this.inheritedProps=e?e.inheritedProps:{},this.vertical=e?e.vertical:!1,this.direction=e?e.direction:\"ltr\",this.firstPseudo=e?e.firstPseudo:null,this.formattingContext=e?e.formattingContext:null,this.pageType=e?e.pageType:null}resetView(){this.inline=!0,this.breakPenalty=this.parent?this.parent.breakPenalty:0,this.viewNode=null,this.clearSpacer=null,this.offsetInNode=0,this.after=!1,this.display=null,this.floatReference=Vn.FloatReference.INLINE,this.floatSide=null,this.clearSide=null,this.floatMinWrapBlock=null,this.columnSpan=null,this.verticalAlign=\"baseline\",this.flexContainer=!1,this.whitespace=this.parent?this.parent.whitespace:Ze.IGNORE,this.hyphenateCharacter=this.parent?this.parent.hyphenateCharacter:null,this.breakWord=this.parent?this.parent.breakWord:!1,this.breakBefore=null,this.breakAfter=null,this.nodeShadow=null,this.establishesBFC=!1,this.containingBlockForAbsolute=!1,this.vertical=this.parent?this.parent.vertical:!1,this.nodeShadow=null,this.preprocessedTextContent=null,this.formattingContext=this.parent?this.parent.formattingContext:null,this.repeatOnBreak=null,this.pluginProps={},this.fragmentIndex=1,this.afterIfContinues=null,this.footnotePolicy=null}cloneItem(){let t=new r(this.sourceNode,this.parent,this.boxOffset);return t.offsetInNode=this.offsetInNode,t.after=this.after,t.nodeShadow=this.nodeShadow,t.shadowType=this.shadowType,t.shadowContext=this.shadowContext,t.shadowSibling=this.shadowSibling,t.inline=this.inline,t.breakPenalty=this.breakPenalty,t.display=this.display,t.floatReference=this.floatReference,t.floatSide=this.floatSide,t.clearSide=this.clearSide,t.floatMinWrapBlock=this.floatMinWrapBlock,t.columnSpan=this.columnSpan,t.verticalAlign=this.verticalAlign,t.captionSide=this.captionSide,t.inlineBorderSpacing=this.inlineBorderSpacing,t.blockBorderSpacing=this.blockBorderSpacing,t.establishesBFC=this.establishesBFC,t.containingBlockForAbsolute=this.containingBlockForAbsolute,t.flexContainer=this.flexContainer,t.whitespace=this.whitespace,t.hyphenateCharacter=this.hyphenateCharacter,t.breakWord=this.breakWord,t.breakBefore=this.breakBefore,t.breakAfter=this.breakAfter,t.viewNode=this.viewNode,t.clearSpacer=this.clearSpacer,t.firstPseudo=this.firstPseudo,t.vertical=this.vertical,t.overflow=this.overflow,t.preprocessedTextContent=this.preprocessedTextContent,t.formattingContext=this.formattingContext,t.repeatOnBreak=this.repeatOnBreak,t.pluginProps=Object.create(this.pluginProps),t.fragmentIndex=this.fragmentIndex,t.afterIfContinues=this.afterIfContinues,t.footnotePolicy=this.footnotePolicy,t}modify(){return this.shared?this.cloneItem():this}copy(){let t=this;do{if(t.shared)break;t.shared=!0,t=t.parent}while(t);return this}clone(){let t=this.cloneItem(),e=t,n;for(;(n=e.parent)!=null;)n=n.cloneItem(),e.parent=n,e=n;return t}toNodePositionStep(){return{node:this.sourceNode,shadowType:this.shadowType,shadowContext:this.shadowContext,nodeShadow:this.nodeShadow,shadowSibling:this.shadowSibling?this.shadowSibling.toNodePositionStep():null,formattingContext:this.formattingContext,fragmentIndex:this.fragmentIndex}}toNodePosition(){var s,o,i;let t=this,e=[];t.shadowType===At.ShadowType.ROOTLESS&&(t.floatReference!==Vn.FloatReference.INLINE||t.floatSide===\"footnote\")&&((i=(o=(s=t.shadowContext)==null?void 0:s.styler)==null?void 0:o.style)!=null&&i._pseudos)&&(t=t.parent);do(!t.firstPseudo||!t.parent||t.parent.firstPseudo===t.firstPseudo)&&e.push(t.toNodePositionStep()),t=t.parent;while(t);let n=this.preprocessedTextContent?vh(this.preprocessedTextContent,this.offsetInNode):this.offsetInNode;return{steps:e,offsetInNode:n,after:this.after,preprocessedTextContent:this.preprocessedTextContent}}isInsideBFC(){let t=this.parent;for(;t;){if(t.establishesBFC)return!0;t=t.parent}return!1}getContainingBlockForAbsolute(){let t=this.parent;for(;t;){if(t.containingBlockForAbsolute)return t;t=t.parent}return null}belongsTo(t){return this.formattingContext===t&&!!this.parent&&this.parent.formattingContext===t}},pt=class r{constructor(t){this.primary=t;d(this,\"floats\",null)}clone(){let t=new r(this.primary);if(this.floats){t.floats=[];for(let e=0;e<this.floats.length;++e)t.floats[e]=this.floats[e]}return t}isSamePosition(t){if(!t)return!1;if(this===t)return!0;if(!Dt(this.primary,t.primary))return!1;if(this.floats){if(!t.floats||this.floats.length!==t.floats.length)return!1;for(let e=0;e<this.floats.length;e++)if(!Dt(this.floats[e],t.floats[e]))return!1}else if(t.floats)return!1;return!0}},Ur=class r{constructor(t,e){this.chunkPosition=t;this.flowChunk=e}clone(){return new r(this.chunkPosition.clone(),this.flowChunk)}isSamePosition(t){return!!t&&(this===t||this.chunkPosition.isSamePosition(t.chunkPosition))}},Hr=class r{constructor(){d(this,\"positions\",[]);d(this,\"startBreakType\",null);d(this,\"breakAfter\",null)}clone(){let t=new r,e=this.positions,n=t.positions;for(let s=0;s<e.length;s++)n[s]=e[s].clone();return t.startBreakType=this.startBreakType,t.breakAfter=this.breakAfter,t}isSamePosition(t){if(this===t)return!0;if(!t||this.positions.length!==t.positions.length)return!1;for(let e=0;e<this.positions.length;e++)if(!this.positions[e].isSamePosition(t.positions[e]))return!1;return!0}hasContent(t){return this.positions.length>0&&this.positions[0].flowChunk.startOffset<=t}},zr=class r{constructor(){d(this,\"page\",0);d(this,\"flows\",{});d(this,\"flowPositions\",{});d(this,\"isBlankPage\",!1);d(this,\"highestSeenOffset\",0);d(this,\"highestSeenNode\");d(this,\"lookupPositionOffset\")}clone(){let t=new r;t.page=this.page,t.isBlankPage=this.isBlankPage,t.highestSeenNode=this.highestSeenNode,t.highestSeenOffset=this.highestSeenOffset,t.lookupPositionOffset=this.lookupPositionOffset,t.flows=this.flows;for(let e in this.flowPositions)t.flowPositions[e]=this.flowPositions[e].clone();return t}isSamePosition(t){if(this===t)return!0;if(!t||this.page!==t.page)return!1;let e=Object.keys(this.flowPositions),n=Object.keys(t.flowPositions);if(e.length!==n.length)return!1;for(let s of e)if(!this.flowPositions[s].isSamePosition(t.flowPositions[s]))return!1;return!0}hasContent(t,e){let n=this.flowPositions[t];return n?n.hasContent(e):!1}startSideOfFlow(t){var n;let e=(n=this.flowPositions[t])==null?void 0:n.startBreakType;return e&&In(e)?e:\"any\"}firstFlowChunkOfFlow(t){let e=this.flowPositions[t];if(!e)return null;let n=e.positions[0];return n?n.flowChunk:null}},ao=class{constructor(t){this.element=t;d(this,\"left\",0);d(this,\"top\",0);d(this,\"marginLeft\",0);d(this,\"marginRight\",0);d(this,\"marginTop\",0);d(this,\"marginBottom\",0);d(this,\"borderLeft\",0);d(this,\"borderRight\",0);d(this,\"borderTop\",0);d(this,\"borderBottom\",0);d(this,\"paddingLeft\",0);d(this,\"paddingRight\",0);d(this,\"paddingTop\",0);d(this,\"paddingBottom\",0);d(this,\"width\",0);d(this,\"height\",0);d(this,\"originX\",0);d(this,\"originY\",0);d(this,\"exclusions\",null);d(this,\"innerShape\",null);d(this,\"computedBlockSize\",0);d(this,\"snapWidth\",0);d(this,\"snapHeight\",0);d(this,\"snapOffsetX\",0);d(this,\"snapOffsetY\",0);d(this,\"vertical\",!1);d(this,\"rtl\",!1)}getInsetTop(){return this.marginTop+this.borderTop+this.paddingTop}getInsetBottom(){return this.marginBottom+this.borderBottom+this.paddingBottom}getInsetLeft(){return this.marginLeft+this.borderLeft+this.paddingLeft}getInsetRight(){return this.marginRight+this.borderRight+this.paddingRight}getInsetBefore(){return this.vertical?this.getInsetRight():this.getInsetTop()}getInsetAfter(){return this.vertical?this.getInsetLeft():this.getInsetBottom()}getInsetStart(){return this.vertical?this.getInsetTop():this.getInsetLeft()}getInsetEnd(){return this.vertical?this.getInsetBottom():this.getInsetRight()}getBeforeEdge(t){return this.vertical?t.right:t.top}getAfterEdge(t){return this.vertical?t.left:t.bottom}getStartEdge(t){return this.vertical?this.rtl?t.bottom:t.top:this.rtl?t.right:t.left}getEndEdge(t){return this.vertical?this.rtl?t.top:t.bottom:this.rtl?t.left:t.right}getInlineSize(t){return this.vertical?t.bottom-t.top:t.right-t.left}getBoxSize(t){return this.vertical?t.right-t.left:t.bottom-t.top}getBoxDir(){return this.vertical?-1:1}getInlineDir(){return this.rtl?-1:1}copyFrom(t){this.element=t.element,this.left=t.left,this.top=t.top,this.marginLeft=t.marginLeft,this.marginRight=t.marginRight,this.marginTop=t.marginTop,this.marginBottom=t.marginBottom,this.borderLeft=t.borderLeft,this.borderRight=t.borderRight,this.borderTop=t.borderTop,this.borderBottom=t.borderBottom,this.paddingLeft=t.paddingLeft,this.paddingRight=t.paddingRight,this.paddingTop=t.paddingTop,this.paddingBottom=t.paddingBottom,this.width=t.width,this.height=t.height,this.originX=t.originX,this.originY=t.originY,this.innerShape=t.innerShape,this.exclusions=t.exclusions,this.computedBlockSize=t.computedBlockSize,this.snapWidth=t.snapWidth,this.snapHeight=t.snapHeight,this.vertical=t.vertical,this.rtl=t.rtl}setVerticalPosition(t,e){this.top=t,this.height=e,T(this.element,\"top\",`${t}px`),T(this.element,\"height\",`${e}px`)}setHorizontalPosition(t,e){this.left=t,this.width=e,T(this.element,\"left\",`${t}px`),T(this.element,\"width\",`${e}px`)}setBlockPosition(t,e){if(this.vertical){let n=e+this.marginLeft+this.marginRight+this.paddingLeft+this.paddingRight+this.borderLeft+this.borderRight;this.setHorizontalPosition(t+n*this.getBoxDir(),e)}else this.setVerticalPosition(t,e)}setInlinePosition(t,e){if(this.vertical)if(this.rtl){let n=e+this.marginTop+this.marginBottom+this.paddingTop+this.paddingBottom+this.borderTop+this.borderBottom;this.setVerticalPosition(t+n*this.getInlineDir(),e)}else this.setVerticalPosition(t,e);else if(this.rtl){let n=e+this.marginLeft+this.marginRight+this.paddingLeft+this.paddingRight+this.borderLeft+this.borderRight;this.setHorizontalPosition(t+n*this.getInlineDir(),e)}else this.setHorizontalPosition(t,e)}clear(){let t=this.element,e;for(;e=t.lastChild;)t.removeChild(e)}getInnerShape(){let t=this.getInnerRect();return this.innerShape?this.innerShape.withOffset(t.x1,t.y1):$o(t.x1,t.y1,t.x2,t.y2)}getInnerRect(){let t=this.originX+this.left+this.getInsetLeft(),e=this.originY+this.top+this.getInsetTop();return new He(t,e,t+this.width,e+this.height)}getPaddingRect(){let t=this.originX+this.left+this.marginLeft+this.borderLeft,e=this.originY+this.top+this.marginTop+this.borderTop,n=this.paddingLeft+this.width+this.paddingRight,s=this.paddingTop+this.height+this.paddingBottom;return new He(t,e,t+n,e+s)}getOuterShape(t,e){let n=this.getOuterRect();return Sr(t,n.x1,n.y1,n.x2-n.x1,n.y2-n.y1,e)}getOuterRect(){let t=this.originX+this.left,e=this.originY+this.top,n=this.getInsetLeft()+this.width+this.getInsetRight(),s=this.getInsetTop()+this.height+this.getInsetBottom();return new He(t,e,t+n,e+s)}},un=class extends lt{constructor(e,n,s,o){super();this.elem=e;this.context=n;this.rootContentValue=s;this.exprContentListener=o}visitStrInner(e,n){var s;if(!n){if(((s=this.elem.lastChild)==null?void 0:s.nodeType)===3){this.elem.lastChild.textContent+=e;return}n=this.elem.ownerDocument.createTextNode(e)}this.elem.appendChild(n)}visitStr(e){return this.visitStrInner(e.str),null}visitURL(e){if(this.rootContentValue.url)this.elem.setAttribute(\"src\",e.url);else{let n=this.elem.ownerDocument.createElementNS(\"http://www.w3.org/1999/xhtml\",\"img\");n.setAttribute(\"src\",e.url),this.elem.appendChild(n)}return null}visitSpaceList(e){return this.visitValues(e.values),null}visitExpr(e){let n=e.toExpr(),s=n.evaluate(this.context);if(typeof s==\"string\"){n instanceof le&&(s=Zt(n.scope,new Oe(s,null),\"\").stringValue()),this.elem.ownerDocument;let o=this.exprContentListener(n,s,this.elem.ownerDocument);!o&&s&&n instanceof oe&&n.str.startsWith(\"running-element-\")&&(s=\"\"),this.visitStrInner(s,o)}return null}};function St(r){return r!=null&&r!==O&&r!==x.normal&&r!==x.none&&!U(r)}var ue=Vn.FloatReference;function Vh(r){switch(r){case\"inline\":return ue.INLINE;case\"column\":return ue.COLUMN;case\"region\":return ue.REGION;case\"page\":return ue.PAGE;default:throw new Error(`Unknown float-reference: ${r}`)}}function Dn(r){switch(r){case ue.INLINE:return!1;case ue.COLUMN:case ue.REGION:case ue.PAGE:return!0;default:throw new Error(`Unknown float-reference: ${r}`)}}function Ic(r,t,e){let n=t?\"vertical-rl\":\"horizontal-tb\";if((r===\"top\"||r===\"bottom\")&&(r=yc(r,n,e)),r===\"block-start\"&&(r=\"inline-start\"),r===\"block-end\"&&(r=\"inline-end\"),r===\"inline-start\"||r===\"inline-end\"){let s=bc(r,n,e),o=uh(s,n);o===\"line-left\"?r=\"left\":o===\"line-right\"&&(r=\"right\")}return r!==\"left\"&&r!==\"right\"&&(V.warn(`Invalid float value: ${r}. Fallback to left.`),r=\"left\"),r}var Jo=class{constructor(t,e,n,s,o,i){this.nodePosition=t;this.floatReference=e;this.floatSide=n;this.clearSide=s;this.flowName=o;this.floatMinWrapBlock=i;d(this,\"order\",null);d(this,\"id\",null)}getOrder(){if(this.order===null)throw new Error(\"The page float is not yet added\");return this.order}getId(){if(!this.id)throw new Error(\"The page float is not yet added\");return this.id}isAllowedOnContext(t){return t.isAnchorAlreadyAppeared(this.getId())}isAllowedToPrecede(t){return!1}},Lc=class{constructor(){d(this,\"floats\",[]);d(this,\"nextPageFloatIndex\",0)}nextOrder(){return this.nextPageFloatIndex++}createPageFloatId(t){return`pf${t}`}addPageFloat(t){if(this.floats.findIndex(n=>Dt(n.nodePosition,t.nodePosition))>=0)throw new Error(\"A page float with the same source node is already registered\");{let n=t.order=this.nextOrder();t.id=this.createPageFloatId(n),this.floats.push(t)}}findPageFloatByNodePosition(t){let e=this.floats.findIndex(n=>Dt(n.nodePosition,t));return e>=0?this.floats[e]:null}findPageFloatById(t){let e=this.floats.findIndex(n=>n.id===t);return e>=0?this.floats[e]:null}},ei=class{constructor(t,e,n,s,o){this.floatReference=t;this.floatSide=e;this.continuations=n;this.area=s;this.continues=o}hasFloat(t){return this.continuations.some(e=>e.float===t)}findNotAllowedFloat(t){for(let e=this.continuations.length-1;e>=0;e--){let n=this.continuations[e].float;if(!n.isAllowedOnContext(t))return n}return null}getOuterShape(){return this.area.getOuterShape(null,null)}getOuterRect(){return this.area.getOuterRect()}getOrder(){let t=this.continuations.map(e=>e.float);return Math.min.apply(null,t.map(e=>e.getOrder()))}shouldBeStashedBefore(t){return this.getOrder()<t.getOrder()}addContinuations(t){t.forEach(e=>{this.continuations.push(e)})}getFlowName(){let t=this.continuations[0].float.flowName;return this.continuations.every(e=>e.float.flowName===t),t}},ti=class{constructor(t,e){this.float=t;this.nodePosition=e}equals(t){return t?this===t?!0:this.float===t.float&&Dt(this.nodePosition,t.nodePosition):!1}},dn=class{constructor(t,e,n,s,o,i,a){this.parent=t;this.floatReference=e;this.container=n;this.flowName=s;this.generatingNodePosition=o;d(this,\"children\",[]);d(this,\"writingMode\");d(this,\"direction\");d(this,\"invalidated\",!1);d(this,\"floatStore\");d(this,\"forbiddenFloats\",[]);d(this,\"floatFragments\",[]);d(this,\"stashedFloatFragments\",[]);d(this,\"floatAnchors\",{});d(this,\"floatsDeferredToNext\",[]);d(this,\"floatsDeferredFromPrevious\");d(this,\"layoutConstraints\",[]);d(this,\"locked\",!1);t&&t.children.push(this),this.writingMode=i||t&&t.writingMode||x.horizontal_tb,this.direction=a||t&&t.direction||x.ltr,this.floatStore=t?t.floatStore:new Lc;let l=this.getPreviousSibling();this.floatsDeferredFromPrevious=l?[].concat(l.floatsDeferredToNext):[]}getParent(t){if(!this.parent)throw new Error(`No PageFloatLayoutContext for ${t}`);return this.parent}getPreviousSiblingOf(t,e,n,s){let o=this.children.indexOf(t);o<0&&(o=this.children.length);for(let i=o-1;i>=0;i--){let a=this.children[i];if(a.floatReference===e&&a.flowName===n&&Dt(a.generatingNodePosition,s))return a;if(a=a.getPreviousSiblingOf(null,e,n,s),a)return a}return null}getPreviousSibling(){let t=this,e=this.parent,n;for(;e;){if(n=e.getPreviousSiblingOf(t,this.floatReference,this.flowName,this.generatingNodePosition),n)return n;t=e,e=e.parent}return null}getContainer(t){return!t||t===this.floatReference?this.container:this.getParent(t).getContainer(t)}setContainer(t){this.container=t,this.reattachFloatFragments()}addPageFloat(t){this.floatStore.addPageFloat(t)}getPageFloatLayoutContext(t){return t===this.floatReference?this:this.getParent(t).getPageFloatLayoutContext(t)}findPageFloatByNodePosition(t){return this.floatStore.findPageFloatByNodePosition(t)}forbid(t){let e=t.getId(),n=t.floatReference;n===this.floatReference?this.forbiddenFloats.includes(e)||(this.forbiddenFloats.push(e),new _t().findByFloat(t).forbid(t,this)):this.getParent(n).forbid(t)}isForbidden(t){let e=t.getId(),n=t.floatReference;return n===this.floatReference?this.forbiddenFloats.includes(e):this.getParent(n).isForbidden(t)}addPageFloatFragment(t,e){let n=t.floatReference;n!==this.floatReference?this.getParent(n).addPageFloatFragment(t,e):this.floatFragments.includes(t)||(this.floatFragments.push(t),this.floatFragments.sort((s,o)=>s.getOrder()-o.getOrder())),e||this.invalidate()}removePageFloatFragment(t,e){let n=t.floatReference;if(n!==this.floatReference)this.getParent(n).removePageFloatFragment(t,e);else{let s=this.floatFragments.indexOf(t);if(s>=0){let o=this.floatFragments.splice(s,1)[0],i=o.area&&o.area.element;i&&i.parentNode&&i.parentNode.removeChild(i),e||this.invalidate()}}}findPageFloatFragment(t){if(t.floatReference!==this.floatReference)return this.getParent(t.floatReference).findPageFloatFragment(t);let e=this.floatFragments.findIndex(n=>n.hasFloat(t));return e>=0?this.floatFragments[e]:null}hasFloatFragments(t){return this.floatFragments.length>0&&(!t||this.floatFragments.some(t))?!0:this.parent?this.parent.hasFloatFragments(t):!1}hasContinuingFloatFragmentsInFlow(t){return this.hasFloatFragments(e=>e.continues&&e.getFlowName()===t)}registerPageFloatAnchor(t,e){this.floatAnchors[t.getId()]=e}collectPageFloatAnchors(){let t=Object.assign({},this.floatAnchors);return this.children.reduce((e,n)=>Object.assign(e,n.collectPageFloatAnchors()),t)}isAnchorAlreadyAppeared(t){if(this.getDeferredPageFloatContinuations().some(o=>o.float.getId()===t))return!0;let s=this.collectPageFloatAnchors()[t];return s&&this.container&&this.container.element?this.container.element.contains(s):!1}deferPageFloat(t){let e=t.float;if(e.floatReference===this.floatReference){let n=this.floatsDeferredToNext.findIndex(s=>s.float===e);n>=0?this.floatsDeferredToNext.splice(n,1,t):this.floatsDeferredToNext.push(t)}else this.getParent(e.floatReference).deferPageFloat(t)}hasPrecedingFloatsDeferredToNext(t,e){if(!e&&t.floatReference!==this.floatReference)return this.getParent(t.floatReference).hasPrecedingFloatsDeferredToNext(t,!1);let n=t.getOrder();return this.floatsDeferredToNext.some(o=>o.float.getOrder()<n&&!t.isAllowedToPrecede(o.float))?!0:this.parent?this.parent.hasPrecedingFloatsDeferredToNext(t,!0):!1}getLastFollowingFloatInFragments(t){let e=t.getOrder(),n=null;if(this.floatFragments.forEach(s=>{s.continuations.forEach(o=>{let i=o.float,a=i.getOrder();a>e&&(!n||a>n.getOrder())&&(n=i)})}),this.parent){let s=this.parent.getLastFollowingFloatInFragments(t);s&&(!n||s.getOrder()>n.getOrder())&&(n=s)}return n}getDeferredPageFloatContinuations(t){t=t||this.flowName;let e=this.floatsDeferredFromPrevious.filter(n=>!t||n.float.flowName===t);return this.parent&&(e=this.parent.getDeferredPageFloatContinuations(t).concat(e)),e.sort((n,s)=>n.float.getOrder()-s.float.getOrder())}getPageFloatContinuationsDeferredToNext(t){t=t||this.flowName;let e=this.floatsDeferredToNext.filter(n=>!t||n.float.flowName===t);return this.parent?this.parent.getPageFloatContinuationsDeferredToNext(t).concat(e):e}getFloatsDeferredToNextInChildContexts(){let t=[],e=[];for(let n=this.children.length-1;n>=0;n--){let s=this.children[n];e.includes(s.flowName)||(e.push(s.flowName),t=t.concat(s.floatsDeferredToNext.map(o=>o.float)),t=t.concat(s.getFloatsDeferredToNextInChildContexts()))}return t}checkAndForbidNotAllowedFloat(){if(this.checkAndForbidFloatFollowingDeferredFloat())return!0;for(let t=this.floatFragments.length-1;t>=0;t--){let e=this.floatFragments[t],n=e.findNotAllowedFloat(this);if(n)return this.locked?this.invalidate():(this.removePageFloatFragment(e),this.forbid(n),this.removeEndFloatFragments(e.floatSide)),!0}return this.floatReference===ue.REGION&&this.parent.locked?this.parent.checkAndForbidNotAllowedFloat():!1}checkAndForbidFloatFollowingDeferredFloat(){let t=this.getFloatsDeferredToNextInChildContexts(),e=this.floatFragments.reduce((n,s)=>n.concat(s.continuations.map(o=>o.float)),[]);e.sort((n,s)=>s.getOrder()-n.getOrder());for(let n of e){let s=n.getOrder();if(t.some(o=>!n.isAllowedToPrecede(o)&&s>o.getOrder())){if(this.locked)this.invalidate();else{this.forbid(n);let o=this.findPageFloatFragment(n);this.removePageFloatFragment(o)}return!0}}return!1}finish(){if(!this.checkAndForbidNotAllowedFloat()){for(let t=this.floatsDeferredToNext.length-1;t>=0;t--)if(!this.floatsDeferredToNext[t].float.isAllowedOnContext(this)){if(this.locked){this.invalidate();return}this.floatsDeferredToNext.splice(t,1)}this.floatsDeferredFromPrevious.forEach(t=>{this.floatsDeferredToNext.findIndex(e=>t.equals(e))>=0||this.floatFragments.some(e=>e.hasFloat(t.float))||this.floatsDeferredToNext.push(t)})}}hasSameContainerAs(t){return!!this.container&&!!t.container&&this.container.element===t.container.element}invalidate(){this.invalidated=!0,!this.locked&&(this.container&&(this.children.forEach(t=>{this.hasSameContainerAs(t)&&t.floatFragments.forEach(e=>{let n=e.area.element;n&&n.parentNode&&n.parentNode.removeChild(n)})}),this.container.clear()),this.children.forEach(t=>{t.layoutConstraints.splice(0)}),this.children.splice(0),Object.keys(this.floatAnchors).forEach(t=>{delete this.floatAnchors[t]}))}detachChildren(){let t=this.children.splice(0);return t.forEach(e=>{e.floatFragments.forEach(n=>{let s=n.area.element;s&&s.parentNode&&s.parentNode.removeChild(s)})}),t}attachChildren(t){t.forEach(e=>{this.children.push(e),e.reattachFloatFragments()})}isInvalidated(){return this.invalidated||!!this.parent&&this.parent.isInvalidated()}validate(){this.invalidated=!1}toLogical(t){let e=this.writingMode.toString(),n=this.direction.toString();return yc(t,e,n)}toPhysical(t){let e=this.writingMode.toString(),n=this.direction.toString();return bc(t,e,n)}toLogicalFloatSides(t){let e=t.split(\" \"),n=[];for(let a of e){let l=this.toLogical(a);n.includes(l)||n.push(l)}let s=[],o=!1,i=!1;for(let a=0;a<n.length;a++){let l=n[a];l.includes(\"block\")?o||(n.slice(a+1).some(c=>c.includes(\"block\"))?(s.push(\"snap-block\"),o=!0):s.push(l)):l.includes(\"inline\")&&(i||(n.slice(a+1).some(c=>c.includes(\"inline\"))?(s.push(\"snap-inline\"),i=!0):s.push(l)))}return s}removeEndFloatFragments(t){let e=this.toLogicalFloatSides(t)[0];if(e===\"block-end\"||e===\"inline-end\"){let n=0;for(;n<this.floatFragments.length;){let s=this.floatFragments[n];this.toLogicalFloatSides(s.floatSide)[0]===e?this.removePageFloatFragment(s):n++}}}stashEndFloatFragments(t){let e=t.floatReference;if(e!==this.floatReference){this.getParent(e).stashEndFloatFragments(t);return}let n=this.toLogicalFloatSides(t.floatSide)[0];if(n===\"block-end\"||n===\"snap-block\"||n===\"inline-end\"||n===\"snap-inline\"){let s=0;for(;s<this.floatFragments.length;){let o=this.floatFragments[s],i=this.toLogicalFloatSides(o.floatSide)[0];(i===n||n===\"snap-block\"&&i===\"block-end\"||n===\"snap-inline\"&&i===\"inline-end\")&&o.shouldBeStashedBefore(t)?(this.stashedFloatFragments.push(o),this.floatFragments.splice(s,1)):s++}}}restoreStashedFragments(t){if(t!==this.floatReference){this.getParent(t).restoreStashedFragments(t);return}this.stashedFloatFragments.forEach(e=>{this.addPageFloatFragment(e,!0)}),this.stashedFloatFragments.splice(0)}discardStashedFragments(t){if(t!==this.floatReference){this.getParent(t).discardStashedFragments(t);return}this.stashedFloatFragments.splice(0)}getStashedFloatFragments(t){return t===this.floatReference?this.stashedFloatFragments.concat().sort((e,n)=>n.getOrder()-e.getOrder()):this.getParent(t).getStashedFloatFragments(t)}getLimitValue(t,e,n,s){this.container;let o=this.toLogical(t),i=this.toPhysical(t),a=this.getLimitValueInner(o,e,n,s);if(this.parent&&this.parent.container){let l=this.parent.getLimitValue(i,e,n,s);switch(i){case\"top\":return Math.max(a,l);case\"left\":return Math.max(a,l);case\"bottom\":return Math.min(a,l);case\"right\":return Math.min(a,l);default:}}return a}getLimitValueInner(t,e,n,s){this.container;let o=this.getLimitValuesInner(e,n,s);switch(t){case\"block-start\":return this.container.vertical?o.right:o.top;case\"block-end\":return this.container.vertical?o.left:o.bottom;case\"inline-start\":return this.container.vertical?this.container.rtl?o.bottom:o.top:this.container.rtl?o.right:o.left;case\"inline-end\":return this.container.vertical?this.container.rtl?o.top:o.bottom:this.container.rtl?o.left:o.right;default:throw new Error(`Unknown logical side: ${t}`)}}getLimitValuesInner(t,e,n){this.container;let s=this.container.originX,o=this.container.originY,i=this.container.getPaddingRect(),a={top:i.y1-o,left:i.x1-s,bottom:i.y2-o,right:i.x2-s,floatMinWrapBlockStart:0,floatMinWrapBlockEnd:0};function l(u,p,h){return u.unit===\"%\"?h*u.num/100:t.convertLengthToPx(u,p,e)}let c=this.floatFragments;return c.length>0&&(a=c.reduce((u,p)=>{if(n&&!n(p,this))return u;let h=this.toLogicalFloatSides(p.floatSide)[0],f=p.area,g=p.continuations[0].float.floatMinWrapBlock,m=u.top,E=u.left,C=u.bottom,b=u.right,y=u.floatMinWrapBlockStart,N=u.floatMinWrapBlockEnd;switch(h){case\"inline-start\":f.vertical?m=Math.max(m,f.top+f.height):E=Math.max(E,f.left+f.width);break;case\"block-start\":f.vertical?(g&&f.left<b&&(y=l(g,f.rootViewNodes[0],i.x2-i.x1)),b=Math.min(b,f.left)):(g&&f.top+f.height>m&&(y=l(g,f.rootViewNodes[0],i.y2-i.y1)),m=Math.max(m,f.top+f.height));break;case\"inline-end\":f.vertical?C=Math.min(C,f.top):b=Math.min(b,f.left);break;case\"block-end\":f.vertical?(g&&f.left+f.width>E&&(N=l(g,f.rootViewNodes[0],i.x2-i.x1)),E=Math.max(E,f.left+f.width)):(g&&f.top<C&&(N=l(g,f.rootViewNodes[0],i.y2-i.y1)),C=Math.min(C,f.top));break;default:throw new Error(`Unknown logical float side: ${h}`)}return{top:m,left:E,bottom:C,right:b,floatMinWrapBlockStart:y,floatMinWrapBlockEnd:N}},a)),a.left+=s,a.right+=s,a.top+=o,a.bottom+=o,a}setFloatAreaDimensions(t,e,n,s,o,i,a){if(e!==this.floatReference)return this.getParent(e).setFloatAreaDimensions(t,e,n,s,o,i,a);let l=this.toLogicalFloatSides(n);if(l[0]===\"snap-block\"){if(!a[\"block-start\"]&&!a[\"block-end\"])return null}else if(l[0]===\"snap-inline\"){if(!a[\"inline-start\"]&&!a[\"inline-end\"])return null}else if(!a[l[0]])return null;t.clientLayout;let c=this.getLimitValue(\"block-start\",t.layoutContext,t.clientLayout),u=this.getLimitValue(\"block-end\",t.layoutContext,t.clientLayout),p=this.getLimitValue(\"inline-start\",t.layoutContext,t.clientLayout),h=this.getLimitValue(\"inline-end\",t.layoutContext,t.clientLayout),f=t.vertical?t.originX:t.originY,g=t.vertical?t.originY:t.originX;c=t.vertical?Math.min(c,t.left+t.getInsetLeft()+t.width+t.getInsetRight()+f):Math.max(c,t.top+f),u=t.vertical?Math.max(u,t.left+f):Math.min(u,t.top+t.getInsetTop()+t.height+t.getInsetBottom()+f);function m(N,S){let w=N(t.bands,S);return w?(t.vertical&&(w=yr(w)),c=t.vertical?Math.min(c,w.x2):Math.max(c,w.y1),u=t.vertical?Math.max(u,w.x1):Math.min(u,w.y2),!0):i}let E,C,b,y;if(o){let N=t.vertical?qs(new He(u,p,c,h)):new He(p,c,h,u);if((l[0]===\"block-start\"||l[0]===\"snap-block\"||l[0]===\"inline-start\"||l[0]===\"snap-inline\")&&!m(Wp,N)||(l[0]===\"block-end\"||l[0]===\"snap-block\"||l[0]===\"inline-end\"||l[0]===\"snap-inline\")&&!m($p,N)||(b=(u-c)*t.getBoxDir(),E=b-t.getInsetBefore()-t.getInsetAfter(),y=(h-p)*t.getInlineDir(),C=y-t.getInsetStart()-t.getInsetEnd(),!i&&(E<=0||C<=0)))return null}else{E=t.computedBlockSize,b=E+t.getInsetBefore()+t.getInsetAfter();let N=(u-c)*t.getBoxDir();if(l[0]===\"snap-block\"){if(s===null)l[0]=\"block-start\";else{let w=this.container.getPaddingRect(),A=this.container.getBoxDir()*(s-(this.container.vertical?w.x2:w.y1)),I=this.container.getBoxDir()*((this.container.vertical?w.x1:w.y2)-s-b);A<=I?l[0]=\"block-start\":l[0]=\"block-end\"}if(!a[l[0]])if(a[\"block-end\"])l[0]=\"block-end\";else return null}else if(l[0]===\"snap-inline\")if(s===null)l[0]=\"inline-start\";else if(a[\"inline-start\"])l[0]=\"inline-start\";else if(a[\"inline-end\"])l[0]=\"inline-end\";else return null;if(!i&&N<b)return null;l[0]===\"inline-start\"||l[0]===\"inline-end\"||l[1]?C=so(t.clientLayout,t.element,[\"fit-content inline size\"])[\"fit-content inline size\"]:t.adjustContentRelativeSize?C=t.getContentInlineSize():C=t.vertical?t.height:t.width,y=C+t.getInsetStart()+t.getInsetEnd();let S=(h-p)*t.getInlineDir();if(!i&&S<y)return null}return c-=f,u-=f,p-=g,h-=g,l.some(N=>N===\"inline-start\"||N===\"snap-inline\")||l.length===1&&(l[0]===\"block-start\"||l[0]===\"snap-block\")?t.setInlinePosition(p,C):(l.some(N=>N===\"inline-end\")||l.length===1&&l[0]===\"block-end\")&&t.setInlinePosition(h-y*t.getInlineDir(),C),l.some(N=>N===\"block-start\"||N===\"snap-block\")||l.length===1&&(l[0]===\"inline-start\"||l[0]===\"snap-inline\")?t.setBlockPosition(c,E):(l.some(N=>N===\"block-end\")||l.length===1&&l[0]===\"inline-end\")&&t.setBlockPosition(u-b*t.getBoxDir(),E),l.join(\" \")}getFloatFragmentExclusions(){let t=this.floatFragments.map(e=>e.getOuterShape());return this.parent?this.parent.getFloatFragmentExclusions().concat(t):t}reattachFloatFragments(){let t=this.container.element&&this.container.element.parentNode;t&&this.floatFragments.forEach(e=>{t.appendChild(e.area.element)})}getMaxReachedAfterEdge(){let t=this.getContainer().vertical;return this.floatFragments.reduce((e,n)=>{let s=n.getOuterRect();return t?Math.min(e,s.x1):Math.max(e,s.y2)},t?1/0:0)}getBlockStartEdgeOfBlockEndFloats(){let t=this.getContainer().vertical;return this.floatFragments.filter(e=>e.floatSide===\"block-end\").reduce((e,n)=>{let s=n.getOuterRect();return t?Math.max(e,s.x2):Math.min(e,s.y1)},t?0:1/0)}getPageFloatClearEdge(t,e){function n(u){return p=>u.isAnchorAlreadyAppeared(p.float.getId())}function s(u,p){return u.continuations.some(n(p))}let o=e.getPaddingRect(),i=e.vertical?o.x1:o.y2,a=this;for(;a;){if(a.floatsDeferredToNext.some(n(a)))return i;a=a.parent}e.clientLayout;let l=this.getLimitValue(\"block-start\",e.layoutContext,e.clientLayout,s);return this.getLimitValue(\"block-end\",e.layoutContext,e.clientLayout,s)*e.getBoxDir()<i*e.getBoxDir()?i:l}getPageFloatPlacementCondition(t,e,n){if(t.floatReference!==this.floatReference)return this.getParent(t.floatReference).getPageFloatPlacementCondition(t,e,n);let s={\"block-start\":!0,\"block-end\":!0,\"inline-start\":!0,\"inline-end\":!0};if(!n)return s;let o=this.toLogicalFloatSides(e)[0],i=this.toLogical(n),a;i===\"all\"?a=[\"block-start\",\"block-end\",\"inline-start\",\"inline-end\"]:i===\"both\"?a=[\"inline-start\",\"inline-end\"]:i===\"same\"?o===\"snap-block\"?a=[\"block-start\",\"block-end\"]:a=[o]:a=[i];let l=t.getOrder();function c(h){return f=>f.floatSide===h&&f.getOrder()<l}function u(h,f){return h.children.some(g=>g.floatFragments.some(c(f))||u(g,f))}function p(h,f){let g=h.parent;return!!g&&(g.floatFragments.some(c(f))||p(g,f))}return a.forEach(h=>{switch(h){case\"block-start\":case\"inline-start\":s[h]=!u(this,h);break;case\"block-end\":case\"inline-end\":s[h]=!p(this,h);break;default:throw new Error(`Unexpected side: ${h}`)}}),s}getLayoutConstraints(){return(this.parent?this.parent.getLayoutConstraints():[]).concat(this.layoutConstraints)}addLayoutConstraint(t,e){e===this.floatReference?this.layoutConstraints.push(t):this.getParent(e).addLayoutConstraint(t,e)}isColumnFullWithPageFloats(t){let e=t.layoutContext,n=t.clientLayout;let s=this,o=null;for(;s&&s.container;){let l=s.getLimitValuesInner(e,n);o?t.vertical?(l.right<o.right&&(o.right=l.right,o.floatMinWrapBlockStart=l.floatMinWrapBlockStart),l.left>o.left&&(o.left=l.left,o.floatMinWrapBlockEnd=l.floatMinWrapBlockEnd)):(l.top>o.top&&(o.top=l.top,o.floatMinWrapBlockStart=l.floatMinWrapBlockStart),l.bottom<o.bottom&&(o.bottom=l.bottom,o.floatMinWrapBlockEnd=l.floatMinWrapBlockEnd)):o=l,s=s.parent}let i=Math.max(o.floatMinWrapBlockStart,o.floatMinWrapBlockEnd);return(t.vertical?o.right-o.left:o.bottom-o.top)<=i}getMaxBlockSizeOfPageFloats(){let t=this.getContainer().vertical;return this.floatFragments.length?Math.max.apply(null,this.floatFragments.map(e=>{let n=e.area;return t?n.width:n.height})):0}lock(){this.locked=!0}unlock(){this.locked=!1}isLocked(){return this.locked}},Qo=[],_t=class{static register(t){Qo.push(t)}findByNodeContext(t){for(let e=Qo.length-1;e>=0;e--){let n=Qo[e];if(n.appliesToNodeContext(t))return n}throw new Error(`No PageFloatLayoutStrategy found for ${t}`)}findByFloat(t){for(let e=Qo.length-1;e>=0;e--){let n=Qo[e];if(n.appliesToFloat(t))return n}throw new Error(`No PageFloatLayoutStrategy found for ${t}`)}},Rc=class{appliesToNodeContext(t){return Dn(t.floatReference)}appliesToFloat(t){return!0}createPageFloat(t,e,n){let s=t.floatReference;t.floatSide;let o=t.floatSide,i=t.toNodePosition();return n.resolveFloatReferenceFromColumnSpan(s,t.columnSpan,t).thenAsync(a=>{s=a,e.flowName;let l=new Jo(i,s,o,t.clearSide,e.flowName,t.floatMinWrapBlock);return e.addPageFloat(l),v(l)})}createPageFloatFragment(t,e,n,s){let o=t[0].float;return new ei(o.floatReference,e,t,n,s)}findPageFloatFragment(t,e){return e.findPageFloatFragment(t)}adjustPageFloatArea(t,e,n){}forbid(t,e){}};_t.register(new Rc);var $m=ei,ni=class r extends Jo{constructor(e,n,s,o,i){super(e,n,\"block-end\",null,s,i);this.footnotePolicy=o}isAllowedToPrecede(e){return!(e instanceof r)}},$r=class extends $m{constructor(t,e,n,s){super(t,\"block-end\",e,n,s)}getOrder(){return 1/0}shouldBeStashedBefore(t){return t instanceof ni?!0:this.getOrder()<t.getOrder()}},Vc=class{constructor(t){this.footnote=t}allowLayout(t){let e=t.toNodePosition();return!Dt(e,this.footnote.nodePosition)}},Fc=class{appliesToNodeContext(t){return t.floatSide===\"footnote\"}appliesToFloat(t){return t instanceof ni}createPageFloat(t,e,n){let s=ue.REGION,o=e.getPageFloatLayoutContext(s);e.getPageFloatLayoutContext(ue.PAGE).hasSameContainerAs(o)&&(s=ue.PAGE);let a=t.toNodePosition();e.flowName;let l=new ni(a,s,e.flowName,t.footnotePolicy,t.floatMinWrapBlock);return e.addPageFloat(l),v(l)}createPageFloatFragment(t,e,n,s){let o=t[0].float;return new $r(o.floatReference,t,n,s)}findPageFloatFragment(t,e){let s=e.getPageFloatLayoutContext(t.floatReference).floatFragments.filter(o=>o instanceof $r);return s.length<=1,s[0]||null}adjustPageFloatArea(t,e,n){t.isFootnote=!0,t.adjustContentRelativeSize=!1;let s=t.element;t.vertical=n.layoutContext.applyFootnoteStyle(e.vertical,n.layoutContext.nodeContext&&n.layoutContext.nodeContext.direction===\"rtl\",s),t.convertPercentageSizesToPx(s),n.setComputedInsets(s,t),n.setComputedWidthAndHeight(s,t)}forbid(t,e){let n=t;switch(n.footnotePolicy){case x.line:{let s=new Vc(n);e.addLayoutConstraint(s,n.floatReference);break}}}};_t.register(new Fc);var Xm=\"data-vivliostyle-flow-root\";function Bh(r){return r.getAttribute(Xm)===\"true\"}function Fh(r){let t=(r==null?void 0:r.toString())||\"block\",e;switch(t){case\"inline-flex\":e=\"flex\";break;case\"inline-grid\":e=\"grid\";break;case\"inline-table\":e=\"table\";break;case\"inline\":case\"table-row-group\":case\"table-column\":case\"table-column-group\":case\"table-header-group\":case\"table-footer-group\":case\"table-row\":case\"table-cell\":case\"table-caption\":case\"inline-block\":e=\"block\";break;default:e=t}return L(e)}function Xr(r){return r===x.absolute||r===x.fixed}function si(r){return r instanceof Pt&&r.name===\"running\"}function Bc(r,t,e,n){return r===x.none||(Xr(t)?(e=x.none,r=Fh(r)):(e&&e!==x.none&&!U(e)||n)&&(r=Fh(r))),{display:r,position:t,float:e}}function jr(r,t,e,n){return Bc(r,t,e,n).display===x.block}function pn(r){switch(r.toString()){case\"inline\":case\"inline-block\":case\"inline-list-item\":case\"inline-flex\":case\"inline-grid\":case\"ruby\":case\"inline-table\":return!0;default:return!1}}function Yr(r){switch(r.toString()){case\"ruby-base\":case\"ruby-text\":case\"ruby-base-container\":case\"ruby-text-container\":return!0;default:return!1}}function Oh(r,t,e,n,s,o,i){return s=s||o||x.horizontal_tb,!!i||!!e&&e!==x.none&&!U(e)||Xr(t)||r===x.inline_block||r===x.table_cell||r===x.table_caption||r==x.flex||r==x.grid||r==x.flow_root||(r===x.block||r===x.list_item)&&!!n&&n!==x.visible&&n!==x.clip&&!U(n)||!!o&&s!==o}function Dh(r){return r===x.relative||r===x.absolute||r===x.fixed}function Mn(r,t,e,n){let s=r.viewNode;if(!s)return NaN;let o=s.nodeType===1?s:s.parentElement;if(o&&o.namespaceURI===\"http://www.w3.org/1999/xhtml\"){let i=o.style;if(i&&pn(i.display)&&/^([\\d\\.]|super|(text-)?top)/.test(i.verticalAlign))return NaN}if(s===o){if(r.after||!r.inline){if(r.after&&!r.inline&&o.querySelector(\"ruby\")){let a=o.parentNode,l=o.nextSibling;a.removeChild(o),a.insertBefore(o,l)}let i=t.getElementClientRect(o);if(i.left===0&&i.top===0&&i.right===0&&i.bottom===0)return NaN;if(i.right>=i.left&&i.bottom>=i.top)return r.after?n?i.left:i.bottom:n?i.right:i.top}return NaN}else{let i=NaN,a=s.ownerDocument.createRange(),l=s.textContent.length;if(!l)return NaN;r.after&&(e+=l),e>=l&&(e=l-1),a.setStart(s,e),a.setEnd(s,e+1);let c=t.getRangeClientRects(a);return c=c.filter(u=>u.right>u.left&&u.bottom>u.top),c.length?(n?i=Math.min.apply(null,c.map(u=>u.left)):i=Math.max.apply(null,c.map(u=>u.bottom)),i):NaN}}function oi(r,t,e){let n=t.clientLayout.getElementClientRect(r),s=t.getComputedMargin(r);return e?n.width+s.left+s.right:n.height+s.top+s.bottom}function hn(r){for(;r;){if(r.parentNode===r.ownerDocument)return!1;r=r.parentNode}return!0}function qr(r,t){var e;if(r)for(let n=r.lastChild,s=n;n!==t;n=s)s=n.previousSibling,!(n.nodeType===1&&n.hasAttribute(\"data-vivliostyle-float-box-moved\")&&((e=t.style)==null?void 0:e.display)===\"inline\")&&r.removeChild(n)}function Zr(r){return!!r.getAttribute(Mt)}function co(r){var n;if((r==null?void 0:r.nodeType)!==1)return!1;let t=r;if(Zr(t))return!0;let e=(n=t.style)==null?void 0:n.position;return e===\"absolute\"||e===\"fixed\"}function fn(r){let t=r==null?void 0:r.viewNode;return(t==null?void 0:t.nodeType)===1&&Zr(t)}function Mh(r){return r!==\"inline\"&&(pn(r)||Yr(r))}function Oc(r){for(let t=r.parent;t;t=t.parent)if(t.display!==\"inline\"&&pn(t.display))return t;return null}var ms=class{calculateOffset(t){return _n(this.getNodeContext(),t.collectElementsOffset())}breakPositionChosen(t){}getNodeContext(){return null}};function _n(r,t){return{current:t.reduce((e,n)=>e+n.calculateOffset(r),0),minimum:t.reduce((e,n)=>e+n.calculateMinimumOffset(r),0)}}var Jt=class extends ms{constructor(e,n,s,o){super();this.position=e;this.breakOnEdge=n;this.overflows=s;this.computedBlockSize=o;d(this,\"overflowIfRepetitiveElementsDropped\");d(this,\"isEdgeUpdated\",!1);d(this,\"edge\",0);this.overflowIfRepetitiveElementsDropped=s}findAcceptableBreak(e,n){return this.updateOverflows(e),n<this.getMinBreakPenalty()?null:e.findEdgeBreakPosition(this)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error(\"EdgeBreakPosition.prototype.updateEdge not called\");let e=this.isFirstContentOfRepetitiveElementsOwner()&&!this.overflowIfRepetitiveElementsDropped;return(oo(this.breakOnEdge)?1:0)+(this.overflows&&!e?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}updateEdge(e){var s;let n=e.calculateClonedPaddingBorder(this.position);if(this.edge=Mn(this.position,e.clientLayout,0,e.vertical)+n,!this.position.after&&!this.position.inline){let o=e.parseComputedLength(e.clientLayout.getElementComputedStyle(this.position.viewNode).marginBlockStart);this.edge-=(e.vertical?-1:1)*o}else if(this.position.after&&((s=this.position.shadowContext)==null?void 0:s.root.id)===\"table-cell\"){let o=e.element.parentElement,i=o==null?void 0:o.closest(\"table, [style*='display: table;']\");if(i){let a=i.style.borderCollapse===\"collapse\",l=0,c=0;for(let u=o;u;u=u.parentElement){let p=e.clientLayout.getElementComputedStyle(u);if((u===o||u===i&&!a)&&(l+=e.parseComputedLength(p.paddingBlockEnd)),u===i&&!a&&(l+=e.parseComputedLength(p.borderSpacing.replace(/^\\S+ (\\S+)$/,\"$1\"))),a?c=Math.max(c,e.parseComputedLength(p.borderBlockEndWidth)):(u===o||u===i)&&(c+=e.parseComputedLength(p.borderBlockEndWidth)),u===i)break}this.edge+=(e.vertical?-1:1)*(l+c)}}this.isEdgeUpdated=!0}updateOverflows(e){this.isEdgeUpdated||this.updateEdge(e);let n=this.edge,s=this.calculateOffset(e);this.overflowIfRepetitiveElementsDropped=e.isOverflown(n+(e.vertical?-1:1)*s.minimum),this.overflows=this.position.overflow=e.isOverflown(n+(e.vertical?-1:1)*s.current)}getNodeContext(){return this.position}isFirstContentOfRepetitiveElementsOwner(){let e=this.getNodeContext();if(!e||!e.parent)return!1;let{formattingContext:n}=e.parent;if(!Qt.isInstanceOfRepetitiveElementsOwnerFormattingContext(n))return!1;let s=n.getRepetitiveElements();return s?s.isFirstContentNode(e):!1}};var Un=class{find(t){let e=$e(\"RESOLVE_LAYOUT_PROCESSOR\");for(let n=0;n<e.length;n++){let s=e[n](t);if(s)return s}throw new Error(`No processor found for a formatting context: ${t.getName()}`)}},en=class{layout(t,e,n){return e.isFloatNodeContext(t)?e.layoutFloatOrFootnote(t):e.isBreakable(t)?e.layoutBreakableBlock(t):e.layoutUnbreakable(t)}createEdgeBreakPosition(t,e,n,s){return new Jt(t.copy(),e,n,s)}startNonInlineElementNode(t){return!1}afterNonInlineElementNode(t,e){return!1}clearOverflownViewNodes(t,e,n,s){var a;if(!n.viewNode||!n.viewNode.parentNode||n.shadowType===At.ShadowType.ROOTLESS&&fn(n))return;let o=n.viewNode;((a=o.parentElement)==null?void 0:a.localName)===\"viv-ts-inner\"&&(o=o.parentElement.parentElement);let i=o.parentNode;qr(i,o),s&&i.removeChild(o)}finishBreak(t,e,n,s){let o=n||e.viewNode!=null&&e.viewNode.nodeType==1&&!e.after;return t.clearOverflownViewNodes(e,o),s&&t.layoutContext.processFragmentedBlockEdge(e),v(!0)}},po=class{constructor(t){this.parent=t;d(this,\"formattingContextType\",\"Block\")}getName(){return\"Block formatting context (BlockFormattingContext)\"}isFirstTime(t,e){return e}getParent(){return this.parent}saveState(){}restoreState(t){}},ii=new en,_h=Or.isInstanceOfBlockFormattingContext;_e(\"RESOLVE_FORMATTING_CONTEXT\",(r,t,e,n,s,o)=>{let i=r.parent;return!i&&r.formattingContext||i&&r.formattingContext!==i.formattingContext?null:r.establishesBFC||!r.formattingContext&&jr(e,n,s,o)?new po(i?i.formattingContext:null):null});_e(\"RESOLVE_LAYOUT_PROCESSOR\",r=>r instanceof po?ii:null);var Hn=class{constructor(){d(this,\"initialBreakPositions\",null);d(this,\"initialStateOfFormattingContext\",null);d(this,\"initialPosition\");d(this,\"initialFragmentLayoutConstraints\")}layout(t,e){return this.prepareLayout(t,e),this.tryLayout(t,e)}tryLayout(t,e){let n=k(\"AbstractLayoutRetryer.tryLayout\");this.saveState(t,e);let s=this.resolveLayoutMode(t);return s.doLayout(t,e).then(o=>{let i=s.accept(o,e);i=s.postLayout(o,this.initialPosition,e,i),i?n.finish(o):(this.initialPosition,this.clearNodes(this.initialPosition),this.restoreState(t,e),this.tryLayout(this.initialPosition,e).thenFinish(n))}),n.result()}prepareLayout(t,e){}clearNodes(t){let e=t.viewNode||t.parent.viewNode,n;for(;n=e.lastChild;)e.removeChild(n);let s;for(;s=e.nextSibling;)s.parentNode.removeChild(s)}saveState(t,e){this.initialPosition=t.copy(),this.initialBreakPositions=[].concat(e.breakPositions),this.initialFragmentLayoutConstraints=[].concat(e.fragmentLayoutConstraints),t.formattingContext&&(this.initialStateOfFormattingContext=t.formattingContext.saveState())}restoreState(t,e){e.breakPositions=this.initialBreakPositions,e.fragmentLayoutConstraints=this.initialFragmentLayoutConstraints,t.formattingContext&&t.formattingContext.restoreState(this.initialStateOfFormattingContext)}};var _c=class{initialState(t){return{nodeContext:t,atUnforcedBreak:!1,break:!1}}startNonDisplayableNode(t){}afterNonDisplayableNode(t){}startIgnoredTextNode(t){}afterIgnoredTextNode(t){}startNonElementNode(t){}afterNonElementNode(t){}startInlineElementNode(t){}afterInlineElementNode(t){}startNonInlineElementNode(t){}afterNonInlineElementNode(t){}finish(t){}},Cs=class{constructor(t,e){this.strategy=t;this.layoutContext=e}iterate(t){let e=this.strategy,n=e.initialState(t),s=k(\"LayoutIterator\");return s.loopWithFrame(o=>{let i;for(;n.nodeContext;){n.nodeContext.viewNode?n.nodeContext.viewNode.nodeType!==1?he(n.nodeContext.viewNode,n.nodeContext.whitespace)?n.nodeContext.after?i=e.afterIgnoredTextNode(n):i=e.startIgnoredTextNode(n):n.nodeContext.after?i=e.afterNonElementNode(n):i=e.startNonElementNode(n):n.nodeContext.inline?n.nodeContext.after?i=e.afterInlineElementNode(n):i=e.startInlineElementNode(n):n.nodeContext.after?i=e.afterNonInlineElementNode(n):i=e.startNonInlineElementNode(n):n.nodeContext.after?i=e.afterNonDisplayableNode(n):i=e.startNonDisplayableNode(n);let l=(i&&i.isPending()?i:v(!0)).thenAsync(()=>n.break?v(null):this.layoutContext.nextInTree(n.nodeContext,n.atUnforcedBreak));if(l.isPending()){l.then(c=>{n.break?o.breakLoop():(n.nodeContext=c,o.continueLoop())});return}else if(n.break){o.breakLoop();return}else n.nodeContext=l.get()}e.finish(n),o.breakLoop()}).then(()=>{s.finish(n.nodeContext)}),s.result()}},gn=class extends _c{constructor(e){super();this.leadingEdge=e}startNonInlineBox(e){}endEmptyNonInlineBox(e){}endNonInlineBox(e){}initialState(e){return{nodeContext:e,atUnforcedBreak:!!this.leadingEdge&&e.after,break:!1,leadingEdge:this.leadingEdge,breakAtTheEdge:null,onStartEdges:!1,leadingEdgeContexts:[],lastAfterNodeContext:null}}processForcedBreak(e,n){let s=!e.leadingEdge&&De(e.breakAtTheEdge);if(s){let o=e.nodeContext=e.leadingEdgeContexts[0]||e.nodeContext;o.viewNode.parentNode.removeChild(o.viewNode),n.pageBreakType=e.breakAtTheEdge}return s}saveEdgeAndProcessOverflow(e,n){let s=n.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!0,e.breakAtTheEdge);return s&&(e.nodeContext=(e.lastAfterNodeContext||e.nodeContext).modify(),e.nodeContext.overflow=!0),s}processLayoutConstraint(e,n,s){let o=e.nodeContext,i=!n.allowLayout(o);return i&&(s.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!1,e.breakAtTheEdge),o=e.nodeContext=o.modify(),o.overflow=!0),i}startNonElementNode(e){e.onStartEdges=!1}startNonInlineElementNode(e){return e.leadingEdgeContexts.push(e.nodeContext.copy()),e.breakAtTheEdge=Ve(e.breakAtTheEdge,e.nodeContext.breakBefore),e.onStartEdges=!0,this.startNonInlineBox(e)}afterNonInlineElementNode(e){let n,s;return e.onStartEdges?(n=this.endEmptyNonInlineBox(e),s=n&&n.isPending()?n:v(!0),s=s.thenAsync(()=>(e.break||(e.leadingEdgeContexts=[],e.leadingEdge=!1,e.atUnforcedBreak=!1,e.breakAtTheEdge=null),v(!0)))):(n=this.endNonInlineBox(e),s=n&&n.isPending()?n:v(!0)),s.thenAsync(()=>(e.break||(e.onStartEdges=!1,e.lastAfterNodeContext=e.nodeContext.copy(),e.breakAtTheEdge=Ve(e.breakAtTheEdge,e.nodeContext.breakAfter)),v(!0)))}};var Jr=[];function Hh(){Jr=[]}function zc(r,t,e){return r-=e,t===0?r===0:r%t===0&&r/t>=0}var Uc=class{constructor(t){this.matchers=t}matches(){return this.matchers.some(t=>t.matches())}},Hc=class{constructor(t){this.matchers=t}matches(){return this.matchers.every(t=>t.matches())}},ho=class ho{constructor(t,e,n){this.elementOffset=t;this.a=e;this.b=n}static registerFragmentIndex(t,e,n){let s=ho.fragmentIndices;(!s[t]||s[t].priority<=n)&&(s[t]={fragmentIndex:e,priority:n})}static clearFragmentIndices(){ho.fragmentIndices={}}matches(){let t=ho.fragmentIndices[this.elementOffset];return t!=null&&t.fragmentIndex!=null&&zc(t.fragmentIndex,this.a,this.b)}};d(ho,\"fragmentIndices\",{});var zn=ho,bs=class{static buildViewConditionMatcher(t,e){let n=e.split(\"_\");return n[0]==\"NFS\"?new zn(t,parseInt(n[1],10),parseInt(n[2],10)):(`${e}`,null)}static buildAllMatcher(t){return new Hc(t)}static buildAnyMatcher(t){return new Uc(t)}};var ku={\"border-collapse\":!0,\"border-spacing\":!0,\"caption-side\":!0,\"clip-rule\":!0,color:!0,\"color-interpolation\":!0,\"color-rendering\":!0,cursor:!0,direction:!0,\"empty-cells\":!0,fill:!0,\"fill-opacity\":!0,\"fill-rule\":!0,\"font-kerning\":!0,\"font-size\":!0,\"font-size-adjust\":!0,\"font-family\":!0,\"font-feature-settings\":!0,\"font-style\":!0,\"font-stretch\":!0,\"font-variant-ligatures\":!0,\"font-variant-caps\":!0,\"font-variant-numeric\":!0,\"font-variant-east-asian\":!0,\"font-weight\":!0,\"glyph-orientation-vertical\":!0,\"hanging-punctuation\":!0,hyphens:!0,\"hyphenate-character\":!0,\"hyphenate-limit-chars\":!0,\"hyphenate-limit-last\":!0,\"image-rendering\":!0,\"image-resolution\":!0,\"letter-spacing\":!0,\"line-break\":!0,\"line-height\":!0,\"list-style-image\":!0,\"list-style-position\":!0,\"list-style-type\":!0,marker:!0,\"marker-end\":!0,\"marker-mid\":!0,\"marker-start\":!0,orphans:!0,\"overflow-wrap\":!0,\"paint-order\":!0,\"pointer-events\":!0,quotes:!0,\"ruby-align\":!0,\"ruby-position\":!0,\"shape-rendering\":!0,stroke:!0,\"stroke-dasharray\":!0,\"stroke-dashoffset\":!0,\"stroke-linecap\":!0,\"stroke-linejoin\":!0,\"stroke-miterlimit\":!0,\"stroke-opacity\":!0,\"stroke-width\":!0,\"tab-size\":!0,\"text-align\":!0,\"text-align-last\":!0,\"text-anchor\":!0,\"text-autospace\":!0,\"text-decoration-skip\":!0,\"text-emphasis-color\":!0,\"text-emphasis-position\":!0,\"text-emphasis-style\":!0,\"text-fill-color\":!0,\"text-combine-upright\":!0,\"text-indent\":!0,\"text-justify\":!0,\"text-orientation\":!0,\"text-rendering\":!0,\"text-size-adjust\":!0,\"text-spacing-trim\":!0,\"text-stroke-color\":!0,\"text-stroke-width\":!0,\"text-transform\":!0,\"text-underline-position\":!0,visibility:!0,\"white-space\":!0,widows:!0,\"word-break\":!0,\"word-spacing\":!0,\"writing-mode\":!0},jm=[\"image-resolution\",\"orphans\",\"widows\"];function Xh(){return $e(\"POLYFILLED_INHERITED_PROPS\").reduce((t,e)=>t.concat(e()),[].concat(jm))}var Ym={\"http://www.idpf.org/2007/ops\":!0,\"http://www.w3.org/1999/xhtml\":!0,\"http://www.w3.org/2000/svg\":!0,\"http://www.w3.org/1998/Math/MathML\":!0},$c=[\"margin-%\",\"padding-%\",\"border-%-width\",\"border-%-style\",\"border-%-color\",\"%\"],Km=[\"max-%\",\"min-%\",\"%\"],qm=(()=>{let r=[\"left\",\"right\",\"top\",\"bottom\"],t={width:!0,height:!0,\"max-width\":!0,\"max-height\":!0,\"min-width\":!0,\"min-height\":!0};for(let e=0;e<$c.length;e++)for(let n=0;n<r.length;n++){let s=$c[e].replace(\"%\",r[n]);t[s]=!0}return t})();function la(r,t){let e={};for(let n of $c)for(let s in r){let o=n.replace(\"%\",s),i=n.replace(\"%\",r[s]);e[o]=i,e[i]=o}for(let n of Km)for(let s in t){let o=n.replace(\"%\",s),i=n.replace(\"%\",t[s]);e[o]=i,e[i]=o}return e}var Au=la({\"block-start\":\"right\",\"block-end\":\"left\",\"inline-start\":\"top\",\"inline-end\":\"bottom\"},{\"block-size\":\"width\",\"inline-size\":\"height\"}),Lu=la({\"block-start\":\"top\",\"block-end\":\"bottom\",\"inline-start\":\"left\",\"inline-end\":\"right\"},{\"block-size\":\"height\",\"inline-size\":\"width\"}),Zm=la({\"block-start\":\"right\",\"block-end\":\"left\",\"inline-start\":\"bottom\",\"inline-end\":\"top\"},{\"block-size\":\"width\",\"inline-size\":\"height\"}),Qm=la({\"block-start\":\"top\",\"block-end\":\"bottom\",\"inline-start\":\"right\",\"inline-end\":\"left\"},{\"block-size\":\"height\",\"inline-size\":\"width\"}),M=class r{constructor(t,e){this.value=t;this.priority=e}getBaseValue(){return this}filterValue(t){let e=this.value.visit(t);return e===this.value?this:new r(e,this.priority)}increaseSpecificity(t){return t==0?this:new r(this.value,this.priority+t)}evaluate(t,e,n,s){return e&&bt(e)?this.value:hi(t,this.value,e,n,s)}isEnabled(t){return!0}},ai=class r extends M{constructor(e,n,s){super(e,n);this.condition=s}getBaseValue(){return new M(this.value,this.priority)}filterValue(e){let n=this.value.visit(e);return n===this.value?this:new r(n,this.priority,this.condition)}increaseSpecificity(e){return e==0?this:new r(this.value,this.priority+e,this.condition)}isEnabled(e){try{return!!this.condition.evaluate(e)}catch(n){V.warn(n)}return!1}};function Xc(r,t,e){return(!t||e.priority>=t.priority)&&e.isEnabled(r)?e.getBaseValue():t}function tn(r,t,e,n){if(r)if(!e)delete r[t];else{let s=r[t];(!s||e.priority>=s.priority)&&(n?e.isEnabled(n)&&(r[t]=e.getBaseValue()):r[t]=e)}}var jh={\"region-id\":!0,\"fragment-selector-id\":!0};function Jm(r){return!!jh[r]}function jc(r){return r.charAt(0)===\"_\"&&r!==\"_viewConditionalStyles\"}function xs(r){return r.charAt(0)!==\"_\"&&!jh[r]}function Wn(r){return!!ku[r]||bt(r)}function de(r,t){return r[t]}function mn(r,t,e){e?r[t]=e:delete r[t]}function Nt(r,t){return r[t]}function bo(r,t){let e=r[t];return e||(e={},r[t]=e),e}var Yh=r=>{let t=r._viewConditionalStyles;return t||(t=[],r._viewConditionalStyles=t),t};function Ru(r,t){return r[t]}function Kh(r,t){let e=r[t];return e||(e=[],r[t]=e),e}function pi(r,t,e,n,s,o,i){var l,c;if([{id:s,styleKey:\"_pseudos\"},{id:o,styleKey:\"_regions\"}].forEach(u=>{if(u.id){let p=bo(t,u.styleKey);t=p[u.id],t||(t={},p[u.id]=t)}}),i){let u=Yh(t);t={},u.push({styles:t,matcher:i})}for(let u in e)if(!jc(u))if(Jm(u)){let p=Ru(e,u),h=Kh(t,u);Array.prototype.push.apply(h,p)}else{let p=de(e,u);if(!p.isEnabled(r))continue;let h=p.increaseSpecificity(n);tn(t,u,h,r);let f=(c=(l=r.style)==null?void 0:l.validatorSet.shorthands[u])==null?void 0:c.propList;if(f)for(let g of f){let m=new M(O,h.priority);tn(t,g,m,r)}}}function qh(r,t){let e={};for(let n=0;n<t.length;n++)pi(r,e,t[n],0,null,null,null);return e}function Zh(r,t){if(r.length>0){r.sort((n,s)=>s.getPriority()-n.getPriority());let e=null;for(let n=r.length-1;n>=0;n--)e=r[n],e.chained=t,t=e;return e}return t}var ta=class extends jt{constructor(e,n){super();this.props=e;this.context=n;d(this,\"propName\",\"\")}setPropName(e){this.propName=e}getFontSize(){let e=de(this.props,\"font-size\");if(!e.value.isNumeric())return $.em;let n=e.value;if(!Vp(n.unit))throw new Error(\"Unexpected state\");return n.num*$[n.unit]}visitNumeric(e){return this.context,this.propName===\"font-size\"?Iu(e,this.getFontSize(),this.context):e.unit===\"em\"||e.unit===\"ex\"||e.unit===\"rem\"||e.unit===\"lh\"||e.unit===\"rlh\"?ca(e,this.getFontSize(),this.context):e}visitExpr(e){return this.propName==\"font-size\"?hi(this.context,e,this.propName).visit(this):e}};function ca(r,t,e){let n=r.unit,s=r.num;if(n===\"em\"||n===\"ex\"){let o=$[n]/$.em;return new P(s*o*t,\"px\")}else return n===\"rem\"?new P(s*e.fontSize(),\"px\"):n===\"rlh\"?new P(s*e.rootLineHeight,\"px\"):r}function Iu(r,t,e){r=ca(r,t,e);let n=r.unit,s=r.num;return n===\"px\"?r:n===\"%\"?new P(s/100*t,\"px\"):new P(s*e.queryUnitSize(n,!1),\"px\")}var Cn=class{apply(t){}mergeWith(t){return new Yc([this,t])}clone(){return this}},go=class extends Cn{constructor(e){super();this.conditionItem=e}apply(e){e.pushConditionItem(this.conditionItem.fresh(e))}},Yc=class r extends Cn{constructor(e){super();this.list=e}apply(e){for(let n=0;n<this.list.length;n++)this.list[n].apply(e)}mergeWith(e){return this.list.push(e),this}clone(){return new r([].concat(this.list))}},Es=class extends Cn{constructor(e,n,s,o,i){super();this.style=e;this.specificity=n;this.pseudoelement=s;this.regionId=o;this.viewConditionId=i}apply(e){pi(e.context,e.currentStyle,this.style,this.specificity,this.pseudoelement,this.regionId,e.buildViewConditionMatcher(this.viewConditionId))}},Z=class extends Cn{constructor(){super();d(this,\"chained\",null)}apply(e){this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}},Kc=class extends Z{constructor(e){super();this.className=e}apply(e){e.currentClassNames.includes(this.className)&&this.chained.apply(e)}getPriority(){return 10}makePrimary(e){return this.chained&&e.insertInTable(e.classes,this.className,this.chained),!0}},qc=class extends Z{constructor(e){super();this.id=e}apply(e){(e.currentId==this.id||e.currentXmlId==this.id)&&this.chained.apply(e)}getPriority(){return 11}makePrimary(e){return this.chained&&e.insertInTable(e.ids,this.id,this.chained),!0}},na=class extends Z{constructor(e){super();this.localName=e}apply(e){e.currentLocalName==this.localName&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){return this.chained&&e.insertInTable(e.tags,this.localName,this.chained),!0}},Zc=class extends Z{constructor(e,n){super();this.ns=e;this.localName=n}apply(e){e.currentLocalName==this.localName&&e.currentNamespace==this.ns&&this.chained.apply(e)}getPriority(){return 8}makePrimary(e){if(this.chained){let n=e.nsPrefix[this.ns];n||(n=`ns${e.nsCount++}:`,e.nsPrefix[this.ns]=n);let s=n+this.localName;e.insertInTable(e.nstags,s,this.chained)}return!0}},Qc=class extends Z{constructor(e,n){super();this.epubTypePatt=e;this.targetLocalName=n}apply(e){let n=e.currentElement;if(n instanceof HTMLAnchorElement&&n.hash&&n.href==n.baseURI+n.hash){let s=n.hash.substring(1),o=n.ownerDocument.getElementById(s);if(o&&(!this.targetLocalName||o.localName==this.targetLocalName)){let i=o.getAttributeNS(\"http://www.idpf.org/2007/ops\",\"type\")||o.getAttribute(\"epub:type\");i&&i.match(this.epubTypePatt)&&this.chained.apply(e)}}}},Jc=class extends Z{constructor(e){super();this.ns=e}apply(e){e.currentNamespace==this.ns&&this.chained.apply(e)}};function ua(r,t,e,n){if(!r)return!1;if(t!==null)return n(r,t,e);for(let s of r.getAttributeNames())if((s===e||s.endsWith(`:${e}`))&&n(r,s===e?\"\":r.lookupNamespaceURI(s.split(\":\")[0]),e))return!0;return!1}var sa=class extends Z{constructor(e,n){super();this.ns=e;this.name=n}apply(e){ua(e.currentElement,this.ns,this.name,(n,s,o)=>n.hasAttributeNS(s,o))&&this.chained.apply(e)}},eu=class extends Z{constructor(e,n,s){super();this.ns=e;this.name=n;this.value=s}apply(e){ua(e.currentElement,this.ns,this.name,(n,s,o)=>n.getAttributeNS(s,o)==this.value)&&this.chained.apply(e)}getPriority(){return this.name==\"type\"&&this.ns==\"http://www.idpf.org/2007/ops\"?9:0}makePrimary(e){return this.name==\"type\"&&this.ns==\"http://www.idpf.org/2007/ops\"?(this.chained&&e.insertInTable(e.epubtypes,this.value,this.chained),!0):!1}},tu=class extends Z{constructor(e,n){super();this.ns=e;this.name=n}apply(e){ua(e.currentElement,this.ns,this.name,(n,s,o)=>!!Ym[n.getAttributeNS(s,o)])&&this.chained.apply(e)}getPriority(){return 0}makePrimary(e){return!1}},ys=class extends Z{constructor(e,n,s){super();this.ns=e;this.name=n;this.regexp=s}apply(e){ua(e.currentElement,this.ns,this.name,(n,s,o)=>{var i;return!!((i=n.getAttributeNS(s,o))!=null&&i.match(this.regexp))})&&this.chained.apply(e)}},nu=class extends Z{constructor(e){super();this.langRegExp=e}apply(e){e.lang.match(this.langRegExp)&&this.chained.apply(e)}},oa=class extends Z{constructor(){super()}apply(t){t.isFirst&&this.chained.apply(t)}getPriority(){return 6}},su=class extends Z{constructor(){super()}apply(t){t.isRoot&&this.chained.apply(t)}getPriority(){return 12}},Gn=class extends Z{constructor(e,n){super();this.a=e;this.b=n}matchANPlusB(e){return zc(e,this.a,this.b)}},ou=class extends Gn{constructor(t,e){super(t,e)}apply(t){this.matchANPlusB(t.currentSiblingOrder)&&this.chained.apply(t)}getPriority(){return 5}},li=class extends Gn{constructor(t,e){super(t,e)}apply(t){let e=t.currentSiblingTypeCounts[t.currentNamespace][t.currentLocalName];this.matchANPlusB(e)&&this.chained.apply(t)}getPriority(){return 5}},ci=class extends Gn{constructor(t,e){super(t,e)}apply(t){let e=t.currentFollowingSiblingOrder;e===null&&(e=t.currentFollowingSiblingOrder=t.currentElement.parentNode.childElementCount-t.currentSiblingOrder+1),this.matchANPlusB(e)&&this.chained.apply(t)}getPriority(){return 4}},ui=class extends Gn{constructor(t,e){super(t,e)}apply(t){let e=t.currentFollowingSiblingTypeCounts;if(!e[t.currentNamespace]){let n=t.currentElement;do{let s=n.namespaceURI,o=n.localName,i=e[s];i||(i=e[s]={}),i[o]=(i[o]||0)+1}while(n=n.nextElementSibling)}this.matchANPlusB(e[t.currentNamespace][t.currentLocalName])&&this.chained.apply(t)}getPriority(){return 4}},iu=class extends Z{constructor(){super()}apply(t){let e=t.currentElement.firstChild;for(;e;){switch(e.nodeType){case Node.ELEMENT_NODE:return;case Node.TEXT_NODE:if(e.length>0)return}e=e.nextSibling}this.chained.apply(t)}getPriority(){return 4}},ru=class extends Z{constructor(){super()}apply(t){t.currentElement.disabled===!1&&this.chained.apply(t)}getPriority(){return 5}},au=class extends Z{constructor(){super()}apply(t){t.currentElement.disabled===!0&&this.chained.apply(t)}getPriority(){return 5}},lu=class extends Z{constructor(){super()}apply(t){let e=t.currentElement;(e.selected===!0||e.checked===!0)&&this.chained.apply(t)}getPriority(){return 5}},ze=class extends Z{constructor(e){super();this.condition=e}apply(e){if(e.conditions[this.condition])try{e.dependentConditions.push(this.condition),this.chained.apply(e)}finally{e.dependentConditions.pop()}}getPriority(){return 5}},cu=class r extends Cn{constructor(){super();d(this,\"applied\",!1)}apply(e){this.applied=!0}clone(){let e=new r;return e.applied=this.applied,e}},di=class extends Z{constructor(e){super();d(this,\"checkAppliedAction\");d(this,\"firstActions\",[]);this.checkAppliedAction=new cu;for(let n of e)this.firstActions.push(Zh(n,this.checkAppliedAction))}apply(e){for(let n of this.firstActions)if(n.apply(e),this.checkAppliedAction.applied)break;this.checkAppliedAction.applied===this.positive()&&this.chained.apply(e),this.checkAppliedAction.applied=!1}getPriority(){return Math.max(...this.firstActions.map(e=>e instanceof Z?e.getPriority():0))}positive(){return!0}relational(){return!1}},uu=class extends di{positive(){return!1}},du=class extends di{constructor(e){super([]);this.selectorTexts=e}apply(e){for(let n of this.selectorTexts){let s,o;/^\\s*[+~]/.test(n)?(o=e.currentElement.parentNode,s=`:scope > :nth-child(${Array.from(o.children).indexOf(e.currentElement)+1}) ${n}`):(o=e.currentElement,s=`:scope ${n}`);try{if(o.querySelector(s)){this.checkAppliedAction.apply(e);break}}catch(i){}}this.checkAppliedAction.applied&&this.chained.apply(e),this.checkAppliedAction.applied=!1}relational(){return!0}},mo=class{constructor(t,e,n){this.condition=t;this.viewConditionId=e;this.viewCondition=n}increment(t){t.increment(this.condition,this.viewCondition)}decrement(t){t.decrement(this.condition,this.viewCondition)}buildViewConditionMatcher(t){return t.buildViewConditionMatcher(this.viewConditionId)}},pu=class r extends mo{constructor(t,e,n){super(t,e,n)}fresh(t){return new r(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,e){return e==0&&this.increment(t),!1}pop(t,e){return e==0?(this.decrement(t),!0):!1}},hu=class r extends mo{constructor(t,e,n){super(t,e,n)}fresh(t){return new r(this.condition,this.viewConditionId,this.buildViewConditionMatcher(t))}push(t,e){return e==0?this.increment(t):e==1&&this.decrement(t),!1}pop(t,e){return e==0?(this.decrement(t),!0):(e==1&&this.increment(t),!1)}},fu=class r extends mo{constructor(e,n,s){super(e,n,s);d(this,\"fired\",!1)}fresh(e){return new r(this.condition,this.viewConditionId,this.buildViewConditionMatcher(e))}push(e,n){return this.fired?(this.decrement(e),!0):!1}pop(e,n){return this.fired?(this.decrement(e),!0):(n==0&&(this.fired=!0,this.increment(e)),!1)}},gu=class r extends mo{constructor(e,n,s){super(e,n,s);d(this,\"fired\",!1)}fresh(e){return new r(this.condition,this.viewConditionId,this.buildViewConditionMatcher(e))}push(e,n){return this.fired&&(n==-1?this.increment(e):n==0&&this.decrement(e)),!1}pop(e,n){if(this.fired){if(n==-1)return this.decrement(e),!0;n==0&&this.increment(e)}else n==0&&(this.fired=!0,this.increment(e));return!1}},mu=class{constructor(t,e){this.afterprop=t;this.element=e}fresh(t){return this}push(t,e){return!1}pop(t,e){return e==0?(t.processPseudoelementProps(this.afterprop,this.element),!0):!1}},Cu=class{constructor(t){this.lang=t}fresh(t){return this}push(t,e){return!1}pop(t,e){return e==0?(t.lang=this.lang,!0):!1}},bu=class{constructor(t){this.oldQuotes=t}fresh(t){return this}push(t,e){return!1}pop(t,e){return e==0?(t.quotes=this.oldQuotes,!0):!1}},yu=class extends jt{constructor(e){super();this.element=e}createValueFromString(e,n){switch(n){case\"url\":return e?new Ue(e):new Ue(\"about:invalid\");case\"string\":default:return e?new ce(e):new ce(\"\")}}visitFunc(e){if(e.name!==\"attr\")return super.visitFunc(e);let n=\"string\",s=null,o=null;if(e.values[0]instanceof q){let i=e.values[0].values;i.length>=2&&(n=i[1].stringValue()),s=i[0].stringValue()}else s=e.values[0].stringValue();return e.values.length>1?o=this.createValueFromString(e.values[1].stringValue(),n):o=this.createValueFromString(null,n),this.element&&this.element.hasAttribute(s)?this.createValueFromString(this.element.getAttribute(s),n):o}};function ri(r){if(St(r)){if(r instanceof ce)return r.stringValue();if(r instanceof q)return r.values.map(t=>ri(t)).join(\"\")}return\"\"}var Co=class extends jt{constructor(e,n,s){super();this.cascade=e;this.element=n;this.counterResolver=s}visitIdent(e){let n=this.cascade,s=n.quotes,o=Math.floor(s.length/2)-1;switch(e.name){case\"open-quote\":{let i=s[2*Math.min(o,n.quoteDepth)];return n.quoteDepth++,i}case\"close-quote\":return n.quoteDepth>0&&n.quoteDepth--,s[2*Math.min(o,n.quoteDepth)+1];case\"no-open-quote\":return n.quoteDepth++,new ce(\"\");case\"no-close-quote\":return n.quoteDepth>0&&n.quoteDepth--,new ce(\"\")}return e}format(e,n){let s=!1,o=!1,i;(i=n.match(/^upper-(.*)/))!=null?(s=!0,n=i[1]):(i=n.match(/^lower-(.*)/))!=null&&(o=!0,n=i[1]);let a=\"\";return Gh[n]?a=tC(Gh[n],e):Wh[n]?a=sC(Wh[n],e):$h[n]!=null?a=$h[n]:n==\"decimal-leading-zero\"?(a=`${e}`,a.length==1&&(a=`0${a}`)):n==\"cjk-ideographic\"||n==\"trad-chinese-informal\"?a=iC(e,oC):a=`${e}`,s?a.toUpperCase():o?a.toLowerCase():a}visitFuncCounter(e){let n=e[0].toString(),s=e.length>1?e[1].stringValue():\"decimal\",o=this.cascade.counters[n];if(o&&o.length){let i=o&&o.length&&o[o.length-1]||0;return new ce(this.format(i,s))}else{let i=new F(this.counterResolver.getPageCounterVal(n,a=>this.format(a||0,s)));return new q([i])}}visitFuncCounters(e){let n=e[0].toString(),s=e[1].stringValue(),o=e.length>2?e[2].stringValue():\"decimal\",i=this.cascade.counters[n],a=new je;if(i&&i.length)for(let c=0;c<i.length;c++)c>0&&a.append(s),a.append(this.format(i[c],o));let l=new F(this.counterResolver.getPageCountersVal(n,c=>{let u=[];if(c.length)for(let h=0;h<c.length;h++)u.push(this.format(c[h],o));let p=a.toString();return p.length&&u.push(p),u.length?u.join(s):this.format(0,o)}));return new q([l])}visitFuncTargetCounter(e){let n=e[0],s;n instanceof Ue?s=n.url:s=n.stringValue();let o=e[1].toString(),i=e.length>2?e[2].stringValue():\"decimal\",a=new F(this.counterResolver.getTargetCounterVal(s,o,l=>this.format(l||0,i)));return new q([a])}visitFuncTargetCounters(e){let n=e[0],s;n instanceof Ue?s=n.url:s=n.stringValue();let o=e[1].toString(),i=e[2].stringValue(),a=e.length>3?e[3].stringValue():\"decimal\",l=new F(this.counterResolver.getTargetCountersVal(s,o,c=>{let u=c.map(p=>this.format(p,a));return u.length?u.join(i):this.format(0,a)}));return new q([l])}visitFuncString(e){let n=e.length>0?e[0].stringValue():\"\",s=e.length>1?e[1].stringValue():\"first\";return new F(this.counterResolver.getNamedStringVal(n,s))}visitFuncElement(e){let n=e.length>0?e[0].stringValue():\"\",s=e.length>1?e[1].stringValue():\"first\";return new F(this.counterResolver.getRunningElementVal(n,s))}visitFuncContent(e){var o,i,a,l,c,u;let n=e.length>0?e[0].stringValue():\"text\",s=\"\";switch(n){case\"text\":s=this.element.textContent;break;case\"before\":case\"after\":{let p=Nt(this.cascade.currentStyle,\"_pseudos\"),h=(i=(o=p==null?void 0:p[n])==null?void 0:o.content)==null?void 0:i.value;s=ri(h)}break;case\"first-letter\":{let p=Nt(this.cascade.currentStyle,\"_pseudos\"),h=(ri((l=(a=p==null?void 0:p.before)==null?void 0:a.content)==null?void 0:l.value)||this.element.textContent||ri((u=(c=p==null?void 0:p.after)==null?void 0:c.content)==null?void 0:u.value)).match(Io);s=h?h[0]:\"\"}break}return new ce(s)}visitFuncLeader(e){let n=\"\";if(e[0]instanceof Be)switch(e[0].stringValue()){case\"dotted\":n=\".\";break;case\"solid\":n=\"_\";break;case\"space\":n=\" \";break}else e[0]instanceof ce&&(n=e[0].stringValue());return n.length==0?new ce(\"\"):new F(new oe(null,()=>n,\"viv-leader\"))}visitFunc(e){switch(e.name){case\"counter\":if(e.values.length<=2)return this.visitFuncCounter(e.values);break;case\"counters\":if(e.values.length<=3)return this.visitFuncCounters(e.values);break;case\"target-counter\":if(e.values.length<=3)return this.visitFuncTargetCounter(e.values);break;case\"target-counters\":if(e.values.length<=4)return this.visitFuncTargetCounters(e.values);break;case\"string\":if(e.values.length<=2)return this.visitFuncString(e.values);break;case\"element\":if(e.values.length<=2)return this.visitFuncElement(e.values);break;case\"content\":if(e.values.length<=1)return this.visitFuncContent(e.values);break;case\"leader\":if(e.values.length<=1)return this.visitFuncLeader(e.values);break}return e}},eC=(r,t,e)=>{let n=t.filter(l=>l.after&&l.viewNode.nodeType===1&&l.viewNode.getAttribute(\"data-viv-leader\"));for(let l of n){let C=function(Q){if(m===\"rtl\"){let re=\"\\u200F\";u.textContent=(Q.startsWith(re)?\"\":re)+Q+(Q.endsWith(re)?\"\":re)}else u.textContent=Q},S=function(){let Q=e.clientLayout.getElementClientRect(p);return b.left>Q.left||b.right<Q.right||b.top>Q.top||b.bottom<Q.bottom},w=function(){let Q,re;if(C(f),S())Q=1,re=f.length/h.length;else{Q=f.length/h.length,re=Q;for(let Te=0;Te<16;Te++){let Ge=f;for(let R=0;R<1<<Te;R++)Ge+=h;if(C(Ge),S()){re+=1<<Te;break}}}for(let Te=0;Te<16;Te++){let Ge=\"\",R=Math.floor((Q+re)/2);for(let G=0;G<R;G++)Ge+=h;if(C(Ge),S())re=R;else{if(Q==R)return;Q=R}}C(h)},_=function(Q){let re=0,Te=p.parentElement;for(;Te&&Te!==c.viewNode;)re+=e.getComputedInsets(Te)[Q],Te=Te.parentElement;return re};var s=C,o=S,i=w,a=_;let c=l.parent;for(;c&&c.inline;)c=c.parent;let u=l.viewNode,p=u.parentElement,h=u.getAttribute(\"data-viv-leader-value\"),f=u.textContent||h,{writingMode:g,direction:m,marginInlineEnd:E}=e.clientLayout.getElementComputedStyle(p);u.style.marginInlineStart=\"1px\",C(h),p.style.display=\"inline-block\",p.style.textIndent=\"0\";let b=e.clientLayout.getElementClientRect(c.viewNode),y=e.clientLayout.getElementClientRect(p),N=e.parseComputedLength(E);g===\"vertical-rl\"||g===\"vertical-lr\"?(m===\"rtl\"?b.top+=N:b.bottom-=N,b.left=y.left,b.right=y.right,b.top=Math.min(y.top,b.top),b.bottom=Math.max(y.bottom,b.bottom)):(m===\"rtl\"?b.left+=N:b.right-=N,b.top=y.top,b.bottom=y.bottom,b.left=Math.min(y.left,b.left),b.right=Math.max(y.right,b.right)),w();let A=e.clientLayout.getElementClientRect(p);m==\"rtl\"?p.style.float=\"left\":p.style.float=\"right\";let I=e.clientLayout.getElementClientRect(p),Ee=0;m==\"rtl\"?g==\"vertical-rl\"||g==\"vertical-lr\"?Ee=A.top-I.top-_(\"top\"):Ee=A.left-I.left-_(\"left\"):g==\"vertical-rl\"||g==\"vertical-lr\"?Ee=I.bottom-A.bottom-_(\"bottom\"):Ee=I.right-A.right-_(\"right\"),Ee=Math.max(0,Ee-.1),p.style.float=\"\",u.style.marginInlineStart=`${Ee}px`}};_e(\"POST_LAYOUT_BLOCK\",eC);var Gh={roman:[4999,1e3,\"M\",900,\"CM\",500,\"D\",400,\"CD\",100,\"C\",90,\"XC\",50,\"L\",40,\"XL\",10,\"X\",9,\"IX\",5,\"V\",4,\"IV\",1,\"I\"],armenian:[9999,9e3,\"\\u0584\",8e3,\"\\u0583\",7e3,\"\\u0582\",6e3,\"\\u0581\",5e3,\"\\u0580\",4e3,\"\\u057F\",3e3,\"\\u057E\",2e3,\"\\u057D\",1e3,\"\\u057C\",900,\"\\u057B\",800,\"\\u057A\",700,\"\\u0579\",600,\"\\u0578\",500,\"\\u0577\",400,\"\\u0576\",300,\"\\u0575\",200,\"\\u0574\",100,\"\\u0573\",90,\"\\u0572\",80,\"\\u0571\",70,\"\\u0570\",60,\"\\u056F\",50,\"\\u056E\",40,\"\\u056D\",30,\"\\u056C\",20,\"\\u056B\",10,\"\\u056A\",9,\"\\u0569\",8,\"\\u0568\",7,\"\\u0567\",6,\"\\u0566\",5,\"\\u0565\",4,\"\\u0564\",3,\"\\u0563\",2,\"\\u0562\",1,\"\\u0561\"],georgian:[19999,1e4,\"\\u10F5\",9e3,\"\\u10F0\",8e3,\"\\u10EF\",7e3,\"\\u10F4\",6e3,\"\\u10EE\",5e3,\"\\u10ED\",4e3,\"\\u10EC\",3e3,\"\\u10EB\",2e3,\"\\u10EA\",1e3,\"\\u10E9\",900,\"\\u10E8\",800,\"\\u10E7\",700,\"\\u10E6\",600,\"\\u10E5\",500,\"\\u10E4\",400,\"\\u10F3\",300,\"\\u10E2\",200,\"\\u10E1\",100,\"\\u10E0\",90,\"\\u10DF\",80,\"\\u10DE\",70,\"\\u10DD\",60,\"\\u10F2\",50,\"\\u10DC\",40,\"\\u10DB\",30,\"\\u10DA\",20,\"\\u10D9\",10,\"\\u10D8\",9,\"\\u10D7\",8,\"\\u10F1\",7,\"\\u10D6\",6,\"\\u10D5\",5,\"\\u10D4\",4,\"\\u10D3\",3,\"\\u10D2\",2,\"\\u10D1\",1,\"\\u10D0\"],hebrew:[999,400,\"\\u05EA\",300,\"\\u05E9\",200,\"\\u05E8\",100,\"\\u05E7\",90,\"\\u05E6\",80,\"\\u05E4\",70,\"\\u05E2\",60,\"\\u05E1\",50,\"\\u05E0\",40,\"\\u05DE\",30,\"\\u05DC\",20,\"\\u05DB\",19,\"\\u05D9\\u05D8\",18,\"\\u05D9\\u05D7\",17,\"\\u05D9\\u05D6\",16,\"\\u05D8\\u05D6\",15,\"\\u05D8\\u05D5\",10,\"\\u05D9\",9,\"\\u05D8\",8,\"\\u05D7\",7,\"\\u05D6\",6,\"\\u05D5\",5,\"\\u05D4\",4,\"\\u05D3\",3,\"\\u05D2\",2,\"\\u05D1\",1,\"\\u05D0\"]},Wh={latin:\"a-z\",alpha:\"a-z\",greek:\"\\u03B1-\\u03C1\\u03C3-\\u03C9\",russian:\"\\u0430-\\u0438\\u043A-\\u0449\\u044D-\\u044F\"},$h={square:\"\\u25A0\",disc:\"\\u2022\",circle:\"\\u25E6\",none:\"\"};function tC(r,t){let e=r[0];if(t>e||t<=0||t!=Math.round(t))return\"\";let n=\"\";for(let s=1;s<r.length;s+=2){let o=r[s],i=Math.floor(t/o);if(i>20)return\"\";for(t-=i*o;i>0;)n+=r[s+1],i--}return n}function nC(r){let t=[],e=0;for(;e<r.length;)if(r.substr(e+1,1)==\"-\"){let n=r.charCodeAt(e),s=r.charCodeAt(e+2);e+=3;for(let o=n;o<=s;o++)t.push(String.fromCharCode(o))}else t.push(r.substr(e++,1));return t}function sC(r,t){if(t<=0||t!=Math.round(t))return\"\";let e=nC(r),n=\"\";do{t--;let s=t%e.length;n=e[s]+n,t=(t-s)/e.length}while(t>0);return n}var oC={formal:!1,digits:\"\\u96F6\\u4E00\\u4E8C\\u4E09\\u56DB\\u4E94\\u516D\\u4E03\\u516B\\u4E5D\",markers:\"\\u5341\\u767E\\u5343\",negative:\"\\u8CA0\"};function iC(r,t){if(r>9999||r<-9999)return`${r}`;if(r==0)return t.digits.charAt(0);let e=new je;if(r<0&&(e.append(t.negative),r=-r),r<10)e.append(t.digits.charAt(r));else if(!t.formal&&r<=19)e.append(t.markers.charAt(0)),r!=0&&e.append(t.digits.charAt(r-10));else{let n=Math.floor(r/1e3);n&&(e.append(t.digits.charAt(n)),e.append(t.markers.charAt(2)));let s=Math.floor(r/100)%10;s&&(e.append(t.digits.charAt(s)),e.append(t.markers.charAt(1)));let o=Math.floor(r/10)%10;o&&(e.append(t.digits.charAt(o)),e.append(t.markers.charAt(0)));let i=r%10;i&&e.append(t.digits.charAt(i))}return e.toString()}var Vu=1/1048576;function fo(r,t){for(let e in r)t[e]=r[e].clone()}var xu=class r{constructor(){d(this,\"nsCount\",0);d(this,\"nsPrefix\",{});d(this,\"tags\",{});d(this,\"nstags\",{});d(this,\"epubtypes\",{});d(this,\"classes\",{});d(this,\"ids\",{});d(this,\"pagetypes\",{});d(this,\"order\",0)}clone(){let t=new r;t.nsCount=this.nsCount;for(let e in this.nsPrefix)t.nsPrefix[e]=this.nsPrefix[e];return fo(this.tags,t.tags),fo(this.nstags,t.nstags),fo(this.epubtypes,t.epubtypes),fo(this.classes,t.classes),fo(this.ids,t.ids),fo(this.pagetypes,t.pagetypes),t.order=this.order,t}insertInTable(t,e,n){let s=t[e];s&&(n=s.mergeWith(n)),t[e]=n}createInstance(t,e,n,s){return new Eu(this,t,e,n,s)}nextOrder(){return this.order+=Vu}},Eu=class{constructor(t,e,n,s,o){this.context=e;this.counterListener=n;this.counterResolver=s;d(this,\"code\");d(this,\"stack\",[[],[]]);d(this,\"conditions\",{});d(this,\"currentElement\",null);d(this,\"currentElementOffset\",null);d(this,\"currentStyle\",null);d(this,\"currentClassNames\",null);d(this,\"currentLocalName\",\"\");d(this,\"currentNamespace\",\"\");d(this,\"currentId\",\"\");d(this,\"currentXmlId\",\"\");d(this,\"currentNSTag\",\"\");d(this,\"currentEpubTypes\",null);d(this,\"currentPageType\",null);d(this,\"previousPageType\",null);d(this,\"firstPageType\",null);d(this,\"isFirst\",!0);d(this,\"isRoot\",!0);d(this,\"counters\",{});d(this,\"counterScoping\",[{}]);d(this,\"quotes\");d(this,\"quoteDepth\",0);d(this,\"lang\",\"\");d(this,\"siblingOrderStack\",[0]);d(this,\"currentSiblingOrder\",0);d(this,\"siblingTypeCountsStack\",[{}]);d(this,\"currentSiblingTypeCounts\");d(this,\"currentFollowingSiblingOrder\",null);d(this,\"followingSiblingOrderStack\");d(this,\"followingSiblingTypeCountsStack\",[{}]);d(this,\"currentFollowingSiblingTypeCounts\");d(this,\"viewConditions\",{});d(this,\"dependentConditions\",[]);d(this,\"elementStack\");this.code=t,this.quotes=[new ce(\"\\u201C\"),new ce(\"\\u201D\"),new ce(\"\\u2018\"),new ce(\"\\u2019\")],this.currentSiblingTypeCounts=this.siblingTypeCountsStack[0],this.followingSiblingOrderStack=[this.currentFollowingSiblingOrder],this.currentFollowingSiblingTypeCounts=this.siblingTypeCountsStack[0]}pushConditionItem(t){this.stack[this.stack.length-1].push(t)}increment(t,e){this.conditions[t]=(this.conditions[t]||0)+1,e&&(this.viewConditions[t]?this.viewConditions[t].push(e):this.viewConditions[t]=[e])}decrement(t,e){this.conditions[t]--,this.viewConditions[t]&&(this.viewConditions[t]=this.viewConditions[t].filter(n=>n!==e),this.viewConditions[t].length===0&&delete this.viewConditions[t])}buildViewConditionMatcher(t){let e=null;t&&(this.currentElementOffset,e=bs.buildViewConditionMatcher(this.currentElementOffset,t));let n=this.dependentConditions.map(s=>{let o=this.viewConditions[s];return o&&o.length>0?o.length===1?o[0]:bs.buildAnyMatcher([].concat(o)):null}).filter(s=>s);return n.length<=0?e:e===null?n.length===1?n[0]:bs.buildAllMatcher(n):bs.buildAllMatcher([e].concat(n))}applyAction(t,e){let n=t[e];n&&n.apply(this)}pushRule(t,e,n){this.currentElement=null,this.currentElementOffset=null,this.currentStyle=n,this.currentNamespace=\"\",this.currentLocalName=\"\",this.currentId=\"\",this.currentXmlId=\"\",this.currentClassNames=t,this.currentNSTag=\"\",this.currentEpubTypes=Wc,this.currentPageType=e,this.applyActions()}defineCounter(t,e){let n=this.counterScoping[this.counterScoping.length-1];n||(n={},this.counterScoping[this.counterScoping.length-1]=n),this.counters[t]?(n[t]&&this.counters[t].pop(),this.counters[t].push(e)):this.counters[t]=[e],n[t]=!0}pushCounters(t){var h,f,g,m,E,C,b;let e=x.inline,n=t.display;if(n&&(e=n.evaluate(this.context)),e===x.none){this.currentElement.setAttribute(\"data-viv-display-none\",\"true\"),this.counterScoping.push(null);return}else if(this.currentElement.closest(\"[data-viv-display-none]\")){this.counterScoping.push(null);return}let s=x.inline,o=t.float;o&&(s=o.evaluate(this.context));let i=null,a=null,l=null,c=t[\"counter-reset\"];if(c){let y=c.evaluate(this.context);y&&(i=is(y,!0))}let u=t[\"counter-set\"];if(u){let y=u.evaluate(this.context);y&&(l=is(y,!1))}let p=t[\"counter-increment\"];if(p){let y=p.evaluate(this.context);y&&(a=is(y,!1))}if((this.currentLocalName==\"ol\"||this.currentLocalName==\"ul\")&&this.currentNamespace==\"http://www.w3.org/1999/xhtml\"&&(i||(i={}),i[\"list-item\"]=((f=(h=this.currentElement)==null?void 0:h.start)!=null?f:1)-1),e===x.list_item&&(a||(a={}),a[\"list-item\"]=(g=a[\"list-item\"])!=null?g:1,/^\\s*[-+]?\\d/.test((E=(m=this.currentElement)==null?void 0:m.getAttribute(\"value\"))!=null?E:\"\")&&(l||(l={}),l[\"list-item\"]=this.currentElement.value)),((C=this.currentElement)==null?void 0:C.parentNode.nodeType)===Node.DOCUMENT_NODE&&(i||(i={}),i.footnote===void 0&&(i.footnote=0)),s===x.footnote&&(a||(a={}),a.footnote===void 0)){let y=(b=this.currentStyle[\"counter-increment\"])==null?void 0:b.value;(!y||!(y===x.footnote||y instanceof q&&y.values.includes(x.footnote)))&&(a.footnote=1)}if(i)for(let y in i)this.defineCounter(y,i[y]);if(a)for(let y in a){this.counters[y]||this.defineCounter(y,0);let N=this.counters[y];N[N.length-1]+=a[y]}if(l)for(let y in l)if(!this.counters[y])this.defineCounter(y,l[y]);else{let N=this.counters[y];N[N.length-1]=l[y]}if(e===x.list_item){let y=this.counters[\"list-item\"],N=y[y.length-1];t[\"ua-list-item-count\"]=new M(new et(N),0)}this.counterScoping.push(null)}popCounters(){let t=this.counterScoping.pop();if(t)for(let e in t){let n=this.counters[e];n&&(n.length==1?delete this.counters[e]:n.pop())}}setNamedStrings(t){let e=t[\"string-set\"];if(!e)return;e=e.filterValue(new Co(this,this.currentElement,this.counterResolver));let n=e.value instanceof ge?e.value.values:[e.value];for(let s of n)if(s instanceof q){let o=s.values[0].stringValue(),i=s.values.slice(1).map(a=>ri(a)).join(\"\");this.counterResolver.setNamedString(o,i,this.currentElementOffset)}delete t[\"string-set\"]}setRunningElement(t){let e=t.position;if((e==null?void 0:e.value)instanceof Pt&&e.value.name===\"running\"){let n=e.value.values[0].stringValue();this.counterResolver.setRunningElement(n,this.currentElementOffset)}}processPseudoelementProps(t,e){this.pushCounters(t);let n=t.content;n&&(t.content=n.filterValue(new Co(this,e,this.counterResolver))),this.popCounters()}pushElement(t,e,n,s){var S,w;this.currentPageType=null,this.currentElement=e,this.currentElementOffset=s,this.currentStyle=n,this.currentNamespace=e.namespaceURI,this.currentLocalName=e.localName;let o=this.code.nsPrefix[this.currentNamespace];o?this.currentNSTag=o+this.currentLocalName:this.currentNSTag=\"\",this.currentId=e.getAttribute(\"id\"),this.currentXmlId=e.getAttributeNS(\"http://www.w3.org/XML/1998/namespace\",\"id\");let i=e.getAttribute(\"class\");i?this.currentClassNames=i.split(/\\s+/):this.currentClassNames=Wc;let a=e.getAttributeNS(\"http://www.idpf.org/2007/ops\",\"type\");a?this.currentEpubTypes=a.split(/\\s+/):this.currentEpubTypes=Wc;let l=Vo(e);l&&(this.stack[this.stack.length-1].push(new Cu(this.lang)),this.lang=l.toLowerCase());let c=this.isRoot,u=this.siblingOrderStack;this.currentSiblingOrder=++u[u.length-1],u.push(0);let p=this.siblingTypeCountsStack,h=this.currentSiblingTypeCounts=p[p.length-1],f=h[this.currentNamespace];f||(f=h[this.currentNamespace]={}),f[this.currentLocalName]=(f[this.currentLocalName]||0)+1,p.push({});let g=this.followingSiblingOrderStack;g[g.length-1]!==null?this.currentFollowingSiblingOrder=--g[g.length-1]:this.currentFollowingSiblingOrder=null,g.push(null);let m=this.followingSiblingTypeCountsStack,E=this.currentFollowingSiblingTypeCounts=m[m.length-1];E&&E[this.currentNamespace]&&E[this.currentNamespace][this.currentLocalName]--,m.push({}),this.applyActions(),this.applyVarFilter([this.currentStyle],t,e),this.applyCalcFilter(this.currentStyle,this.context),this.applyAttrFilter(e);let C=n.quotes,b=null;if(C){let A=C.evaluate(this.context);A&&(b=new bu(this.quotes),A===x.none?this.quotes=[new ce(\"\"),new ce(\"\")]:A===x.auto||A===x.initial?this.quotes=[new ce(\"\\u201C\"),new ce(\"\\u201D\"),new ce(\"\\u2018\"),new ce(\"\\u2019\")]:A instanceof q&&(this.quotes=A.values))}this.pushCounters(this.currentStyle);let y=this.currentId||this.currentXmlId||e.getAttribute(\"name\")||\"\";if(c||y){let A={};Object.keys(this.counters).forEach(I=>{A[I]=Array.from(this.counters[I])}),this.counterListener.countersOfId(y,A)}let N=Nt(this.currentStyle,\"_pseudos\");if(N){let A=!0;for(let I of rC){I||(A=!1);let _=N[I];_&&((I===\"before\"||I===\"after\")&&!St((S=_.content)==null?void 0:S.value)||(I===\"footnote-call\"||I===\"footnote-marker\")&&((w=de(this.currentStyle,\"float\"))==null?void 0:w.value)!==x.footnote?delete N[I]:A?this.processPseudoelementProps(_,e):this.stack[this.stack.length-2].push(new mu(_,e)))}}this.setNamedStrings(this.currentStyle),this.setRunningElement(this.currentStyle),b&&this.stack[this.stack.length-2].push(b)}applyAttrFilterInner(t,e){for(let n in e)xs(n)&&!bt(n)&&(e[n]=e[n].filterValue(t))}applyAttrFilter(t){let e=new yu(t),n=this.currentStyle,s=Nt(n,\"_pseudos\");for(let o in s)this.applyAttrFilterInner(e,s[o]);this.applyAttrFilterInner(e,n)}applyVarFilter(t,e,n){var l,c,u;let s=t[0],o=new Pu(t,e,n),i=32,a={};for(let p in s)if(jc(p)){let h=Nt(s,p);for(let f in h)this.applyVarFilter([h[f],...t],e,n)}else if(xs(p)){let h=de(s,p),f=h.value;for(let g=0;;g++){if(g>=i){f=O;break}let m=f.visit(o);if(o.error){f=O,o.error=!1;break}if(m===f)break;f=m}if(f!==h.value){let g=e.validatorSet,m=(l=g==null?void 0:g.shorthands[p])==null?void 0:l.clone();if(m)if(U(f)){for(let E of m.propList){let C=new M(f,h.priority),b=de(s,E);mn(a,E,Xc(this.context,b,C))}delete s[p]}else{let E=Zt(e.scope,new Oe(f.toString(),null),\"\");if(E&&(E.visit(m),!m.error)){for(let C of m.propList){let b=new M((u=(c=m.values[C])!=null?c:g.defaultValues[C])!=null?u:x.initial,h.priority),y=de(s,C);mn(a,C,Xc(this.context,y,b))}delete s[p]}}else s[p]=new M(f,h.priority)}if(a[p]){let g=de(s,p);g&&g.value!==O&&tn(a,p,g,this.context)}}for(let p in a)s[p]=a[p]}applyCalcFilter(t,e){let n=new aa(e);for(let s in t)if(jc(s)){let o=Nt(t,s);for(let i in o)this.applyCalcFilter(o[i],e)}else if(xs(s)&&!bt(s)){let o=de(t,s),i=o.value.visit(n);i!==o.value&&(t[s]=new M(i,o.priority))}}applyActions(){let t;for(t=0;t<this.currentClassNames.length;t++)this.applyAction(this.code.classes,this.currentClassNames[t]);for(t=0;t<this.currentEpubTypes.length;t++)this.applyAction(this.code.epubtypes,this.currentEpubTypes[t]);this.applyAction(this.code.ids,this.currentId),this.applyAction(this.code.tags,this.currentLocalName),this.currentLocalName!=\"\"&&this.applyAction(this.code.tags,\"*\"),this.applyAction(this.code.nstags,this.currentNSTag),this.currentPageType!==null&&(this.applyAction(this.code.pagetypes,this.currentPageType),this.applyAction(this.code.pagetypes,\"*\")),this.stack.push([]);for(let e=1;e>=-1;--e){let n=this.stack[this.stack.length-e-2];for(t=0;t<n.length;)n[t].push(this,e)?n.splice(t,1):t++}this.isFirst=!0,this.isRoot=!1}pop(){for(let t=1;t>=-1;--t){let e=this.stack[this.stack.length-t-2],n=0;for(;n<e.length;)e[n].pop(this,t)?e.splice(n,1):n++}this.stack.pop(),this.isFirst=!1}popRule(){this.pop()}popElement(t){this.siblingOrderStack.pop(),this.siblingTypeCountsStack.pop(),this.followingSiblingOrderStack.pop(),this.followingSiblingTypeCountsStack.pop(),this.pop(),this.popCounters()}},Wc=[],rC=[\"before\",\"transclusion-before\",\"footnote-call\",\"footnote-marker\",\"inner\",\"first-letter\",\"first-line\",\"\",\"transclusion-after\",\"after\"];var Su=null;function Qh(r){Su=r}var bn=class extends qt{constructor(e,n,s,o,i,a,l){super(e,n,l);this.condition=s;this.regionId=i;this.validatorSet=a;d(this,\"chain\",null);d(this,\"specificity\",0);d(this,\"elementStyle\",null);d(this,\"conditionCount\",0);d(this,\"pseudoelement\",null);d(this,\"footnoteContent\",!1);d(this,\"cascade\");d(this,\"state\");d(this,\"viewConditionId\",null);d(this,\"insideSelectorRule\");d(this,\"invalid\",!1);this.cascade=o?o.cascade:Su?Su.clone():new xu,this.state=0}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.tags,\"*\",e)}processChain(e){let n=Zh(this.chain,e);n!==e&&n.makePrimary(this.cascade)||this.insertNonPrimary(n)}isInsideSelectorRule(e){return this.state!=0?(this.reportAndSkip(e),!0):!1}tagSelector(e,n){!n&&!e||(n&&(this.specificity+=1),n&&e?this.chain.push(new Zc(e,n.toLowerCase())):n?this.chain.push(new na(n.toLowerCase())):this.chain.push(new Jc(e)))}invalidSelector(e){V.warn(e),this.chain.push(new ze(\"\")),this.setInvalid()}setInvalid(){this.invalid=!0;for(let e=this;e instanceof Ss;e=e.parent)e.parent.invalid=!0}classSelector(e){if(this.pseudoelement){this.invalidSelector(`::${this.pseudoelement} followed by .${e}`);return}this.specificity+=256,this.chain.push(new Kc(e))}pseudoclassSelector(e,n){if(this.pseudoelement){this.invalidSelector(`::${this.pseudoelement} followed by :${e}`);return}switch(e.toLowerCase()){case\"enabled\":this.chain.push(new ru);break;case\"disabled\":this.chain.push(new au);break;case\"checked\":this.chain.push(new lu);break;case\"root\":case\"scope\":this.chain.push(new su);break;case\"link\":this.chain.push(new na(\"a\")),this.chain.push(new sa(\"\",\"href\"));break;case\"-adapt-href-epub-type\":case\"href-epub-type\":if(n&&n.length>=1&&typeof n[0]==\"string\"){let s=n[0],o=new RegExp(`(^|\\\\s)${sn(s)}($|\\\\s)`),i=n[1];this.chain.push(new Qc(o,i))}else this.chain.push(new ze(\"\"));break;case\"-adapt-footnote-content\":case\"footnote-content\":this.footnoteContent=!0;break;case\"visited\":case\"active\":case\"hover\":case\"focus\":this.chain.push(new ze(\"\"));break;case\"lang\":if(n&&n.length==1&&typeof n[0]==\"string\"){let s=n[0];this.chain.push(new nu(new RegExp(`^${sn(s.toLowerCase())}($|-)`)))}else this.chain.push(new ze(\"\"));break;case\"nth-child\":case\"nth-last-child\":case\"nth-of-type\":case\"nth-last-of-type\":{let s=aC[e.toLowerCase()];n&&n.length==2?this.chain.push(new s(n[0],n[1])):this.chain.push(new ze(\"\"));break}case\"first-child\":this.chain.push(new oa);break;case\"last-child\":this.chain.push(new ci(0,1));break;case\"first-of-type\":this.chain.push(new li(0,1));break;case\"last-of-type\":this.chain.push(new ui(0,1));break;case\"only-child\":this.chain.push(new oa),this.chain.push(new ci(0,1));break;case\"only-of-type\":this.chain.push(new li(0,1)),this.chain.push(new ui(0,1));break;case\"empty\":this.chain.push(new iu);break;case\"before\":case\"after\":case\"first-line\":case\"first-letter\":this.pseudoelementSelector(e,n);return;default:this.invalidSelector(`Unknown pseudo-class :${e}`);return}this.specificity+=256}pseudoelementSelector(e,n){switch(e){case\"before\":case\"after\":case\"first-line\":case\"first-letter\":case\"footnote-call\":case\"footnote-marker\":case\"inner\":case\"after-if-continues\":if(!this.pseudoelement)this.pseudoelement=e;else{this.invalidSelector(`Double pseudo-element ::${this.pseudoelement}::${e}`);return}break;case\"first-n-lines\":if(n&&n.length==1&&typeof n[0]==\"number\"){let s=Math.round(n[0]);if(s>0&&s==n[0]){if(!this.pseudoelement)this.pseudoelement=`first-${s}-lines`;else{this.invalidSelector(`Double pseudo-element ::${this.pseudoelement}::${e}`);return}break}}this.chain.push(new ze(\"\"));break;case\"nth-fragment\":n&&n.length==2?this.viewConditionId=`NFS_${n[0]}_${n[1]}`:this.chain.push(new ze(\"\"));break;default:this.invalidSelector(`Unknown pseudo-element ::${e}`);return}this.specificity+=1}idSelector(e){this.specificity+=65536,this.chain.push(new qc(e))}attributeSelector(e,n,s,o){this.specificity+=256,n=n.toLowerCase(),o=o||\"\";let i;switch(s){case 0:i=new sa(e,n);break;case 39:i=new eu(e,n,o);break;case 45:!o||o.match(/\\s/)?i=new ze(\"\"):i=new ys(e,n,new RegExp(`(^|\\\\s)${sn(o)}($|\\\\s)`));break;case 44:i=new ys(e,n,new RegExp(`^${sn(o)}($|-)`));break;case 43:o?i=new ys(e,n,new RegExp(`^${sn(o)}`)):i=new ze(\"\");break;case 42:o?i=new ys(e,n,new RegExp(`${sn(o)}$`)):i=new ze(\"\");break;case 46:o?i=new ys(e,n,new RegExp(sn(o))):i=new ze(\"\");break;case 50:if(o==\"supported\")i=new tu(e,n);else{this.invalidSelector(`Unsupported :: attr selector op: ${o}`);return}break;default:this.invalidSelector(`Unsupported attr selector: ${s}`);return}this.chain.push(i)}descendantSelector(){let e=`d${ea++}`;this.processChain(new go(new pu(e,this.viewConditionId,null))),this.chain=[new ze(e)],this.viewConditionId=null}childSelector(){let e=`c${ea++}`;this.processChain(new go(new hu(e,this.viewConditionId,null))),this.chain=[new ze(e)],this.viewConditionId=null}adjacentSiblingSelector(){let e=`a${ea++}`;this.processChain(new go(new fu(e,this.viewConditionId,null))),this.chain=[new ze(e)],this.viewConditionId=null}followingSiblingSelector(){let e=`f${ea++}`;this.processChain(new go(new gu(e,this.viewConditionId,null))),this.chain=[new ze(e)],this.viewConditionId=null}nextSelector(){this.finishChain(),this.pseudoelement=null,this.footnoteContent=!1,this.specificity=0,this.chain=[]}startSelectorRule(){this.isInsideSelectorRule(\"E_CSS_UNEXPECTED_SELECTOR\")||(this.state=1,this.elementStyle={},this.pseudoelement=null,this.specificity=0,this.footnoteContent=!1,this.chain=[],this.invalid=!1)}error(e,n){super.error(e,n),this.state==1&&(this.state=0),this.setInvalid()}startStylesheet(e){super.startStylesheet(e),this.state=0}startRuleBody(){this.finishChain(),super.startRuleBody(),this.state==1&&(this.state=0)}endRule(){super.endRule(),this.insideSelectorRule=0}finishChain(){this.chain&&(this.processChain(this.makeApplyRuleAction(this.specificity)),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0)}makeApplyRuleAction(e){let n=this.regionId;return this.footnoteContent&&(n?n=\"xxx-bogus-xxx\":n=\"footnote\"),new Es(this.elementStyle,e,this.pseudoelement,n,this.viewConditionId)}special(e,n){let s;this.condition?s=new ai(n,0,this.condition):s=new M(n,0),Kh(this.elementStyle,e).push(s)}property(e,n,s){this.validatorSet.validatePropertyAndHandleShorthand(e,n,s,this)}invalidPropertyValue(e,n){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${n.toString()}`)}unknownProperty(e,n){this.report(`E_INVALID_PROPERTY ${e}: ${n.toString()}`)}simpleProperty(e,n,s){e==\"display\"&&(n===x.oeb_page_head||n===x.oeb_page_foot)&&(this.simpleProperty(\"flow-options\",new q([x.exclusive,x._static]),s),this.simpleProperty(\"flow-into\",n,s),n=x.block),$e(\"SIMPLE_PROPERTY\").forEach(c=>{let p=c({name:e,value:n,important:s});e=p.name,n=p.value,s=p.important});let a=(s?this.getImportantSpecificity():this.getBaseSpecificity())+this.cascade.nextOrder(),l=this.condition?new ai(n,a,this.condition):new M(n,a);tn(this.elementStyle,e,l)}finish(){return this.cascade}startFuncWithSelector(e){let n;switch(e){case\"is\":n=new Ss(this);break;case\"not\":n=new Nu(this);break;case\"where\":n=new vu(this);break;case\"has\":n=new Tu(this);break}n&&(n.startSelectorRule(),this.owner.pushHandler(n))}},aC={\"nth-child\":ou,\"nth-of-type\":li,\"nth-last-child\":ci,\"nth-last-of-type\":ui},ea=0,Ss=class r extends bn{constructor(e){super(e.scope,e.owner,e.condition,e,e.regionId,e.validatorSet,!1);this.parent=e;d(this,\"parentChain\");d(this,\"chains\",[]);d(this,\"maxSpecificity\",0);d(this,\"selectorTexts\",[]);this.parentChain=e.chain}nextSelector(){this.chain&&this.chains.push(this.chain),this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.chain=[],this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0}endFuncWithSelector(){this.chain&&this.chains.push(this.chain),this.chains.length>0?(this.maxSpecificity=Math.max(this.maxSpecificity,this.specificity),this.parentChain.push(this.relational()?new du(this.selectorTexts):this.positive()?new di(this.chains):new uu(this.chains)),this.increasingSpecificity()&&(this.parent.specificity+=this.maxSpecificity)):this.parentChain.push(new ze(\"\")),this.owner.popHandler()}startRuleBody(){this.reportAndSkip(\"E_CSS_UNEXPECTED_RULE_BODY\")}error(e,n){super.error(e,n),this.chain=null,this.pseudoelement=null,this.viewConditionId=null,this.footnoteContent=!1,this.specificity=0;let s=!1;for(let o=this;o instanceof r;o=o.parent)if(o.forgiving()){s=!0;break}s||this.owner.popHandler()}pushSelectorText(e){this.chain&&this.relational()&&this.selectorTexts.push(e)}positive(){return!0}increasingSpecificity(){return!0}forgiving(){return!0}relational(){return!1}},Nu=class extends Ss{positive(){return!1}forgiving(){return!1}},vu=class extends Ss{increasingSpecificity(){return!1}},Tu=class extends Ss{relational(){return!0}},ia=class extends qt{constructor(t,e){super(t,e,!1)}property(t,e,n){if(this.scope.values[t])this.error(`E_CSS_NAME_REDEFINED ${t}`,this.getCurrentToken());else{let s=t.match(/height|^(top|bottom)$/)?\"vh\":\"vw\",o=new at(this.scope,100,s);this.scope.defineName(t,e.toExpr(this.scope,o))}}},Ns=class extends qt{constructor(e,n,s,o,i,a){super(e,n,!1);this.condition=s;this.elementStyle=o;this.validatorSet=i;this.ruleType=a;d(this,\"order\");this.order=0}property(e,n,s){s?V.warn(\"E_IMPORTANT_NOT_ALLOWED\"):this.validatorSet.validatePropertyAndHandleShorthand(e,n,s,this)}invalidPropertyValue(e,n){V.warn(\"E_INVALID_PROPERTY_VALUE\",`${e}:`,n.toString())}unknownProperty(e,n){V.warn(\"E_INVALID_PROPERTY\",`${e}:`,n.toString())}simpleProperty(e,n,s){let o=s?this.getImportantSpecificity():this.getBaseSpecificity();o+=this.order,this.order+=Vu;let i=this.condition?new ai(n,o,this.condition):new M(n,o);tn(this.elementStyle,e,i)}},wu=class extends Ko{constructor(e,n){super(e);this.validatorSet=n;d(this,\"elementStyle\",{});d(this,\"order\",0)}property(e,n,s){this.validatorSet.validatePropertyAndHandleShorthand(e,n,s,this)}invalidPropertyValue(e,n){V.warn(\"E_INVALID_PROPERTY_VALUE\",`${e}:`,n.toString())}unknownProperty(e,n){V.warn(\"E_INVALID_PROPERTY\",`${e}:`,n.toString())}simpleProperty(e,n,s){let o=s?Lr:Ar;o+=this.order,this.order+=Vu;let i=new M(n,o);tn(this.elementStyle,e,i)}};function Fu(r,t){let e=Yh(r);e&&e.forEach(n=>{n.matcher.matches()&&t(n.styles)})}function ra(r,t,e){Fu(e,n=>{yo(r,n,t)})}function Jh(r,t,e,n){let s=new wu(r,t),o=new Oe(n,s);try{ih(o,s,e)}catch(i){V.warn(i,\"Style attribute parse error:\")}return s.elementStyle}function da(r,t,e){let n=r[\"writing-mode\"];if(n){let s=n.evaluate(t,\"writing-mode\");if(s&&s!==x.inherit&&s!==x.revert&&s!==x.unset)return s===x.vertical_rl}return e}function pa(r,t,e){let n=r.direction;if(n){let s=n.evaluate(t,\"direction\");if(s&&s!==x.inherit&&s!==x.revert&&s!==x.unset)return s===x.rtl}return e}function ha(r,t,e,n,s){let o={};for(let i in r)xs(i)&&(o[i]=de(r,i));return ra(o,t,r),Bu(r,e,n,(i,a)=>{yo(o,a,t),ra(o,t,a)}),o}function Bu(r,t,e,n){let s=Nt(r,\"_regions\");if((t||e)&&s){if(e){let o=[\"footnote\"];t?t=t.concat(o):t=o}for(let o of t){let i=s[o];i&&n(o,i)}}}function yo(r,t,e){for(let n in t)if(xs(n)){let s=de(t,n),o=r[n];r[n]=Xc(e,o,s)}}var fa=(r,t,e,n,s)=>{let o=e?n?Zm:Au:n?Qm:Lu;for(let i in r)if(r.hasOwnProperty(i)){let a=r[i];if(!a)continue;let l=o[i],c;if(l){let u=r[l];if(u&&u.priority>a.priority)continue;c=qm[l]?l:i}else c=i;t[c]=s(i,a)}},Pu=class extends jt{constructor(e,n,s){super();this.elementStyles=e;this.styler=n;this.element=s}getVarValue(e){var s,o,i,a,l;let n=(s=this.element)!=null?s:this.styler.root;if((o=this.elementStyles)!=null&&o.length){for(let c of this.elementStyles){let u=(i=c[e])==null?void 0:i.value;if(u)return u}this.element&&(n=this.element.parentElement)}for(;n;n=n.parentElement){let c=(l=(a=this.styler.getStyle(n,!1))==null?void 0:a[e])==null?void 0:l.value;if(c)return c}return null}visitFunc(e){if(e.name!==\"var\")return super.visitFunc(e);let n=e.values[0]instanceof Be&&e.values[0].name;if(!n||!bt(n))return this.error=!0,O;let s=this.getVarValue(n);return s||(e.values.length<2?(this.error=!0,O):e.values.length===2?e.values[1]:new ge(e.values.slice(1)))}},aa=class extends jt{constructor(e,n,s,o){super();this.context=e;this.resolveViewportUnit=n;this.percentRef=s;this.vertical=o}visitFunc(e){let n=super.visitFunc(e);if(e.name!==\"calc\")return n;let s=n.toString().replace(/^calc\\b/,\"-epubx-expr\");if(/\\d(%|em|ex|cap|ch|ic|lh|p?v[whbi]|p?vmin|p?vmax)\\W|\\Wvar\\(\\s*--/i.test(s))return n;let o=Zt(this.context.rootScope,new Oe(s,null),\"\");if(o instanceof F)try{let i=o.expr.evaluate(this.context);typeof i==\"number\"&&!isNaN(i)&&(/\\d(px|in|pt|pc|cm|mm|q|rem|rlh)\\W/i.test(s)?n=new P(i,\"px\"):/\\d[a-z]/i.test(s)||(n=new et(i)))}catch(i){V.warn(i)}return n}visitNumeric(e){return this.resolveViewportUnit&&(Ll(e.unit)||Bp(e.unit))?new P(e.num*this.context.queryUnitSize(e.unit,!1,this.vertical),\"px\"):typeof this.percentRef==\"number\"&&e.unit===\"%\"?new P(e.num*this.percentRef/100,\"px\"):e}};function hi(r,t,e,n,s){try{if(t instanceof F)return t.expr instanceof oe&&(t.expr.str.startsWith(\"named-string-\")||t.expr.str.startsWith(\"running-element-\"))?t:rh(r,t.expr,e);if(t instanceof P||t instanceof Pt||t instanceof q||t instanceof ge)return t.visit(new aa(r,!0,n,s))}catch(o){return V.warn(o),O}return t}var ef={first:!1,forceEnd:!1,allowEnd:!1,last:!1};function tf(r){let t=r instanceof Se?r:typeof r==\"string\"?L(r):x.none;if(t===x.none)return ef;let e=t instanceof q?t.values:[t],n=Object.create(ef);for(let s of e)if(s instanceof Be)switch(s.name){case\"first\":n.first=!0;break;case\"force-end\":n.forceEnd=!0,n.allowEnd=!1;break;case\"allow-end\":n.forceEnd=!1,n.allowEnd=!0;break;case\"last\":n.last=!0;break}return n}function nf(r){return!r.first&&!r.last&&!r.forceEnd&&!r.allowEnd}var lC={trimStart:!1,spaceFirst:!1,trimEnd:!1,allowEnd:!1,trimAdjacent:!1},sf={trimStart:!1,spaceFirst:!1,trimEnd:!1,allowEnd:!0,trimAdjacent:!0},of={trimStart:!0,spaceFirst:!1,trimEnd:!0,allowEnd:!1,trimAdjacent:!0};function rf(r){let t=r instanceof Se?r:typeof r==\"string\"?L(r):x.normal;if(t===x.normal)return sf;if(t===x.auto)return of;let e=t instanceof q?t.values:[t],n=Object.create(sf);for(let s of e)if(s instanceof Be)switch(s.name){case\"trim-both\":case\"trim-auto\":return of;case\"space-all\":return lC;case\"trim-start\":n.trimStart=!0,n.spaceFirst=!1;break;case\"space-start\":n.trimStart=!1,n.spaceFirst=!1;break;case\"space-first\":n.trimStart=!1,n.spaceFirst=!0;break;case\"trim-end\":n.trimEnd=!0,n.allowEnd=!1;break;case\"space-end\":n.trimEnd=!1,n.allowEnd=!1;break;case\"allow-end\":n.trimEnd=!1,n.allowEnd=!0;break;case\"trim-adjacent\":n.trimAdjacent=!0;break;case\"space-adjacent\":n.trimAdjacent=!1;break}return n}var Ou={ideographAlpha:!1,ideographNumeric:!1},cC={ideographAlpha:!0,ideographNumeric:!0};function af(r){let t=r instanceof Se?r:typeof r==\"string\"?L(r):x.normal;if(t===x.normal||t===x.auto)return cC;if(t===x.none)return Ou;let e=t instanceof q?t.values:[t],n=Object.create(Ou);for(let s of e)if(s instanceof Be)switch(s.name){case\"no-autospace\":return Ou;case\"ideograph-alpha\":n.ideographAlpha=!0;break;case\"ideograph-numeric\":n.ideographNumeric=!0;break}return n}function lf(r,t){return!r.ideographAlpha&&!r.ideographNumeric&&!t.trimStart&&!t.spaceFirst&&!t.trimEnd&&!t.allowEnd&&!t.trimAdjacent}function cf(r){return r?(r=r.toLowerCase(),/^zh\\b.*-(hant|tw|hk)\\b/.test(r)?\"zh-hant\":/^zh\\b/.test(r)?\"zh-hans\":/^ja\\b/.test(r)?\"ja\":/^ko\\b/.test(r)?\"ko\":r):null}var Du=class{getPolyfilledInheritedProps(){return[\"hanging-punctuation\",\"text-autospace\",\"text-spacing-trim\"]}preprocessSingleDocument(t){t.body&&this.preprocessForTextSpacing(t.body)}preprocessForTextSpacing(t){var n;let e=t.ownerDocument.createNodeIterator(t,NodeFilter.SHOW_TEXT);for(let s=e.nextNode();s;s=e.nextNode()){if(s.parentElement.namespaceURI!==\"http://www.w3.org/1999/xhtml\"||((n=s.parentElement.dataset)==null?void 0:n.mathTypeset)===\"true\")continue;let o=s.textContent.replace(/(?![()\\[\\]{}])[\\p{Ps}\\p{Pe}\\p{Pf}\\p{Pi}\\u3000]\\p{M}*(?=\\P{M})|.(?=(?![()\\[\\]{}])[\\p{Ps}\\p{Pe}\\p{Pf}\\p{Pi}\\u3000])|(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF]\\p{M}*(?=(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])[\\p{L}\\p{Nd}])|(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])[\\p{L}\\p{Nd}]\\p{M}*(?=(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF])/gsu,\"$&\\0\").split(\"\\0\");if(o.length>1){let i=o.length-1;for(let a=0;a<i;a++)s.parentNode.insertBefore(document.createTextNode(o[a]),s);s.textContent=o[i]}}}processGeneratedContent(t,e,n,s,o,i){o=cf(o);let a=af(e),l=rf(n),c=tf(s);if(nf(c)&&lf(a,l))return;this.preprocessForTextSpacing(t);let u=t.style.whiteSpace;(i?t.offsetHeight:t.offsetWidth)===0&&(t.style.whiteSpace=\"pre\");let p=t.ownerDocument.createNodeIterator(t,NodeFilter.SHOW_TEXT),h=null,f=null;for(let g=p.nextNode();g;g=f){f=p.nextNode();let m=!h,E=!h||/\\n$/.test(h.textContent),C=!f||/^\\n/.test(f.textContent),b=!f;this.processTextSpacing(g,m||E,m,E,C,b,h,f,a,l,c,o,i),h=g}t.style.whiteSpace=u}postLayoutBlock(t,e){var p,h,f,g,m,E,C;let n=!t||t.fragmentIndex===1&&i(),s=n||a();function o(b){var w;if((b==null?void 0:b.nodeType)!==1)return!1;let y=b;if(y.hasAttribute(Mt))return!0;let{position:N,float:S}=(w=y.style)!=null?w:{};return N===\"absolute\"||N===\"fixed\"||S&&S!==\"none\"}function i(){let b=e[0];for(let y=b;;y=y.parent)if(!y||!y.inline){if((y==null?void 0:y.fragmentIndex)!==1)return!1;break}if(!b.inline)return!0;for(let y=b.viewNode.previousSibling;y;y=y.previousSibling)if(!he(y,b.whitespace)&&!o(y))return!1;return!0}function a(){var N,S;let b=e[0],y;for(;b&&b.inline&&(y=(N=b.viewNode)==null?void 0:N.previousSibling,!(y&&(y.nodeType===3&&/^[ \\t\\r\\n\\f]*$/.test(y.textContent)&&b.whitespace!==Ze.PRESERVE&&(y=y.previousSibling),y)));)b=b.parent;for(;y;){if(y.nodeType===1){if(y.localName===\"br\")return!0;let w=(S=y.style)==null?void 0:S.display;if(w&&w!==\"inline\")return!/^(inline|ruby)\\b/.test(w)}else if(y.nodeType===3){if(b.whitespace===Ze.PRESERVE){if(/\\n$/.test(y.textContent))return!0}else if(b.whitespace===Ze.NEWLINE&&/\\n[ \\t\\r\\n\\f]*$/.test(y.textContent))return!0}y=y.lastChild}return!1}let l=-1;for(let b=0;b<e.length;b++){let y=e[b];if(!y.after&&y.inline&&!y.display&&y.parent&&y.viewNode.parentNode&&y.viewNode.nodeType===Node.TEXT_NODE&&!he(y.viewNode,y.whitespace)){let R=function(B){var z,j,fe;if(((z=B.viewNode)==null?void 0:z.nodeType)===1)return B.viewNode.localName===\"br\";if(((j=B.viewNode)==null?void 0:j.nodeType)===3){if(B.whitespace===Ze.PRESERVE){if(/\\n$/.test(B.viewNode.textContent))return!0}else if(B.whitespace===Ze.NEWLINE&&/\\n[ \\t\\r\\n\\f]*$/.test(B.viewNode.textContent))return!0;if(((fe=B.viewNode.previousElementSibling)==null?void 0:fe.localName)===\"br\")return he(B.viewNode,B.whitespace)}return!1},G=function(B){var z,j,fe;if(((z=B.viewNode)==null?void 0:z.nodeType)===1)return B.viewNode.localName===\"br\";if(((j=B.viewNode)==null?void 0:j.nodeType)===3){if(B.whitespace===Ze.PRESERVE){if(/^\\n/.test(B.viewNode.textContent))return!0}else if(B.whitespace===Ze.NEWLINE&&/^[ \\t\\r\\n\\f]*\\n/.test(B.viewNode.textContent))return!0;if(((fe=B.viewNode.nextElementSibling)==null?void 0:fe.localName)===\"br\")return he(B.viewNode,B.whitespace)}return!1};var c=R,u=G;let N=cf((g=(h=(p=y.lang)!=null?p:y.parent.lang)!=null?h:t==null?void 0:t.lang)!=null?g:(f=t==null?void 0:t.parent)==null?void 0:f.lang),S=af(y.inheritedProps[\"text-autospace\"]),w=rf(y.inheritedProps[\"text-spacing-trim\"]),A=tf(y.inheritedProps[\"hanging-punctuation\"]);if(nf(A)&&lf(S,w)||/\\b(flex|grid)\\b/.test(y.parent.display))continue;l<0&&(l=b);let I=null,_=null,Ee=b===l,Q=b===l&&n,re=b===l&&s,Te=!1,Ge=!1;for(let B=b-1;B>=0;B--){let z=e[B];if(R(z)){re=!0;break}if(!z.display&&z.viewNode.nodeType===Node.TEXT_NODE&&z.viewNode.textContent.length>0){I=z.viewNode;break}if(z.display&&!/^(inline|ruby)\\b/.test(z.display)||((m=z.viewNode)==null?void 0:m.nodeType)===1&&(z.viewNode.localName===\"br\"||Xt[z.viewNode.localName]))break;B===0&&(Ee=!0,n&&(Q=!0,re=!0))}for(let B=b+1;B<e.length;B++){let z=e[B];if(G(z)){Te=!0;break}if(z.viewNode!==y.viewNode&&!z.display&&z.viewNode.nodeType===Node.TEXT_NODE&&z.viewNode.textContent.length>0){_=z.viewNode;break}if(z.display&&!/^(inline|ruby)\\b/.test(z.display)||((E=z.viewNode)==null?void 0:E.nodeType)===1&&(z.viewNode.localName===\"br\"||Xt[z.viewNode.localName])){B===e.length-1&&o(z.viewNode)&&(Ge=!0);break}if(B===e.length-1){Te=!0,Ge=!0;for(let j=z.viewNode.nextSibling;j;j=j.nextSibling)if(!o(j)){Ge=!1;break}}}if(((C=y.parent)==null?void 0:C.display)===\"inline-block\"){if(!Q){let B=y.parent.viewNode.firstChild;for(;he(B,y.whitespace);)B=B.nextSibling;y.viewNode===B&&(Q=!0)}if(!Ge){let B=y.parent.viewNode.lastChild;for(;he(B,y.whitespace);)B=B.previousSibling;y.viewNode===B&&(Ge=!0)}}this.processTextSpacing(y.viewNode,Ee,Q,re,Te,Ge,I,_,S,w,A,N,y.vertical)}}}processTextSpacing(t,e,n,s,o,i,a,l,c,u,p,h,f){let g=t.textContent,m=t.ownerDocument,E,C,b;function y(){if(e)return!0;if(!a)return!1;E||(E=m.createRange(),E.selectNode(t));let R=E.getClientRects()[0];C||(C=m.createRange(),C.selectNode(a));let G=C.getClientRects(),B=G[G.length-1];return!R||!B?!1:f?R.top<B.top+B.height-R.width||R.left+R.width<B.left+R.width/10||R.left>B.left+B.width-R.width/10:R.left<B.left+B.width-R.height||R.top>B.top+B.height-R.height/10||R.top+R.height<B.top+R.height/10}function N(){if(!l)return!1;E||(E=m.createRange(),E.selectNode(t));let R=E.getClientRects()[0];b||(b=m.createRange(),b.selectNode(l));let G=b.getClientRects()[0];return!R||!G?!1:f?R.top+R.height>G.top+R.width||R.left>G.left+G.width-R.width/10||R.left+R.width<G.left+R.width/10:R.left+R.width>G.left+R.height||R.top+R.height<G.top+R.height/10||R.top>G.top+G.height-R.height/10}let S=!1,w=!1,A=!1,I=!1,_;if(n&&p.first&&/^[\\p{Ps}\\p{Pf}\\p{Pi}'\"\\u3000]\\p{M}*$/u.test(g)?(_=\"viv-ts-open\",S=!0,w=!0):i&&p.last&&/^[\\p{Pe}\\p{Pf}\\p{Pi}'\"]\\p{M}*$/u.test(g)?(_=\"viv-ts-close\",S=!0,A=!0):(p.forceEnd||p.allowEnd)&&/^[]\\p{M}*$/u.test(g)?(_=\"viv-ts-close\",S=!0,I=!0):(u.trimStart||u.spaceFirst||u.trimAdjacent)&&/^[]\\p{M}*$/u.test(g)?(_=\"viv-ts-open\",S=!0):(u.trimEnd||u.allowEnd||u.trimAdjacent)&&(/^[]\\p{M}*$/u.test(g)||h===\"zh-hans\"&&/^[]\\p{M}*$/u.test(g)||h!==\"zh-hant\"&&/^[]\\p{M}*$/u.test(g))&&(_=\"viv-ts-close\",S=!0),S){let B=function(fe){let Po=parseFloat(m.defaultView.getComputedStyle(fe).fontSize)*.7;return(f?fe.offsetHeight:fe.offsetWidth)>Po},j=function(){return f?R.offsetLeft:R.offsetTop};var Te=B,Ge=j;if(t.parentElement.localName===\"viv-ts-inner\")return;let R=m.createElement(_),G=m.createElement(\"viv-ts-inner\");R.appendChild(G),t.parentNode.insertBefore(R,t),G.appendChild(t);let z=B(G);if(z||w||A||I){if(_===\"viv-ts-open\"){if(w)R.className=\"viv-hang-first\";else if(n||s)u.trimStart?R.className=\"viv-ts-trim\":R.className=\"viv-ts-space\";else if(!(u.trimStart||u.spaceFirst)&&y())R.className=\"viv-ts-space\";else if(u.trimAdjacent&&a&&/[\\p{Ps}\\p{Pi}\\p{Pe}\\p{Pf}\\u00B7\\u2027\\u30FB\\u3000]\\p{M}*$/u.test(a.textContent)&&(!/[\\p{Pe}\\p{Pf}]\\p{M}*$/u.test(a.textContent)||a.parentElement.localName===\"viv-ts-inner\"&&B(a.parentElement)))R.className=\"viv-ts-trim\";else if((u.trimStart||u.spaceFirst)&&y()){let fe=j();R.className=\"viv-ts-auto\",fe===j()&&!y()&&(R.className=\"viv-ts-trim\")}}else if(_===\"viv-ts-close\"){if(A)R.className=z?\"viv-hang-last\":\"viv-hang-last viv-hang-hw\";else if(i||o){let fe=j();I?(R.className=z?p.allowEnd&&u.allowEnd?\"viv-ts-auto\":\"viv-hang-end\":\"viv-hang-end viv-hang-hw\",p.allowEnd&&fe===j()&&(u.trimEnd?R.className=\"viv-ts-trim\":u.allowEnd?(R.className=\"viv-hang-end\",fe===j()&&(R.className=\"\")):R.className=\"viv-ts-space\")):u.trimEnd?R.className=\"viv-ts-trim\":u.allowEnd?(R.className=\"viv-ts-auto\",fe===j()&&(R.className=\"\")):R.className=\"viv-ts-space\"}else if(l&&/^[\\p{Pe}\\p{Pf}\\u00B7\\u2027\\u30FB\\u3000]/u.test(l.textContent))z&&u.trimAdjacent&&(R.className=\"viv-ts-trim\");else if(I){let fe=N(),qn=fe&&p.allowEnd;qn||(R.className=z?\"viv-hang-end\":\"viv-hang-end viv-hang-hw\"),z?qn&&u.trimEnd?R.className=\"viv-ts-auto\":!qn&&!N()?R.className=\"\":!fe&&p.allowEnd&&(u.trimEnd?(R.className=\"viv-ts-auto\",N()||(R.className=\"viv-hang-end\")):(R.className=\"viv-ts-space\",N()||(u.allowEnd?(R.className=\"viv-ts-auto\",N()||(R.className=\"viv-hang-end\")):R.className=\"viv-hang-end\"))):!fe&&!N()&&(R.className=\"\")}else if(u.trimEnd||u.allowEnd)if(N())u.allowEnd?R.className=\"viv-ts-space\":R.className=\"viv-ts-auto\";else{let fe=j();R.className=\"viv-ts-auto\",fe===j()&&(R.className=\"\")}}}}let Ee=!1;function Q(R){var B;let G=(B=R==null?void 0:R.ownerDocument.defaultView)==null?void 0:B.getComputedStyle(R);return!!G&&(G.textOrientation===\"upright\"||G.textCombineUpright===\"all\"||G[\"-webkit-text-combine\"]===\"horizontal\")}function re(R,G){if(R.nodeType===1){let j=m.defaultView.getComputedStyle(R);if(parseFloat(j.marginInlineEnd)||parseFloat(j.borderInlineEndWidth)||parseFloat(j.paddingInlineEnd))return!0}let B=R.parentElement;if(B&&!B.contains(G))return re(B,G);if(G.nodeType===1){let j=m.defaultView.getComputedStyle(G);if(parseFloat(j.marginInlineStart)||parseFloat(j.borderInlineStartWidth)||parseFloat(j.paddingInlineStart))return!0}let z=G.parentElement;return z&&!z.contains(R)?re(R,z):!1}(c.ideographAlpha||c.ideographNumeric)&&(a&&/^(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF]/u.test(g)&&(c.ideographAlpha&&/(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])\\p{L}\\p{M}*$/u.test(a.textContent)||c.ideographNumeric&&/(?![\\uFF01-\\uFF60])\\p{Nd}\\p{M}*$/u.test(a.textContent))&&!(f&&Q(a.parentElement))&&!re(a,t)&&(t.parentNode.insertBefore(m.createElement(\"viv-ts-thin-sp\"),t),Ee=!0),l&&/(?!\\p{P})[\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF]\\p{M}*$/u.test(g)&&(c.ideographAlpha&&/^(?![\\p{sc=Han}\\u3041-\\u30FF\\u31C0-\\u31FF\\uFF01-\\uFF60])\\p{L}/u.test(l.textContent)||c.ideographNumeric&&/^(?![\\uFF01-\\uFF60])\\p{Nd}/u.test(l.textContent))&&!(f&&Q(l.parentElement))&&!re(t,l)&&(t.parentNode.insertBefore(m.createElement(\"viv-ts-thin-sp\"),t.nextSibling),Ee=!0))}registerHooks(){_e(\"POLYFILLED_INHERITED_PROPS\",this.getPolyfilledInheritedProps.bind(this)),_e(\"PREPROCESS_SINGLE_DOCUMENT\",this.preprocessSingleDocument.bind(this)),_e(\"POST_LAYOUT_BLOCK\",this.postLayoutBlock.bind(this),!0)}},Mu=new Du;Mu.registerHooks();function uf(r){Mu.preprocessForTextSpacing(r)}function df(r,t,e,n,s,o){Mu.processGeneratedContent(r,t,e,n,s,o)}var xo=new DOMParser().parseFromString('<root xmlns=\"http://www.pyroxy.com/ns/shadow\"/>',\"text/xml\"),hf=[\"footnote-marker\",\"first-5-lines\",\"first-4-lines\",\"first-3-lines\",\"first-2-lines\",\"first-line\",\"first-letter\",\"before\",\"\",\"after\"],ga=\"data-adapt-pseudo\";function vs(r){return r.getAttribute(ga)||\"\"}function gi(r,t){r.setAttribute(ga,t)}var fi=class{constructor(t,e,n,s,o){this.element=t;this.style=e;this.styler=n;this.context=s;this.exprContentListener=o;d(this,\"contentProcessed\",{})}getStyle(t,e){let n=vs(t);this.styler&&n&&n.match(/after$/)&&(this.style=this.styler.getStyle(this.element,!0),this.styler=null);let o=Nt(this.style,\"_pseudos\")[n]||{};if(n.match(/^first-/)&&!o[\"x-first-pseudo\"]){let i=1,a;n==\"first-letter\"?i=0:(a=n.match(/^first-([0-9]+)-lines$/))!=null&&(i=a[1]-0),o[\"x-first-pseudo\"]=new M(new ct(i),0)}return o}processContent(t,e,n){let s=vs(t);if(!this.contentProcessed[s]){this.contentProcessed[s]=!0;let o=e.content;o&&St(o)&&(o.visit(new un(t,this.context,o,this.exprContentListener)),uf(t))}}};var fy=Zo.isInstanceOfAfterIfContinuesLayoutConstraint,mf=zn.registerFragmentIndex,gy=zn.clearFragmentIndices,ma=class{constructor(t,e){this.sourceNode=t;this.styler=e}createElement(t,e){let s=e.viewNode.ownerDocument.createElement(\"div\"),o=new Ps(t,s,e),i=o.getColumn().pageBreakType;return o.getColumn().pageBreakType=null,o.layout(this.createNodePositionForPseudoElement(),!0).thenAsync(()=>{this.styler.contentProcessed[\"after-if-continues\"]=!1,o.getColumn().pageBreakType=i;let a=s.firstChild;return T(a,\"display\",\"block\"),v(a)})}createNodePositionForPseudoElement(){let t=xo.createElementNS(\"http://www.w3.org/1999/xhtml\",\"div\");gi(t,\"after-if-continues\");let e=this.createShadowContext(t),s={steps:[{node:t,shadowType:e.type,shadowContext:e,nodeShadow:null,shadowSibling:null}],offsetInNode:0,after:!1,preprocessedTextContent:null};return new pt(s)}createShadowContext(t){return new fs(this.sourceNode,t,null,null,null,At.ShadowType.ROOTED,this.styler)}},_u=class r{constructor(t,e,n){this.nodeContext=t;this.afterIfContinues=e;this.pseudoElementHeight=n;d(this,\"flagmentLayoutConstraintType\",\"AfterIfContinue\")}allowLayout(t,e,n){return!(e&&!t||t&&t.overflow)}nextCandidate(t){return!1}postLayout(t,e,n,s){}finishBreak(t,e){return this.getRepetitiveElements().affectTo(t)?this.afterIfContinues.createElement(e,this.nodeContext).thenAsync(n=>(this.nodeContext.viewNode.appendChild(n),v(!0))):v(!0)}getRepetitiveElements(){return new Uu(this.nodeContext,this.pseudoElementHeight)}equalsTo(t){return t instanceof r?this.afterIfContinues==t.afterIfContinues:!1}getPriorityOfFinishBreak(){return 9}},Uu=class{constructor(t,e){this.nodeContext=t;this.pseudoElementHeight=e}calculateOffset(t){return this.affectTo(t)?this.pseudoElementHeight:0}calculateMinimumOffset(t){return this.calculateOffset(t)}affectTo(t){if(!t)return!1;let e=t.shadowContext?t.shadowContext.owner:t.sourceNode;if(e===this.nodeContext.sourceNode)return!!t.after;for(let n=e.parentNode;n;n=n.parentNode)if(n===this.nodeContext.sourceNode)return!0;return!1}};function Cf(r,t){if(!r||!r.afterIfContinues||r.after||t.isFloatNodeContext(r))return v(r);let e=r.afterIfContinues;return e.createElement(t,r).thenAsync(n=>{let s=dC(r,t,n);return t.fragmentLayoutConstraints.push(new _u(r,e,s)),v(r)})}function Wu(r,t){return r.thenAsync(e=>Cf(e,t))}function uC(r,t){let e=k(\"processAfterIfContinuesOfAncestors\"),n=r;return e.loop(()=>{if(n!==null){let s=Cf(n,t);return n=n.parent,s.thenReturn(!0)}else return v(!1)}).then(()=>{e.finish(!0)}),e.result()}function dC(r,t,e){let n=r.viewNode;n.appendChild(e);let s=oi(e,t,r.vertical);return n.removeChild(e),s}var Ca=class{constructor(t){this.constraints=t}allowLayout(t){return this.constraints.every(e=>e.allowLayout(t))}},Ts=class extends ms{constructor(e,n){super();this.checkPoints=e;this.penalty=n;d(this,\"alreadyEvaluated\",!1);d(this,\"breakNodeContext\",null)}findAcceptableBreak(e,n){return n<this.getMinBreakPenalty()?null:(this.alreadyEvaluated||(this.breakNodeContext=e.findBoxBreakPosition(this,n>0),this.alreadyEvaluated=!!this.breakNodeContext||n>0||!!e.pseudoParent),this.breakNodeContext)}getMinBreakPenalty(){return this.penalty}getNodeContext(){return this.alreadyEvaluated?this.breakNodeContext:this.checkPoints[this.checkPoints.length-1]}};var ws=class extends ao{constructor(e,n,s,o,i){super(e);this.layoutContext=n;this.clientLayout=s;this.layoutConstraint=o;this.pageFloatLayoutContext=i;d(this,\"last\");d(this,\"viewDocument\");d(this,\"flowRootFormattingContext\",null);d(this,\"isFloat\",!1);d(this,\"isFootnote\",!1);d(this,\"startEdge\",0);d(this,\"endEdge\",0);d(this,\"beforeEdge\",0);d(this,\"afterEdge\",0);d(this,\"footnoteEdge\",0);d(this,\"box\",null);d(this,\"chunkPositions\",null);d(this,\"bands\",null);d(this,\"overflown\",!1);d(this,\"breakPositions\",null);d(this,\"pageBreakType\",null);d(this,\"forceNonfitting\",!0);d(this,\"leftFloatEdge\",0);d(this,\"rightFloatEdge\",0);d(this,\"bottommostFloatTop\",0);d(this,\"stopAtOverflow\",!0);d(this,\"lastAfterPosition\",null);d(this,\"fragmentLayoutConstraints\",[]);d(this,\"pseudoParent\",null);d(this,\"nodeContextOverflowingDueToRepetitiveElements\",null);d(this,\"blockDistanceToBlockEndFloats\",NaN);d(this,\"breakAtTheEdgeBeforeFloat\",null);this.last=e.lastChild,this.viewDocument=e.ownerDocument,i.setContainer(this)}getTopEdge(){return this.vertical?this.rtl?this.endEdge:this.startEdge:this.beforeEdge}getBottomEdge(){return this.vertical?this.rtl?this.startEdge:this.endEdge:this.afterEdge}getLeftEdge(){return this.vertical?this.afterEdge:this.rtl?this.endEdge:this.startEdge}getRightEdge(){return this.vertical?this.beforeEdge:this.rtl?this.startEdge:this.endEdge}isFloatNodeContext(e){return!!e.floatSide&&(!this.isFloat||!!e.parent)}stopByOverflow(e){return this.stopAtOverflow&&!!e&&e.overflow}isOverflown(e){return this.vertical?e<this.footnoteEdge:e>this.footnoteEdge}getExclusions(){let e=this.pageFloatLayoutContext.getFloatFragmentExclusions();return this.exclusions.concat(e)}openAllViews(e){let n=k(\"openAllViews\"),s=e.steps;this.layoutContext.setViewRoot(this.element,this.isFootnote);let o=s.length-1,i=null;return n.loop(()=>{for(;o>=0;){let a=i,l=s[o];if(i=lo(l,a),o===s.length-1&&!i.formattingContext&&(i.formattingContext=this.flowRootFormattingContext),o==0&&(i.offsetInNode=this.calculateOffsetInNodeForNodeContext(e),i.after=e.after,i.preprocessedTextContent=e.preprocessedTextContent,i.after))break;let c=this.layoutContext.setCurrent(i,o==0&&i.offsetInNode==0);if(o--,c.isPending())return c}return v(!1)}).then(()=>{n.finish(i)}),n.result()}calculateOffsetInNodeForNodeContext(e){return e.preprocessedTextContent?Nh(e.preprocessedTextContent,e.offsetInNode):e.offsetInNode}maybePeelOff(e,n){var s,o;if(e.firstPseudo&&e.inline&&!e.after&&e.firstPseudo.count==0&&e.viewNode.nodeType!=1){let i=e.viewNode.textContent,a=i.match(Io),l=a?a[0].length:0;if(!a&&((s=e.sourceNode)==null?void 0:s.nodeType)===3&&((o=e.sourceNode.nextSibling)==null?void 0:o.nodeType)===3&&i===e.sourceNode.textContent){let c=i+e.sourceNode.nextSibling.textContent,u=c.match(Io);if(u){let p=u[0];l=p.length,e.sourceNode.textContent=p,e.viewNode.textContent=p,e.sourceNode.nextSibling.textContent=c.substr(l)}}return this.layoutContext.peelOff(e,l)}return v(e)}buildViewToNextBlockEdge(e,n){let s=!1,o=k(\"buildViewToNextBlockEdge\");return o.loopWithFrame(i=>{var a;e.viewNode&&!fn(e)&&((a=e.viewNode.parentElement)==null?void 0:a.namespaceURI)===\"http://www.w3.org/1999/xhtml\"&&n.push(e.copy()),this.maybePeelOff(e,0).then(l=>{let c=l;c!==e&&(e=c,fn(e)||n.push(e.copy())),this.nextInTree(e).then(u=>{if(e=u,!e){i.breakLoop();return}(s||!this.layoutConstraint.allowLayout(e))&&(s=!0,e=e.modify(),e.overflow=!0),this.isFloatNodeContext(e)&&(Dn(e.floatReference)||e.floatSide===\"footnote\")?this.layoutFloatOrFootnote(e).then(p=>{if(e=p,this.pageFloatLayoutContext.isInvalidated()&&(e=null),!e){i.breakLoop();return}i.continueLoop()}):e.inline?i.continueLoop():i.breakLoop()})})}).then(()=>{o.finish(e)}),o.result()}nextInTree(e,n){let s=this.layoutContext.nextInTree(e,n);return Wu(s,this)}buildDeepElementView(e){if(!e.viewNode)return v(e);let n=[],s=e.sourceNode,o=k(\"buildDeepElementView\");return o.loopWithFrame(i=>{e.viewNode&&e.inline&&!fn(e)?n.push(e.copy()):(n.length>0&&this.postLayoutBlock(e,n),n=[]),this.maybePeelOff(e,0).then(a=>{let l=a;if(l!==e){let c=l;for(;c&&c.sourceNode!=s;)c=c.parent;if(c==null){e=l,i.breakLoop();return}fn(l)||n.push(l.copy())}this.nextInTree(l).then(c=>{e=c,!e||e.sourceNode==s?i.breakLoop():this.layoutConstraint.allowLayout(e)?i.continueLoop():(e=e.modify(),e.overflow=!0,this.stopAtOverflow?i.breakLoop():i.continueLoop())})})}).then(()=>{n.length>0&&this.postLayoutBlock(e,n),o.finish(e)}),o.result()}createFloat(e,n,s,o){let i=this.viewDocument.createElement(\"div\");return this.vertical?(o>=this.height&&(o-=.1),o<1&&(o=0),T(i,\"height\",`${s}px`),T(i,\"width\",`${o}px`)):(s>=this.width&&(s-=.1),s<1&&(s=0),T(i,\"width\",`${s}px`),T(i,\"height\",`${o}px`)),T(i,\"float\",n),T(i,\"clear\",n),this.element.insertBefore(i,e),i}killFloats(){let e=this.element.firstChild;for(;e;){let n=e.nextSibling;if(e.nodeType==1){let s=e,o=s.style.cssFloat;if(o==\"left\"||o==\"right\"||o===\"none\")this.element.removeChild(s);else break}e=n}}createFloats(){let e=this.element.firstChild,n=this.bands,s=this.vertical?this.getTopEdge():this.getLeftEdge(),o=this.vertical?this.getBottomEdge():this.getRightEdge(),i=null;for(let a of n){let l=a.y2-a.y1;a.left=this.createFloat(e,\"left\",a.x1-s,l),a.right=this.createFloat(e,\"right\",o-a.x2,l),a.x1<o&&a.x2>s?i=a:i||T(a.right,\"float\",\"none\")}if(i){let a=n[n.length-1],l=this.vertical?-this.getLeftEdge():this.getBottomEdge();i!==a&&a.y2>=l&&(this.footnoteEdge=this.vertical?-i.y2:i.y2)}}calculateEdge(e,n,s,o){let i;if(e&&hn(e.viewNode))return NaN;if(e&&e.after&&!e.inline&&(i=Mn(e,this.clientLayout,0,this.vertical),!isNaN(i)))return i;e=n[s];let a=o-e.boxOffset;for(;;){if(i=Mn(e,this.clientLayout,a,this.vertical),!isNaN(i))return i;if(a>0){a--;continue}if(s--,s<0)return this.beforeEdge;e=n[s],e.viewNode.nodeType!=1&&(a=e.viewNode.textContent.length)}}parseComputedLength(e){let n=e.match(/^(-?[0-9]*(\\.[0-9]*)?)px$/);return n?this.clientLayout.adjustLengthValue(parseFloat(n[0])):0}getComputedMargin(e){let n=this.clientLayout.getElementComputedStyle(e),s=new Ks(0,0,0,0);return n&&(s.left=this.parseComputedLength(n.marginLeft),s.top=this.parseComputedLength(n.marginTop),s.right=this.parseComputedLength(n.marginRight),s.bottom=this.parseComputedLength(n.marginBottom)),s}getComputedPaddingBorder(e){let n=this.clientLayout.getElementComputedStyle(e),s=new Ks(0,0,0,0);return n&&(s.left=this.parseComputedLength(n.borderLeftWidth)+this.parseComputedLength(n.paddingLeft),s.top=this.parseComputedLength(n.borderTopWidth)+this.parseComputedLength(n.paddingTop),s.right=this.parseComputedLength(n.borderRightWidth)+this.parseComputedLength(n.paddingRight),s.bottom=this.parseComputedLength(n.borderBottomWidth)+this.parseComputedLength(n.paddingBottom)),s}getComputedInsets(e){let n=this.clientLayout.getElementComputedStyle(e),s=new Ks(0,0,0,0);if(n){if(n.boxSizing==\"border-box\")return this.getComputedMargin(e);s.left=this.parseComputedLength(n.marginLeft)+this.parseComputedLength(n.borderLeftWidth)+this.parseComputedLength(n.paddingLeft),s.top=this.parseComputedLength(n.marginTop)+this.parseComputedLength(n.borderTopWidth)+this.parseComputedLength(n.paddingTop),s.right=this.parseComputedLength(n.marginRight)+this.parseComputedLength(n.borderRightWidth)+this.parseComputedLength(n.paddingRight),s.bottom=this.parseComputedLength(n.marginBottom)+this.parseComputedLength(n.borderBottomWidth)+this.parseComputedLength(n.paddingBottom)}return s}setComputedInsets(e,n){let s=this.clientLayout.getElementComputedStyle(e);s&&(n.marginLeft=this.parseComputedLength(s.marginLeft),n.borderLeft=this.parseComputedLength(s.borderLeftWidth),n.paddingLeft=this.parseComputedLength(s.paddingLeft),n.marginTop=this.parseComputedLength(s.marginTop),n.borderTop=this.parseComputedLength(s.borderTopWidth),n.paddingTop=this.parseComputedLength(s.paddingTop),n.marginRight=this.parseComputedLength(s.marginRight),n.borderRight=this.parseComputedLength(s.borderRightWidth),n.paddingRight=this.parseComputedLength(s.paddingRight),n.marginBottom=this.parseComputedLength(s.marginBottom),n.borderBottom=this.parseComputedLength(s.borderBottomWidth),n.paddingBottom=this.parseComputedLength(s.paddingBottom))}setComputedWidthAndHeight(e,n){let s=this.clientLayout.getElementComputedStyle(e);s&&(n.width=this.parseComputedLength(s.width),n.height=this.parseComputedLength(s.height))}layoutUnbreakable(e){return this.buildDeepElementView(e)}layoutFloat(e){let n=k(\"layoutFloat\"),s=e.viewNode,o=Ic(e.floatSide,e.vertical,e.direction);return T(s,\"float\",\"none\"),T(s,\"display\",\"inline-block\"),T(s,\"vertical-align\",\"top\"),this.buildDeepElementView(e).then(i=>{let a=this.clientLayout.getElementClientRect(s),l=this.getComputedMargin(s),c=new He(a.left-l.left,a.top-l.top,a.right+l.right,a.bottom+l.bottom),u=this.rtl?this.endEdge:this.startEdge,p=this.rtl?this.startEdge:this.endEdge,h=e.parent;for(;h&&h.inline;)h=h.parent;if(h){let S=h.viewNode.ownerDocument.createElement(\"div\");S.style.left=\"0px\",S.style.top=\"0px\",this.vertical?(S.style.bottom=\"0px\",S.style.width=\"1px\"):(S.style.right=\"0px\",S.style.height=\"1px\"),h.viewNode.appendChild(S);let w=this.clientLayout.getElementClientRect(S);u=Math.max(this.rtl?this.getEndEdge(w):this.getStartEdge(w),u),p=Math.min(this.rtl?this.getStartEdge(w):this.getEndEdge(w),p),h.viewNode.removeChild(S);let A=this.vertical?c.y2-c.y1:c.x2-c.x1;o==\"left\"?p=Math.max(p,u+A):u=Math.min(u,p-A),h!==e.parent&&!e.firstPseudo&&(h.viewNode.appendChild(s),s.setAttribute(\"data-vivliostyle-float-box-moved\",\"true\"))}let f=new He(u,this.getBoxDir()*this.beforeEdge,p,this.getBoxDir()*this.afterEdge),g=c;this.vertical&&(g=qs(c));let m=this.getBoxDir();if(g.y1<this.bottommostFloatTop*m){let S=g.y2-g.y1;g.y1=this.bottommostFloatTop*m,g.y2=g.y1+S}Xp(f,this.bands,g,o),this.vertical&&(c=yr(g));let E=this.getComputedInsets(s);T(s,\"width\",`${c.x2-c.x1-E.left-E.right}px`),T(s,\"height\",`${c.y2-c.y1-E.top-E.bottom}px`),T(s,\"position\",\"absolute\"),e.display,T(s,\"display\",e.display);let C,b=null;if(h&&(h.containingBlockForAbsolute?b=h:b=h.getContainingBlockForAbsolute()),b){let S=b.viewNode.ownerDocument.createElement(\"div\");S.style.position=\"absolute\",b.vertical?S.style.right=\"0\":S.style.left=\"0\",S.style.top=\"0\",b.viewNode.appendChild(S),C=this.clientLayout.getElementClientRect(S),b.viewNode.removeChild(S)}else C={left:this.getLeftEdge()-this.paddingLeft,right:this.getRightEdge()+this.paddingRight,top:this.getTopEdge()-this.paddingTop};(b?b.vertical:this.vertical)?T(s,\"right\",`${C.right-c.x2}px`):T(s,\"left\",`${c.x1-C.left}px`),T(s,\"top\",`${c.y1-C.top}px`),e.clearSpacer&&(e.clearSpacer.parentNode.removeChild(e.clearSpacer),e.clearSpacer=null);let y=this.vertical?c.x1:c.y2,N=this.vertical?c.x2:c.y1;!this.isOverflown(y)||this.breakPositions.length==0?(this.killFloats(),f=new He(this.getLeftEdge(),this.getTopEdge(),this.getRightEdge(),this.getBottomEdge()),this.vertical&&(f=qs(f)),jp(f,this.bands,g,null,o),this.createFloats(),o==\"left\"?this.leftFloatEdge=y:this.rightFloatEdge=y,this.bottommostFloatTop=N,this.updateMaxReachedAfterEdge(y),n.finish(i)):(e=e.modify(),e.overflow=!0,n.finish(e))}),n.result()}setupFloatArea(e,n,s,o,i,a){let l=this.pageFloatLayoutContext,c=l.getContainer(n),u=e.element;c.element.parentNode.appendChild(u),e.isFloat=!0,e.originX=c.originX,e.originY=c.originY,e.vertical=c.vertical,e.rtl=c.rtl,e.marginLeft=e.marginRight=e.marginTop=e.marginBottom=0,e.borderLeft=e.borderRight=e.borderTop=e.borderBottom=0,e.paddingLeft=e.paddingRight=e.paddingTop=e.paddingBottom=0,e.exclusions=(c.exclusions||[]).concat(),e.forceNonfitting=!l.hasFloatFragments(),e.innerShape=null;let p=c.getPaddingRect();e.setHorizontalPosition(p.x1-c.originX,p.x2-p.x1),e.setVerticalPosition(p.y1-c.originY,p.y2-p.y1),i.adjustPageFloatArea(e,c,this),e.init();let h=!!l.setFloatAreaDimensions(e,n,s,o,!0,!l.hasFloatFragments(),a);return h?(e.killFloats(),e.init()):c.element.parentNode.removeChild(u),h}createPageFloatArea(e,n,s,o,i){let a=this.element.ownerDocument.createElement(\"div\");T(a,\"position\",\"absolute\");let l=this.pageFloatLayoutContext.getPageFloatLayoutContext(e.floatReference),c=new dn(null,ue.COLUMN,null,this.pageFloatLayoutContext.flowName,e.nodePosition,null,null),u=l.getContainer(),p=new Gu(n,a,this.layoutContext.clone(),this.clientLayout,this.layoutConstraint,c,u);return c.setContainer(p),this.setupFloatArea(p,e.floatReference,n,s,o,i)?p:null}layoutSinglePageFloatFragment(e,n,s,o,i,a,l){let c=this.pageFloatLayoutContext;e=(l?l.continuations:[]).concat(e);let p=e[0].float,h=c.getPageFloatPlacementCondition(p,n,s),f=this.createPageFloatArea(p,n,a,i,h),g={floatArea:f,pageFloatFragment:null,newPosition:null};if(!f)return v(g);let m=k(\"layoutSinglePageFloatFragment\"),E=!1,C=0;return m.loopWithFrame(b=>{if(C>=e.length){b.breakLoop();return}let y=e[C],N=new pt(y.nodePosition);f.layout(N,!0).then(S=>{g.newPosition=S,!S||o?(C++,b.continueLoop()):(E=!0,b.breakLoop())})}).then(()=>{if(!E){let b=c.setFloatAreaDimensions(f,p.floatReference,n,a,!1,o,h);if(!b)E=!0;else{let y=i.createPageFloatFragment(e,b,f,!!g.newPosition);c.addPageFloatFragment(y,!0),g.pageFloatFragment=y}}m.finish(g)}),m.result()}layoutPageFloatInner(e,n,s,o){let i=this.pageFloatLayoutContext,a=e.float;i.stashEndFloatFragments(a);function l(u,p){p?i.removePageFloatFragment(p,!0):u&&u.element.parentNode.removeChild(u.element),i.restoreStashedFragments(a.floatReference),i.deferPageFloat(e)}let c=k(\"layoutPageFloatInner\");return this.layoutSinglePageFloatFragment([e],a.floatSide,a.clearSide,!i.hasFloatFragments(),n,s,o).then(u=>{let p=u.floatArea,h=u.pageFloatFragment,f=u.newPosition;h?this.layoutStashedPageFloats(a.floatReference,[o]).then(g=>{if(g){if(i.addPageFloatFragment(h),i.discardStashedFragments(a.floatReference),f){let m=new ti(a,f.primary);i.deferPageFloat(m)}c.finish(!0)}else l(p,h),c.finish(!1)}):(l(p,h),c.finish(!1))}),c.result()}layoutStashedPageFloats(e,n){let s=this.pageFloatLayoutContext,o=s.getStashedFloatFragments(e),i=[],a=[],l=!1,c=k(\"layoutStashedPageFloats\"),u=0;return c.loopWithFrame(p=>{if(u>=o.length){p.breakLoop();return}let h=o[u];if(n.includes(h)){u++,p.continueLoop();return}let f=new _t().findByFloat(h.continuations[0].float);this.layoutSinglePageFloatFragment(h.continuations,h.floatSide,null,!1,f,null).then(g=>{let m=g.floatArea;m&&i.push(m);let E=g.pageFloatFragment;E?(a.push(E),u++,p.continueLoop()):(l=!0,p.breakLoop())})}).then(()=>{l?(a.forEach(p=>{s.removePageFloatFragment(p,!0)}),i.forEach(p=>{let h=p.element;h&&h.parentNode&&h.parentNode.removeChild(h)})):o.forEach(p=>{let h=p.area.element;h&&h.parentNode&&h.parentNode.removeChild(h)}),c.finish(!l)}),c.result()}setFloatAnchorViewNode(e){let n=e.viewNode.parentNode,s=n.ownerDocument.createElement(\"span\");s.setAttribute(Mt,\"1\"),e.floatSide===\"footnote\"&&this.layoutContext.applyPseudoelementStyle(e,\"footnote-call\",s),n.appendChild(s),n.removeChild(e.viewNode);let o=e.modify();return o.after=!0,o.viewNode=s,o}resolveFloatReferenceFromColumnSpan(e,n,s){let o=k(\"resolveFloatReferenceFromColumnSpan\"),i=this.pageFloatLayoutContext,a=i.getPageFloatLayoutContext(ue.REGION);return i.getContainer().width<a.getContainer().width&&e===ue.COLUMN?n===x.auto?this.buildDeepElementView(s.copy()).then(c=>{let u=c.viewNode,p=so(this.clientLayout,u,[\"min-content inline size\"])[\"min-content inline size\"],h=this.getComputedMargin(u);this.vertical?p+=h.top+h.bottom:p+=h.left+h.right,p>this.width?o.finish(ue.REGION):o.finish(e)}):n===x.all?o.finish(ue.REGION):o.finish(e):o.finish(e),o.result()}layoutPageFloat(e){let n=this.pageFloatLayoutContext,s=new _t().findByNodeContext(e),o,i=n.findPageFloatByNodePosition(e.toNodePosition());return i?o=v(i):o=s.createPageFloat(e,n,this),o.thenAsync(a=>{let l=gs(e,0),c=this.setFloatAnchorViewNode(e),u=s.findPageFloatFragment(a,n),p=new ti(a,l);if(u&&u.hasFloat(a))return n.registerPageFloatAnchor(a,c.viewNode),v(c);if(n.isForbidden(a)||n.hasPrecedingFloatsDeferredToNext(a))return n.deferPageFloat(p),n.registerPageFloatAnchor(a,c.viewNode),v(c);if(this.nodeContextOverflowingDueToRepetitiveElements)return v(null);{let h=Mn(c,this.clientLayout,0,this.vertical);return this.isOverflown(h)?v(c):this.layoutPageFloatInner(p,s,h,u).thenAsync(f=>f?v(null):(n.registerPageFloatAnchor(a,c.viewNode),v(c)))}})}processLineStyling(e,n,s){let o=k(\"processLineStyling\"),i=s.concat([]);s.splice(0,s.length);let a=0,l=e.firstPseudo;return l.count==0&&(l=l.outer),o.loopWithFrame(c=>{if(!l){c.breakLoop();return}let u=this.findLinePositions(i),p=l.count-a;if(u.length<=p){c.breakLoop();return}let h=this.findAcceptableBreakInside(i,u[p-1],!0);if(h==null){c.breakLoop();return}this.finishBreak(h,!1,!1).then(()=>{a+=p,this.layoutContext.peelOff(h,0).then(f=>{e=f,l=e.firstPseudo,i=[],this.buildViewToNextBlockEdge(e,i).then(g=>{n=g,c.continueLoop()})})})}).then(()=>{Array.prototype.push.apply(s,i),o.finish(n)}),o.result()}isLoneImage(e){return e.length!=2&&this.breakPositions.length>0?!1:e[0].sourceNode==e[1].sourceNode&&Xt[e[0].sourceNode.localName]}getTrailingMarginEdgeAdjustment(e){let n=0,s=0;for(let o=e.length-1;o>=0;o--){let i=e[o];if(!i.after||!i.viewNode||i.viewNode.nodeType!=1)break;let a=this.getComputedMargin(i.viewNode),l=this.vertical?-a.left:a.bottom;l>0?n=Math.max(n,l):s=Math.min(s,l)}return n+s}layoutBreakableBlock(e){let n=k(\"layoutBreakableBlock\"),s=[];return this.buildViewToNextBlockEdge(e,s).then(o=>{let i=s.length-1;if(i<0){n.finish(o);return}this.postLayoutBlock(o,s);let a=this.calculateEdge(o,s,i,s[i].boxOffset),l=!1;if(!o||!hn(o.viewNode)){let u=_n(o,this.collectElementsOffset());l=this.isOverflown(a+(this.vertical?-1:1)*u.minimum),this.isOverflown(a+(this.vertical?-1:1)*u.current)&&!this.nodeContextOverflowingDueToRepetitiveElements&&(this.nodeContextOverflowingDueToRepetitiveElements=o)}o==null&&(a+=this.getTrailingMarginEdgeAdjustment(s)),this.updateMaxReachedAfterEdge(a);let c;e.firstPseudo?c=this.processLineStyling(e,o,s):c=v(o),c.then(u=>{s.length>0&&(this.saveBoxBreakPosition(s),l&&!this.isLoneImage(s)&&u&&(u=u.modify(),u.overflow=!0)),n.finish(u)})}),n.result()}postLayoutBlock(e,n){$e(\"POST_LAYOUT_BLOCK\").forEach(o=>{o(e,n,this)})}findEndOfLine(e,n,s){let o=this.vertical?e-1:e+1,i=0,a=n[0].boxOffset,l=i,c=n.length-1,u=n[c].boxOffset,p;for(;a<u;){p=a+Math.ceil((u-a)/2),l=i;let h=c;for(;l<h;){let g=l+Math.ceil((h-l)/2);n[g].boxOffset>p?h=g-1:l=g}let f=this.calculateEdge(null,n,l,p);if(this.vertical?f<=o:f>=o){for(u=p-1;n[l].boxOffset==p;)l--;c=l}else s&&this.updateMaxReachedAfterEdge(f),a=p,i=l}return{nodeContext:n[l],index:a,checkPointIndex:l}}findAcceptableBreakInside(e,n,s){var l,c;let o=this.findEndOfLine(n,e,!0),i=o.nodeContext;if(o.checkPointIndex===0&&o.index===i.boxOffset)return null;let a=i.viewNode;if(a.nodeType!=1&&((l=a.parentElement)==null?void 0:l.localName)!==\"viv-ts-inner\"){let u=a;i=this.resolveTextNodeBreaker(i).breakTextNode(u,i,o.index,e,o.checkPointIndex,s)}else{let u=Oc(i);if(u){if(((c=this.breakPositions)==null?void 0:c[0])instanceof Ts&&(u!=null&&u.viewNode.contains(this.breakPositions[0].checkPoints[0].viewNode)))return null;i=u}}return this.clearOverflownViewNodes(i,!1),i}resolveTextNodeBreaker(e){return $e(\"RESOLVE_TEXT_NODE_BREAKER\").reduce((s,o)=>o(e)||s,Eo.instance)}getRangeBoxes(e,n){let s=[],o=e.ownerDocument.createRange(),i=!1,a=e,l=null,c=!1,u=!0;for(;u;){let p=!0;do{let h=null;a==n&&(n.nodeType===1?u=!(!n.firstChild||i):u=!1);let f=a.nodeType===1?a:null;f?i?i=!1:Zr(f)?p=!c:!f.firstChild||Xt[f.localName]||/^r(uby|[bt]c?)$/.test(f.localName)||Mh(this.clientLayout.getElementComputedStyle(f).display)?(p=!c,p?(f.localName===\"ruby\"&&a.firstChild&&(a=a.firstChild),o.setStartBefore(a),c=!0,l=a):/^r(uby|tc?)$/.test(f.localName)||(l=a),a.contains(n)&&(u=!1)):h=a.firstChild:(c||(a.parentNode==null?u=!1:(o.setStartBefore(a),c=!0)),l=a),h||(h=a.nextSibling,h||(i=!0,h=a.parentNode)),a=h}while(p&&u);if(c){o.setEndAfter(l);let h=this.clientLayout.getRangeClientRects(o);for(let f=0;f<h.length;f++)s.push(h[f]);c=!1}}return s}findLinePositions(e){let o=[],i=this.getRangeBoxes(e[0].viewNode,e[e.length-1].viewNode);i.sort(this.vertical?Ah:kh);let a=0,l=0,c=0,u=0,p=0,h=this.getBoxDir();for(;;){if(p<i.length){let f=i[p],g=1;if(u>0){let m=Math.max(this.getBoxSize(f),1);h*this.getBeforeEdge(f)<h*a?g=h*(this.getAfterEdge(f)-a)/m:h*this.getAfterEdge(f)>h*l?g=h*(l-this.getBeforeEdge(f))/m:g=1}if(u==0||g>=.6||g>=.2&&this.getStartEdge(f)>=c-1){c=this.getEndEdge(f),this.vertical?(a=u==0?f.right:Math.max(a,f.right),l=u==0?f.left:Math.min(l,f.left)):(a=u==0?f.top:Math.min(a,f.top),l=u==0?f.bottom:Math.max(l,f.bottom)),u++,p++;continue}}if(u>0&&(o.push(l),u=0),p>=i.length)break}return o.sort(Ki),this.vertical&&o.reverse(),o}calculateClonedPaddingBorder(e){let n=0;for(let s=e;s;s=s.parent)if(!s.inline&&ps(s.viewNode)){let o=this.getComputedPaddingBorder(s.viewNode);n+=s.vertical?-o.left:o.bottom,s.display===\"table\"&&(n+=(s.vertical?-1:1)*s.blockBorderSpacing)}return n}getOffsetByRepetitiveElements(e){let n;return e?n=e.calculateOffset(this):n=_n(null,this.collectElementsOffset()),n.current}findBoxBreakPosition(e,n){let s=this.element.parentNode,o=this.element.nextSibling;s.removeChild(this.element),s.insertBefore(this.element,o);let i=e.checkPoints,a=i[0];for(;a.parent&&a.inline;)a=a.parent;let l,c;n?(l=1,c=1):(l=Math.max((a.inheritedProps.widows||2)-0,1),c=Math.max((a.inheritedProps.orphans||2)-0,1));let u=this.calculateClonedPaddingBorder(a),p=this.findLinePositions(i),h=this.footnoteEdge-u,f=this.getBoxDir(),g=this.getOffsetByRepetitiveElements(e);h-=f*g;let m=this.findFirstOverflowingEdgeAndCheckPoint(i);isNaN(m.edge)&&(m.edge=f*(1/0));let E=gt(p.length,N=>{let S=p[N];return this.vertical?S<h||S<=m.edge:S>h||S>=m.edge}),C=E<=0;C&&(E=gt(p.length,N=>this.vertical?p[N]<h:p[N]>h));let b=i[i.length-1].viewNode;if((b==null?void 0:b.parentElement.localName)===\"viv-ts-inner\"&&(b=b.parentElement.parentElement),(E===p.length&&b.nextSibling||E>=p.length-1&&b.parentElement.querySelector(\".MJXc-display\"))&&(l=0),E=Math.min(p.length-l,E),E<c)return null;h=p[E-1];let y;if(C?y=m.checkPoint:y=this.findAcceptableBreakInside(e.checkPoints,h,n),y){let N=this.getAfterEdgeOfBlockContainer(y);!isNaN(N)&&f*(h-N)>0&&(h=N),this.computedBlockSize=f*(h-this.beforeEdge)+g}return y}getAfterEdgeOfBlockContainer(e){let n=e;do n=n.parent;while(n&&n.inline);return n?(n=n.copy().modify(),n.after=!0,Mn(n,this.clientLayout,0,this.vertical)):NaN}findFirstOverflowingEdgeAndCheckPoint(e){let n=e.findIndex(o=>o.overflow);if(n<0)return{edge:NaN,checkPoint:null};let s=e[n];return{edge:this.calculateEdge(null,e,n,s.boxOffset),checkPoint:s}}findEdgeBreakPosition(e){return this.computedBlockSize=e.computedBlockSize+this.getOffsetByRepetitiveElements(e),e.position}finishBreak(e,n,s){e.formattingContext;let i=new Un().find(e.formattingContext).finishBreak(this,e,n,s);return i||(i=ii.finishBreak(this,e,n,s)),i}findAcceptableBreakPosition(){let e=null,n=null,s=0,o=0;do{s=o,o=Number.MAX_VALUE;for(let i=this.breakPositions.length-1;i>=0&&!n;--i){e=this.breakPositions[i],n=e.findAcceptableBreak(this,s);let a=e.getMinBreakPenalty();a>s&&(o=Math.min(o,a))}}while(o>s&&!n&&this.forceNonfitting);return{breakPosition:n?e:null,nodeContext:n}}doFinishBreak(e,n,s,o){if(this.pageFloatLayoutContext.isInvalidated()||this.pageBreakType||!n)return v(e);let i=k(\"doFinishBreak\"),a=!1;if(!e){if(this.forceNonfitting)return V.warn(\"Could not find any page breaks?!!\"),this.skipTailEdges(n).then(l=>{l?(l=l.modify(),l.overflow=!1,this.finishBreak(l,a,!0).then(()=>{i.finish(l)})):i.finish(l)}),i.result();e=s,a=!0,this.computedBlockSize=o}return this.finishBreak(e,a,!0).then(()=>{i.finish(e)}),i.result()}isBreakable(e){for(let n=e;n;n=n.parent)if(co(n.viewNode))return!1;if(e.after)return!0;switch(e.sourceNode.namespaceURI){case\"http://www.w3.org/2000/svg\":return!1}return!e.flexContainer}zeroIndent(e){let n=e.toString();return n==\"\"||n==\"auto\"||!!n.match(/^0+(.0*)?[^0-9]/)}checkOverflowAndSaveEdge(e,n){if(!e)return!1;for(let a=e;a;a=a.parent)if(co(a.viewNode))return!1;if(hn(e.viewNode))return!1;let s=Mn(e,this.clientLayout,0,this.vertical),o=_n(e,this.collectElementsOffset()),i=this.isOverflown(s+(this.vertical?-1:1)*o.minimum);if(this.isOverflown(s+(this.vertical?-1:1)*o.current)&&!this.nodeContextOverflowingDueToRepetitiveElements)this.nodeContextOverflowingDueToRepetitiveElements=e;else if(n){let a=s+this.getTrailingMarginEdgeAdjustment(n),l=this.footnoteEdge-this.getBoxDir()*o.current;s=this.vertical?Math.min(s,Math.max(a,l)):Math.max(s,Math.min(a,l))}return this.updateMaxReachedAfterEdge(s),i}checkOverflowAndSaveEdgeAndBreakPosition(e,n,s,o){if(!e||hn(e.viewNode))return!1;let i=this.checkOverflowAndSaveEdge(e,n);return(s||!i)&&this.saveEdgeBreakPosition(e,o,i),i}applyClearance(e){if(!e.viewNode.parentNode)return!1;let n=this.getComputedMargin(e.viewNode),s=e.viewNode.ownerDocument.createElement(\"div\");this.vertical?(s.style.bottom=\"0px\",s.style.width=\"1px\",s.style.marginRight=`${n.right}px`):(s.style.right=\"0px\",s.style.height=\"1px\",s.style.marginTop=`${n.top}px`),e.viewNode.parentNode.insertBefore(s,e.viewNode);let o=this.clientLayout.getElementClientRect(s),i=this.getBeforeEdge(o),a=this.getBoxDir(),l=e.clearSide,c=-this.getBoxDir()*(1/0);switch(l===\"all\"&&(c=this.pageFloatLayoutContext.getPageFloatClearEdge(l,this)),/^(top|bottom|(block|inline)-(start|end))$/.test(l)?Ic(l,e.vertical,e.direction):l){case\"left\":c=a*Math.max(c*a,this.leftFloatEdge*a);break;case\"right\":c=a*Math.max(c*a,this.rightFloatEdge*a);break;default:c=a*Math.max(c*a,Math.max(this.rightFloatEdge*a,this.leftFloatEdge*a))}if(i*a>=c*a)return e.viewNode.parentNode.removeChild(s),!1;{let p=Math.max(1,(c-i)*a);this.vertical?s.style.width=`${p}px`:s.style.height=`${p}px`,o=this.clientLayout.getElementClientRect(s);let h=this.getAfterEdge(o);if(!e.floatSide)if(this.vertical){let f=h+n.right-c;f>0==n.right>=0&&(f+=n.right),s.style.marginLeft=`${f}px`}else{let f=c-(h+n.top);f>0==n.top>=0&&(f+=n.top),s.style.marginBottom=`${f}px`}return e.clearSpacer=s,!0}}isBFC(e){return!!(_h(e)||Qt.isInstanceOfRepetitiveElementsOwnerFormattingContext(e))}skipEdges(e,n,s){var E;let o=e.after?(E=e.parent)==null?void 0:E.formattingContext:e.formattingContext;if(o&&!this.isBFC(o))return v(e);let i=k(\"skipEdges\"),a=!s&&n&&e&&e.after,l=s,c=null,u=[],p=[],h=!1;function f(){return!!s||!n&&De(l)&&!g()}function g(){var C;if(!c||e.floatSide)return!1;for(let b=c;b!=null&&b.parent;b=b.parent){let y=b.after?b.viewNode:(C=b.viewNode)==null?void 0:C.previousSibling;for(;y&&(he(y,b.parent.whitespace)||co(y));)y=y.previousSibling;if(y)return!1}return!0}let m=()=>{e=u[0]||e,e.viewNode.parentNode.removeChild(e.viewNode),this.pageBreakType=l};return i.loopWithFrame(C=>{var b;for(;e;){e.formattingContext;let y=new Un().find(e.formattingContext);do{if(!e.viewNode)break;if(e.inline&&e.viewNode.nodeType!=1){if(he(e.viewNode,e.whitespace))break;if(!e.after){f()?m():this.checkOverflowAndSaveEdgeAndBreakPosition(c,null,!0,l)?(e=(this.stopAtOverflow&&c||e).modify(),e.overflow=!0):(e=e.modify(),e.breakBefore=l),C.breakLoop();return}}if(!e.after){if(e.floatSide&&(this.breakAtTheEdgeBeforeFloat=oo(l)?l:null),y&&y.startNonInlineElementNode(e))break;if(e.clearSide&&this.applyClearance(e)&&n&&this.breakPositions.length===0&&this.saveEdgeBreakPosition(e.copy(),l,!1),!e.inline&&!e.repeatOnBreak&&(c?Oc(c):this.breakPositions[this.breakPositions.length-1]instanceof Ts)&&this.saveEdgeBreakPosition(e.copy(),l,!1),!this.isBFC(e.formattingContext)||Qt.isInstanceOfRepetitiveElementsOwnerFormattingContext(e.formattingContext)||this.isFloatNodeContext(e)||e.flexContainer||!e.nodeShadow&&!e.sourceNode.firstElementChild&&he(e.sourceNode.firstChild,e.whitespace)){u.push(e.copy()),l=Ve(l,e.breakBefore),f()?m():(this.checkOverflowAndSaveEdgeAndBreakPosition(c,null,!0,l)||!this.layoutConstraint.allowLayout(e))&&(e=(this.stopAtOverflow&&c||e).modify(),e.overflow=!0),C.breakLoop();return}}if(e.viewNode.nodeType!=1)break;let S=e.viewNode.style;if(e.after){e.floatSide&&(l=l!=null?l:this.breakAtTheEdgeBeforeFloat,this.breakAtTheEdgeBeforeFloat=null);let w=e.sourceNode;if(w.localName===\"svg\"||w.localName===\"math\"||w.getAttribute(\"data-math-typeset\")===\"true\"){h=!1,c=e.copy(),p.push(c),l=Ve(null,e.breakAfter),this.checkOverflowAndSaveEdgeAndBreakPosition(c,null,!this.stopAtOverflow,l);break}if(e.inline||y&&y.afterNonInlineElementNode(e,this.stopAtOverflow))break;if(h){if(f()){m(),C.breakLoop();return}u=[],n=!1,a=!1,l=null}h=!1,c=e.copy(),p.push(c),l=Ve(l,e.breakAfter),S&&!(this.zeroIndent(S.paddingBottom)&&this.zeroIndent(S.borderBottomWidth))&&(p=[c])}else{if(u.push(e.copy()),l=Ve(l,e.breakBefore),(e.pageType!=((b=e.parent)==null?void 0:b.pageType)||!De(l))&&!this.layoutConstraint.allowLayout(e)&&(this.checkOverflowAndSaveEdgeAndBreakPosition(c,null,!this.stopAtOverflow,l),e=e.modify(),e.overflow=!0,this.stopAtOverflow)){C.breakLoop();return}let w=e.viewNode.localName;if(Xt[w]){f()?m():this.checkOverflowAndSaveEdgeAndBreakPosition(c,null,!0,l)&&(e=(this.stopAtOverflow&&c||e).modify(),e.overflow=!0),C.breakLoop();return}S&&!(this.zeroIndent(S.paddingTop)&&this.zeroIndent(S.borderTopWidth))&&(a=!1,p=[]),h=!0}}while(!1);let N=this.nextInTree(e,a);if(N.isPending()){N.then(S=>{e=S,C.continueLoop()});return}else e=N.get()}this.checkOverflowAndSaveEdgeAndBreakPosition(c,p,!this.stopAtOverflow,l)?c&&this.stopAtOverflow&&(e=c.modify(),e.overflow=!0):De(l)&&(this.pageBreakType=l),C.breakLoop()}).then(()=>{c&&(this.lastAfterPosition=c.toNodePosition()),i.finish(e)}),i.result()}skipTailEdges(e){let n=e.copy(),s=k(\"skipEdges\"),o=null,i=!1;return s.loopWithFrame(a=>{for(;e;){do{if(!e.viewNode)break;if(e.inline&&e.viewNode.nodeType!=1){if(he(e.viewNode,e.whitespace))break;if(!e.after){De(o)&&(this.pageBreakType=o),a.breakLoop();return}}if(!e.after&&(this.isFloatNodeContext(e)||e.flexContainer)){o=Ve(o,e.breakBefore),De(o)&&(this.pageBreakType=o),a.breakLoop();return}if(e.viewNode.nodeType!=1)break;let c=e.viewNode.style;if(e.after){if(i){if(De(o)){this.pageBreakType=o,a.breakLoop();return}o=null}i=!1,o=Ve(o,e.breakAfter)}else{o=Ve(o,e.breakBefore);let u=e.viewNode.localName;if(Xt[u]){De(o)&&(this.pageBreakType=o),a.breakLoop();return}if(c&&!(this.zeroIndent(c.paddingTop)&&this.zeroIndent(c.borderTopWidth))){a.breakLoop();return}}i=!0}while(!1);let l=this.layoutContext.nextInTree(e);if(l.isPending()){l.then(c=>{e=c,a.continueLoop()});return}else e=l.get()}n=null,a.breakLoop()}).then(()=>{s.finish(n)}),s.result()}layoutFloatOrFootnote(e){return Dn(e.floatReference)||e.floatSide===\"footnote\"?this.layoutPageFloat(e):this.layoutFloat(e)}layoutNext(e,n,s){let o=k(\"layoutNext\");return this.skipEdges(e,n,s||null).then(i=>{if(e=i,!e||this.pageBreakType||this.stopByOverflow(e))o.finish(e);else{let a=e.formattingContext;new Un().find(a).layout(e,this,n).thenFinish(o)}}),o.result()}clearOverflownViewNodes(e,n){if(e)for(let s=e.parent;e;e=s,s=s?s.parent:null){let o=(s||e).formattingContext;new Un().find(o).clearOverflownViewNodes(this,s,e,n),n=!1}}initGeom(){let e=this.element.ownerDocument.createElement(\"div\");e.style.position=\"absolute\",e.style.top=`${this.paddingTop}px`,e.style.right=`${this.paddingRight}px`,e.style.bottom=`${this.paddingBottom}px`,e.style.left=`${this.paddingLeft}px`,this.element.appendChild(e);let n=this.clientLayout.getElementClientRect(e);this.element.removeChild(e);let s=this.originX+this.left+this.getInsetLeft(),o=this.originY+this.top+this.getInsetTop();this.box=new He(s,o,s+this.width,o+this.height),this.startEdge=n?this.vertical?this.rtl?n.bottom:n.top:this.rtl?n.right:n.left:0,this.endEdge=n?this.vertical?this.rtl?n.top:n.bottom:this.rtl?n.left:n.right:0,this.beforeEdge=n?this.vertical?n.right:n.top:0,this.afterEdge=n?this.vertical?n.left:n.bottom:0,this.leftFloatEdge=this.beforeEdge,this.rightFloatEdge=this.beforeEdge,this.bottommostFloatTop=this.beforeEdge,this.footnoteEdge=this.afterEdge,this.bands=Hp(this.box,[this.getInnerShape()],this.getExclusions(),8,this.snapHeight,this.vertical),this.createFloats()}init(){this.chunkPositions=[],T(this.element,\"width\",`${this.width}px`),T(this.element,\"height\",`${this.height}px`),this.initGeom(),this.computedBlockSize=0,this.overflown=!1,this.pageBreakType=null,this.lastAfterPosition=null}saveEdgeBreakPosition(e,n,s){e.formattingContext;let o=e.copy(),i=new Un().find(e.formattingContext),a=this.calculateClonedPaddingBorder(o),l=i.createEdgeBreakPosition(o,n,s,this.computedBlockSize+a);this.breakPositions.push(l)}saveBoxBreakPosition(e){let n=e[0].breakPenalty;if(n){let o=e[0];for(;o.parent&&o.inline;)o=o.parent;n=o.breakPenalty}let s=new Ts(e,n);this.breakPositions.push(s)}updateMaxReachedAfterEdge(e){if(!isNaN(e)){let n=this.getBoxDir()*(e-this.beforeEdge);this.computedBlockSize=Math.max(n,this.computedBlockSize)}}layout(e,n,s){if(this.chunkPositions.push(e),e.primary.after&&(this.lastAfterPosition=e.primary),this.stopAtOverflow&&this.overflown)return v(e);if(this.isFullWithPageFloats())return e.primary.after&&e.primary.steps.length===1?v(null):v(e);let o=k(\"layout\");return this.openAllViews(e.primary).then(i=>{let a=null;if(i.viewNode)a=i.copy();else{let c=u=>{u.nodeContext.viewNode&&(a=u.nodeContext,this.layoutContext.removeEventListener(\"nextInTree\",c))};this.layoutContext.addEventListener(\"nextInTree\",c)}let l=new Hu(n,s);l.layout(i,this).then(c=>{this.doFinishBreak(c,l.context.overflownNodeContext,a,l.initialComputedBlockSize).then(u=>{let p=null;this.pseudoParent?p=v(null):p=this.doFinishBreakOfFragmentLayoutConstraints(u),p.then(()=>{if(this.pageFloatLayoutContext.isInvalidated()){o.finish(null);return}if(!u)o.finish(null);else{this.overflown=!0;let h=new pt(u.toNodePosition());o.finish(h)}})})})}),o.result()}isFullWithPageFloats(){return this.pageFloatLayoutContext.isColumnFullWithPageFloats(this)}getMaxBlockSizeOfPageFloats(){return this.pageFloatLayoutContext.getMaxBlockSizeOfPageFloats()}doFinishBreakOfFragmentLayoutConstraints(e){let n=k(\"doFinishBreakOfFragmentLayoutConstraints\"),s=[].concat(this.fragmentLayoutConstraints);s.sort((i,a)=>i.getPriorityOfFinishBreak()-a.getPriorityOfFinishBreak());let o=0;return n.loop(()=>o<s.length?s[o++].finishBreak(e,this).thenReturn(!0):v(!1)).then(()=>{n.finish(!0)}),n.result()}doLayout(e,n,s){let o=k(\"doLayout\"),i=null;return this.breakPositions=[],this.nodeContextOverflowingDueToRepetitiveElements=null,o.loopWithFrame(a=>{for(;e;){let l=!0;if(this.layoutNext(e,n,s||null).then(c=>{if(n=!1,s=null,this.nodeContextOverflowingDueToRepetitiveElements&&this.stopAtOverflow?(this.pageBreakType=null,e=this.nodeContextOverflowingDueToRepetitiveElements,e.overflow=!0):e=c,this.pageFloatLayoutContext.isInvalidated())a.breakLoop();else if(this.pageBreakType)a.breakLoop();else if(e&&this.stopByOverflow(e)){i=e;let u=this.findAcceptableBreakPosition();e=u.nodeContext,u.breakPosition&&u.breakPosition.breakPositionChosen(this),a.breakLoop()}else l?l=!1:a.continueLoop()}),l){l=!1;return}}this.computedBlockSize+=this.getOffsetByRepetitiveElements(),a.breakLoop()}).then(()=>{o.finish({nodeContext:e,overflownNodeContext:i})}),o.result()}redoLayout(){let e=this.chunkPositions,n=this.element.lastChild;for(;n!=this.last;){let l=n.previousSibling;this.element===n.parentNode&&this.layoutContext.isPseudoelement(n)||this.element.removeChild(n),n=l}this.killFloats(),this.init();let s=k(\"redoLayout\"),o=0,i=null,a=!0;return s.loopWithFrame(l=>{if(o<e.length){let c=e[o++];this.layout(c,a).then(u=>{a=!1,u?(i=u,l.breakLoop()):l.continueLoop()});return}l.breakLoop()}).then(()=>{s.finish(i)}),s.result()}saveDistanceToBlockEndFloats(){let e=this.pageFloatLayoutContext.getBlockStartEdgeOfBlockEndFloats();e>0&&isFinite(e)&&(this.blockDistanceToBlockEndFloats=this.getBoxDir()*(e-this.beforeEdge-this.computedBlockSize))}collectElementsOffset(){let e=[];for(let n=this;n;n=n.pseudoParent)n.fragmentLayoutConstraints.forEach(s=>{if(Qt.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(s)){let o=s.getRepetitiveElements();e.push(o)}if(Zo.isInstanceOfAfterIfContinuesLayoutConstraint(s)){let o=s.getRepetitiveElements();e.push(o)}Ot.isInstanceOfTableRowLayoutConstraint(s)&&s.getElementsOffsetsForTableCell(this).forEach(o=>{e.push(o)})});return e}},Ps=class{constructor(t,e,n){d(this,\"startNodeContexts\",[]);d(this,\"column\");this.column=Object.create(t),this.column.element=e,this.column.layoutContext=t.layoutContext.clone(),this.column.stopAtOverflow=!1,this.column.flowRootFormattingContext=n.formattingContext,this.column.pseudoParent=t;let s=this.column.calculateClonedPaddingBorder(n);this.column.footnoteEdge=this.column.footnoteEdge-s;let o=this;this.column.openAllViews=function(i){return ws.prototype.openAllViews.call(this,i).thenAsync(a=>(o.startNodeContexts.push(a.copy()),v(a)))}}layout(t,e){return this.column.layout(t,e)}findAcceptableBreakPosition(t){let e=this.column.findAcceptableBreakPosition();if(t){let n=this.startNodeContexts[0].copy(),s=new Jt(n,null,n.overflow,0);if(s.findAcceptableBreak(this.column,0),!e.nodeContext)return{breakPosition:s,nodeContext:n}}return e}finishBreak(t,e,n){return this.column.finishBreak(t,e,n)}doFinishBreakOfFragmentLayoutConstraints(t){this.column.doFinishBreakOfFragmentLayoutConstraints(t)}isStartNodeContext(t){let e=this.startNodeContexts[0];return e.viewNode===t.viewNode&&e.after===t.after&&e.offsetInNode===t.offsetInNode}isLastAfterNodeContext(t){return Dt(t.toNodePosition(),this.column.lastAfterPosition)}getColumnElement(){return this.column.element}getColumn(){return this.column}},Eo=class{breakTextNode(t,e,n,s,o,i){if(e.after)e.offsetInNode=t.length;else{let a=n-e.boxOffset,l=t.data;l.charCodeAt(a)==173?a=this.breakAfterSoftHyphen(t,l,a,e):a=this.breakAfterOtherCharacter(t,l,a,e),a>0&&(e=this.updateNodeContext(e,a,t))}return e}breakAfterSoftHyphen(t,e,n,s){let i=/[\\u0620\\u0626\\u0628\\u062A-\\u062E\\u0633-\\u0647\\u0649\\u064A\\u066E\\u066F\\u0678-\\u0687\\u069A-\\u06BF\\u06C1\\u06C2\\u06CC\\u06CE\\u06D0\\u06D1\\u06FA-\\u06FC\\u06FF\\u0712-\\u0714\\u071A-\\u071D\\u071F-\\u0727\\u0729\\u072B\\u072D\\u072E\\u074E-\\u0758\\u075C-\\u076A\\u076D-\\u0770\\u0772\\u0775-\\u0777\\u077A-\\u077F\\u07CA-\\u07EA\\u07FA\\u0841-\\u0845\\u0848\\u084A-\\u0853\\u0855\\u0860\\u0862-\\u0865\\u0868\\u0883-\\u0886\\u0889-\\u088D\\u08A0-\\u08A9\\u08AF\\u08B0\\u08B3-\\u08B8\\u08BA-\\u08C8\\u1807\\u180A\\u1820-\\u1878\\u1887-\\u18A8\\u18AA\\u200D\\uA840-\\uA871\\u{10AC0}-\\u{10AC4}\\u{10AD3}-\\u{10AD6}\\u{10AD8}-\\u{10ADC}\\u{10ADE}-\\u{10AE0}\\u{10AEB}-\\u{10AEE}\\u{10B80}\\u{10B82}\\u{10B86}-\\u{10B88}\\u{10B8A}\\u{10B8B}\\u{10B8D}\\u{10B90}\\u{10BAD}\\u{10BAE}\\u{10D01}-\\u{10D21}\\u{10D23}\\u{10EC3}\\u{10EC4}\\u{10F30}-\\u{10F32}\\u{10F34}-\\u{10F44}\\u{10F51}-\\u{10F53}\\u{10F70}-\\u{10F73}\\u{10F76}-\\u{10F81}\\u{10FB0}\\u{10FB2}\\u{10FB3}\\u{10FB8}\\u{10FBB}\\u{10FBC}\\u{10FBE}\\u{10FBF}\\u{10FC1}\\u{10FC4}\\u{10FCA}\\u{1E900}-\\u{1E943}]\\p{Mn}*$/u.test(e.slice(0,n))?\"\\u200D\":\"\";if(t.replaceData(n,e.length-n,s.breakWord?\"\":i+gf(s)),i){let a=s.preprocessedTextContent[0][1];s.preprocessedTextContent[0][1]=a.slice(0,n+1)+i+a.slice(n+1)}return n+1}breakAfterOtherCharacter(t,e,n,s){let o=e.charAt(n);n++;let i=e.charAt(n);return t.replaceData(n,e.length-n,!s.breakWord&&Nl(o)&&Nl(i)?gf(s):\"\"),n}updateNodeContext(t,e,n){return t=t.modify(),t.offsetInNode+=e,t.breakBefore=null,t}};d(Eo,\"instance\");Eo.instance=new Eo;function gf(r){return r.hyphenateCharacter||r.parent&&r.parent.hyphenateCharacter||\"-\"}var Hu=class extends Hn{constructor(e,n){super();this.leadingEdge=e;d(this,\"breakAfter\");d(this,\"initialPageBreakType\",null);d(this,\"initialComputedBlockSize\",0);d(this,\"initialOverflown\",!1);d(this,\"context\",{overflownNodeContext:null});this.breakAfter=n||null}resolveLayoutMode(e){return new zu(this.leadingEdge,this.breakAfter,this.context)}prepareLayout(e,n){n.fragmentLayoutConstraints=[],n.pseudoParent||Hh()}clearNodes(e){super.clearNodes(e);let n=e;for(;n;){let s=n.viewNode;s&&qr(s.parentNode,s),n=n.parent}}saveState(e,n){super.saveState(e,n),this.initialPageBreakType=n.pageBreakType,this.initialComputedBlockSize=n.computedBlockSize,this.initialOverflown=n.overflown}restoreState(e,n){super.restoreState(e,n),n.pageBreakType=this.initialPageBreakType,n.computedBlockSize=this.initialComputedBlockSize,n.overflown=this.initialOverflown}},zu=class{constructor(t,e,n){this.leadingEdge=t;this.breakAfter=e;this.context=n}doLayout(t,e){let n=k(\"DefaultLayoutMode.doLayout\");return uC(t,e).then(()=>{e.doLayout(t,this.leadingEdge,this.breakAfter).then(s=>{this.context.overflownNodeContext=s.overflownNodeContext,n.finish(s.nodeContext)})}),n.result()}accept(t,e){return e.pageFloatLayoutContext.isInvalidated()||e.pageBreakType||e.fragmentLayoutConstraints.length<=0?!0:e.fragmentLayoutConstraints.every(n=>n.allowLayout(t,this.context.overflownNodeContext,e))}postLayout(t,e,n,s){return s||(s=!n.fragmentLayoutConstraints.some(i=>i.nextCandidate(t))),n.fragmentLayoutConstraints.forEach(o=>{o.postLayout(s,t,e,n)}),s}},Gu=class extends ws{constructor(e,n,s,o,i,a,l){super(n,s,o,i,a);this.floatSide=e;this.parentContainer=l;d(this,\"rootViewNodes\",[]);d(this,\"floatMargins\",[]);d(this,\"adjustContentRelativeSize\",!0)}openAllViews(e){return super.openAllViews(e).thenAsync(n=>(n&&this.fixFloatSizeAndPosition(n),v(n)))}convertPercentageSizesToPx(e){let n=this.parentContainer.getPaddingRect(),s=n.x2-n.x1,o=n.y2-n.y1;function i(a,l){a.forEach(c=>{let u=Tn(e,c);if(u&&u.charAt(u.length-1)===\"%\"){let p=parseFloat(u),h=l*p/100;T(e,c,`${h}px`)}})}i([\"width\",\"max-width\",\"min-width\"],s),i([\"height\",\"max-height\",\"min-height\"],o),i([\"margin-top\",\"margin-right\",\"margin-bottom\",\"margin-left\",\"padding-top\",\"padding-right\",\"padding-bottom\",\"padding-left\"],this.vertical?o:s),[\"margin-top\",\"margin-right\",\"margin-bottom\",\"margin-left\"].forEach(a=>{Tn(e,a)===\"auto\"&&T(e,a,\"0\")})}fixFloatSizeAndPosition(e){for(;e.parent;)e=e.parent;e.viewNode.nodeType;let n=e.viewNode;if(this.rootViewNodes.push(n),this.adjustContentRelativeSize&&this.convertPercentageSizesToPx(n),this.floatMargins.push(this.getComputedMargin(n)),this.adjustContentRelativeSize){let s=this.floatSide;if(this.parentContainer.vertical){if(s===\"block-end\"||s===\"left\"){let i=Tn(n,\"height\");i!==\"\"&&i!==\"auto\"&&T(n,\"margin-top\",\"auto\")}}else if(s===\"block-end\"||s===\"bottom\"){let i=Tn(n,\"width\");i!==\"\"&&i!==\"auto\"&&T(n,\"margin-left\",\"auto\")}}}getContentInlineSize(){return Math.max.apply(null,this.rootViewNodes.map((e,n)=>{let s=this.clientLayout.getElementClientRect(e),o=this.floatMargins[n];return this.vertical?o.top+s.height+o.bottom:o.left+s.width+o.right}))}};var Ut=class{constructor(t,e){this.parent=t;this.rootSourceNode=e;d(this,\"formattingContextType\",\"RepetitiveElementsOwner\");d(this,\"isRoot\",!1);d(this,\"repetitiveElements\",null)}getName(){return\"Repetitive elements owner formatting context (RepetitiveElementsOwnerFormattingContext)\"}isFirstTime(t,e){return e}getParent(){return this.parent}getRepetitiveElements(){return this.repetitiveElements}getRootViewNode(t){let e=this.getRootNodeContext(t);return e?e.viewNode:null}getRootNodeContext(t){do if(!t.belongsTo(this)&&t.sourceNode===this.rootSourceNode)return t;while(t=t.parent);return null}initializeRepetitiveElements(t){if(this.repetitiveElements)return;Jr.some(n=>n.root===this.rootSourceNode?(this.repetitiveElements=n.elements,!0):!1)||(this.repetitiveElements=new $u(t,this.rootSourceNode),Jr.push({root:this.rootSourceNode,elements:this.repetitiveElements}))}saveState(){}restoreState(t){}},$u=class{constructor(t,e){this.vertical=t;this.ownerSourceNode=e;d(this,\"headerSourceNode\",null);d(this,\"footerSourceNode\",null);d(this,\"headerViewNode\",null);d(this,\"footerViewNode\",null);d(this,\"headerNodePosition\",null);d(this,\"footerNodePosition\",null);d(this,\"headerHeight\",0);d(this,\"footerHeight\",0);d(this,\"isSkipHeader\",!1);d(this,\"isSkipFooter\",!1);d(this,\"enableSkippingFooter\",!0);d(this,\"enableSkippingHeader\",!0);d(this,\"doneInitialLayout\",!1);d(this,\"firstContentSourceNode\",null);d(this,\"lastContentSourceNode\",null);d(this,\"affectedNodeCache\",[]);d(this,\"afterLastContentNodeCache\",[]);d(this,\"allowInsert\",!1);d(this,\"allowInsertRepeatitiveElements\")}setHeaderNodeContext(t){this.headerNodePosition||(this.headerNodePosition=gs(t,0),this.headerSourceNode=t.sourceNode,this.headerViewNode=t.viewNode)}setFooterNodeContext(t){this.footerNodePosition||(this.footerNodePosition=gs(t,0),this.footerSourceNode=t.sourceNode,this.footerViewNode=t.viewNode)}updateHeight(t){this.headerViewNode&&(this.headerHeight=oi(this.headerViewNode,t,this.vertical),this.headerViewNode=null),this.footerViewNode&&(this.footerHeight=oi(this.footerViewNode,t,this.vertical),this.footerViewNode=null)}prepareLayoutFragment(){this.isSkipHeader=this.isSkipFooter=!1,this.enableSkippingFooter=!0,this.enableSkippingHeader=!0}appendHeaderToFragment(t,e,n){return!this.headerNodePosition||this.isSkipHeader?v(!0):this.appendElementToFragment(this.headerNodePosition,t,e,n)}appendFooterToFragment(t,e,n){return!this.footerNodePosition||this.isSkipFooter?v(!0):this.appendElementToFragment(this.footerNodePosition,t,e,n)}appendElementToFragment(t,e,n,s){let o=e.viewNode.ownerDocument,i=e.viewNode,a=o.createElement(\"div\");i.appendChild(a);let l=new Ps(s,a,e),c=l.getColumn().pageBreakType;return l.getColumn().pageBreakType=null,this.allowInsertRepeatitiveElements=!0,l.layout(new pt(t),!0).thenAsync(()=>(this.allowInsertRepeatitiveElements=!1,i.removeChild(a),this.moveChildren(a,i,n),l.getColumn().pageBreakType=c,v(!0)))}moveChildren(t,e,n){if(e)for(;t.firstChild;){let s=t.firstChild;t.removeChild(s),s.setAttribute(Mt,\"1\"),n?e.insertBefore(s,n):e.appendChild(s)}}calculateOffset(t){let e=0;return t&&!this.affectTo(t)||((!this.isSkipFooter||t&&this.isAfterLastContent(t))&&(e+=this.footerHeight),this.isSkipHeader||(e+=this.headerHeight)),e}calculateMinimumOffset(t){let e=0;return t&&!this.affectTo(t)||(!this.enableSkippingFooter&&t&&this.isAfterLastContent(t)&&(e+=this.footerHeight),this.enableSkippingHeader||(e+=this.headerHeight)),e}isAfterLastContent(t){return this.findResultFromCache(t,this.afterLastContentNodeCache,e=>this.isAfterNodeContextOf(this.lastContentSourceNode,t,!1))}affectTo(t){return this.findResultFromCache(t,this.affectedNodeCache,e=>this.isAfterNodeContextOf(this.ownerSourceNode,t,!0))}findResultFromCache(t,e,n){let s=e.filter(o=>o.nodeContext.sourceNode===t.sourceNode&&o.nodeContext.after===t.after);if(s.length>0)return s[0].result;{let o=n(t);return e.push({nodeContext:t,result:o}),o}}isAfterNodeContextOf(t,e,n){let s=[];for(let o=t;o;o=o.parentNode){if(e.sourceNode===o)return e.after;s.push(o)}for(let o=e.sourceNode;o;o=o.parentNode){let i=s.indexOf(o);if(i>=0)return n?i===0:!1;for(let a=o;a;a=a.previousElementSibling)if(s.includes(a))return!0}return e.after}isFirstContentNode(t){return t&&this.firstContentSourceNode===t.sourceNode}isEnableToUpdateState(){return!!(!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition||!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition)}updateState(){!this.isSkipFooter&&this.enableSkippingFooter&&this.footerNodePosition?this.isSkipFooter=!0:!this.isSkipHeader&&this.enableSkippingHeader&&this.headerNodePosition&&(this.isSkipHeader=!0)}preventSkippingHeader(){this.isSkipHeader=!1,this.enableSkippingHeader=!1}preventSkippingFooter(){this.isSkipFooter=!1,this.enableSkippingFooter=!1}isHeaderRegistered(){return!!this.headerNodePosition}isFooterRegistered(){return!!this.footerNodePosition}isHeaderSourceNode(t){return this.headerSourceNode===t}isFooterSourceNode(t){return this.footerSourceNode===t}},mi=class{constructor(t){this.formattingContext=t}accept(t,e){return!!t}postLayout(t,e,n,s){let o=this.formattingContext.getRepetitiveElements();return o&&(n.clientLayout,o.doneInitialLayout||(o.updateHeight(n),o.doneInitialLayout=!0)),s}},Ci=class{constructor(t){this.formattingContext=t}accept(t,e){return!0}postLayout(t,e,n,s){return s}},Xu=class extends mi{constructor(e,n){super(e);this.processor=n}doLayout(e,n){return this.processor.doInitialLayout(e,n)}accept(e,n){return!1}},ju=class extends Ci{constructor(e,n){super(e);this.processor=n}doLayout(e,n){return!e.belongsTo(this.formattingContext)&&!e.after&&n.fragmentLayoutConstraints.unshift(new So(e)),this.processor.doLayout(e,n)}},So=class r{constructor(t){d(this,\"flagmentLayoutConstraintType\",\"RepetitiveElementsOwner\");d(this,\"nodeContext\");let e=yn(t.formattingContext);this.nodeContext=e.getRootNodeContext(t)}allowLayout(t,e,n){let s=this.getRepetitiveElements();return!s||hn(this.nodeContext.viewNode)||!s.isEnableToUpdateState()?!0:!(e&&!t||t&&t.overflow)}nextCandidate(t){let e=this.getRepetitiveElements();return e&&e.isEnableToUpdateState()?(e.updateState(),!0):!1}postLayout(t,e,n,s){let o=this.getRepetitiveElements();o&&t&&s.stopAtOverflow&&(e==null||o.isAfterLastContent(e))&&o.preventSkippingFooter()}finishBreak(t,e){let n=yn(this.nodeContext.formattingContext),s=this.getRepetitiveElements();if(!s)return v(!0);let o=this.nodeContext;return hC(n,o,e).thenAsync(()=>fC(n,o,e).thenAsync(()=>(s.prepareLayoutFragment(),v(!0))))}getRepetitiveElements(){return yn(this.nodeContext.formattingContext).getRepetitiveElements()}equalsTo(t){return t instanceof r?yn(this.nodeContext.formattingContext)===yn(t.nodeContext.formattingContext):!1}getPriorityOfFinishBreak(){return 10}},Yu=class extends Hn{constructor(e,n){super();this.formattingContext=e;this.processor=n}resolveLayoutMode(e){let n=this.formattingContext.getRepetitiveElements();return!e.belongsTo(this.formattingContext)&&!n.doneInitialLayout?new Xu(this.formattingContext,this.processor):(!e.belongsTo(this.formattingContext)&&!e.after&&n&&n.preventSkippingHeader(),new ju(this.formattingContext,this.processor))}},Ku=class extends gn{constructor(e,n){super();this.formattingContext=e;this.column=n}startNonInlineElementNode(e){let n=this.formattingContext,s=e.nodeContext,o=n.getRepetitiveElements();if(s.parent&&n.rootSourceNode===s.parent.sourceNode){switch(s.repeatOnBreak){case\"header\":if(o.isHeaderRegistered())s.repeatOnBreak=\"none\";else return o.setHeaderNodeContext(s),v(!0);break;case\"footer\":if(o.isFooterRegistered())s.repeatOnBreak=\"none\";else return o.setFooterNodeContext(s),v(!0);break}o.firstContentSourceNode||(o.firstContentSourceNode=s.sourceNode)}return gn.prototype.startNonInlineElementNode.call(this,e)}afterNonInlineElementNode(e){let n=this.formattingContext,s=e.nodeContext;return s.sourceNode===n.rootSourceNode&&(n.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0),s.repeatOnBreak===\"header\"||s.repeatOnBreak===\"footer\"?v(!0):gn.prototype.afterNonInlineElementNode.call(this,e)}};var qu=class extends en{layout(t,e,n){if(e.isFloatNodeContext(t))return e.layoutFloatOrFootnote(t);let s=yn(t.formattingContext);return s.getRootViewNode(t)?(n&&Zu(t.parent,e),t.belongsTo(s)?en.prototype.layout.call(this,t,e,n):new Yu(s,this).layout(t,e)):e.buildDeepElementView(t)}startNonInlineElementNode(t){let n=gC(t).getRepetitiveElements();return n&&!n.allowInsertRepeatitiveElements&&(n.isHeaderSourceNode(t.sourceNode)||n.isFooterSourceNode(t.sourceNode))&&t.viewNode.parentNode.removeChild(t.viewNode),!1}doInitialLayout(t,e){let n=yn(t.formattingContext),s=k(\"BlockLayoutProcessor.doInitialLayout\");return this.layoutEntireBlock(t,e).thenFinish(s),s.result()}layoutEntireBlock(t,e){let n=yn(t.formattingContext),s=new Ku(n,e);return new Cs(s,e.layoutContext).iterate(t)}doLayout(t,e){let n=yn(t.formattingContext),s=k(\"doLayout\"),o=e.layoutContext.nextInTree(t,!1);return Wu(o,e).then(i=>{let a=i;s.loopWithFrame(l=>{for(;a;){let c=!0;if(e.layoutNext(a,!1).then(u=>{a=u,e.pageFloatLayoutContext.isInvalidated()||e.pageBreakType||a&&e.stopByOverflow(a)||a&&a.after&&a.sourceNode==n.rootSourceNode?l.breakLoop():c?c=!1:l.continueLoop()}),c){c=!1;return}}l.breakLoop()}).then(()=>{s.finish(a)})}),s.result()}finishBreak(t,e,n,s){return en.prototype.finishBreak.call(this,t,e,n,s)}clearOverflownViewNodes(t,e,n,s){en.prototype.clearOverflownViewNodes(t,e,n,s)}};function pC(r,t){for(let e=r;e;e=e.parent){let n=e.formattingContext;n&&n instanceof Ut&&!e.belongsTo(n)&&t(n,e)}}function Zu(r,t){r&&pC(r.after?r.parent:r,(e,n)=>{Ot.isInstanceOfTableFormattingContext(e)||t.fragmentLayoutConstraints.push(new So(n))})}function hC(r,t,e){let n=r.getRepetitiveElements();if(n){let s=r.getRootNodeContext(t);if(s.viewNode){let o=s.viewNode.firstChild;return n.appendHeaderToFragment(s,o,e)}}return v(!0)}function fC(r,t,e){let n=r.getRepetitiveElements();if(n&&!n.isSkipFooter){let s=r.getRootNodeContext(t);if(s.viewNode)return n.appendFooterToFragment(s,null,e)}return v(!0)}function gC(r){let t=r.formattingContext;return!t||!(t instanceof Ut)?null:t}function yn(r){return r instanceof Ut,r}var mC=new qu;_e(\"RESOLVE_LAYOUT_PROCESSOR\",r=>r instanceof Ut&&!Ot.isInstanceOfTableFormattingContext(r)?mC:null);var ya=class{constructor(t,e){this.rowIndex=t;this.sourceNode=e;d(this,\"cells\",[])}addCell(t){this.cells.push(t)}getMinimumHeight(){return Math.min.apply(null,this.cells.map(t=>t.height))}},Qu=class{constructor(t,e,n){this.rowIndex=t;this.columnIndex=e;d(this,\"viewElement\");d(this,\"colSpan\");d(this,\"rowSpan\");d(this,\"height\",0);d(this,\"anchorSlot\",null);this.viewElement=n,this.colSpan=n.colSpan||1,this.rowSpan=n.rowSpan||1}setHeight(t){this.height=t}setAnchorSlot(t){this.anchorSlot=t}},Ju=class{constructor(t,e,n){this.rowIndex=t;this.columnIndex=e;this.cell=n}},ed=class{constructor(t,e,n){this.column=t;this.cellNodeContext=n;d(this,\"pseudoColumn\");d(this,\"empty\",!1);this.pseudoColumn=new Ps(t,e,n)}findAcceptableBreakPosition(){let t=this.cellNodeContext.viewNode,{verticalAlign:e,alignContent:n}=t.style;e!==\"top\"&&e!==\"baseline\"&&T(t,\"vertical-align\",\"top\"),n&&n!==\"normal\"&&T(t,\"align-content\",\"normal\");let s=this.pseudoColumn.findAcceptableBreakPosition(!0);return T(t,\"vertical-align\",e),n&&n!==\"normal\"&&T(t,\"align-content\",n),s}},td=class{constructor(t,e){this.viewNode=t;this.side=e}},nd=class extends Jt{constructor(e,n,s,o){super(e,n,s,o);d(this,\"formattingContext\");d(this,\"acceptableCellBreakPositions\",null);d(this,\"rowIndex\",null);this.formattingContext=e.formattingContext}findAcceptableBreak(e,n){let s=super.findAcceptableBreak(e,n);return n<this.getMinBreakPenalty()?null:this.getAcceptableCellBreakPositions().every(i=>!!i.nodeContext)?s:null}getMinBreakPenalty(){let e=super.getMinBreakPenalty();this.getAcceptableCellBreakPositions().forEach(s=>{e+=s.breakPosition.getMinBreakPenalty()});let n=this.getCellFragments();return e+=Math.max(0,...n.map(s=>s.cellNodeContext.breakPenalty)),e}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){let e=this.formattingContext,n=this.getCellFragments();this.acceptableCellBreakPositions=n.map(s=>s.findAcceptableBreakPosition())}return this.acceptableCellBreakPositions}getRowIndex(){return this.rowIndex!=null?this.rowIndex:this.rowIndex=this.formattingContext.findRowIndexBySourceNode(this.position.sourceNode)}getCellFragments(){return this.formattingContext.getRowSpanningCellsOverflowingTheRow(this.getRowIndex()).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}},sd=class extends ms{constructor(e,n,s){super();this.rowIndex=e;this.beforeNodeContext=n;this.formattingContext=s;d(this,\"acceptableCellBreakPositions\",null)}findAcceptableBreak(e,n){if(n<this.getMinBreakPenalty())return null;let s=this.getCellFragments(),o=this.getAcceptableCellBreakPositions(),i=o.every(a=>!!a.nodeContext)&&o.some((a,l)=>{let c=s[l].pseudoColumn,u=a.nodeContext;return!c.isStartNodeContext(u)&&!c.isLastAfterNodeContext(u)});return this.beforeNodeContext.overflow=o.some(a=>a.nodeContext&&a.nodeContext.overflow),i?this.beforeNodeContext:null}getMinBreakPenalty(){let e=this.formattingContext,n=e.getRowByIndex(this.rowIndex),s=this.beforeNodeContext.breakPenalty,o=this.getAcceptableCellBreakPositions(),i=this.getCellFragments();s+=Math.max(0,...i.map(l=>l.cellNodeContext.breakPenalty));let a=o.some((l,c)=>l.breakPosition instanceof Ts&&i[c].cellNodeContext.sourceNode.rowSpan>1);return!a&&!e.isFreelyFragmentableRow(n)&&(s+=10),o.forEach((l,c)=>{let u=l.breakPosition.getMinBreakPenalty();a&&l.breakPosition instanceof Jt&&l.breakPosition.overflows&&u>=3&&(i[c].column.checkOverflowAndSaveEdge(l.nodeContext,null)||(u-=3)),s+=u}),s}getAcceptableCellBreakPositions(){if(!this.acceptableCellBreakPositions){let e=this.getCellFragments();this.acceptableCellBreakPositions=e.map(n=>n.findAcceptableBreakPosition())}return this.acceptableCellBreakPositions}getCellFragments(){return this.formattingContext.getCellsFallingOnRow(this.rowIndex).map(this.formattingContext.getCellFragmentOfCell,this.formattingContext)}},Xn=class extends Ut{constructor(e,n){super(e,n);this.tableSourceNode=n;d(this,\"formattingContextType\",\"Table\");d(this,\"vertical\",!1);d(this,\"columnCount\",-1);d(this,\"tableWidth\",0);d(this,\"captions\",[]);d(this,\"colGroups\",null);d(this,\"colWidths\",null);d(this,\"inlineBorderSpacing\",0);d(this,\"rows\",[]);d(this,\"slots\",[]);d(this,\"cellFragments\",[]);d(this,\"lastRowViewNode\",null);d(this,\"cellBreakPositions\",[]);d(this,\"repetitiveElements\",null)}getName(){return\"Table formatting context (Table.TableFormattingContext)\"}isFirstTime(e,n){if(!n)return n;switch(e.display){case\"table-row\":return this.cellBreakPositions.length===0;case\"table-cell\":return!this.cellBreakPositions.some(s=>s.cellNodePosition.steps[0].node===e.sourceNode);default:return n}}getParent(){return this.parent}finishFragment(){this.cellFragments=[]}addRow(e,n){this.rows[e]=n}getRowSlots(e){let n=this.slots[e];return n||(n=this.slots[e]=[]),n}addCell(e,n){let s=this.rows[e];s||(this.addRow(e,new ya(e,null)),s=this.rows[e]),s.addCell(n);let o=e+n.rowSpan,i=this.getRowSlots(e),a=0;for(;i[a];)a++;for(;e<o;e++){i=this.getRowSlots(e);for(let l=a;l<a+n.colSpan;l++){let c=i[l]=new Ju(e,l,n);n.anchorSlot||n.setAnchorSlot(c)}}}getRowByIndex(e){let n=this.rows[e];return n}findRowIndexBySourceNode(e){return this.rows.findIndex(n=>e===n.sourceNode)}addCellFragment(e,n,s){let o=this.cellFragments[e];o||(o=this.cellFragments[e]=[]),o[n]=s}getCellsFallingOnRow(e){return this.getRowSlots(e).reduce((s,o)=>o.cell!==s[s.length-1]?s.concat(o.cell):s,[])}getRowSpanningCellsOverflowingTheRow(e){return this.getCellsFallingOnRow(e).filter(n=>n.rowIndex+n.rowSpan-1>e)}getCellFragmentOfCell(e){return this.cellFragments[e.rowIndex]&&this.cellFragments[e.rowIndex][e.columnIndex]}isFreelyFragmentableRow(e){return e.getMinimumHeight()>this.tableWidth/2}getColumnCount(){return this.columnCount<0&&(this.columnCount=Math.max.apply(null,this.rows.map(e=>e.cells.reduce((n,s)=>n+s.colSpan,0)))),this.columnCount}updateCellSizes(e){this.rows.forEach(n=>{n.cells.forEach(s=>{let o=e.getElementClientRect(s.viewElement);s.viewElement=null,s.setHeight(this.vertical?o.width:o.height)})})}findCellFromColumn(e){if(!e)return null;let n=null,s=0,o=0;e:for(s=0;s<this.cellFragments.length;s++)if(this.cellFragments[s]){for(o=0;o<this.cellFragments[s].length;o++)if(this.cellFragments[s][o]&&e===this.cellFragments[s][o].pseudoColumn.getColumn()){n=this.rows[s].cells[o];break e}}if(!n)return null;for(;s<this.slots.length;s++)for(;o<this.slots[s].length;o++){let i=this.slots[s][o];if(i.cell===n)return{rowIndex:i.rowIndex,columnIndex:i.columnIndex}}return null}collectElementsOffsetOfUpperCells(e){let n=[];return this.slots.reduce((s,o,i)=>{if(i>=e.rowIndex)return s;let a=o[e.columnIndex]&&this.getCellFragmentOfCell(o[e.columnIndex].cell);return!a||n.includes(a)||(this.collectElementsOffsetFromColumn(a.pseudoColumn.getColumn(),s),n.push(a)),s},[])}collectElementsOffsetOfHighestColumn(){let e=[];return this.rows.forEach(n=>{n.cells.forEach((s,o)=>{e[o]||(e[o]={collected:[],elements:[]});let i=e[o],a=this.getCellFragmentOfCell(s);!a||i.collected.includes(a)||(this.collectElementsOffsetFromColumn(a.pseudoColumn.getColumn(),i.elements),i.collected.push(a))})}),[new od(e.map(n=>n.elements))]}collectElementsOffsetFromColumn(e,n){e.fragmentLayoutConstraints.forEach(s=>{if(Qt.isInstanceOfRepetitiveElementsOwnerLayoutConstraint(s)){let o=s.getRepetitiveElements();n.push(o)}Ot.isInstanceOfTableRowLayoutConstraint(s)&&s.getElementsOffsetsForTableCell(null).forEach(o=>{n.push(o)})})}saveState(){return[].concat(this.cellBreakPositions)}restoreState(e){this.cellBreakPositions=e}},od=class{constructor(t){this.repeatitiveElementsInColumns=t}calculateOffset(t){return this.calculateMaxOffsetOfColumn(t,e=>e.current)}calculateMinimumOffset(t){return this.calculateMaxOffsetOfColumn(t,e=>e.minimum)}calculateMaxOffsetOfColumn(t,e){let n=0;return this.repeatitiveElementsInColumns.forEach(s=>{let o=_n(t,s);n=Math.max(n,e(o))}),n}};function Lt(r){return r instanceof Xn,r}function CC(r){return r===\"table-row-group\"||r===\"table-header-group\"||r===\"table-footer-group\"}function bC(r){return r===\"table\"||r===\"inline-table\"}function yf(r){return CC(r)||bC(r)}function xf(r,t,e){let n=r.nodeContext,s=n.display,o=n.parent?n.parent.display:null,i=!1;if(o===\"inline-table\"&&!(n.formattingContext instanceof Xn)){for(let l=n.parent;l;l=l.parent)if(l.formattingContext instanceof Xn){i=l.formattingContext===t;break}}return i||s===\"table-row\"&&!yf(o)||s===\"table-cell\"&&o!==\"table-row\"&&!yf(o)||n.formattingContext instanceof Xn&&n.formattingContext!==t?e.buildDeepElementView(n).thenAsync(l=>(r.nodeContext=l,v(!0))):null}var id=class extends gn{constructor(e,n){super();this.formattingContext=e;this.column=n;d(this,\"rowIndex\",-1);d(this,\"columnIndex\",0);d(this,\"inRow\",!1);d(this,\"checkPoints\",[]);d(this,\"inHeaderOrFooter\",!1)}startNonInlineElementNode(e){let n=this.formattingContext,s=xf(e,n,this.column);if(s)return s;this.postLayoutBlockContents(e);let o=e.nodeContext,i=o.display,a=n.getRepetitiveElements();switch(i){case\"table\":n.inlineBorderSpacing=o.inlineBorderSpacing;break;case\"table-caption\":{let l=new td(o.viewNode,o.captionSide);n.captions.push(l);break}case\"table-header-group\":return a.isHeaderRegistered()||(this.inHeaderOrFooter=!0,a.setHeaderNodeContext(o)),v(!0);case\"table-footer-group\":return a.isFooterRegistered()||(this.inHeaderOrFooter=!0,a.setFooterNodeContext(o)),v(!0);case\"table-row\":this.inHeaderOrFooter||(this.inRow=!0,this.rowIndex++,o.sourceNode,this.columnIndex=0,n.addRow(this.rowIndex,new ya(this.rowIndex,o.sourceNode)),a.firstContentSourceNode||(a.firstContentSourceNode=o.sourceNode));break}return super.startNonInlineElementNode(e)}afterNonInlineElementNode(e){let n=this.formattingContext,s=e.nodeContext,o=s.display,i=this.column.clientLayout;if(this.postLayoutBlockContents(e),s.sourceNode===n.tableSourceNode){let a=i.getElementComputedStyle(n.getRootViewNode(s));n.tableWidth=parseFloat(a[n.vertical?\"height\":\"width\"]),n.getRepetitiveElements().lastContentSourceNode=e.lastAfterNodeContext&&e.lastAfterNodeContext.sourceNode,e.break=!0}else switch(o){case\"table-header-group\":case\"table-footer-group\":if(this.inHeaderOrFooter)return this.inHeaderOrFooter=!1,v(!0);break;case\"table-row\":this.inHeaderOrFooter||(n.lastRowViewNode=s.viewNode,this.inRow=!1);break;case\"table-cell\":if(!this.inHeaderOrFooter){this.inRow||(this.rowIndex++,this.columnIndex=0,this.inRow=!0);let a=s.viewNode;n.addCell(this.rowIndex,new Qu(this.rowIndex,this.columnIndex,a)),this.columnIndex++}break}return super.afterNonInlineElementNode(e)}startNonElementNode(e){this.registerCheckPoint(e)}afterNonElementNode(e){this.registerCheckPoint(e)}startInlineElementNode(e){this.registerCheckPoint(e)}afterInlineElementNode(e){this.registerCheckPoint(e)}registerCheckPoint(e){let n=e.nodeContext;n&&n.viewNode&&!fn(n)&&this.checkPoints.push(n.clone())}postLayoutBlockContents(e){this.checkPoints.length>0&&this.column.postLayoutBlock(e.nodeContext,this.checkPoints),this.checkPoints=[]}},Ea=class Ea extends gn{constructor(e,n){super(!0);this.formattingContext=e;this.column=n;d(this,\"inRow\",!1);d(this,\"currentRowIndex\",-1);d(this,\"currentColumnIndex\",0);d(this,\"originalStopAtOverflow\");d(this,\"inHeader\");d(this,\"inFooter\");this.originalStopAtOverflow=n.stopAtOverflow,n.stopAtOverflow=!1}resetColumn(){this.column.stopAtOverflow=this.originalStopAtOverflow}getColSpanningCellWidth(e){let n=this.formattingContext.colWidths;let s=0;for(let o=0;o<e.colSpan;o++)s+=n[e.anchorSlot.columnIndex+o];return s+=this.formattingContext.inlineBorderSpacing*(e.colSpan-1),s}layoutCell(e,n,s){let o=e.rowIndex,i=e.columnIndex,a=e.colSpan,l=n.viewNode,c=n.verticalAlign;a>1&&(T(l,\"box-sizing\",\"border-box\"),T(l,this.formattingContext.vertical?\"height\":\"width\",`${this.getColSpanningCellWidth(e)}px`));let u=l.ownerDocument.createElement(\"div\");l.appendChild(u);let p=new ed(this.column,u,n);return this.formattingContext.addCellFragment(o,i,p),s.primary.steps.length===1&&s.primary.after&&(p.empty=!0),p.pseudoColumn.layout(s,!0).thenReturn(!0)}hasBrokenCellAtSlot(e){let n=this.formattingContext.cellBreakPositions[0];return n?n.cell.anchorSlot.columnIndex===e:!1}extractRowSpanningCellBreakPositions(){let e=this.formattingContext.cellBreakPositions;if(e.length===0)return[];let n=[],s=0;do{let o=e[s],i=o.cell.rowIndex;if(i<this.currentRowIndex){let a=n[i];a||(a=n[i]=[]),a.push(o),e.splice(s,1)}else s++}while(s<e.length);return n}layoutRowSpanningCellsFromPreviousFragment(e){let n=this.formattingContext,s=this.extractRowSpanningCellBreakPositions(),o=s.reduce(h=>h+1,0);if(o===0)return v(!0);let i=this.column.layoutContext,a=e.nodeContext;a.viewNode.parentNode.removeChild(a.viewNode);let l=k(\"layoutRowSpanningCellsFromPreviousFragment\"),c=v(!0),u=0,p=[];return s.forEach(h=>{c=c.thenAsync(()=>{let f=lo(h[0].cellNodePosition.steps[1],a.parent);return i.setCurrent(f,!1).thenAsync(()=>{let g=v(!0),m=0;function E(C){for(;m<C;){if(!p.includes(m)){let b=f.viewNode.ownerDocument.createElement(\"td\");T(b,\"padding\",\"0\"),f.viewNode.appendChild(b)}m++}}return h.forEach(C=>{g=g.thenAsync(()=>{let b=C.cell;E(b.anchorSlot.columnIndex);let y=C.cellNodePosition,N=lo(y.steps[0],f);return N.offsetInNode=y.offsetInNode,N.after=y.after,N.fragmentIndex=y.steps[0].fragmentIndex+1,i.setCurrent(N,!1).thenAsync(()=>{let S=C.breakChunkPosition;for(let w=0;w<b.colSpan;w++)p.push(m+w);return m+=b.colSpan,this.layoutCell(b,N,S).thenAsync(()=>(N.viewNode.rowSpan=b.rowIndex+b.rowSpan-this.currentRowIndex+o-u,v(!0)))})})}),g.thenAsync(()=>(E(n.getColumnCount()),u++,v(!0)))})})}),c.then(()=>{i.setCurrent(a,!0,e.atUnforcedBreak).then(()=>{l.finish(!0)})}),l.result()}startTableRow(e){if(this.inHeader||this.inFooter)return v(!0);let n=e.nodeContext,s=this.formattingContext;return this.currentRowIndex<0?(n.sourceNode,this.currentRowIndex=s.findRowIndexBySourceNode(n.sourceNode)):this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0,this.layoutRowSpanningCellsFromPreviousFragment(e).thenAsync(()=>(this.registerCellFragmentIndex(),this.column.checkOverflowAndSaveEdgeAndBreakPosition(e.lastAfterNodeContext,null,!0,e.breakAtTheEdge)&&s.getRowSpanningCellsOverflowingTheRow(this.currentRowIndex-1).length===0&&(this.resetColumn(),n.overflow=!0,e.break=!0),v(!0)))}registerCellFragmentIndex(){this.formattingContext.getRowByIndex(this.currentRowIndex).cells.forEach(n=>{let s=this.formattingContext.cellBreakPositions[n.columnIndex];if(s&&s.cell.anchorSlot.columnIndex==n.anchorSlot.columnIndex){let o=s.cellNodePosition.steps[0],i=this.column.layoutContext.xmldoc.getElementOffset(o.node);mf(i,o.fragmentIndex+1,1)}})}startTableCell(e){if(this.inHeader||this.inFooter)return v(!0);let n=e.nodeContext;this.inRow||(this.currentRowIndex<0?this.currentRowIndex=0:this.currentRowIndex++,this.currentColumnIndex=0,this.inRow=!0);let s=this.formattingContext.getRowByIndex(this.currentRowIndex).cells[this.currentColumnIndex];if(!s)return e.break=!0,v(!0);let o=n.copy().modify();o.after=!0,e.nodeContext=o;let i=k(\"startTableCell\"),a;if(this.hasBrokenCellAtSlot(s.anchorSlot.columnIndex)){let l=this.formattingContext.cellBreakPositions.shift();n.fragmentIndex=l.cellNodePosition.steps[0].fragmentIndex+1,a=v(l.breakChunkPosition)}else a=this.column.nextInTree(n,e.atUnforcedBreak).thenAsync(l=>{l.viewNode&&n.viewNode.removeChild(l.viewNode);let c=gs(l,0);return v(new pt(c))});return a.then(l=>{this.layoutCell(s,n,l).then(()=>{this.afterNonInlineElementNode(e),this.currentColumnIndex++,i.finish(!0)})}),i.result()}startNonInlineBox(e){let n=xf(e,Lt(this.formattingContext),this.column);if(n)return n;let s=e.nodeContext,o=this.formattingContext.getRepetitiveElements(),i=s.display;return i===\"table-header-group\"&&o&&o.isHeaderSourceNode(s.sourceNode)?(this.inHeader=!0,v(!0)):i===\"table-footer-group\"&&o&&o.isFooterSourceNode(s.sourceNode)?(this.inFooter=!0,v(!0)):i===\"table-row\"?this.startTableRow(e):i===\"table-cell\"?this.startTableCell(e):v(!0)}endNonInlineBox(e){let n=e.nodeContext;if(n.display===\"table-row\"&&(this.inRow=!1,!this.inHeader&&!this.inFooter)){let o=n.copy().modify();o.after=!1;let i=new sd(this.currentRowIndex,o,this.formattingContext);this.column.breakPositions.push(i)}return v(!0)}afterNonInlineElementNode(e){let n=e.nodeContext,s=this.formattingContext.getRepetitiveElements(),o=n.display;if(o===\"table-header-group\"?s&&!s.allowInsertRepeatitiveElements&&s.isHeaderSourceNode(n.sourceNode)?(this.inHeader=!1,n.viewNode.parentNode.removeChild(n.viewNode)):T(n.viewNode,\"display\",\"table-row-group\"):o===\"table-footer-group\"&&(s&&!s.allowInsertRepeatitiveElements&&s.isFooterSourceNode(n.sourceNode)?(this.inFooter=!1,n.viewNode.parentNode.removeChild(n.viewNode)):T(n.viewNode,\"display\",\"table-row-group\")),o&&Ea.ignoreList[o])n.viewNode.parentNode.removeChild(n.viewNode);else if(n.sourceNode===this.formattingContext.tableSourceNode)n.overflow=this.column.checkOverflowAndSaveEdge(n,null),this.resetColumn(),e.break=!0;else return super.afterNonInlineElementNode(e);return v(!0)}};d(Ea,\"ignoreList\",{\"table-caption\":!0,\"table-column-group\":!0,\"table-column\":!0});var rd=Ea,bi=[];function yC(r){let t=bi.findIndex(n=>n.root===r),e=bi[t];return e?e.tableLayoutOption:null}function xC(r){let t=bi.findIndex(e=>e.root===r);t>=0&&bi.splice(t,1)}var xa=class{layoutEntireTable(t,e){let n=Lt(t.formattingContext),s=new id(n,e);return new Cs(s,e.layoutContext).iterate(t)}getColumnWidths(t,e,n,s){let o=t.ownerDocument,i=o.createElement(\"tr\"),a=[];for(let c=0;c<e;c++){let u=o.createElement(\"td\");i.appendChild(u),a.push(u)}t.parentNode.insertBefore(i,t.nextSibling);let l=a.map(c=>{let u=s.getElementClientRect(c),p=n?u.height:u.width;return Math.ceil(p)});return t.parentNode.removeChild(i),l}getColGroupElements(t){let e=[],n=t.firstElementChild;for(;n;)n.localName===\"colgroup\"&&e.push(n),n=n.nextElementSibling;return e}normalizeAndGetColElements(t){let e=[];return t.forEach(n=>{let s=n.span;n.removeAttribute(\"span\");let o=n.firstElementChild;for(;o;){if(o.localName===\"col\"){let i=o.span;for(o.removeAttribute(\"span\"),s-=i;i-- >1;){let a=o.cloneNode(!0);n.insertBefore(a,o),e.push(a)}e.push(o)}o=o.nextElementSibling}for(;s-- >0;)o=n.ownerDocument.createElement(\"col\"),n.appendChild(o),e.push(o)}),e}addMissingColElements(t,e,n,s){if(t.length<n){let o=s.ownerDocument.createElement(\"colgroup\");e.push(o);for(let i=t.length;i<n;i++){let a=s.ownerDocument.createElement(\"col\");o.appendChild(a),t.push(a)}}}normalizeColGroups(t,e,n){let s=t.vertical,o=t.lastRowViewNode;if(!o)return;t.lastRowViewNode=null;let a=o.ownerDocument.createDocumentFragment(),l=t.getColumnCount();if(!(l>0)){t.colGroups=a;return}let c=t.colWidths=this.getColumnWidths(o,l,s,n.clientLayout),u=this.getColGroupElements(e),p=this.normalizeAndGetColElements(u);this.addMissingColElements(p,u,l,e),p.forEach((h,f)=>{T(h,s?\"height\":\"width\",`${c[f]}px`)}),u.forEach(h=>{a.appendChild(h.cloneNode(!0))}),t.colGroups=a}doInitialLayout(t,e){let n=Lt(t.formattingContext);n.vertical=t.vertical,n.initializeRepetitiveElements(t.vertical),t.sourceNode;let s=yC(t.sourceNode);xC(t.sourceNode);let o=k(\"TableLayoutProcessor.doInitialLayout\"),i=t.copy();return this.layoutEntireTable(t,e).then(a=>{let l=a.viewNode,c=e.clientLayout.getElementClientRect(l),u=e.vertical?c.left:c.bottom;if(u+=(e.vertical?-1:1)*_n(t,e.collectElementsOffset()).current,!e.isOverflown(u)&&(!s||!s.calculateBreakPositionsInside)){e.breakPositions.push(new cd(i)),o.finish(a);return}this.normalizeColGroups(n,l,e),n.updateCellSizes(e.clientLayout),o.finish(null)}),o.result()}addCaptions(t,e,n){let s=t.captions;s.forEach((o,i)=>{o&&(e.insertBefore(o.viewNode,n),o.side===\"top\"&&(s[i]=null))})}addColGroups(t,e,n){t.colGroups&&this.getColGroupElements(e).length===0&&e.insertBefore(t.colGroups.cloneNode(!0),n)}removeColGroups(t,e){if(t.colGroups&&e){let n=this.getColGroupElements(e);n&&n.forEach(s=>{e.removeChild(s)})}}doLayout(t,e){let n=Lt(t.formattingContext),s=n.getRootViewNode(t),o=s.firstChild;this.addCaptions(n,s,o),this.addColGroups(n,s,o);let i=new rd(n,e),a=new Cs(i,e.layoutContext),l=k(\"TableFormattingContext.doLayout\");return a.iterate(t).thenFinish(l),l.result()}layout(t,e,n){let s=Lt(t.formattingContext);return s.getRootViewNode(t)?(n&&Zu(t.parent,e),new ad(s,this).layout(t,e)):e.buildDeepElementView(t)}createEdgeBreakPosition(t,e,n,s){return new nd(t,e,n,s)}startNonInlineElementNode(t){return!1}afterNonInlineElementNode(t,e){return!1}finishBreak(t,e,n,s){let o=Lt(e.formattingContext);if(e.display===\"table-row\"){e.sourceNode;let i=o.findRowIndexBySourceNode(e.sourceNode);o.cellBreakPositions=[];let a;if(e.after?a=o.getRowSpanningCellsOverflowingTheRow(i):a=o.getCellsFallingOnRow(i),a.length){let l=k(\"TableLayoutProcessor.finishBreak\"),c=0;return l.loopWithFrame(u=>{if(c===a.length){u.breakLoop();return}let p=a[c++],h=o.getCellFragmentOfCell(p),f=h.findAcceptableBreakPosition().nodeContext;let g=h.cellNodeContext,m=g.toNodePosition(),E=new pt(f.toNodePosition());o.cellBreakPositions.push({cellNodePosition:m,breakChunkPosition:E,cell:p});let C=g.viewNode;h.column.layoutContext.processFragmentedBlockEdge(h.cellNodeContext),i<p.rowIndex+p.rowSpan-1&&(C.rowSpan=i-p.rowIndex+1),h.empty?u.continueLoop():h.pseudoColumn.finishBreak(f,!1,!0).then(()=>{EC(h,o,f),u.continueLoop()})}).then(()=>{t.clearOverflownViewNodes(e,!1),t.layoutContext.processFragmentedBlockEdge(e),o.finishFragment(),l.finish(!0)}),l.result()}}return o.finishFragment(),ii.finishBreak(t,e,n,s)}clearOverflownViewNodes(t,e,n,s){en.prototype.clearOverflownViewNodes(t,e,n,s)}};function EC(r,t,e){let n=t.getRepetitiveElements();if(!n)return;let s=t.vertical,o=r.column,i=r.pseudoColumn.getColumnElement(),a=r.cellNodeContext.viewNode,l=o.clientLayout.getElementClientRect(a),c=o.getComputedPaddingBorder(a);if(s){let u=l.right-o.footnoteEdge-n.calculateOffset(e)-c.right;T(i,\"max-width\",`${u}px`)}else{let u=o.footnoteEdge-n.calculateOffset(e)-l.top-c.top;T(i,\"max-height\",`${u}px`)}T(i,\"overflow\",\"hidden\")}var ad=class extends Hn{constructor(e,n){super();this.tableFormattingContext=e;this.processor=n}resolveLayoutMode(e){let n=this.tableFormattingContext.getRepetitiveElements();return!n||!n.doneInitialLayout?new ld(this.tableFormattingContext,this.processor):(e.sourceNode===this.tableFormattingContext.tableSourceNode&&!e.after&&n&&n.preventSkippingHeader(),new dd(this.tableFormattingContext,this.processor))}clearNodes(e){super.clearNodes(e);let n=this.tableFormattingContext.getRootViewNode(e);this.processor.removeColGroups(this.tableFormattingContext,n)}restoreState(e,n){super.restoreState(e,n),this.tableFormattingContext.finishFragment()}},ld=class extends mi{constructor(e,n){super(e);this.processor=n}doLayout(e,n){return this.processor.doInitialLayout(e,n)}},cd=class extends Jt{constructor(t){super(t,null,t.overflow,0)}getMinBreakPenalty(){if(!this.isEdgeUpdated)throw new Error(\"EdgeBreakPosition.prototype.updateEdge not called\");return(this.overflows?3:0)+(this.position.parent?this.position.parent.breakPenalty:0)}breakPositionChosen(t){t.fragmentLayoutConstraints.push(new ud(this.position.sourceNode))}},ud=class r{constructor(t){this.tableRootNode=t;d(this,\"flagmentLayoutConstraintType\",\"EntireTable\")}allowLayout(t,e,n){return t.overflow,!1}nextCandidate(t){return!0}postLayout(t,e,n,s){e.sourceNode,bi.push({root:e.sourceNode,tableLayoutOption:{calculateBreakPositionsInside:!0}})}finishBreak(t,e){return v(!0)}equalsTo(t){return t instanceof r&&t.tableRootNode===this.tableRootNode}getPriorityOfFinishBreak(){return 0}},dd=class extends Ci{constructor(e,n){super(e);this.processor=n}doLayout(e,n){let s=this.formattingContext.getRepetitiveElements();if(s&&!s.isAfterLastContent(e)){let o=new pd(e);n.fragmentLayoutConstraints.some(i=>o.equalsTo(i))||n.fragmentLayoutConstraints.unshift(o)}return this.processor.doLayout(e,n)}},pd=class r extends So{constructor(e){super(e);d(this,\"flagmentLayoutConstraintType\",\"TableRow\");d(this,\"cellFragmentLayoutConstraints\",[])}allowLayout(e,n,s){let o=this.getRepetitiveElements();return!o||s.pseudoParent||hn(this.nodeContext.viewNode)||!o.isEnableToUpdateState()?!0:!(n&&!e||e&&e.overflow)}nextCandidate(e){let n=Lt(this.nodeContext.formattingContext);return this.collectCellFragmentLayoutConstraints(e,n).some(o=>o.constraints.some(i=>i.nextCandidate(e)))?!0:super.nextCandidate(e)}postLayout(e,n,s,o){let i=Lt(this.nodeContext.formattingContext);if(this.cellFragmentLayoutConstraints=this.collectCellFragmentLayoutConstraints(n,i),this.cellFragmentLayoutConstraints.forEach(a=>{a.constraints.forEach(l=>{l.postLayout(e,a.breakPosition,s,o)})}),!e){let a=i.getRootViewNode(this.nodeContext);new xa().removeColGroups(i,a),this.removeDummyRowNodes(s)}super.postLayout(e,n,s,o)}finishBreak(e,n){let s=Lt(this.nodeContext.formattingContext),o=k(\"finishBreak\"),i=this.cellFragmentLayoutConstraints.reduce((l,c)=>l.concat(c.constraints.map(u=>({constraint:u,breakPosition:c.breakPosition}))),[]),a=0;return o.loop(()=>{if(a<i.length){let l=i[a++];return l.constraint.finishBreak(l.breakPosition,n).thenReturn(!0)}else return v(!1)}).then(()=>{o.finish(!0)}),o.result().thenAsync(()=>super.finishBreak(e,n))}removeDummyRowNodes(e){if(!(!e||e.display!==\"table-row\"||!e.viewNode))for(;e.viewNode.previousElementSibling;){let n=e.viewNode.previousElementSibling;n.parentNode&&n.parentNode.removeChild(n)}}collectCellFragmentLayoutConstraints(e,n){return this.getCellFragemnts(e,n).map(s=>({constraints:s.fragment.pseudoColumn.getColumn().fragmentLayoutConstraints,breakPosition:s.breakPosition}))}getCellFragemnts(e,n){let s=Number.MAX_VALUE;e&&e.display===\"table-row\"&&(e.sourceNode,s=n.findRowIndexBySourceNode(e.sourceNode)+1),s=Math.min(n.cellFragments.length,s);let o=[];for(let i=0;i<s;i++)n.cellFragments[i]&&n.cellFragments[i].forEach(a=>{a&&o.push({fragment:a,breakPosition:a.findAcceptableBreakPosition().nodeContext})});return o}getElementsOffsetsForTableCell(e){let n=Lt(this.nodeContext.formattingContext),s=n.findCellFromColumn(e);return s?n.collectElementsOffsetOfUpperCells(s):n.collectElementsOffsetOfHighestColumn()}equalsTo(e){return e instanceof r?Lt(this.nodeContext.formattingContext)===Lt(e.nodeContext.formattingContext):!1}},SC=new xa;function NC(r,t,e,n,s,o){if(!t)return null;if(e===x.table){let i=r.parent;return new Xn(i?i.formattingContext:null,r.sourceNode)}return null}function vC(r){return r instanceof Xn?SC:null}_e(\"RESOLVE_FORMATTING_CONTEXT\",NC);_e(\"RESOLVE_LAYOUT_PROCESSOR\",vC);function Ef(r){return r.reduce((t,e)=>t+e,0)/r.length}function Sf(r){let t=Ef(r);return Ef(r.map(e=>{let n=e-t;return n*n}))}var hd=class{constructor(t,e){this.layoutResult=t;this.penalty=e}};function yi(r){return r.vertical?r.width:r.height}function xi(r,t){r.vertical?r.width=t:r.height=t}var Sa=class{constructor(t,e,n){this.layoutContainer=t;this.columnGenerator=e;this.regionPageFloatLayoutContext=n;d(this,\"originalContainerBlockSize\");this.originalContainerBlockSize=yi(t)}balanceColumns(t){let e=k(\"ColumnBalancer#balanceColumns\");this.preBalance(t),this.savePageFloatLayoutContexts(t),this.layoutContainer.clear();let n=[this.createTrialResult(t)];return e.loopWithFrame(s=>{if(!this.hasNextCandidate(n)){s.breakLoop();return}this.updateCondition(n),this.columnGenerator().then(o=>{if(this.savePageFloatLayoutContexts(o),this.layoutContainer.clear(),!o){s.breakLoop();return}n.push(this.createTrialResult(o)),s.continueLoop()})}).then(()=>{let s=n.reduce((o,i)=>i.penalty<o.penalty?i:o,n[0]);this.restoreContents(s.layoutResult),this.postBalance(),e.finish(s.layoutResult)}),e.result()}createTrialResult(t){let e=this.calculatePenalty(t);return new hd(t,e)}preBalance(t){}postBalance(){xi(this.layoutContainer,this.originalContainerBlockSize)}savePageFloatLayoutContexts(t){let e=this.regionPageFloatLayoutContext.detachChildren();t&&(t.columnPageFloatLayoutContexts=e)}restoreContents(t){let e=this.layoutContainer.element;t.columns.forEach(n=>{e.appendChild(n.element)}),t.columnPageFloatLayoutContexts,this.regionPageFloatLayoutContext.attachChildren(t.columnPageFloatLayoutContexts)}},fd=1;function vf(r){let t=r[r.length-1];if(t.penalty===0)return!1;let e=r[r.length-2];if(e&&t.penalty>=e.penalty)return!1;let n=t.layoutResult.columns,s=Math.max.apply(null,n.map(i=>i.computedBlockSize)),o=Math.max.apply(null,n.map(i=>i.getMaxBlockSizeOfPageFloats()));return s>o+fd}function Tf(r,t){let e=r[r.length-1].layoutResult.columns,s=Math.max.apply(null,e.map(o=>isNaN(o.blockDistanceToBlockEndFloats)?o.computedBlockSize:o.computedBlockSize-o.blockDistanceToBlockEndFloats+fd))-fd;s<yi(t)?xi(t,s):xi(t,yi(t)-1)}var gd=class extends Sa{constructor(e,n,s,o){super(s,e,n);this.columnCount=o;d(this,\"originalPosition\",null);d(this,\"foundUpperBound\",!1)}preBalance(e){let s=e.columns.reduce((o,i)=>o+i.computedBlockSize,0);xi(this.layoutContainer,s/this.columnCount),this.originalPosition=e.position}checkPosition(e){return this.originalPosition?this.originalPosition.isSamePosition(e):e===null}calculatePenalty(e){if(!this.checkPosition(e.position))return 1/0;let n=e.columns;return Nf(n)?1/0:Math.max.apply(null,n.map(s=>s.computedBlockSize))}hasNextCandidate(e){if(e.length===1)return!0;if(this.foundUpperBound)return vf(e);{let n=e[e.length-1];return this.checkPosition(n.layoutResult.position)&&!Nf(n.layoutResult.columns)?(this.foundUpperBound=!0,!0):yi(this.layoutContainer)<this.originalContainerBlockSize}}updateCondition(e){if(this.foundUpperBound)Tf(e,this.layoutContainer);else{let n=Math.min(this.originalContainerBlockSize,yi(this.layoutContainer)+this.originalContainerBlockSize*.1);xi(this.layoutContainer,n)}}};function Nf(r){if(r.length<=1)return!1;let t=r[r.length-1].computedBlockSize;return r.slice(0,r.length-1).every(n=>t>n.computedBlockSize)}var md=class extends Sa{constructor(t,e,n){super(n,t,e)}calculatePenalty(t){if(t.columns.every(n=>n.computedBlockSize===0))return 1/0;let e=t.columns.filter(n=>!n.pageBreakType).map(n=>n.computedBlockSize);return Sf(e)}hasNextCandidate(t){return vf(t)}updateCondition(t){Tf(t,this.layoutContainer)}};function wf(r,t,e,n,s,o,i){if(t===x.auto)return null;{let a=i.positions.length===0,l=o[o.length-1],c=!!(l&&l.pageBreakType);return a||c?new gd(e,n,s,r):t===x.balance_all?new md(e,n,s):(x.balance,null)}}var Ei=class{constructor(t,e,n){d(this,\"endStuckFixed\");d(this,\"endFixed\");d(this,\"endSlipped\");this.endStuckFixed=t,this.endFixed=e,this.endSlipped=n}},Cd=class{constructor(){d(this,\"map\",[])}getMaxFixed(){return this.map.length==0?0:this.map[this.map.length-1].endFixed}getMaxSlipped(){return this.map.length==0?0:this.map[this.map.length-1].endSlipped}addStuckRange(t){if(this.map.length==0)this.map.push(new Ei(t,t,t));else{let e=this.map[this.map.length-1],n=e.endSlipped+t-e.endFixed;e.endFixed==e.endStuckFixed?(e.endFixed=t,e.endStuckFixed=t,e.endSlipped=n):this.map.push(new Ei(t,t,n))}}addSlippedRange(t){this.map.length==0?this.map.push(new Ei(t,0,0)):this.map[this.map.length-1].endFixed=t}slippedByFixed(t){let e=gt(this.map.length,s=>t<=this.map[s].endFixed),n=this.map[e];return n.endSlipped-Math.max(0,n.endStuckFixed-t)}fixedBySlipped(t){let e=gt(this.map.length,s=>t<=this.map[s].endSlipped),n=this.map[e];return n.endStuckFixed-(n.endSlipped-t)}},bd=class r{constructor(t,e,n,s,o,i,a,l){this.context=t;this.style=e;this.offset=n;this.isRoot=s;this.flowChunk=o;this.atBlockStart=i;this.atFlowStart=a;this.isParentBoxDisplayed=l;d(this,\"flowName\");d(this,\"isBlockValue\",null);d(this,\"hasBoxValue\",null);d(this,\"styleValues\",{});d(this,\"beforeBox\",null);d(this,\"afterBox\",null);d(this,\"breakBefore\",null);if(this.flowName=o.flowName,this.hasBox()){let c=e._pseudos;if(c&&c.before){let u=new r(t,c.before,n,!1,o,this.isBlock(),a,!0),p=u.styleValue(\"content\");St(p)&&(this.beforeBox=u,this.breakBefore=u.breakBefore)}}this.breakBefore=Ve(this.getBreakValue(\"before\"),this.breakBefore),this.atFlowStart&&De(this.breakBefore)&&(o.breakBefore=Ve(o.breakBefore,this.breakBefore))}buildAfterPseudoElementBox(t,e,n){if(this.hasBox()){let s=this.style._pseudos;if(s&&s.after){let o=new r(this.context,s.after,t,!1,this.flowChunk,e,n,!0),i=o.styleValue(\"content\");St(i)&&(this.afterBox=o)}}}styleValue(t,e){if(!(t in this.styleValues)){let n=this.style[t];this.styleValues[t]=n?n.evaluate(this.context,t):e||null}return this.styleValues[t]}displayValue(){return this.styleValue(\"display\",x.inline)}isBlock(){if(this.isBlockValue===null){let t=this.displayValue(),e=this.styleValue(\"position\"),n=this.styleValue(\"float\");this.isBlockValue=jr(t,e,n,this.isRoot)}return this.isBlockValue}hasBox(){return this.hasBoxValue===null&&(this.hasBoxValue=this.isParentBoxDisplayed&&this.displayValue()!==x.none&&!si(this.styleValue(\"position\"))),this.hasBoxValue}getBreakValue(t){let e=null;if(this.isBlock()){let n=this.styleValue(`break-${t}`);n&&(e=n.toString())}return e}},yd=class{constructor(t){this.context=t;d(this,\"stack\",[]);d(this,\"atBlockStart\",!0);d(this,\"atFlowStart\",!0);d(this,\"atStartStack\",[])}empty(){return this.stack.length===0}lastBox(){return this.stack[this.stack.length-1]}lastFlowName(){let t=this.lastBox();return t?t.flowChunk.flowName:null}isCurrentBoxDisplayed(){return this.stack.every(t=>t.displayValue()!==x.none)}push(t,e,n,s){let o=this.lastBox();s&&o&&s.flowName!==o.flowName&&this.atStartStack.push({atBlockStart:this.atBlockStart,atFlowStart:this.atFlowStart});let i=s||o.flowChunk,a=this.atFlowStart||!!s,l=this.isCurrentBoxDisplayed(),c=new bd(this.context,t,e,n,i,a||this.atBlockStart,a,l);return this.stack.push(c),this.atBlockStart=c.hasBox()?!c.beforeBox&&c.isBlock():this.atBlockStart,this.atFlowStart=c.hasBox()?!c.beforeBox&&a:this.atFlowStart,c}encounteredTextNode(t){let e=this.lastBox();if((t.nodeType===Node.TEXT_NODE||t.nodeType===Node.CDATA_SECTION_NODE)&&(this.atBlockStart||this.atFlowStart)&&e.hasBox()){let n=e.styleValue(\"white-space\",x.normal).toString(),s=Gr(n);s&&!he(t,s)&&(this.atBlockStart=!1,this.atFlowStart=!1)}}pop(t){let e=this.stack.pop();if(e.buildAfterPseudoElementBox(t,this.atBlockStart,this.atFlowStart),this.atFlowStart&&e.afterBox){let s=e.afterBox.getBreakValue(\"before\");e.flowChunk.breakBefore=Ve(e.flowChunk.breakBefore,s)}let n=this.lastBox();if(n)if(n.flowName===e.flowName)e.hasBox()&&(this.atBlockStart=this.atFlowStart=!1);else{let s=this.atStartStack.pop();this.atBlockStart=s.atBlockStart,this.atFlowStart=s.atFlowStart}return e}nearestBlockStartOffset(t){if(!t.atBlockStart)return t.offset;let e=this.stack.length-1,n=this.stack[e];for(n===t&&(e--,n=this.stack[e]);e>=0;){if(n.flowName!==t.flowName)return t.offset;if(!n.atBlockStart||n.isRoot)return n.offset;t=n,n=this.stack[--e]}throw new Error(\"No block start offset found!\")}},Si=class{constructor(t,e,n,s,o,i,a,l){this.xmldoc=t;this.scope=n;this.context=s;this.primaryFlows=o;this.validatorSet=i;this.counterListener=a;d(this,\"root\");d(this,\"cascadeHolder\");d(this,\"last\");d(this,\"rootStyle\",{});d(this,\"styleMap\",{});d(this,\"flows\",{});d(this,\"flowChunks\",[]);d(this,\"flowListener\",null);d(this,\"flowToReach\",null);d(this,\"idToReach\",null);d(this,\"cascade\");d(this,\"offsetMap\");d(this,\"primary\",!0);d(this,\"primaryStack\",[]);d(this,\"rootBackgroundAssigned\",!1);d(this,\"rootLayoutAssigned\",!1);d(this,\"lastOffset\");d(this,\"breakBeforeValues\",{});d(this,\"boxStack\");d(this,\"bodyReached\",!0);this.root=t.root,this.cascadeHolder=e,this.last=this.root,this.cascade=e.createInstance(s,a,l,t.lang),this.offsetMap=new Cd;let c=t.getElementOffset(this.root);this.lastOffset=c,this.boxStack=new yd(s),this.offsetMap.addStuckRange(c);let u=this.getAttrStyle(this.root);switch(this.cascade.pushElement(this,this.root,u,c),this.postprocessTopStyle(u,!1),this.root.namespaceURI){case\"http://www.w3.org/1999/xhtml\":this.bodyReached=!1;break}this.primaryStack.push(!0),this.styleMap={},this.styleMap[`e${c}`]=u,this.lastOffset++,this.replayFlowElementsFromOffset(-1)}hasProp(t,e,n){let s=t[n];return s&&s.evaluate(this.context)!==e[n]}transferPropsToRoot(t,e){for(let n in e){let s=t[n];if(s)this.rootStyle[n]=s,delete t[n];else{let o=e[n];o&&(this.rootStyle[n]=new M(o,mc))}}}postprocessTopStyle(t,e){var n;if(e)for(let s of[\"writing-mode\",\"direction\"])t[s]&&!(e&&this.rootStyle[s])&&(this.rootStyle[s]=t[s]);else for(let s in t)Wn(s)&&(this.rootStyle[s]=t[s]);if(!this.rootBackgroundAssigned){let s=this.hasProp(t,this.validatorSet.backgroundProps,\"background-color\")?t[\"background-color\"].evaluate(this.context):null,o=this.hasProp(t,this.validatorSet.backgroundProps,\"background-image\")?t[\"background-image\"].evaluate(this.context):null;(s&&!U(s)||o&&!U(o))&&(this.transferPropsToRoot(t,this.validatorSet.backgroundProps),this.rootBackgroundAssigned=!0)}if(!this.rootLayoutAssigned){for(let s=0;s<Pf.length;s++)if(this.hasProp(t,this.validatorSet.layoutProps,Pf[s])){this.transferPropsToRoot(t,this.validatorSet.layoutProps),this.rootLayoutAssigned=!0;break}}if(!e){let s=t[\"font-size\"],o=!0;if(s&&!U(s.value)){let l=s.evaluate(this.context);if(l instanceof P){let c=l.num;switch(l.unit){case\"em\":case\"rem\":c*=this.context.initialFontSize;break;case\"ex\":c*=this.context.initialFontSize*$.ex/$.em;break;case\"%\":c*=this.context.initialFontSize/100;break;case\"lh\":case\"rlh\":c*=this.context.initialFontSize*$.lh/$.em;break;default:{let u=$[l.unit];u&&(c*=u),o=!1}}this.context.rootFontSize=c,this.context.isRelativeRootFontSize=o}}let i=(n=this.context.rootFontSize)!=null?n:this.context.initialFontSize,a=t[\"line-height\"];if(a&&!U(a.value)){let l=a.evaluate(this.context);if(l instanceof et)this.context.rootLineHeight=l.num*i;else if(l instanceof P){let c=l.num;switch(l.unit){case\"em\":case\"rem\":c*=i;break;case\"ex\":c*=i*$.ex/$.em;break;case\"%\":c*=i/100;break;case\"lh\":case\"rlh\":c*=this.context.initialFontSize*$.lh/$.em;break;default:{let u=$[l.unit];u&&(c*=u)}}this.context.rootLineHeight=c}}else this.context.rootLineHeight=this.context.fontSize()*$.lh/$.em}}getTopContainerStyle(){let t=0;for(;!this.bodyReached&&(t+=5e3,this.styleUntil(t,0)!=Number.POSITIVE_INFINITY););return this.rootStyle}getAttrStyle(t){if(t.style instanceof CSSStyleDeclaration){let e=t.getAttribute(\"style\");if(e)return Jh(this.scope,this.validatorSet,this.xmldoc.url,e)}return{}}getReachedOffset(){return this.lastOffset}replayFlowElementsFromOffset(t){if(t>=this.lastOffset)return;let e=this.context,n=this.xmldoc.getElementOffset(this.root);if(t<n){let i=this.getStyle(this.root,!1);let a=de(i,\"flow-into\"),l=a?a.evaluate(e,\"flow-into\").toString():\"body\",c=this.encounteredFlowElement(l,i,this.root,n);this.boxStack.empty()&&this.boxStack.push(i,n,!0,c)}let s=this.xmldoc.getNodeByOffset(t),o=this.xmldoc.getNodeOffset(s,0,!1);if(!(o>=this.lastOffset))for(;;){if(s.nodeType!=1)o+=s.textContent.length;else{let a=s,l=this.getStyle(a,!1),c=l[\"flow-into\"];if(c){let u=c.evaluate(e,\"flow-into\").toString();this.encounteredFlowElement(u,l,a,o)}o++}if(o>=this.lastOffset)break;let i=s.firstChild;if(i==null){for(;i=s.nextSibling,!i;)if(s=s.parentNode,s===this.root)return}s=i}}resetFlowChunkStream(t){this.flowListener=t;for(let e=0;e<this.flowChunks.length;e++)this.flowListener.encounteredFlowChunk(this.flowChunks[e],this.flows[this.flowChunks[e].flowName])}styleUntilFlowIsReached(t){this.flowToReach=t;let e=0;for(;!(this.flowToReach==null||(e+=5e3,this.styleUntil(e,0)==Number.POSITIVE_INFINITY)););}styleUntilIdIsReached(t){if(!t)return;this.idToReach=t;let e=0;for(;!(!this.idToReach||(e+=5e3,this.styleUntil(e,0)===Number.POSITIVE_INFINITY)););this.idToReach=null}encounteredFlowElement(t,e,n,s){let o=0,i=Number.POSITIVE_INFINITY,a=!1,l=!1,c=!1,u=e[\"flow-options\"];if(u){let E=Yp(u.evaluate(this.context,\"flow-options\"));a=!!E.exclusive,l=!!E.static,c=!!E.last}let p=e[\"flow-linger\"];p&&(i=zl(p.evaluate(this.context,\"flow-linger\"),Number.POSITIVE_INFINITY));let h=e[\"flow-priority\"];h&&(o=zl(h.evaluate(this.context,\"flow-priority\"),0));let f=this.breakBeforeValues[s]||null,g=this.flows[t];if(!g){let E=this.boxStack.lastFlowName();g=this.flows[t]=new Dr(t,E)}let m=new Mr(t,n,s,o,i,a,l,c,f);return this.flowChunks.push(m),this.flowToReach==t&&(this.flowToReach=null),this.flowListener&&this.flowListener.encounteredFlowChunk(m,g),m}registerForcedBreakOffset(t,e,n){if(De(t)){let o=this.flows[n].forcedBreakOffsets;(o.length===0||o[o.length-1]<e)&&o.push(e)}let s=this.breakBeforeValues[e];this.breakBeforeValues[e]=Ve(s,t)}styleUntil(t,e){let n=-1,s;if(t<=this.lastOffset&&(s=this.offsetMap.slippedByFixed(t),n=s+e,n<this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(n);if(this.last==null)return Number.POSITIVE_INFINITY;let o=this.context;for(;;){let i=this.last.firstChild;if(i==null)for(;;){if(this.last.nodeType==1){this.cascade.popElement(this.last),this.primary=this.primaryStack.pop();let a=this.boxStack.pop(this.lastOffset),l=null;if(a.afterBox){let c=a.afterBox.getBreakValue(\"before\");this.registerForcedBreakOffset(c,a.afterBox.atBlockStart?this.boxStack.nearestBlockStartOffset(a):a.afterBox.offset,a.flowName),l=a.afterBox.getBreakValue(\"after\")}l=Ve(l,a.getBreakValue(\"after\")),this.registerForcedBreakOffset(l,this.lastOffset,a.flowName)}if(i=this.last.nextSibling,i)break;if(this.last=this.last.parentNode,this.last===this.root)return this.last=null,t<this.lastOffset&&(n<0&&(s=this.offsetMap.slippedByFixed(t),n=s+e),n<=this.offsetMap.getMaxSlipped())?this.offsetMap.fixedBySlipped(n):Number.POSITIVE_INFINITY}if(this.last=i,this.last.nodeType!=1)this.lastOffset+=this.last.textContent.length,this.boxStack.encounteredTextNode(this.last),this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset);else{let a=this.last,l=this.getAttrStyle(a);this.primaryStack.push(this.primary),this.cascade.pushElement(this,a,l,this.lastOffset);let c=a.getAttribute(\"id\")||a.getAttributeNS(\"http://www.w3.org/XML/1998/namespace\",\"id\");c&&c===this.idToReach&&(this.idToReach=null),!this.bodyReached&&a.localName==\"body\"&&a.parentNode==this.root&&(this.postprocessTopStyle(l,!0),this.bodyReached=!0);let u,p=l[\"flow-into\"];if(p){let f=p.evaluate(o,\"flow-into\").toString(),g=this.encounteredFlowElement(f,l,a,this.lastOffset);this.primary=!!this.primaryFlows[f],u=this.boxStack.push(l,this.lastOffset,a===this.root,g)}else u=this.boxStack.push(l,this.lastOffset,a===this.root),a===this.xmldoc.body&&(u.breakBefore=Ve(u.flowChunk.breakBefore,u.breakBefore));let h=this.boxStack.nearestBlockStartOffset(u);if(h===0){let f=l.page,g=f&&!U(f.value)&&f.value.toString();g&&g.toLowerCase()!==\"auto\"&&(this.cascade.firstPageType=g)}if(this.registerForcedBreakOffset(u.breakBefore,h,u.flowName),u.beforeBox){let f=u.beforeBox.getBreakValue(\"after\");this.registerForcedBreakOffset(f,u.beforeBox.atBlockStart?h:u.offset,u.flowName)}if(this.primary&&u.displayValue()===x.none&&(this.primary=!1),this.styleMap[`e${this.lastOffset}`]=l,this.lastOffset++,this.primary?this.offsetMap.addStuckRange(this.lastOffset):this.offsetMap.addSlippedRange(this.lastOffset),this.bodyReached&&h===0)continue;if(t<this.lastOffset&&(n<0&&(s=this.offsetMap.slippedByFixed(t),n=s+e),n<=this.offsetMap.getMaxSlipped()))return this.offsetMap.fixedBySlipped(n)}}}getStyle(t,e){let n=this.xmldoc.getElementOffset(t),s=`e${n}`;return e&&(n=this.xmldoc.getNodeOffset(t,0,!0)),this.lastOffset<=n&&this.styleUntil(n,0),this.styleMap[s]}processContent(t,e,n){}},Pf=[\"column-count\",\"column-width\",\"column-fill\"];var jn=class{constructor(t){this.validator=t;d(this,\"success\",null);d(this,\"failure\",null);d(this,\"code\",0)}isSpecial(){return this.code!=0}markAsStartGroup(){this.code=-1}isStartGroup(){return this.code==-1}markAsEndGroup(){this.code=-2}isEndGroup(){return this.code==-2}markAsStartAlternate(t){this.code=2*t+1}isStartAlternate(){return this.code>0&&this.code%2!=0}markAsEndAlternate(t){this.code=2*t+2}isEndAlternate(){return this.code>0&&this.code%2==0}getAlternate(){return Math.floor((this.code-1)/2)}},xn=class{constructor(t,e){this.where=t;this.success=e;d(this,\"what\",-1)}};var As=class r{constructor(){d(this,\"nodes\",[]);d(this,\"connections\",[]);d(this,\"match\",[]);d(this,\"nomatch\",[]);d(this,\"error\",[]);d(this,\"emptyHead\",!0)}connect(t,e){for(let n=0;n<t.length;n++)this.connections[t[n]].what=e;t.splice(0,t.length)}clone(){let t=new r;for(let e=0;e<this.nodes.length;e++){let n=this.nodes[e],s=new jn(n.validator);s.code=n.code,t.nodes.push(s)}for(let e=0;e<this.connections.length;e++){let n=this.connections[e],s=new xn(n.where,n.success);s.what=n.what,t.connections.push(s)}return t.match.push(...this.match),t.nomatch.push(...this.nomatch),t.error.push(...this.error),t}addSpecialToArr(t,e,n){let s=this.nodes.length,o=new jn(kf);n>=0?e?o.markAsStartAlternate(n):o.markAsEndAlternate(n):e?o.markAsStartGroup():o.markAsEndGroup(),this.nodes.push(o),this.connect(t,s);let i=new xn(s,!0),a=new xn(s,!1);t.push(this.connections.length),this.connections.push(a),t.push(this.connections.length),this.connections.push(i)}endSpecialGroup(){let t=[this.match,this.nomatch,this.error];for(let e=0;e<t.length;e++)this.addSpecialToArr(t[e],!1,-1)}startSpecialGroup(){if(this.nodes.length)throw new Error(\"invalid call\");this.addSpecialToArr(this.match,!0,-1)}endClause(t){this.addSpecialToArr(this.match,!1,t)}startClause(t){if(this.nodes.length)throw new Error(\"invalid call\");let e=new jn(kf);e.markAsStartAlternate(t),this.nodes.push(e);let n=new xn(0,!0),s=new xn(0,!1);this.nomatch.push(this.connections.length),this.connections.push(s),this.match.push(this.connections.length),this.connections.push(n)}addPrimitive(t){let e=this.nodes.length;this.nodes.push(new jn(t));let n=new xn(e,!0),s=new xn(e,!1);this.connect(this.match,e),this.emptyHead?(this.nomatch.push(this.connections.length),this.emptyHead=!1):this.error.push(this.connections.length),this.connections.push(s),this.match.push(this.connections.length),this.connections.push(n)}isSimple(){return this.nodes.length==1&&!this.nodes[0].isSpecial()}isPrimitive(){return this.isSimple()&&this.nodes[0].validator instanceof Ce}addGroup(t,e){if(t.nodes.length==0)return;let n=this.nodes.length;if(e==4&&n==1&&t.isPrimitive()&&this.isPrimitive()){this.nodes[0].validator=this.nodes[0].validator.combine(t.nodes[0].validator);return}for(let o=0;o<t.nodes.length;o++)this.nodes.push(t.nodes[o]);e==4?(this.emptyHead=!0,this.connect(this.nomatch,n)):this.connect(this.match,n);let s=this.connections.length;for(let o=0;o<t.connections.length;o++){let i=t.connections[o];i.where+=n,i.what>=0&&(i.what+=n),this.connections.push(i)}for(let o=0;o<t.match.length;o++)this.match.push(t.match[o]+s);if(e==3&&this.connect(this.match,n),e==2||e==3)for(let o=0;o<t.nomatch.length;o++)this.match.push(t.nomatch[o]+s);else if(this.emptyHead){for(let o=0;o<t.nomatch.length;o++)this.nomatch.push(t.nomatch[o]+s);this.emptyHead=t.emptyHead}else for(let o=0;o<t.nomatch.length;o++)this.error.push(t.nomatch[o]+s);for(let o=0;o<t.error.length;o++)this.error.push(t.error[o]+s);t.nodes=null,t.connections=null}finish(t,e){let n=this.nodes.length;this.nodes.push(t),this.nodes.push(e),this.connect(this.match,n),this.connect(this.nomatch,n+1),this.connect(this.error,n+1);for(let s of this.connections)s.success?this.nodes[s.where].success=this.nodes[s.what]:this.nodes[s.where].failure=this.nodes[s.what];for(let s=0;s<n;s++)if(this.nodes[s].failure==null||this.nodes[s].success==null)throw new Error(\"Invalid validator state\");return this.nodes[0]}},kC=1,Lf=2,Rf=4,ks=8,Na=16,xd=32,va=64,If=128,Ni=256,vi=512,Ed=1024,Vf=2048,Ff=4096,Bf=8192,Ta=class extends lt{constructor(){super()}validateForShorthand(t,e){let n=t[e].visit(this);return n?[n]:null}},Ce=class r extends Ta{constructor(e,n,s){super();this.allowed=e;this.idents=n;this.units=s}visitEmpty(e){return this.allowed&kC?e:null}visitSlash(e){return this.allowed&Vf?e:null}visitStr(e){return this.allowed&Lf?e:null}visitIdent(e){let n=this.idents[e.name.toLowerCase()];return n||(this.allowed&Rf||this.allowed&va&&CSS.supports(\"color\",e.name)?e:null)}visitNumeric(e){return e.num==0&&!(this.allowed&vi)?e.unit==\"%\"&&this.allowed&Ed?e:null:e.num<0&&!(this.allowed&Ni)?null:this.units[e.unit]?e:null}visitNum(e){return e.num==0?this.allowed&vi?e:null:e.num<=0&&!(this.allowed&Ni)?null:this.allowed&Na?e:null}visitInt(e){if(e.num==0)return this.allowed&vi?e:null;if(e.num<=0&&!(this.allowed&Ni))return null;if(this.allowed&(xd|Na))return e;let n=this.idents[`${e.num}`];return n||null}visitHexColor(e){return this.allowed&va&&/^([0-9A-F]{3,4}|([0-9A-F]{2}){3,4})$/i.test(e.hex)?e:null}visitURL(e){return this.allowed&If?e:null}visitURange(e){return this.allowed&Ff?e:null}visitSpaceList(e){return null}visitCommaList(e){return null}visitFunc(e){return this.allowed&va&&CSS.supports(\"color\",e.toString())||this.allowed&Bf&&CSS.supports(\"background-image\",e.toString())||e.name===\"calc\"&&this.allowed&(ks|Na|xd|Ni|vi|Ed)?e:null}visitExpr(e){return this.allowed&2046?e:null}combine(e){let n={},s={};for(let o in this.idents)n[o]=this.idents[o];for(let o in e.idents)n[o]=e.idents[o];for(let o in this.units)s[o]=this.units[o];for(let o in e.units)s[o]=e.units[o];return new r(this.allowed|e.allowed,n,s)}},W={},kf=new Ce(0,W,W),Ti=class extends Ta{constructor(e){super();d(this,\"successTerminal\");d(this,\"failureTerminal\");d(this,\"first\");this.successTerminal=new jn(null),this.failureTerminal=new jn(null),this.first=e.finish(this.successTerminal,this.failureTerminal)}validateList(e,n,s){let o=n?[]:e,i=this.first,a=s,l=null,c=null;for(;i!==this.successTerminal&&i!==this.failureTerminal;){if(a>=e.length){i=i.failure;continue}let u=e[a],p=u;if(i.isSpecial()){let h=!0;i.isStartGroup()?(l?l.push(c):l=[c],c=[]):i.isEndGroup()?l.length>0?c=l.pop():c=null:i.isEndAlternate()?c[i.getAlternate()]=\"taken\":h=c[i.getAlternate()]==null,i=h?i.success:i.failure}else{if(a==0&&!n&&i.validator instanceof Ls&&this instanceof Ls){if(p=new q(e).visit(i.validator),p){a=e.length,i=i.success;continue}}else if(a==0&&!n&&i.validator instanceof wi&&this instanceof Ls){if(p=new ge(e).visit(i.validator),p){a=e.length,i=i.success;continue}}else p=u.visit(i.validator);if(!p){i=i.failure;continue}if(p!==u&&e===o){o=[];for(let h=0;h<a;h++)o[h]=e[h]}e!==o&&(o[a-s]=p),a++,i=i.success}}return i===this.successTerminal&&(n?o.length>0:a==e.length)?o:null}validateSingle(e){let n=null,s=this.first;for(;s!==this.successTerminal&&s!==this.failureTerminal;){if(!e){s=s.failure;continue}if(s.isSpecial()){s=s.success;continue}if(n=e.visit(s.validator),!n){s=s.failure;continue}e=null,s=s.success}return s===this.successTerminal?n:null}visitEmpty(e){return this.validateSingle(e)}visitSlash(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitHexColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitURange(e){return this.validateSingle(e)}visitSpaceList(e){return null}visitCommaList(e){return null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return null}},Ls=class extends Ti{constructor(t){super(t)}visitSpaceList(t){let e=this.validateList(t.values,!1,0);return e===t.values?t:e?new q(e):null}visitCommaList(t){let e=this.first,n=!1;for(;e;){if(e.validator instanceof wi){n=!0;break}e=e.failure}if(n){let s=this.validateList(t.values,!1,0);return s===t.values?t:s?new ge(s):null}return null}validateForShorthand(t,e){return this.validateList(t,!0,e)}},wi=class extends Ti{constructor(t){super(t)}visitSpaceList(t){return this.validateSingle(t)}visitCommaList(t){let e=this.validateList(t.values,!1,0);return e===t.values?t:e?new ge(e):null}validateForShorthand(t,e){let n=this.first,s;for(;n!==this.failureTerminal;){if(s=n.validator.validateForShorthand(t,e),s)return s;n=n.failure}return null}},Sd=class extends Ti{constructor(e,n){super(n);this.name=e}validateSingle(e){return null}visitFunc(e){if(e.name.toLowerCase()!=this.name)return null;let n=this.validateList(e.values,!1,0);return n===e.values?e:n?new Pt(e.name,n):null}},wa=class{tryParse(t,e,n){return e}success(t,e){}},Pa=class extends wa{constructor(e,n){super();this.name=n;d(this,\"validator\");this.validator=e.validators[this.name]}tryParse(e,n,s){if(s.values[this.name])return n;let o=this.validator.validateForShorthand(e,n);if(o){let i=o.length,a=i>1?new q(o):o[0];return this.success(a,s),n+i}return n}success(e,n){n.values[this.name]=e}},Nd=class extends Pa{constructor(e,n){super(e,n[0]);this.names=n}success(e,n){for(let s=0;s<this.names.length;s++)n.values[this.names[s]]=e}},vd=class extends wa{constructor(e,n){super();this.nodes=e;this.slash=n}tryParse(e,n,s){let o=n;if(this.slash)if(e[n]==js){if(++n==e.length)return o}else return o;let i=this.nodes[0].tryParse(e,n,s);if(i==n)return o;n=i;for(let a=1;a<this.nodes.length&&n<e.length&&(i=this.nodes[a].tryParse(e,n,s),i!=n);a++)n=i;return n}},Pi=class extends lt{constructor(){super(...arguments);d(this,\"syntax\",null);d(this,\"propList\",null);d(this,\"error\",!1);d(this,\"values\",{});d(this,\"validatorSet\",null)}setOwner(e){this.validatorSet=e}syntaxNodeForProperty(e){return new Pa(this.validatorSet,e)}clone(){let e=new this.constructor;return e.syntax=this.syntax,e.propList=this.propList,e.validatorSet=this.validatorSet,e}init(e,n){this.syntax=e,this.propList=n}finish(e,n){var s,o;if(!this.error){for(let i of this.propList)n.simpleProperty(i,(o=(s=this.values[i])!=null?s:this.validatorSet.defaultValues[i])!=null?o:x.initial,e);return!0}return!1}propagateDefaultingValue(e,n,s){for(let o of this.propList)s.simpleProperty(o,e,n)}validateList(e){return this.error=!0,0}validateSingle(e){return this.validateList([e]),null}visitEmpty(e){return this.validateSingle(e)}visitStr(e){return this.validateSingle(e)}visitIdent(e){return this.validateSingle(e)}visitNumeric(e){return this.validateSingle(e)}visitNum(e){return this.validateSingle(e)}visitInt(e){return this.validateSingle(e)}visitHexColor(e){return this.validateSingle(e)}visitURL(e){return this.validateSingle(e)}visitSpaceList(e){return this.validateList(e.values),null}visitCommaList(e){return this.error=!0,null}visitFunc(e){return this.validateSingle(e)}visitExpr(e){return this.validateSingle(e)}},Yn=class extends Pi{constructor(){super()}validateList(t){let e=0,n=0;for(;e<t.length;){let s=this.syntax[n].tryParse(t,e,this);if(s>e){e=s,n=0;continue}if(++n==this.syntax.length){this.error=!0;break}}return e}},ka=class extends Pi{constructor(){super()}validateList(t){if(t.length>this.syntax.length||t.length==0)return this.error=!0,0;for(let e=0;e<this.syntax.length;e++){let n=e;for(;n>=t.length;)n=n==1?0:n-2;if(this.syntax[e].tryParse(t,n,this)!=n+1)return this.error=!0,0}return t.length}createSyntaxNode(){return new Nd(this.validatorSet,this.propList)}},Td=class extends Pi{constructor(){super()}validateList(t){let e=t.length;for(let n=0;n<t.length;n++)if(t[n]===js){e=n;break}if(e>this.syntax.length||t.length==0)return this.error=!0,0;for(let n=0;n<this.syntax.length;n++){let s=n;for(;s>=e;)s=s==1?0:s-2;let o;if(e+1<t.length)for(o=e+n+1;o>=t.length;)o=o-(o==e+2?1:2);else o=s;let i=[t[s],t[o]];if(this.syntax[n].tryParse(i,0,this)!=2)return this.error=!0,0}return t.length}},wd=class extends Yn{constructor(){super()}mergeIn(t,e){var n,s;for(let o of this.propList){let i=(s=(n=e[o])!=null?n:this.validatorSet.defaultValues[o])!=null?s:x.initial,a=t[o];a||(a=[],t[o]=a),a.push(i)}}visitCommaList(t){let e={};for(let n=0;n<t.values.length;n++)if(this.values={},t.values[n]instanceof ge?this.error=!0:(t.values[n].visit(this),this.mergeIn(e,this.values),this.values[\"background-color\"]&&n!=t.values.length-1&&(this.error=!0)),this.error)return null;this.values={};for(let n in e)n==\"background-color\"?this.values[n]=e[n].pop():this.values[n]=new ge(e[n]);return null}},Pd=class extends Yn{constructor(){super()}init(t,e){super.init(t,e),this.propList.push(\"font-family\",\"line-height\",\"font-size\",\"font-stretch\",\"font-variant-ligatures\",\"font-variant-caps\",\"font-variant-numeric\",\"font-variant-east-asian\")}validateList(t){let e=super.validateList(t),n=this.values[\"font-variant_css2\"];n&&(delete this.values[\"font-variant_css2\"],this.values[\"font-variant-caps\"]=n);let s=this.values[\"font-stretch_css3\"];if(s&&(delete this.values[\"font-stretch_css3\"],this.values[\"font-stretch\"]=s),e+2>t.length)return this.error=!0,e;this.error=!1;let o=this.validatorSet.validators;if(!t[e].visit(o[\"font-size\"]))return this.error=!0,e;if(this.values[\"font-size\"]=t[e++],t[e]===js){if(e++,e+2>t.length)return this.error=!0,e;if(!t[e].visit(o[\"line-height\"]))return this.error=!0,e;this.values[\"line-height\"]=t[e++]}let i=e==t.length-1?t[e]:new q(t.slice(e,t.length));return i.visit(o[\"font-family\"])?(this.values[\"font-family\"]=i,t.length):(this.error=!0,e)}visitCommaList(t){if(t.values[0].visit(this),this.error)return null;let e=[this.values[\"font-family\"]];for(let s=1;s<t.values.length;s++)e.push(t.values[s]);let n=new ge(e);return n.visit(this.validatorSet.validators[\"font-family\"])?this.values[\"font-family\"]=n:this.error=!0,null}visitIdent(t){let e=this.validatorSet.systemFonts[t.name];if(e)for(let n in e)this.values[n]=e[n];else this.error=!0;return null}},kd=class extends Yn{validateList(t){if(t.length===1&&t[0]instanceof Be)switch(t[0].name.toLowerCase()){case\"normal\":t=[this.validatorSet.defaultValues[\"text-autospace\"],this.validatorSet.defaultValues[\"text-spacing-trim\"]];break;case\"auto\":t=[x.auto,x.auto];break;case\"none\":t=[L(\"no-autospace\"),L(\"space-all\")];break}return super.validateList(t)}},AC=[\"unicode-bidi\",\"direction\",\"margin-block-start\",\"margin-block-end\",\"margin-inline-start\",\"margin-inline-end\",\"padding-block-start\",\"padding-block-end\",\"padding-inline-start\",\"padding-inline-end\",\"border-block-start-color\",\"border-block-end-color\",\"border-inline-start-color\",\"border-inline-end-color\",\"border-block-start-style\",\"border-block-end-style\",\"border-inline-start-style\",\"border-inline-end-style\",\"border-block-start-width\",\"border-block-end-width\",\"border-inline-start-width\",\"border-inline-end-width\",\"block-start\",\"block-end\",\"inline-start\",\"inline-end\",\"block-size\",\"inline-size\",\"max-block-size\",\"max-inline-size\",\"min-block-size\",\"min-inline-size\",\"behavior\",\"bleed\",\"conflicting-partitions\",\"crop-offset\",\"enabled\",\"flow-consume\",\"flow-from\",\"flow-into\",\"flow-linger\",\"flow-options\",\"flow-priority\",\"font-display\",\"font-size-adjust\",\"font-stretch_css3\",\"font-variant_css2\",\"glyph-orientation-vertical\",\"marks\",\"min-page-height\",\"min-page-width\",\"repeat-on-break\",\"required\",\"required-partitions\",\"ruby-align\",\"shape-inside\",\"snap-height\",\"snap-width\",\"template\",\"text-decoration-skip\",\"text-justify\",\"text-zoom\",\"unicode-range\",\"utilization\",\"wrap-flow\"],Ad=class extends Yn{constructor(){super()}init(t,e){super.init(t,e);for(let n in this.validatorSet.validators)AC.includes(n)||this.propList.push(n)}validateList(t){return this.error=!0,0}},Af={SIMPLE:Yn,INSETS:ka,INSETS_SLASH:Td,COMMA:wd,FONT:Pd,TEXT_SPACING:kd,ALL:Ad},Ld=class{constructor(){d(this,\"validators\",{});d(this,\"prefixes\",{});d(this,\"defaultValues\",{});d(this,\"namedValidators\",{});d(this,\"systemFonts\",{});d(this,\"shorthands\",{});d(this,\"layoutProps\",{});d(this,\"backgroundProps\",{})}addReplacement(t,e){let n;if(e.type==3)n=new P(e.num,e.text);else if(e.type==7)n=new Xs(e.text);else if(e.type==1)n=L(e.text);else throw new Error(\"unexpected replacement\");if(t.isPrimitive()){let o=t.nodes[0].validator.idents;for(let i in o)o[i]=n;return t}throw new Error(\"unexpected replacement\")}newGroup(t,e){let n=new As;if(t==\"||\"){for(let o=0;o<e.length;o++){let i=new As;i.startClause(o),i.addGroup(e[o],1),i.endClause(o),n.addGroup(i,o==0?1:4)}let s=new As;return s.startSpecialGroup(),s.addGroup(n,3),s.endSpecialGroup(),s}else{let s;switch(t){case\" \":s=1;break;case\"|\":case\"||\":s=4;break;default:throw new Error(\"unexpected op\")}for(let o=0;o<e.length;o++)n.addGroup(e[o],o==0?1:s);return n}}addCounts(t,e,n){let s=new As;for(let o=0;o<e;o++)s.addGroup(t.clone(),1);if(n==Number.POSITIVE_INFINITY)s.addGroup(t,3);else for(let o=e;o<n;o++)s.addGroup(t.clone(),2);return s}primitive(t){let e=new As;return e.addPrimitive(t),e}newFunc(t,e){let n;switch(t){case\"COMMA\":n=new wi(e);break;case\"SPACE\":n=new Ls(e);break;default:n=new Sd(t.toLowerCase(),e);break}return this.primitive(n)}initBuiltInValidators(){this.namedValidators.COLOR=this.primitive(new Ce(va,W,W)),this.namedValidators.IMAGE_FUNCTION=this.primitive(new Ce(Bf,W,W)),this.namedValidators.POS_INT=this.primitive(new Ce(xd,W,W)),this.namedValidators.POS_NUM=this.primitive(new Ce(Na,W,W)),this.namedValidators.POS_PERCENTAGE=this.primitive(new Ce(ks,W,{\"%\":O})),this.namedValidators.NEGATIVE=this.primitive(new Ce(Ni,W,W)),this.namedValidators.ZERO=this.primitive(new Ce(vi,W,W)),this.namedValidators.ZERO_PERCENTAGE=this.primitive(new Ce(Ed,W,W)),this.namedValidators.POS_LENGTH=this.primitive(new Ce(ks,W,{em:O,ex:O,ch:O,rem:O,lh:O,rlh:O,vw:O,vh:O,vi:O,vb:O,vmin:O,vmax:O,pvw:O,pvh:O,pvi:O,pvb:O,pvmin:O,pvmax:O,cm:O,mm:O,in:O,px:O,pt:O,pc:O,q:O})),this.namedValidators.POS_ANGLE=this.primitive(new Ce(ks,W,{deg:O,grad:O,rad:O,turn:O})),this.namedValidators.POS_TIME=this.primitive(new Ce(ks,W,{s:O,ms:O})),this.namedValidators.FREQUENCY=this.primitive(new Ce(ks,W,{Hz:O,kHz:O})),this.namedValidators.RESOLUTION=this.primitive(new Ce(ks,W,{dpi:O,dpcm:O,dppx:O})),this.namedValidators.URI=this.primitive(new Ce(If,W,W)),this.namedValidators.URANGE=this.primitive(new Ce(Ff,W,W)),this.namedValidators.IDENT=this.primitive(new Ce(Rf,W,W)),this.namedValidators.STRING=this.primitive(new Ce(Lf,W,W)),this.namedValidators.SLASH=this.primitive(new Ce(Vf,W,W));let t={\"font-family\":L(\"sans-serif\")};this.systemFonts.caption=t,this.systemFonts.icon=t,this.systemFonts.menu=t,this.systemFonts[\"message-box\"]=t,this.systemFonts[\"small-caption\"]=t,this.systemFonts[\"status-bar\"]=t}isBuiltIn(t){return!!t.match(/^[A-Z_0-9]+$/)}readNameAndPrefixes(t,e){let n=t.token();if(n.type==0)return null;let s={\"\":!0};if(n.type==14){do{if(t.consume(),n=t.token(),n.type!=1)throw new Error(\"Prefix name expected\");s[n.text]=!0,t.consume(),n=t.token()}while(n.type==16);if(n.type!=15)throw new Error(\"']' expected\");t.consume(),n=t.token()}if(n.type!=1)throw new Error(\"Property name expected\");if(e==2?n.text==\"SHORTHANDS\":n.text==\"DEFAULTS\")return t.consume(),null;let o=n.text;if(t.consume(),e!=2){if(t.token().type!=39)throw new Error(\"'=' expected\");this.isBuiltIn(o)||(this.prefixes[o]=s)}else if(t.token().type!=18)throw new Error(\"':' expected\");return o}parseValidators(t){for(;;){let e=this.readNameAndPrefixes(t,1);if(!e)return;let n=[],s=[],o=\"\",i,a=!0,l=()=>{if(n.length==0)throw new Error(\"No values\");return n.length==1?n[0]:this.newGroup(o,n)},c=p=>{if(a)throw new Error(`'${p}': unexpected`);if(o&&o!=p)throw new Error(`mixed operators: '${p}' and '${o}'`);o=p,a=!0},u=null;for(;!u;){t.consume();let p=t.token();switch(p.type){case 1:if(a||c(\" \"),this.isBuiltIn(p.text)){let h=this.namedValidators[p.text];if(!h)throw new Error(`'${p.text}' unexpected`);n.push(h.clone())}else{let h={};h[p.text.toLowerCase()]=L(p.text),n.push(this.primitive(new Ce(0,h,W)))}a=!1;break;case 5:{let h={};h[`${p.num}`]=new ct(p.num),n.push(this.primitive(new Ce(0,h,W))),a=!1;break}case 34:c(\"|\");break;case 25:c(\"||\");break;case 14:a||c(\" \"),s.push({vals:n,op:o,b:\"[\"}),o=\"\",n=[],a=!0;break;case 6:a||c(\" \"),s.push({vals:n,op:o,b:\"(\",fn:p.text}),o=\"\",n=[],a=!0;break;case 15:{i=l();let h=s.pop();if(h.b!=\"[\")throw new Error(\"']' unexpected\");n=h.vals,n.push(i),o=h.op,a=!1;break}case 11:{i=l();let h=s.pop();if(h.b!=\"(\")throw new Error(\"')' unexpected\");n=h.vals,n.push(this.newFunc(h.fn,i)),o=h.op,a=!1;break}case 18:if(a)throw new Error(\"':' unexpected\");t.consume(),n.push(this.addReplacement(n.pop(),t.token()));break;case 22:if(a)throw new Error(\"'?' unexpected\");n.push(this.addCounts(n.pop(),0,1));break;case 36:if(a)throw new Error(\"'*' unexpected\");n.push(this.addCounts(n.pop(),0,Number.POSITIVE_INFINITY));break;case 23:if(a)throw new Error(\"'+' unexpected\");n.push(this.addCounts(n.pop(),1,Number.POSITIVE_INFINITY));break;case 12:{if(t.consume(),p=t.token(),p.type!=5)throw new Error(\"<int> expected\");let h=p.num,f=h;if(t.consume(),p=t.token(),p.type==16){if(t.consume(),p=t.token(),p.type!=5)throw new Error(\"<int> expected\");f=p.num,t.consume(),p=t.token()}if(p.type!=13)throw new Error(\"'}' expected\");n.push(this.addCounts(n.pop(),h,f));break}case 17:if(u=l(),s.length>0)throw new Error(`unclosed '${s.pop().b}'`);break;default:throw new Error(\"unexpected token\")}}t.consume(),this.isBuiltIn(e)?this.namedValidators[e]=u:u.isSimple()?this.validators[e]=u.nodes[0].validator:this.validators[e]=new Ls(u)}}parseDefaults(t){for(;;){let e=this.readNameAndPrefixes(t,2);if(!e)return;let n=[];for(;;){t.consume();let s=t.token();if(s.type==17){t.consume();break}switch(s.type){case 1:n.push(L(s.text));break;case 4:n.push(new et(s.num));break;case 5:n.push(new ct(s.num));break;case 3:n.push(new P(s.num,s.text));break;default:throw new Error(\"unexpected token\")}}this.defaultValues[e]=n.length>1?new q(n):n[0]}}parseShorthands(t){for(;;){let e=this.readNameAndPrefixes(t,3);if(!e)return;let n=t.nthToken(1),s;n.type==1&&Af[n.text]?(s=new Af[n.text],t.consume()):s=new Yn,s.setOwner(this);let o=!1,i=[],a=!1,l=[],c=[];for(;!o;)switch(t.consume(),n=t.token(),n.type){case 1:if(this.validators[n.text])i.push(s.syntaxNodeForProperty(n.text)),n.text.includes(\"_\")||c.push(n.text);else if(this.shorthands[n.text]instanceof ka){let u=this.shorthands[n.text];i.push(u.createSyntaxNode()),c.push(...u.propList)}else throw new Error(`'${n.text}' is neither a simple property nor an inset shorthand`);break;case 19:if(i.length>0||a)throw new Error(\"unexpected slash\");a=!0;break;case 14:l.push({slash:a,syntax:i}),i=[],a=!1;break;case 15:{let u=new vd(i,a),p=l.pop();i=p.syntax,a=p.slash,i.push(u);break}case 17:o=!0,t.consume();break;default:throw new Error(\"unexpected token\")}s.init(i,c),this.shorthands[e]=s}}parse(t){let e=new Oe(t,null);this.parseValidators(e),this.parseDefaults(e),this.parseShorthands(e),this.backgroundProps=this.makePropSet([\"background\"]),this.layoutProps=this.makePropSet([\"margin\",\"border\",\"padding\",\"columns\",\"column-gap\",\"column-rule\",\"column-fill\"])}makePropSet(t){var n;let e={};for(let s of t){let o=this.shorthands[s],i=o?o.propList:[s];for(let a of i)e[a]=(n=this.defaultValues[a])!=null?n:x.initial}return e}validatePropertyAndHandleShorthand(t,e,n,s){if(bt(t)||s.ruleType===\"font-face\"||LC(e)){s.simpleProperty(t,e,n);return}let o=\"\",i=t;t=t.toLowerCase();let a=t.match(/^-([a-z]+)-([-a-z0-9]+)$/);a&&(o=a[1],t=a[2]);let l=this.prefixes[t];if(!l||!l[o]){CSS.supports(t,e.toString())?s.simpleProperty(i,e,n):o&&!xl.includes(`-${o}-`)||s.unknownProperty(i,e);return}let c=this.validators[t];if(c){let u=U(e)||e.isExpr()?e:e.visit(c);u?s.simpleProperty(t,u,n):!o&&CSS.supports(t,e.toString())?s.simpleProperty(t,e,n):s.invalidPropertyValue(i,e)}else{let u=this.shorthands[t].clone();U(e)?u.propagateDefaultingValue(e,n,s):(e.visit(u),u.finish(n,s)||s.invalidPropertyValue(i,e))}}};function Id(){let r=new Ld;return r.initBuiltInValidators(),r.parse(cc),r}var Rd=class extends lt{constructor(){super(...arguments);d(this,\"varFound\",!1)}visitFunc(e){return e.name===\"var\"?this.varFound=!0:this.varFound||this.visitValues(e.values),null}};function LC(r){let t=new Rd;return r.visit(t),t.varFound}var ki={\"font-style\":x.auto,\"font-stretch\":x.auto,\"font-weight\":x.auto,\"unicode-range\":Dp},Oy=`OTTO${new Date().valueOf()}`;function IC(r){let t=new je;for(let e in ki)t.append(\" \"),t.append(r[e].toString());return t.toString()}function VC(r){for(let t in ki)r[t]||(r[t]=ki[t])}function Df(r,t){let e={};for(let n in r)e[n]=de(r,n).evaluate(t,n);return VC(e),e}var Ai=class{constructor(t){this.properties=t;d(this,\"fontTraitKey\");d(this,\"src\");d(this,\"blobURLs\",[]);d(this,\"blobs\",[]);d(this,\"family\");this.fontTraitKey=IC(this.properties),this.src=this.properties.src?this.properties.src.toString():null;let e=this.properties[\"font-family\"];this.family=e?e.stringValue():null}traitsEqual(t){return this.fontTraitKey==t.fontTraitKey}makeAtRule(t,e){let n=new je;n.append(`@font-face {\n  font-family: `),n.append(this.family),n.append(`;\n  `);for(let s in ki)n.append(s),n.append(\": \"),this.properties[s].appendTo(n,!0),n.append(`;\n  `);if(e){n.append('src: url(\"');let s=th(e);n.append(s),this.blobURLs.push(s),this.blobs.push(e),n.append('\")')}else n.append(\"src: \"),n.append(t);return n.append(`;\n}\n`),n.toString()}},Aa=class{constructor(t){this.deobfuscator=t;d(this,\"familyMap\",{})}registerFamily(t,e){let n=t.family,s=this.familyMap[n],o=e.family;if(s){if(s!=o)throw new Error(`E_FONT_FAMILY_INCONSISTENT ${t.family}`)}else this.familyMap[n]=o}filterFontFamily(t){if(t instanceof ge){let e=t.values,n=[];for(let s of e){let o=this.familyMap[s.stringValue()];o&&n.push(L(o)),n.push(s)}return new ge(n)}else{let e=this.familyMap[t.stringValue()];return e?new ge([L(e),t]):t}}},La=class{constructor(t,e,n){this.head=t;this.body=e;d(this,\"srcURLMap\",{});d(this,\"familyPrefix\");d(this,\"familyCounter\",0);this.familyPrefix=n||\"Fnt_\"}getViewFontFamily(t,e){let n=t.family,s=e.familyMap[n];return s||(s=this.familyPrefix+ ++this.familyCounter,e.familyMap[n]=s,s)}initFont(t,e,n){let s=k(\"initFont\"),o=t.src,i={};for(let u in ki)i[u]=t.properties[u];let a=this.getViewFontFamily(t,n);i[\"font-family\"]=L(a);let l=new Ai(i),c=this.head.ownerDocument.createElement(\"style\");return c.textContent=l.makeAtRule(o,e),this.head.appendChild(c),V.debug(\"Load font:\",o),s.finish(l),s.result()}loadFont(t,e){let n=t.src,s=t.family+\";\"+n,o=this.srcURLMap[s];return o?o.piggyback(i=>{let a=i;a.traitsEqual(t)?(e.registerFamily(t,a),V.debug(\"Found already-loaded font:\",n)):V.warn(\"E_FONT_FACE_INCOMPATIBLE\",t.src)}):(o=new Kt(()=>{let i=k(\"loadFont\"),a=n.replace(/^url\\(\"([^\"]+)\"\\).*$/,\"$1\"),l=e.deobfuscator?e.deobfuscator(a):null;return l?cs(a,\"blob\").then(c=>{if(!c.responseBlob){i.finish(null);return}l(c.responseBlob).then(u=>{this.initFont(t,u,e).thenFinish(i)})}):this.initFont(t,null,e).thenFinish(i),i.result()},`loadFont ${n}`),this.srcURLMap[s]=o,o.start()),o}findOrLoadFonts(t,e){let n=[];for(let s of t){if(!s.src||!s.family){V.warn(\"E_FONT_FACE_INVALID\");continue}n.push(this.loadFont(s,e))}return An(n).thenAsync(()=>this.waitFontLoading())}waitFontLoading(){let t=this.head.ownerDocument.fonts,e=0;if(t.forEach(s=>{s.status===\"unloaded\"&&(e++,s.load().catch(o=>{}))}),e===0)return v(!0);let n=k(\"waitFontLoading\");return n.loop(()=>n.sleep(20).thenAsync(()=>t.status===\"loading\"?v(!0):v(!1))).thenFinish(n),n.result()}};var FC=1,No=class{constructor(t,e,n,s,o){this.name=e;this.pseudoName=n;this.classes=s;this.parent=o;d(this,\"specified\",{});d(this,\"children\",[]);d(this,\"pageMaster\",null);d(this,\"index\",0);d(this,\"key\");d(this,\"_scope\");this._scope=t,this.key=`p${FC++}`,o&&(this.index=o.children.length,o.children.push(this))}get scope(){return this._scope}createInstance(t){throw new Error(\"E_UNEXPECTED_CALL\")}clone(t){throw new Error(\"E_UNEXPECTED_CALL\")}copySpecified(t){let e=this.specified,n=t.specified;for(let s in e)Object.prototype.hasOwnProperty.call(e,s)&&(n[s]=e[s])}cloneChildren(t){for(let e=0;e<this.children.length;e++)this.children[e].clone({parent:t})}},Ra=class extends No{constructor(t){super(t,null,null,[],null),this.specified.width=new M(rn,0),this.specified.height=new M(an,0)}},Ia=class extends ts{constructor(e,n){super(e,o);this.pageMaster=n;let s=this;function o(i,a){let l=i.match(/^([^.]+)\\.([^.]+)$/);if(l){let c=s.pageMaster.keyMap[l[1]];if(c){let p=this.lookupInstance(c);if(p)return a?p.resolveFunc(l[2]):p.resolveName(l[2])}}return null}}},vo=class r extends No{constructor(e,n,s,o,i,a,l){super(e,n,s,o,i);this.condition=a;this.specificity=l;d(this,\"keyMap\",{});e instanceof Ia||(this._scope=new Ia(e,this)),this.pageMaster=this,this.specified.width=new M(rn,0),this.specified.height=new M(an,0),this.specified[\"wrap-flow\"]=new M(x.auto,0),this.specified.position=new M(x.relative,0),this.specified.overflow=new M(x.visible,0)}createInstance(e){return new Is(e,this)}clone(e){let n=new r(this.scope,this.name,e.pseudoName||this.pseudoName,this.classes,this.parent,this.condition,this.specificity);return this.copySpecified(n),this.cloneChildren(n),n}resetScope(){this.scope.pageMaster=this}},Va=class r extends No{constructor(t,e,n,s,o){super(t,e,n,s,o),this.pageMaster=o.pageMaster,e&&(this.pageMaster.keyMap[e]=this.key),this.specified[\"wrap-flow\"]=new M(x.auto,0)}createInstance(t){return new Vd(t,this)}clone(t){let e=new r(t.parent.scope,this.name,this.pseudoName,this.classes,t.parent);return this.copySpecified(e),this.cloneChildren(e),e}},Rs=class r extends No{constructor(t,e,n,s,o){super(t,e,n,s,o),this.pageMaster=o.pageMaster,e&&(this.pageMaster.keyMap[e]=this.key)}createInstance(t){return new En(t,this)}clone(t){let e=new r(t.parent.scope,this.name,this.pseudoName,this.classes,t.parent);return this.copySpecified(e),this.cloneChildren(e),e}};function BC(r,t,e){return!t||U(t)?new se(r,e):t.toExpr(r,r.zero)}function ee(r,t,e){return!t||t===x.auto||U(t)?null:t.toExpr(r,e)}function OC(r,t,e){return!t||t===x.normal||U(t)?null:t.toExpr(r,e)}function nt(r,t,e){return!t||t===x.auto||U(t)?r.zero:t.toExpr(r,e)}function Bd(r,t,e){return!t||U(t)?r.zero:t===x.auto?null:t.toExpr(r,e)}function Ht(r,t,e,n){return!t||e===x.none||U(t)?r.zero:t.toExpr(r,n)}function Wf(r,t,e){return!t||U(t)?e:t===x._true?r._true:t===x._false?r._false:t.toExpr(r,r.zero)}var To=class{constructor(t,e){this.parentInstance=t;this.pageBox=e;d(this,\"cascaded\",{});d(this,\"style\",{});d(this,\"autoWidth\",null);d(this,\"autoHeight\",null);d(this,\"children\",[]);d(this,\"isAutoWidth\",!1);d(this,\"isAutoHeight\",!1);d(this,\"isTopDependentOnAutoHeight\",!1);d(this,\"isRightDependentOnAutoWidth\",!1);d(this,\"calculatedWidth\",0);d(this,\"calculatedHeight\",0);d(this,\"pageMasterInstance\",null);d(this,\"namedValues\",{});d(this,\"namedFuncs\",{});d(this,\"vertical\",!1);d(this,\"rtl\",!1);d(this,\"suppressEmptyBoxGeneration\",!1);t&&t.children.push(this)}reset(){this.calculatedWidth=0,this.calculatedHeight=0}addNamedValues(t,e){let n=this.resolveName(t),s=this.resolveName(e);if(!n||!s)throw new Error(\"E_INTERNAL\");return H(this.pageBox.scope,n,s)}resolveName(t){let e=this.namedValues[t];if(e)return e;let n=this.style[t];switch(n&&(e=n.toExpr(this.pageBox.scope,this.pageBox.scope.zero)),t){case\"margin-left-edge\":e=this.resolveName(\"left\");break;case\"margin-top-edge\":e=this.resolveName(\"top\");break;case\"margin-right-edge\":e=this.addNamedValues(\"border-right-edge\",\"margin-right\");break;case\"margin-bottom-edge\":e=this.addNamedValues(\"border-bottom-edge\",\"margin-bottom\");break;case\"border-left-edge\":e=this.addNamedValues(\"margin-left-edge\",\"margin-left\");break;case\"border-top-edge\":e=this.addNamedValues(\"margin-top-edge\",\"margin-top\");break;case\"border-right-edge\":e=this.addNamedValues(\"padding-right-edge\",\"border-right-width\");break;case\"border-bottom-edge\":e=this.addNamedValues(\"padding-bottom-edge\",\"border-bottom-width\");break;case\"padding-left-edge\":e=this.addNamedValues(\"border-left-edge\",\"border-left-width\");break;case\"padding-top-edge\":e=this.addNamedValues(\"border-top-edge\",\"border-top-width\");break;case\"padding-right-edge\":e=this.addNamedValues(\"right-edge\",\"padding-right\");break;case\"padding-bottom-edge\":e=this.addNamedValues(\"bottom-edge\",\"padding-bottom\");break;case\"left-edge\":e=this.addNamedValues(\"padding-left-edge\",\"padding-left\");break;case\"top-edge\":e=this.addNamedValues(\"padding-top-edge\",\"padding-top\");break;case\"right-edge\":e=this.addNamedValues(\"left-edge\",\"width\");break;case\"bottom-edge\":e=this.addNamedValues(\"top-edge\",\"height\");break}if(!e){let s;if(t==\"extent\")s=this.vertical?\"width\":\"height\";else if(t==\"measure\")s=this.vertical?\"height\":\"width\";else{let o=this.vertical?Au:Lu;s=t;for(let i in o)s=s.replace(i,o[i])}s!=t&&(e=this.resolveName(s))}return e&&(this.namedValues[t]=e),e}resolveFunc(t){let e=this.namedFuncs[t];if(e)return e;switch(t){case\"columns\":{let n=this.pageBox.scope,s=new Ws(n,0),o=this.resolveName(\"column-count\"),i=this.resolveName(\"column-width\"),a=this.resolveName(\"column-gap\");e=K(n,$s(n,new on(n,\"min\",[s,o]),H(n,i,a)),a);break}}return e&&(this.namedFuncs[t]=e),e}initEnabled(){let t=this.pageBox.scope,e=this.style,n=Wf(t,e.enabled,t._true),s=ee(t,e.page,t.zero);if(s){let a=new le(t,\"page-number\");n=Je(t,n,new Pn(t,s,a))}let o=ee(t,e[\"min-page-width\"],t.zero);o&&(n=Je(t,n,new ns(t,new le(t,\"page-width\"),o)));let i=ee(t,e[\"min-page-height\"],t.zero);i&&(n=Je(t,n,new ns(t,new le(t,\"page-height\"),i))),n=this.boxSpecificEnabled(n),e.enabled=new F(n)}boxSpecificEnabled(t){return t}initHorizontal(){let t=this.pageBox.scope,e=this.style,n=this.parentInstance?this.parentInstance.style.width.toExpr(t,null):null,s=ee(t,e.left,n),o=ee(t,e[\"margin-left\"],n),i=Ht(t,e[\"border-left-width\"],e[\"border-left-style\"],n),a=nt(t,e[\"padding-left\"],n),l=ee(t,e.width,n),c=ee(t,e[\"max-width\"],n),u=nt(t,e[\"padding-right\"],n),p=Ht(t,e[\"border-right-width\"],e[\"border-right-style\"],n),h=ee(t,e[\"margin-right\"],n),f=ee(t,e.right,n),g=H(t,i,a),m=H(t,i,u);if(s&&f&&l){let b=K(t,n,H(t,l,H(t,H(t,s,g),m)));o?h?f=K(t,b,h):h=K(t,b,H(t,f,o)):(b=K(t,b,f),h?o=K(t,b,h):(o=$s(t,b,new se(t,.5)),h=o))}else{o||(o=t.zero),h||(h=t.zero),!s&&!f&&!l&&(s=t.zero),!s&&!l?(l=this.autoWidth,this.isAutoWidth=!0):!s&&!f?s=t.zero:!l&&!f&&(l=this.autoWidth,this.isAutoWidth=!0);let b=K(t,n,H(t,H(t,o,g),H(t,h,m)));this.isAutoWidth&&(c||(c=K(t,b,s||f)),!this.vertical&&(ee(t,e[\"column-width\"],null)||ee(t,e[\"column-count\"],null))&&(l=c,this.isAutoWidth=!1)),s?l?f||(f=K(t,b,H(t,s,l))):l=K(t,b,H(t,s,f)):s=K(t,b,H(t,f,l))}let E=e[\"snap-width\"]||(this.parentInstance?this.parentInstance.style[\"snap-width\"]:null),C=nt(t,E,n);e.left=new F(s),e[\"margin-left\"]=new F(o),e[\"border-left-width\"]=new F(i),e[\"padding-left\"]=new F(a),e.width=new F(l),e[\"max-width\"]=new F(c||l),e[\"padding-right\"]=new F(u),e[\"border-right-width\"]=new F(p),e[\"margin-right\"]=new F(h),e.right=new F(f),e[\"snap-width\"]=new F(C)}initVertical(){let t=this.pageBox.scope,e=this.style,n=this.parentInstance?this.parentInstance.style.width.toExpr(t,null):null,s=this.parentInstance?this.parentInstance.style.height.toExpr(t,null):null,o=ee(t,e.top,s),i=ee(t,e[\"margin-top\"],n),a=Ht(t,e[\"border-top-width\"],e[\"border-top-style\"],n),l=nt(t,e[\"padding-top\"],n),c=ee(t,e.height,s),u=ee(t,e[\"max-height\"],s),p=nt(t,e[\"padding-bottom\"],n),h=Ht(t,e[\"border-bottom-width\"],e[\"border-bottom-style\"],n),f=ee(t,e[\"margin-bottom\"],n),g=ee(t,e.bottom,s),m=H(t,a,l),E=H(t,h,p);if(o&&g&&c){let y=K(t,s,H(t,c,H(t,H(t,o,m),E)));i?f?g=K(t,y,i):f=K(t,y,H(t,g,i)):(y=K(t,y,g),f?i=K(t,y,f):(i=$s(t,y,new se(t,.5)),f=i))}else{i||(i=t.zero),f||(f=t.zero),!o&&!g&&!c&&(o=t.zero),!o&&!c?(c=this.autoHeight,this.isAutoHeight=!0):!o&&!g?o=t.zero:!c&&!g&&(c=this.autoHeight,this.isAutoHeight=!0);let y=K(t,s,H(t,H(t,i,m),H(t,f,E)));this.isAutoHeight&&(u||(u=K(t,y,o||g)),this.vertical&&(ee(t,e[\"column-width\"],null)||ee(t,e[\"column-count\"],null))&&(c=u,this.isAutoHeight=!1)),o?c?g||(g=K(t,y,H(t,o,c))):c=K(t,y,H(t,g,o)):o=K(t,y,H(t,g,c))}let C=e[\"snap-height\"]||(this.parentInstance?this.parentInstance.style[\"snap-height\"]:null),b=nt(t,C,n);e.top=new F(o),e[\"margin-top\"]=new F(i),e[\"border-top-width\"]=new F(a),e[\"padding-top\"]=new F(l),e.height=new F(c),e[\"max-height\"]=new F(u||c),e[\"padding-bottom\"]=new F(p),e[\"border-bottom-width\"]=new F(h),e[\"margin-bottom\"]=new F(f),e.bottom=new F(g),e[\"snap-height\"]=new F(b)}initColumns(){let t=this.pageBox.scope,e=this.style,n=ee(t,e[this.vertical?\"height\":\"width\"],null),s=ee(t,e[\"column-width\"],n),o=ee(t,e[\"column-count\"],null),i=OC(t,e[\"column-gap\"],null);i||(i=new at(t,1,\"em\")),s&&!o&&(o=new on(t,\"floor\",[Go(t,H(t,n,i),H(t,s,i))]),o=new on(t,\"max\",[t.one,o])),o||(o=t.one),s=K(t,Go(t,H(t,n,i),o),i),e[\"column-width\"]=new F(s),e[\"column-count\"]=new F(o),e[\"column-gap\"]=new F(i)}depends(t,e,n){return this.style[t].toExpr(this.pageBox.scope,null).depend(e,n)}init(t){t.registerInstance(this.pageBox.key,this);let n=this.pageBox.scope,s=this.style,o=this.parentInstance?this.parentInstance.getActiveRegions(t):null,i=ha(this.cascaded,t,o,!1,null);this.vertical=da(i,t,this.parentInstance?this.parentInstance.vertical:!1),this.rtl=pa(i,t,this.parentInstance?this.parentInstance.rtl:!1),fa(i,s,this.vertical,this.rtl,(a,l)=>l.value),this.autoWidth=new oe(n,()=>this.calculatedWidth,\"autoWidth\"),this.autoHeight=new oe(n,()=>this.calculatedHeight,\"autoHeight\"),this.initHorizontal(),this.initVertical(),this.initColumns(),this.initEnabled()}getProp(t,e){var s,o;let n=this.style[e];return!n&&Wn(e)&&(e===\"font-size\"&&t.isRelativeRootFontSize&&t.rootFontSize?n=new P(t.rootFontSize,\"px\"):n=(o=((s=t.styler)==null?void 0:s.rootStyle)[e])==null?void 0:o.value),n&&(n=hi(t,n,e)),n}getPropAsNumber(t,e){var s,o;let n=this.style[e];if(n){let i=/\\b(height|top|bottom)\\b/.test(e)?(s=t.pageAreaHeight)!=null?s:t.pageHeight():(o=t.pageAreaWidth)!=null?o:t.pageWidth();n=hi(t,n,e,i)}return Ae(n,t)}getSpecial(t,e){let n=Ru(this.cascaded,e);if(n){let s=[];for(let o=0;o<n.length;o++){let i=n[o].evaluate(t,\"\");i&&i!==O&&s.push(i)}if(s.length)return s}return null}getActiveRegions(t){let e=this.getSpecial(t,\"region-id\");if(e){let n=[];for(let s=0;s<e.length;s++)n[s]=e[s].toString();return n}return null}propagateProperty(t,e,n,s){this.propagatePropertyToElement(t,e.element,n,s)}propagatePropertyToElement(t,e,n,s){let o=this.getProp(t,n);o&&(o.isNumeric()&&fr(o.unit)&&(o=Cr(o,t)),n===\"font-family\"&&(o=s.filterFontFamily(o)),(n.startsWith(\"background\")||n===\"z-index\")&&e.parentElement.hasAttribute(\"data-vivliostyle-bleed-box\")&&(e=e.parentElement),T(e,n,o.toString()))}propagateDelayedProperty(t,e,n,s){let o=this.getProp(t,n);o&&s.push(new Bn(e.element,n,o))}assignLeftPosition(t,e){let n=this.getPropAsNumber(t,\"left\"),s=this.getPropAsNumber(t,\"margin-left\"),o=this.getPropAsNumber(t,\"padding-left\"),i=this.getPropAsNumber(t,\"border-left-width\"),a=this.getPropAsNumber(t,\"width\");e.setHorizontalPosition(n,a),T(e.element,\"margin-left\",`${s}px`),T(e.element,\"padding-left\",`${o}px`),T(e.element,\"border-left-width\",`${i}px`),e.marginLeft=s,e.borderLeft=i,e.paddingLeft=o}assignRightPosition(t,e){let n=this.getPropAsNumber(t,\"right\"),s=this.getPropAsNumber(t,\"snap-height\"),o=this.getPropAsNumber(t,\"margin-right\"),i=this.getPropAsNumber(t,\"padding-right\"),a=this.getPropAsNumber(t,\"border-right-width\");if(T(e.element,\"margin-right\",`${o}px`),T(e.element,\"padding-right\",`${i}px`),T(e.element,\"border-right-width\",`${a}px`),e.marginRight=o,e.borderRight=a,this.vertical&&s>0){let l=n+e.getInsetRight(),c=l-Math.floor(l/s)*s;c>0&&(e.snapOffsetX=s-c,i+=e.snapOffsetX)}e.paddingRight=i,e.snapWidth=s}assignTopPosition(t,e){let n=this.getPropAsNumber(t,\"snap-height\"),s=this.getPropAsNumber(t,\"top\"),o=this.getPropAsNumber(t,\"margin-top\"),i=this.getPropAsNumber(t,\"padding-top\"),a=this.getPropAsNumber(t,\"border-top-width\");if(e.top=s,e.marginTop=o,e.borderTop=a,e.snapHeight=n,!this.vertical&&n>0){let l=s+e.getInsetTop(),c=l-Math.floor(l/n)*n;c>0&&(e.snapOffsetY=n-c,i+=e.snapOffsetY)}e.paddingTop=i,T(e.element,\"top\",`${s}px`),T(e.element,\"margin-top\",`${o}px`),T(e.element,\"padding-top\",`${i}px`),T(e.element,\"border-top-width\",`${a}px`)}assignBottomPosition(t,e){let n=this.getPropAsNumber(t,\"margin-bottom\"),s=this.getPropAsNumber(t,\"padding-bottom\"),o=this.getPropAsNumber(t,\"border-bottom-width\"),i=this.getPropAsNumber(t,\"height\")-e.snapOffsetY;T(e.element,\"height\",`${i}px`),T(e.element,\"margin-bottom\",`${n}px`),T(e.element,\"padding-bottom\",`${s}px`),T(e.element,\"border-bottom-width\",`${o}px`),e.height=i-e.snapOffsetY,e.marginBottom=n,e.borderBottom=o,e.paddingBottom=s}assignBeforePosition(t,e){this.vertical?this.assignRightPosition(t,e):this.assignTopPosition(t,e)}assignAfterPosition(t,e){this.vertical?this.assignLeftPosition(t,e):this.assignBottomPosition(t,e)}assignStartEndPosition(t,e){this.vertical?(this.assignTopPosition(t,e),this.assignBottomPosition(t,e)):(this.assignRightPosition(t,e),this.assignLeftPosition(t,e))}sizeWithMaxHeight(t,e){T(e.element,\"border-top-width\",\"0px\");let n=this.getPropAsNumber(t,\"max-height\");this.isTopDependentOnAutoHeight?e.setVerticalPosition(0,n):(this.assignTopPosition(t,e),n-=e.snapOffsetY,e.height=n,T(e.element,\"height\",`${n}px`))}sizeWithMaxWidth(t,e){T(e.element,\"border-left-width\",\"0px\");let n=this.getPropAsNumber(t,\"max-width\");if(this.isRightDependentOnAutoWidth)e.setHorizontalPosition(0,n);else{this.assignRightPosition(t,e),n-=e.snapOffsetX,e.width=n;let s=this.getPropAsNumber(t,\"right\");T(e.element,\"right\",`${s}px`),T(e.element,\"width\",`${n}px`)}}prepareContainer(t,e,n,s,o){(!this.parentInstance||this.vertical!=this.parentInstance.vertical)&&T(e.element,\"writing-mode\",this.vertical?\"vertical-rl\":\"horizontal-tb\"),(!this.parentInstance||this.rtl!=this.parentInstance.rtl)&&T(e.element,\"direction\",this.rtl?\"rtl\":\"ltr\"),(this.vertical?this.isAutoWidth:this.isAutoHeight)?this.vertical?this.sizeWithMaxWidth(t,e):this.sizeWithMaxHeight(t,e):(this.assignBeforePosition(t,e),this.assignAfterPosition(t,e)),(this.vertical?this.isAutoHeight:this.isAutoWidth)?this.vertical?this.sizeWithMaxHeight(t,e):this.sizeWithMaxWidth(t,e):this.assignStartEndPosition(t,e);for(let i=0;i<_f.length;i++)this.propagateProperty(t,e,_f[i],s)}transferContentProps(t,e,n,s){for(let o=0;o<Hf.length;o++)this.propagateProperty(t,e,Hf[o],s)}transferSingleUriContentProps(t,e,n){let s=()=>{var a,l;let i=(l=(a=this.cascaded.width)!=null?a:this.cascaded[this.vertical?\"block-size\":\"inline-size\"])==null?void 0:l.value;return!!i&&i!==x.auto&&!U(i)},o=()=>{var a,l;let i=(l=(a=this.cascaded.height)!=null?a:this.cascaded[this.vertical?\"inline-size\":\"block-size\"])==null?void 0:l.value;return!!i&&i!==x.auto&&!U(i)};for(let i=0;i<zf.length;i++){let a=zf[i];a===\"width\"&&!s()||a===\"height\"&&!o()||this.propagatePropertyToElement(t,e,a,n)}}finishContainer(t,e,n,s,o,i,a){this.vertical?this.calculatedWidth=e.computedBlockSize+e.snapOffsetX:this.calculatedHeight=e.computedBlockSize+e.snapOffsetY;let l=(this.vertical||!s)&&this.isAutoHeight,c=(!this.vertical||!s)&&this.isAutoWidth,u=null;if((c||l)&&(c&&T(e.element,\"width\",\"auto\"),l&&T(e.element,\"height\",\"auto\"),u=i.getElementClientRect(s?s.element:e.element),c&&(this.calculatedWidth=Math.ceil(u.right-u.left-e.paddingLeft-e.borderLeft-e.paddingRight-e.borderRight),this.vertical&&(this.calculatedWidth+=e.snapOffsetX)),l&&(this.calculatedHeight=u.bottom-u.top-e.paddingTop-e.borderTop-e.paddingBottom-e.borderBottom,this.vertical||(this.calculatedHeight+=e.snapOffsetY))),(this.vertical?this.isAutoHeight:this.isAutoWidth)&&this.assignStartEndPosition(t,e),(this.vertical?this.isAutoWidth:this.isAutoHeight)&&((this.vertical?this.isRightDependentOnAutoWidth:this.isTopDependentOnAutoHeight)&&this.assignBeforePosition(t,e),this.assignAfterPosition(t,e)),o>1){let p=this.getPropAsNumber(t,\"column-rule-width\"),h=this.getProp(t,\"column-rule-style\"),f=this.getProp(t,\"column-rule-color\");if(p>0&&h&&h!=x.none&&f!=x.transparent){let g=this.getPropAsNumber(t,\"column-gap\"),m=this.vertical?e.height:e.width,E=this.vertical?\"border-top\":\"border-left\";for(let C=1;C<o;C++){let b=this.vertical?(m+g)*C/o-g/2+e.paddingTop-p/2:(m+g)*C/o-g/2+e.paddingLeft-p/2,y=this.vertical?e.width+e.paddingLeft+e.paddingRight:e.height+e.paddingTop+e.paddingBottom,N=e.element.ownerDocument.createElement(\"div\");T(N,\"position\",\"absolute\"),T(N,this.vertical?\"left\":\"top\",\"0px\"),T(N,this.vertical?\"top\":\"left\",`${b}px`),T(N,this.vertical?\"height\":\"width\",\"0px\"),T(N,this.vertical?\"width\":\"height\",`${y}px`),T(N,E,`${p}px ${h.toString()}${f?` ${f.toString()}`:\"\"}`),e.element.insertBefore(N,e.element.firstChild)}}}for(let p=0;p<Uf.length;p++)this.propagateProperty(t,e,Uf[p],a);for(let p=0;p<Gf.length;p++)this.propagateDelayedProperty(t,e,Gf[p],n.delayedItems)}applyCascadeAndInit(t,e){let n=this.cascaded,s=this.pageBox.specified;for(let i in s)this.pageBox.pseudoName==\"vivliostyle-page-rule-master\"&&(i===\"writing-mode\"||i===\"direction\")||xs(i)&&mn(n,i,de(s,i));if(this.pageBox.pseudoName==Ri)for(let i in e)(i.match(/^background-/)||i==\"writing-mode\")&&(n[i]=e[i]);if(this.pageBox.pseudoName==\"layout-host\")for(let i in e)!i.match(/^background-/)&&i!=\"writing-mode\"&&(n[i]=e[i]);t.pushRule(this.pageBox.classes,null,n);let o=n.content;o&&(n.content=o.filterValue(new Co(t,null,t.counterResolver))),this.init(t.context);for(let i of this.pageBox.children)i.createInstance(this).applyCascadeAndInit(t,e);t.popRule()}resolveAutoSizing(t){this.isAutoWidth&&(this.isRightDependentOnAutoWidth=this.depends(\"right\",this.autoWidth,t)||this.depends(\"margin-right\",this.autoWidth,t)||this.depends(\"border-right-width\",this.autoWidth,t)||this.depends(\"padding-right\",this.autoWidth,t)),this.isAutoHeight&&(this.isTopDependentOnAutoHeight=this.depends(\"top\",this.autoHeight,t)||this.depends(\"margin-top\",this.autoHeight,t)||this.depends(\"border-top-width\",this.autoHeight,t)||this.depends(\"padding-top\",this.autoHeight,t));for(let e of this.children)e.resolveAutoSizing(t)}},_f=[\"border-left-style\",\"border-right-style\",\"border-top-style\",\"border-bottom-style\",\"border-left-color\",\"border-right-color\",\"border-top-color\",\"border-bottom-color\",\"outline-style\",\"outline-color\",\"outline-width\",\"overflow\",\"visibility\"],Uf=[\"border-top-left-radius\",\"border-top-right-radius\",\"border-bottom-right-radius\",\"border-bottom-left-radius\",\"border-image-source\",\"border-image-slice\",\"border-image-width\",\"border-image-outset\",\"border-image-repeat\",\"background-attachment\",\"background-color\",\"background-image\",\"background-repeat\",\"background-position\",\"background-clip\",\"background-origin\",\"background-size\",\"opacity\",\"z-index\",\"background-blend-mode\",\"isolation\",\"mix-blend-mode\",\"filter\"],Hf=[\"color\",\"font-family\",\"font-size\",\"font-style\",\"font-weight\",\"line-height\",\"letter-spacing\",\"text-align\",\"text-decoration\",\"text-indent\",\"text-transform\",\"white-space\",\"word-spacing\",\"font-feature-settings\",\"font-kerning\",\"font-size-adjust\",\"font-variant-ligatures\",\"font-variant-caps\",\"font-variant-numeric\",\"font-variant-east-asian\",\"font-stretch\",\"text-combine-upright\",\"text-decoration-color\",\"text-decoration-line\",\"text-decoration-skip\",\"text-decoration-style\",\"text-decoration-thickness\",\"text-emphasis\",\"text-emphasis-color\",\"text-emphasis-position\",\"text-emphasis-style\",\"text-fill-color\",\"text-orientation\",\"text-shadow\",\"text-stroke-color\",\"text-stroke-width\",\"text-underline-position\"],zf=[\"width\",\"height\",\"image-resolution\",\"object-fit\",\"object-position\"],Gf=[\"transform\",\"transform-origin\"],Ri=\"background-host\",Fa=class extends To{constructor(t){super(null,t)}applyCascadeAndInit(t,e){super.applyCascadeAndInit(t,e),this.children.sort((s,o)=>o.pageBox.specificity-s.pageBox.specificity||s.pageBox.index-o.pageBox.index)}},Is=class extends To{constructor(t,e){super(t,e),this.pageMasterInstance=this}boxSpecificEnabled(t){let e=this.pageBox.pageMaster;return e.condition&&(t=Je(e.scope,t,e.condition)),t}adjustPageLayout(t,e,n){}},Vd=class extends To{constructor(t,e){super(t,e),this.pageMasterInstance=t.pageMasterInstance}},En=class extends To{constructor(t,e){super(t,e),this.pageMasterInstance=t.pageMasterInstance}processPartitionList(t,e,n){let s=null;if(e instanceof Be&&(s=[e]),e instanceof ge&&(s=e.values),s){let o=this.pageBox.scope;for(let i=0;i<s.length;i++)if(s[i]instanceof Be){let a=zo(s[i].name,\"enabled\"),l=new le(o,a);n&&(l=new mt(o,l)),t=Je(o,t,l)}}return t}boxSpecificEnabled(t){let e=this.pageBox.scope,n=this.style,s=Wf(e,n.required,e._false)!==e._false;if(s||this.isAutoHeight){let o=BC(e,n[\"flow-from\"],\"body\"),i=new on(e,\"has-content\",[o]);t=Je(e,t,i)}if(t=this.processPartitionList(t,n[\"required-partitions\"],!1),t=this.processPartitionList(t,n[\"conflicting-partitions\"],!0),s){let o=this.pageMasterInstance.style.enabled,i=o?o.toExpr(e,null):e._true;i=Je(e,i,t),this.pageMasterInstance.style.enabled=new F(i)}return t}prepareContainer(t,e,n,s,o){n.pageAreaElement||T(e.element,\"overflow\",\"hidden\"),super.prepareContainer(t,e,n,s,o)}},Li=class extends qt{constructor(e,n,s,o){super(e,n,!1);this.target=s;this.validatorSet=o}property(e,n,s){this.validatorSet.validatePropertyAndHandleShorthand(e,n,s,this)}unknownProperty(e,n){this.report(`E_INVALID_PROPERTY ${e}: ${n.toString()}`)}invalidPropertyValue(e,n){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${n.toString()}`)}simpleProperty(e,n,s){this.target.specified[e]=new M(n,s?Ar:Lr)}},Ba=class extends Li{constructor(t,e,n,s){super(t,e,n,s)}},Fd=class r extends Li{constructor(t,e,n,s){super(t,e,n,s),n.specified.width=new M(Bl,0),n.specified.height=new M(Bl,0)}startPartitionRule(t,e,n){let s=new Rs(this.scope,t,e,n,this.target),o=new Ba(this.scope,this.owner,s,this.validatorSet);this.owner.pushHandler(o)}startPartitionGroupRule(t,e,n){let s=new Va(this.scope,t,e,n,this.target),o=new r(this.scope,this.owner,s,this.validatorSet);this.owner.pushHandler(o)}},Oa=class extends Li{constructor(t,e,n,s){super(t,e,n,s)}startPartitionRule(t,e,n){let s=new Rs(this.scope,t,e,n,this.target),o=new Ba(this.scope,this.owner,s,this.validatorSet);this.owner.pushHandler(o)}startPartitionGroupRule(t,e,n){let s=new Va(this.scope,t,e,n,this.target),o=new Fd(this.scope,this.owner,s,this.validatorSet);this.owner.pushHandler(o)}};function Jd(r){var n,s;let t=(n=r[\"writing-mode\"])==null?void 0:n.value,e=(s=r.direction)==null?void 0:s.value;return t===x.vertical_lr||t!==x.vertical_rl&&e!==x.rtl?\"ltr\":\"rtl\"}var DC={a10:{width:new P(26,\"mm\"),height:new P(37,\"mm\")},a9:{width:new P(37,\"mm\"),height:new P(52,\"mm\")},a8:{width:new P(52,\"mm\"),height:new P(74,\"mm\")},a7:{width:new P(74,\"mm\"),height:new P(105,\"mm\")},a6:{width:new P(105,\"mm\"),height:new P(148,\"mm\")},a5:{width:new P(148,\"mm\"),height:new P(210,\"mm\")},a4:{width:new P(210,\"mm\"),height:new P(297,\"mm\")},a3:{width:new P(297,\"mm\"),height:new P(420,\"mm\")},a2:{width:new P(420,\"mm\"),height:new P(594,\"mm\")},a1:{width:new P(594,\"mm\"),height:new P(841,\"mm\")},a0:{width:new P(841,\"mm\"),height:new P(1189,\"mm\")},b10:{width:new P(31,\"mm\"),height:new P(44,\"mm\")},b9:{width:new P(44,\"mm\"),height:new P(62,\"mm\")},b8:{width:new P(62,\"mm\"),height:new P(88,\"mm\")},b7:{width:new P(88,\"mm\"),height:new P(125,\"mm\")},b6:{width:new P(125,\"mm\"),height:new P(176,\"mm\")},b5:{width:new P(176,\"mm\"),height:new P(250,\"mm\")},b4:{width:new P(250,\"mm\"),height:new P(353,\"mm\")},b3:{width:new P(353,\"mm\"),height:new P(500,\"mm\")},b2:{width:new P(500,\"mm\"),height:new P(707,\"mm\")},b1:{width:new P(707,\"mm\"),height:new P(1e3,\"mm\")},b0:{width:new P(1e3,\"mm\"),height:new P(1414,\"mm\")},c10:{width:new P(28,\"mm\"),height:new P(40,\"mm\")},c9:{width:new P(40,\"mm\"),height:new P(57,\"mm\")},c8:{width:new P(57,\"mm\"),height:new P(81,\"mm\")},c7:{width:new P(81,\"mm\"),height:new P(114,\"mm\")},c6:{width:new P(114,\"mm\"),height:new P(162,\"mm\")},c5:{width:new P(162,\"mm\"),height:new P(229,\"mm\")},c4:{width:new P(229,\"mm\"),height:new P(324,\"mm\")},c3:{width:new P(324,\"mm\"),height:new P(458,\"mm\")},c2:{width:new P(458,\"mm\"),height:new P(648,\"mm\")},c1:{width:new P(648,\"mm\"),height:new P(917,\"mm\")},c0:{width:new P(917,\"mm\"),height:new P(1297,\"mm\")},\"jis-b10\":{width:new P(32,\"mm\"),height:new P(45,\"mm\")},\"jis-b9\":{width:new P(45,\"mm\"),height:new P(64,\"mm\")},\"jis-b8\":{width:new P(64,\"mm\"),height:new P(91,\"mm\")},\"jis-b7\":{width:new P(91,\"mm\"),height:new P(128,\"mm\")},\"jis-b6\":{width:new P(128,\"mm\"),height:new P(182,\"mm\")},\"jis-b5\":{width:new P(182,\"mm\"),height:new P(257,\"mm\")},\"jis-b4\":{width:new P(257,\"mm\"),height:new P(364,\"mm\")},\"jis-b3\":{width:new P(364,\"mm\"),height:new P(515,\"mm\")},\"jis-b2\":{width:new P(515,\"mm\"),height:new P(728,\"mm\")},\"jis-b1\":{width:new P(728,\"mm\"),height:new P(1030,\"mm\")},\"jis-b0\":{width:new P(1030,\"mm\"),height:new P(1456,\"mm\")},letter:{width:new P(8.5,\"in\"),height:new P(11,\"in\")},legal:{width:new P(8.5,\"in\"),height:new P(14,\"in\")},ledger:{width:new P(11,\"in\"),height:new P(17,\"in\")}},MC=new P(.24,\"pt\"),_y=new P(3,\"mm\"),_C=new P(10,\"mm\"),UC=new P(13,\"mm\");function Oi(r){let t={width:rn,height:an,bleed:X,bleedOffset:X,cropOffset:X},e=r.size;if(!(!e||e.value===x.auto)){let c=e.value,u,p;if(c.isSpaceList()?(u=c.values[0],p=c.values[1]):(u=c,p=null),u.isNumeric())t.width=u,t.height=p||u;else{let h=u.name&&DC[u.name.toLowerCase()];h&&(p&&p===x.landscape?(t.width=h.height,t.height=h.width):(t.width=h.width,t.height=h.height))}}let n=r.marks,s=r.bleed,o=n&&!U(n.value)?n.value:x.none,i=s&&!U(s.value)?s.value:x.auto;if(i===x.auto){if(o!==x.none){let c=!1;o.isSpaceList()?c=o.values.some(u=>u===x.crop):c=o===x.crop,c&&(t.bleed=new P(6,\"pt\"))}}else i.isNumeric()&&(t.bleed=i);let a=r[\"crop-offset\"],l=a&&!U(a.value)?a.value:x.auto;return l===x.auto?o!==x.none&&(t.bleedOffset=UC):l.isNumeric()&&(t.cropOffset=l),t}function ep(r,t){let e={},n=Math.max(0,r.bleed.num)*t.queryUnitSize(r.bleed.unit,!1),s=!r.cropOffset.num&&r.bleedOffset.num?r.bleedOffset.num*t.queryUnitSize(r.bleedOffset.unit,!1):Math.max(0,r.cropOffset.num*t.queryUnitSize(r.cropOffset.unit,!1)-n),o=n+s,i=r.width;i===rn?t.pref.defaultPaperSize?e.pageWidth=t.pref.defaultPaperSize.width*t.queryUnitSize(\"px\",!1):e.pageWidth=(t.pref.spreadView?Math.floor(t.viewportWidth/2)-t.pref.pageBorder:t.viewportWidth)-o*2:e.pageWidth=i.num*t.queryUnitSize(i.unit,!1);let a=r.height;return a===an?t.pref.defaultPaperSize?e.pageHeight=t.pref.defaultPaperSize.height*t.queryUnitSize(\"px\",!1):e.pageHeight=t.viewportHeight-o*2:e.pageHeight=a.num*t.queryUnitSize(a.unit,!1),e.bleed=n,e.bleedOffset=s,e.cropOffset=o,e}function Xf(r,t,e){let n=r.createElementNS(\"http://www.w3.org/2000/svg\",\"svg\");return n.setAttribute(\"width\",t),n.setAttribute(\"height\",e),n.style.position=\"absolute\",n}function Ii(r,t,e){e=e||\"polyline\";let n=r.createElementNS(\"http://www.w3.org/2000/svg\",e);return n.setAttribute(\"stroke\",\"#010101\"),n.setAttribute(\"stroke-width\",t),n.setAttribute(\"fill\",\"none\"),n}var Od=(s=>(s.TOP_LEFT=\"top left\",s.TOP_RIGHT=\"top right\",s.BOTTOM_LEFT=\"bottom left\",s.BOTTOM_RIGHT=\"bottom right\",s))(Od||{});function HC(r,t,e,n,s,o){let i=n;i<=s+2*$.mm&&(i=s+n/2);let a=Math.max(n,i),l=s+a+e/2,c=Xf(r,l,l),u=[[0,s+n],[n,s+n],[n,s+n-i]],p=u.map(g=>[g[1],g[0]]);(t===\"top right\"||t===\"bottom right\")&&(u=u.map(g=>[s+a-g[0],g[1]]),p=p.map(g=>[s+a-g[0],g[1]])),(t===\"bottom left\"||t===\"bottom right\")&&(u=u.map(g=>[g[0],s+a-g[1]]),p=p.map(g=>[g[0],s+a-g[1]]));let h=Ii(r,e);h.setAttribute(\"points\",u.map(g=>g.join(\",\")).join(\" \")),c.appendChild(h);let f=Ii(r,e);return f.setAttribute(\"points\",p.map(g=>g.join(\",\")).join(\" \")),c.appendChild(f),t.split(\" \").forEach(g=>{c.style[g]=`${o}px`}),c}var Vi=(s=>(s.TOP=\"top\",s.BOTTOM=\"bottom\",s.LEFT=\"left\",s.RIGHT=\"right\",s))(Vi||{});function zC(r,t,e,n,s){let o=n*2,i,a;t===\"top\"||t===\"bottom\"?(i=o,a=n):(i=n,a=o);let l=Xf(r,i,a),c=Ii(r,e);c.setAttribute(\"points\",`0,${a/2} ${i},${a/2}`),l.appendChild(c);let u=Ii(r,e);u.setAttribute(\"points\",`${i/2},0 ${i/2},${a}`),l.appendChild(u);let p=Ii(r,e,\"circle\");p.setAttribute(\"cx\",i/2),p.setAttribute(\"cy\",a/2),p.setAttribute(\"r\",n/4),l.appendChild(p);let h;switch(t){case\"top\":h=\"bottom\";break;case\"bottom\":h=\"top\";break;case\"left\":h=\"right\";break;case\"right\":h=\"left\";break}return Object.keys(Vi).forEach(f=>{let g=Vi[f];g===t?l.style[g]=`${s}px`:g!==h&&(l.style[g]=\"0\",l.style[`margin-${g}`]=\"auto\")}),l}function jf(r,t,e,n){let s=!1,o=!1,i=r.marks;if(i){let f=i.value;f instanceof q?f.values.forEach(g=>{g===x.crop?s=!0:g===x.cross&&(o=!0)}):f===x.crop?s=!0:f===x.cross&&(o=!0)}let a=t.bleed;if(!s&&!o)return;let l=e.container,c=l.ownerDocument;let u=Ae(MC,n),p=Math.max(0,t.bleedOffset-Ae(_C,n)),h=t.bleedOffset-p;s&&Object.keys(Od).forEach(f=>{let g=Od[f],m=HC(c,g,u,h,a,p);l.appendChild(m)}),o&&Object.keys(Vi).forEach(f=>{let g=Vi[f],m=zC(c,g,u,h,p);l.appendChild(m)})}var Dd=(()=>{let r=[\"left\",\"right\",\"top\",\"bottom\",\"before\",\"after\",\"start\",\"end\",\"block-start\",\"block-end\",\"inline-start\",\"inline-end\"],t={width:!0,height:!0,\"block-size\":!0,\"inline-size\":!0,margin:!0,padding:!0,border:!0,outline:!0,\"outline-width\":!0,\"outline-style\":!0,\"outline-color\":!0};return r.forEach(e=>{t[`margin-${e}`]=!0,t[`padding-${e}`]=!0,t[`border-${e}-width`]=!0,t[`border-${e}-style`]=!0,t[`border-${e}-color`]=!0}),t})();var tp={\"top-left-corner\":{order:1,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},\"top-left\":{order:2,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:\"start\"},\"top-center\":{order:3,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:\"center\"},\"top-right\":{order:4,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:\"end\"},\"top-right-corner\":{order:5,isInTopRow:!0,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},\"right-top\":{order:6,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:\"start\"},\"right-middle\":{order:7,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:\"center\"},\"right-bottom\":{order:8,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:\"end\"},\"bottom-right-corner\":{order:9,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!0,positionAlongVariableDimension:null},\"bottom-right\":{order:10,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:\"end\"},\"bottom-center\":{order:11,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:\"center\"},\"bottom-left\":{order:12,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!1,isInRightColumn:!1,positionAlongVariableDimension:\"start\"},\"bottom-left-corner\":{order:13,isInTopRow:!1,isInBottomRow:!0,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:null},\"left-bottom\":{order:14,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:\"end\"},\"left-middle\":{order:15,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:\"center\"},\"left-top\":{order:16,isInTopRow:!1,isInBottomRow:!1,isInLeftColumn:!0,isInRightColumn:!1,positionAlongVariableDimension:\"start\"}},GC=(()=>{let r=tp;return Object.keys(r).sort((t,e)=>r[t].order-r[e].order)})(),Ha=\"vivliostyle-page-rule-master\",Fi=\"_marginBoxes\",Md=class extends vo{constructor(e,n,s){super(e,null,Ha,[],n,null,0);d(this,\"bodyPartitionKey\");d(this,\"pageMarginBoxes\",{});let o=Oi(s),i=new _d(this.scope,this,s,o);this.bodyPartitionKey=i.key,this.createPageMarginBoxes(s),this.applySpecified(s,o)}createPageMarginBoxes(e){let n=e[Fi];n&&GC.forEach(s=>{n[s]&&(this.pageMarginBoxes[s]=new Ud(this.scope,this,s,e))})}applySpecified(e,n){this.specified.position=new M(x.relative,0),this.specified.width=new M(n.width,0),this.specified.height=new M(n.height,0);for(let s in e)!Dd[s]&&s!==\"background-clip\"&&(this.specified[s]=e[s])}createInstance(e){return new Vs(e,this)}},_d=class extends Rs{constructor(e,n,s,o){super(e,null,null,[],n);this.pageSize=o;this.specified[\"z-index\"]=new M(new ct(0),0),this.applySpecified(s)}applySpecified(e){this.specified[\"flow-from\"]=new M(L(\"body\"),0),this.specified.position=new M(x.absolute,0),this.specified.overflow=new M(x.visible,0);for(let n in Dd)Dd.hasOwnProperty(n)&&(this.specified[n]=e[n])}createInstance(e){return new Bi(e,this)}},Ud=class extends Rs{constructor(e,n,s,o){super(e,null,null,[],n);this.marginBoxName=s;this.applySpecified(o)}applySpecified(e){let n=e[Fi][this.marginBoxName];for(let s in e){let o=e[s],i=n[s];(ku[s]||i&&i.value===x.inherit)&&(this.specified[s]=o)}for(let s in n)if(Object.prototype.hasOwnProperty.call(n,s)){let o=n[s];o&&o.value!==O&&o.value!==x.inherit&&o.value!==x.unset&&o.value!==x.revert&&(this.specified[s]=o)}}createInstance(e){return new zd(e,this)}},Vs=class extends Is{constructor(e,n){super(e,n);d(this,\"pageAreaDimension\",null);d(this,\"pageMarginBoxInstances\",{})}applyCascadeAndInit(e,n){let s=this.cascaded;for(let o in n)if(Object.prototype.hasOwnProperty.call(n,o))switch(o){case\"writing-mode\":case\"direction\":s[o]=n[o]}super.applyCascadeAndInit(e,n)}initHorizontal(){let e=this.style;e.left=X,e[\"margin-left\"]=X,e[\"border-left-width\"]=X,e[\"padding-left\"]=X,e[\"padding-right\"]=X,e[\"border-right-width\"]=X,e[\"margin-right\"]=X,e.right=X}initVertical(){let e=this.style;e.top=X,e[\"margin-top\"]=X,e[\"border-top-width\"]=X,e[\"padding-top\"]=X,e[\"padding-bottom\"]=X,e[\"border-bottom-width\"]=X,e[\"margin-bottom\"]=X,e.bottom=X}setPageAreaDimension(e){this.pageAreaDimension=e;let n=this.style;n.width=new F(e.borderBoxWidth),n.height=new F(e.borderBoxHeight),n[\"padding-left\"]=new F(e.marginLeft),n[\"padding-right\"]=new F(e.marginRight),n[\"padding-top\"]=new F(e.marginTop),n[\"padding-bottom\"]=new F(e.marginBottom)}adjustPageLayout(e,n,s){let o=n.marginBoxes,i={start:this.pageAreaDimension.marginLeft,end:this.pageAreaDimension.marginRight,extent:this.pageAreaDimension.borderBoxWidth},a={start:this.pageAreaDimension.marginTop,end:this.pageAreaDimension.marginBottom,extent:this.pageAreaDimension.borderBoxHeight};this.sizeMarginBoxesAlongVariableDimension(o.top,!0,i,e,s),this.sizeMarginBoxesAlongVariableDimension(o.bottom,!0,i,e,s),this.sizeMarginBoxesAlongVariableDimension(o.left,!1,a,e,s),this.sizeMarginBoxesAlongVariableDimension(o.right,!1,a,e,s)}sizeMarginBoxesAlongVariableDimension(e,n,s,o,i){let a=\"start\",l=\"center\",c=\"end\",u=this.pageBox.scope,p={},h={},f={};for(let S in e){let w=tp[S];if(w){let A=e[S],I=this.pageMarginBoxInstances[S],_=new Da(A,I.style,n,u,i);p[w.positionAlongVariableDimension]=A,h[w.positionAlongVariableDimension]=I,f[w.positionAlongVariableDimension]=_}}let g={start:s.start.evaluate(o),end:s.end.evaluate(o),extent:s.extent.evaluate(o)},m=this.getSizesOfMarginBoxesAlongVariableDimension(f,g.extent),E=!1,C={};Object.keys(p).forEach(S=>{let w=S,A=ee(u,h[w].style[n?\"max-width\":\"max-height\"],s.extent);if(A){let I=A.evaluate(o);if(m[w]>I){let _=f[w]=new Ma(p[w],h[w].style,n,u,i,I);C[w]=_.getOuterSize(),E=!0}}}),E&&(m=this.getSizesOfMarginBoxesAlongVariableDimension(f,g.extent),E=!1,[a,l,c].forEach(S=>{m[S]=C[S]||m[S]}));let b={};Object.keys(p).forEach(S=>{let w=S,A=ee(u,h[w].style[n?\"min-width\":\"min-height\"],s.extent);if(A){let I=A.evaluate(o);if(m[w]<I){let _=f[w]=new Ma(p[w],h[w].style,n,u,i,I);b[w]=_.getOuterSize(),E=!0}}}),E&&(m=this.getSizesOfMarginBoxesAlongVariableDimension(f,g.extent),[a,l,c].forEach(S=>{m[S]=b[S]||m[S]}));let y=g.start+g.extent,N=g.start+(g.start+g.extent);[a,l,c].forEach(S=>{let w=m[S];if(w){let A=p[S],I=0;switch(S){case a:I=n?A.left:A.top;break;case l:I=(N-w)/2;break;case c:I=y-w;break}n?A.setHorizontalPosition(I,w-A.getInsetLeft()-A.getInsetRight()):A.setVerticalPosition(I,w-A.getInsetTop()-A.getInsetBottom())}})}getSizesOfMarginBoxesAlongVariableDimension(e,n){let s=e.start,o=e.center,i=e.end,a={};if(o){let l=[s,i].filter(f=>f),c=l.length?new Hd(l):null,u=this.distributeAutoMarginBoxSizes(o,c,n);u.xSize&&(a.center=u.xSize);let p=u.xSize||o.getOuterSize(),h=(n-p)/2;s&&s.hasAutoSize()&&(a.start=h),i&&i.hasAutoSize()&&(a.end=h)}else{let l=this.distributeAutoMarginBoxSizes(s,i,n);l.xSize&&(a.start=l.xSize),l.ySize&&(a.end=l.ySize)}return a}distributeAutoMarginBoxSizes(e,n,s){let o={xSize:null,ySize:null};if(e&&n)if(e.hasAutoSize()&&n.hasAutoSize()){let i=e.getOuterMaxContentSize(),a=n.getOuterMaxContentSize();if(i>0&&a>0){let l=i+a;if(l<s)o.xSize=s*i/l;else{let c=e.getOuterMinContentSize(),u=n.getOuterMinContentSize(),p=c+u;p<s?o.xSize=c+(s-p)*(i-c)/(l-p):p>0&&(o.xSize=s*c/p)}o.xSize>0&&(o.ySize=s-o.xSize)}else i>0?o.xSize=s:a>0&&(o.ySize=s)}else e.hasAutoSize()?o.xSize=Math.max(s-n.getOuterSize(),0):n.hasAutoSize()&&(o.ySize=Math.max(s-e.getOuterSize(),0));else e?e.hasAutoSize()&&(o.xSize=s):n&&n.hasAutoSize()&&(o.ySize=s);return o}prepareContainer(e,n,s,o,i){super.prepareContainer(e,n,s,o,i),n.element.setAttribute(\"data-vivliostyle-page-box\",!0)}},Da=class{constructor(t,e,n,s,o){this.container=t;this.isHorizontal=n;this.clientLayout=o;d(this,\"hasAutoSize_\");d(this,\"size\",null);let i=e[n?\"width\":\"height\"];this.hasAutoSize_=!i||i===x.auto||U(i)}hasAutoSize(){return this.hasAutoSize_}getSize(){if(!this.size){let t=this.isHorizontal?[\"max-content width\",\"min-content width\"]:[\"max-content height\",\"min-content height\"];this.size=so(this.clientLayout,this.container.element,t)}return this.size}getOuterMaxContentSize(){let t=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+t[\"max-content width\"]+this.container.getInsetRight():this.container.getInsetTop()+t[\"max-content height\"]+this.container.getInsetBottom()}getOuterMinContentSize(){let t=this.getSize();return this.isHorizontal?this.container.getInsetLeft()+t[\"min-content width\"]+this.container.getInsetRight():this.container.getInsetTop()+t[\"min-content height\"]+this.container.getInsetBottom()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.container.width+this.container.getInsetRight():this.container.getInsetTop()+this.container.height+this.container.getInsetBottom()}},Hd=class{constructor(t){this.params=t}hasAutoSize(){return this.params.some(t=>t.hasAutoSize())}getOuterMaxContentSize(){let t=this.params.map(e=>e.getOuterMaxContentSize());return Math.max.apply(null,t)*t.length}getOuterMinContentSize(){let t=this.params.map(e=>e.getOuterMinContentSize());return Math.max.apply(null,t)*t.length}getOuterSize(){let t=this.params.map(e=>e.getOuterSize());return Math.max.apply(null,t)*t.length}},Ma=class extends Da{constructor(e,n,s,o,i,a){super(e,n,s,o,i);d(this,\"fixedSize\");this.fixedSize=a}hasAutoSize(){return!1}getOuterMaxContentSize(){return this.getOuterSize()}getOuterMinContentSize(){return this.getOuterSize()}getOuterSize(){return this.isHorizontal?this.container.getInsetLeft()+this.fixedSize+this.container.getInsetRight():this.container.getInsetTop()+this.fixedSize+this.container.getInsetBottom()}},Bi=class extends En{constructor(e,n){super(e,n);d(this,\"borderBoxWidth\",null);d(this,\"borderBoxHeight\",null);d(this,\"marginTop\",null);d(this,\"marginRight\",null);d(this,\"marginBottom\",null);d(this,\"marginLeft\",null)}applyCascadeAndInit(e,n){let s=this.cascaded;for(let i in n)Object.prototype.hasOwnProperty.call(n,i)&&(i.match(/^column.*$/)||i.match(/^background-/))&&(s[i]=n[i]);super.applyCascadeAndInit(e,n),this.parentInstance.setPageAreaDimension({borderBoxWidth:this.borderBoxWidth,borderBoxHeight:this.borderBoxHeight,marginTop:this.marginTop,marginRight:this.marginRight,marginBottom:this.marginBottom,marginLeft:this.marginLeft})}initHorizontal(){let e=this.resolvePageBoxDimensions({start:\"left\",end:\"right\",extent:\"width\"});this.borderBoxWidth=e.borderBoxExtent,this.marginLeft=e.marginStart,this.marginRight=e.marginEnd}initVertical(){let e=this.resolvePageBoxDimensions({start:\"top\",end:\"bottom\",extent:\"height\"});this.borderBoxHeight=e.borderBoxExtent,this.marginTop=e.marginStart,this.marginBottom=e.marginEnd}resolvePageBoxDimensions(e){let n=this.style,s=this.pageBox.pageSize,o=this.pageBox.scope,i=e.start,a=e.end,l=e.extent,c=s[l].toExpr(o,null),u=ee(o,n[l],c),p=ee(o,n[`margin-${i}`],c),h=ee(o,n[`margin-${a}`],c),f=nt(o,n[`padding-${i}`],c),g=nt(o,n[`padding-${a}`],c),m=Ht(o,n[`border-${i}-width`],n[`border-${i}-style`],c),E=Ht(o,n[`border-${a}-width`],n[`border-${a}-style`],c),C=K(o,c,H(o,H(o,m,f),H(o,E,g)));return u?(C=K(o,C,u),!p&&!h?(p=$s(o,C,new se(o,.5)),h=p):p?h=K(o,C,p):p=K(o,C,h)):(p||(p=o.zero),h||(h=o.zero),u=K(o,C,H(o,p,h))),s.width!==rn||s.height!==an||this.hasBorderOrOutline()||p instanceof at&&p.num<0||h instanceof at&&h.num<0?(n[i]=new F(p),n[a]=new F(h),n[`margin-${i}`]=X,n[`margin-${a}`]=X,n[`border-${i}-width`]=new F(m),n[`border-${a}-width`]=new F(E)):(n[i]=X,n[a]=X,n[`margin-${i}`]=X,n[`margin-${a}`]=X,n[`border-${i}-width`]=new F(p),n[`border-${a}-width`]=new F(h),n[`border-${i}-style`]=x.solid,n[`border-${a}-style`]=x.solid,n[`border-${i}-color`]=x.transparent,n[`border-${a}-color`]=x.transparent,n[\"background-clip\"]=x.padding_box),n[`padding-${i}`]=new F(f),n[`padding-${a}`]=new F(g),n[l]=new F(u),n[`max-${l}`]=new F(u),{borderBoxExtent:K(o,c,H(o,p,h)),marginStart:p,marginEnd:h}}hasBorderOrOutline(){let e=n=>{var o;let s=(o=de(this.cascaded,n))==null?void 0:o.value;return!!s&&s!==x.none};return e(\"border-top-style\")||e(\"border-bottom-style\")||e(\"border-left-style\")||e(\"border-right-style\")||e(\"border-block-start-style\")||e(\"border-block-end-style\")||e(\"border-inline-start-style\")||e(\"border-inline-end-style\")||e(\"outline-style\")}prepareContainer(e,n,s,o,i){s.pageAreaElement=n.element,super.prepareContainer(e,n,s,o,i),e.pageAreaWidth=parseFloat(s.pageAreaElement.style.width),e.pageAreaHeight=parseFloat(s.pageAreaElement.style.height)}},zd=class extends En{constructor(e,n){super(e,n);d(this,\"boxInfo\");d(this,\"suppressEmptyBoxGeneration\",!0);let s=n.marginBoxName;this.boxInfo=tp[s];let o=e;o.pageMarginBoxInstances[s]=this}prepareContainer(e,n,s,o,i){this.applyVerticalAlign(e,n.element),super.prepareContainer(e,n,s,o,i)}applyVerticalAlign(e,n){T(n,\"display\",\"flex\"),T(n,\"flex-flow\",this.vertical?this.rtl?\"row-reverse\":\"row\":\"column\");let s=this.getProp(e,\"vertical-align\"),o=null;s===L(\"middle\")?o=\"center\":s===L(\"top\")?o=\"flex-start\":s===L(\"bottom\")&&(o=\"flex-end\"),o&&T(n,\"justify-content\",o);let i=this.getProp(e,\"content\");if(this.vertical||i instanceof Ue||i instanceof F&&i.expr instanceof oe&&i.expr.str.startsWith(\"running-element-\")){let a=\"center\";(this.boxInfo.isInTopRow||this.boxInfo.isInBottomRow)&&(this.boxInfo.isInLeftColumn||this.boxInfo.positionAlongVariableDimension===\"end\"?a=this.vertical||this.rtl?\"start\":\"end\":(this.boxInfo.isInRightColumn||this.boxInfo.positionAlongVariableDimension===\"start\")&&(a=this.vertical||this.rtl?\"end\":\"start\")),T(n,\"align-items\",a)}}positionAlongVariableDimension(e,n){let s=this.style,o=this.pageBox.scope,i=e.start,a=e.end,l=e.extent,c=i===\"left\",u=c?n.borderBoxWidth:n.borderBoxHeight,p=ee(o,s[l],u),h=c?n.marginLeft:n.marginTop;if(this.boxInfo.positionAlongVariableDimension===\"start\")s[i]=new F(h);else if(p){let f=nt(o,s[`margin-${i}`],u),g=nt(o,s[`margin-${a}`],u),m=nt(o,s[`padding-${i}`],u),E=nt(o,s[`padding-${a}`],u),C=Ht(o,s[`border-${i}-width`],s[`border-${i}-style`],u),b=Ht(o,s[`border-${a}-width`],s[`border-${a}-style`],u),y=H(o,p,H(o,H(o,m,E),H(o,H(o,C,b),H(o,f,g))));switch(this.boxInfo.positionAlongVariableDimension){case\"center\":s[i]=new F(H(o,h,Go(o,K(o,u,y),new se(o,2))));break;case\"end\":s[i]=new F(K(o,H(o,h,u),y));break}}}positionAndSizeAlongFixedDimension(e,n){let s=this.style,o=this.pageBox.scope,i=e.inside,a=e.outside,l=e.extent,c=n[`margin${a.charAt(0).toUpperCase()}${a.substring(1)}`],u=Bd(o,s[`margin-${i}`],c),p=Bd(o,s[`margin-${a}`],c),h=nt(o,s[`padding-${i}`],c),f=nt(o,s[`padding-${a}`],c),g=Ht(o,s[`border-${i}-width`],s[`border-${i}-style`],c),m=Ht(o,s[`border-${a}-width`],s[`border-${a}-style`],c),E=ee(o,s[l],c),C=null;function b(y){if(C)return C;C={extent:E?E.evaluate(y):null,marginInside:u?u.evaluate(y):null,marginOutside:p?p.evaluate(y):null};let N=c.evaluate(y),S=0;return[g,h,f,m].forEach(w=>{w&&(S+=w.evaluate(y))}),(C.marginInside===null||C.marginOutside===null)&&S+C.extent+C.marginInside+C.marginOutside>N&&(C.marginInside===null&&(C.marginInside=0),C.marginOutside===null&&(C.marginOutside=0)),C.extent!==null&&C.marginInside!==null&&C.marginOutside!==null&&(C.marginOutside=null),C.extent===null&&C.marginInside!==null&&C.marginOutside!==null?C.extent=N-S-C.marginInside-C.marginOutside:C.extent!==null&&C.marginInside===null&&C.marginOutside!==null?C.marginInside=N-S-C.extent-C.marginOutside:C.extent!==null&&C.marginInside!==null&&C.marginOutside===null?C.marginOutside=N-S-C.extent-C.marginInside:C.extent===null?(C.marginInside=C.marginOutside=0,C.extent=N-S):C.marginInside=C.marginOutside=(N-S-C.extent)/2,C}s[l]=new F(new oe(o,function(){let y=b(this).extent;return y===null?0:y},l)),s[`margin-${i}`]=new F(new oe(o,function(){let y=b(this).marginInside;return y===null?0:y},`margin-${i}`)),s[`margin-${a}`]=new F(new oe(o,function(){let y=b(this).marginOutside;return y===null?0:y},`margin-${a}`)),i===\"left\"?s.left=new F(H(o,n.marginLeft,n.borderBoxWidth)):i===\"top\"&&(s.top=new F(H(o,n.marginTop,n.borderBoxHeight)))}initHorizontal(){let n=this.parentInstance.pageAreaDimension;this.boxInfo.isInLeftColumn?this.positionAndSizeAlongFixedDimension({inside:\"right\",outside:\"left\",extent:\"width\"},n):this.boxInfo.isInRightColumn?this.positionAndSizeAlongFixedDimension({inside:\"left\",outside:\"right\",extent:\"width\"},n):this.positionAlongVariableDimension({start:\"left\",end:\"right\",extent:\"width\"},n)}initVertical(){let n=this.parentInstance.pageAreaDimension;this.boxInfo.isInTopRow?this.positionAndSizeAlongFixedDimension({inside:\"bottom\",outside:\"top\",extent:\"height\"},n):this.boxInfo.isInBottomRow?this.positionAndSizeAlongFixedDimension({inside:\"top\",outside:\"bottom\",extent:\"height\"},n):this.positionAlongVariableDimension({start:\"top\",end:\"bottom\",extent:\"height\"},n)}finishContainer(e,n,s,o,i,a,l){super.finishContainer(e,n,s,o,i,a,l);let c=s.marginBoxes,u=this.pageBox.marginBoxName,p=this.boxInfo;!p.isInLeftColumn&&!p.isInRightColumn?p.isInTopRow?c.top[u]=n:p.isInBottomRow&&(c.bottom[u]=n):!p.isInTopRow&&!p.isInBottomRow&&(p.isInLeftColumn?c.left[u]=n:p.isInRightColumn&&(c.right[u]=n))}},_a=class{constructor(t,e,n,s,o){this.cascadeInstance=t;this.pageScope=e;this.rootPageBoxInstance=n;this.context=s;this.docElementStyle=o;d(this,\"pageMasterCache\",{});this.definePageProgression()}definePageProgression(){let t=this.pageScope,e=this.context,n=e.isVersoFirstPage,s=new le(t,\"page-number\"),o=new Pn(t,new Gs(t,s,new se(t,2)),n?t.one:t.zero);t.defineName(\"recto-page\",new mt(t,o)),t.defineName(\"verso-page\",o),(e.pageProgression||Jd(this.docElementStyle))===\"ltr\"?(t.defineName(\"left-page\",o),t.defineName(\"right-page\",new mt(t,o))):(t.defineName(\"left-page\",new mt(t,o)),t.defineName(\"right-page\",o))}getCascadedPageStyle(t){let e={};return this.cascadeInstance.pushRule([],t,e),this.cascadeInstance.popRule(),e}getPageRulePageMaster(t,e){let n=t.pageBox;if(Object.keys(e).length===0)return n.resetScope(),t;let s=this.makeCacheKey(e,n),o=this.pageMasterCache[s];return o||(n.pseudoName===Ri?o=this.generatePageRuleMaster(e):o=this.generateCascadedPageMaster(e,n),this.pageMasterCache[s]=o),o.pageBox.resetScope(),o}makeCacheKey(t,e){let n=this.makeCascadeValueObjectKey(t);return`${e.key}^${n}`}makeCascadeValueObjectKey(t){let e=[];for(let n in t)if(Object.prototype.hasOwnProperty.call(t,n)){let s=t[n],o;s instanceof M?o=`${s.value}`:o=this.makeCascadeValueObjectKey(s),e.push(n+o+(s.priority||\"\"))}return e.sort().join(\"^\")}generatePageRuleMaster(t){let n=new Md(this.pageScope,this.rootPageBoxInstance.pageBox,t).createInstance(this.rootPageBoxInstance);return n.applyCascadeAndInit(this.cascadeInstance,this.docElementStyle),n.resolveAutoSizing(this.context),n}generateCascadedPageMaster(t,e){let n=e.clone({pseudoName:Ha}),s=n.specified,o=t.size;if(o&&!U(o.value)){let a=Oi(t),l=o.priority;tn(s,\"width\",new M(a.width,l),this.context),tn(s,\"height\",new M(a.height,l),this.context)}[\"counter-reset\",\"counter-increment\"].forEach(a=>{s[a]&&(t[a]=s[a])});let i=n.createInstance(this.rootPageBoxInstance);return i.applyCascadeAndInit(this.cascadeInstance,this.docElementStyle),i.resolveAutoSizing(this.context),i}},Gd=class extends Z{constructor(e){super();this.pageType=e}apply(e){e.currentPageType===this.pageType&&this.chained.apply(e)}getPriority(){return 3}makePrimary(e){return this.chained&&e.insertInTable(e.pagetypes,this.pageType,this.chained),!0}},Wd=class extends Z{constructor(e){super();this.scope=e}apply(e){new le(this.scope,\"page-number\").evaluate(e.context)===1&&this.chained.apply(e)}getPriority(){return 2}},$d=class extends Z{constructor(e){super();this.scope=e}apply(e){new le(this.scope,\"blank-page\").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 2}},Xd=class extends Z{constructor(e){super();this.scope=e}apply(e){new le(this.scope,\"left-page\").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},jd=class extends Z{constructor(e){super();this.scope=e}apply(e){new le(this.scope,\"right-page\").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},Yd=class extends Z{constructor(e){super();this.scope=e}apply(e){new le(this.scope,\"recto-page\").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},Kd=class extends Z{constructor(e){super();this.scope=e}apply(e){new le(this.scope,\"verso-page\").evaluate(e.context)&&this.chained.apply(e)}getPriority(){return 1}},qd=class extends Gn{constructor(e,n,s){super(n,s);this.scope=e;this.a=n;this.b=s}apply(e){let n=e.context,s=n.layoutPositionAtPageStart.page;n.blankPageAtStart&&s--,s&&this.matchANPlusB(s)&&this.chained.apply(e)}getPriority(){return 2}},Zd=class extends Es{constructor(t,e){super(t,e,null,null,null)}apply(t){WC(t.context,t.currentStyle,this.style,this.specificity,t)}};function WC(r,t,e,n,s){pi(r,t,e,n,null,null,null);let o=e[Fi];if(o){let i=bo(t,Fi);for(let a in o)if(o.hasOwnProperty(a)){let l=i[a];l||(l={},i[a]=l),pi(r,l,o[a],n,null,null,null)}}}var Ua=class extends bn{constructor(e,n,s,o,i){super(e,n,s==null?void 0:s.condition,s,null,o,!1);this.pageProps=i;d(this,\"currentPageSelectors\",[]);d(this,\"currentNamedPageSelector\",\"\");d(this,\"currentPseudoPageClassSelectors\",[])}startPageRule(){this.startSelectorRule()}tagSelector(e,n){this.currentNamedPageSelector=n,n&&(this.chain.push(new Gd(n)),this.specificity+=65536)}pseudoclassSelector(e,n){if(e=e.toLowerCase(),n)switch(e){case\"nth\":{let[s,o]=n;this.currentPseudoPageClassSelectors.push(`:${e}(${s}n${o<0?o:\"+\"+o})`),this.chain.push(new qd(this.scope,s,o)),this.specificity+=256}break;default:this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}(${n.join(\"\")})`);break}else switch(this.currentPseudoPageClassSelectors.push(`:${e}`),e){case\"first\":this.chain.push(new Wd(this.scope)),this.specificity+=256;break;case\"blank\":this.chain.push(new $d(this.scope)),this.specificity+=256;break;case\"left\":this.chain.push(new Xd(this.scope)),this.specificity+=1;break;case\"right\":this.chain.push(new jd(this.scope)),this.specificity+=1;break;case\"recto\":this.chain.push(new Yd(this.scope)),this.specificity+=1;break;case\"verso\":this.chain.push(new Kd(this.scope)),this.specificity+=1;break;default:this.reportAndSkip(`E_INVALID_PAGE_SELECTOR :${e}`);break}}finishSelector(){let e;!this.currentNamedPageSelector&&!this.currentPseudoPageClassSelectors.length?e=null:e=[this.currentNamedPageSelector].concat(this.currentPseudoPageClassSelectors.sort()),this.currentPageSelectors.push({selectors:e,specificity:this.specificity}),this.currentNamedPageSelector=\"\",this.currentPseudoPageClassSelectors=[]}nextSelector(){this.finishSelector(),super.nextSelector()}startRuleBody(){this.finishSelector(),super.startRuleBody()}simpleProperty(e,n,s){if((e===\"bleed\"||e===\"marks\")&&!this.currentPageSelectors.some(a=>a.selectors===null))return;super.simpleProperty(e,n,s);let o=de(this.elementStyle,e),i=this.pageProps;if(e===\"bleed\"||e===\"marks\")i[\"\"]||(i[\"\"]={}),Object.keys(i).forEach(a=>{mn(i[a],e,o)});else if(e===\"size\"){let a=i[\"\"];this.currentPageSelectors.forEach(l=>{let c=new M(o.value,o.priority+l.specificity),u=l.selectors?l.selectors.join(\"\"):\"\",p=i[u];p?tn(p,e,c):(p=i[u]={},mn(p,e,c),a&&[\"bleed\",\"marks\"].forEach(h=>{a[h]&&mn(p,h,a[h])}))})}}insertNonPrimary(e){this.cascade.insertInTable(this.cascade.pagetypes,\"*\",e)}makeApplyRuleAction(e){return new Zd(this.elementStyle,e)}startPageMarginBoxRule(e){let n=bo(this.elementStyle,Fi),s=n[e];s||(s={},n[e]=s);let o=new Qd(this.scope,this.owner,this.validatorSet,s);this.owner.pushHandler(o)}},Qd=class extends qt{constructor(e,n,s,o){super(e,n,!1);this.validatorSet=s;this.boxStyle=o}property(e,n,s){this.validatorSet.validatePropertyAndHandleShorthand(e,n,s,this)}invalidPropertyValue(e,n){this.report(`E_INVALID_PROPERTY_VALUE ${e}: ${n.toString()}`)}unknownProperty(e,n){this.report(`E_INVALID_PROPERTY ${e}: ${n.toString()}`)}simpleProperty(e,n,s){let o=s?this.getImportantSpecificity():this.getBaseSpecificity(),i=new M(n,o);mn(this.boxStyle,e,i)}};var Rt=!0;function Kf(r){Rt=r}var Fs=[];function Yf(r,t){return r===t||(r.src||t.src?r.src===t.src:r.textContent===t.textContent)}function qf(r){let t=Array.from(r.querySelectorAll(\"body > :not(script):not(link):not(style) ~ script\"));return Array.from(r.querySelectorAll(\"head > script, body > script\")).filter(e=>!t.includes(e))}function za(r,t,e){var u,p;if(!Rt)return v(!1);if(!(e!=null&&e.inHead)&&!(e!=null&&e.atEnd)&&qf(r.ownerDocument).includes(r))return v(!1);let n=r.textContent,s=r.src,o=r.type===\"module\",i=(o||s)&&r.async,a=o&&!i||s&&r.defer,l=!(e!=null&&e.atEnd)&&((e==null?void 0:e.forceDefer)||a||i);if(np(t)||(t.onload=null),l)return Fs.some(h=>Yf(h,r))||Fs.push(r),v(!0);if(s.includes(\"/mathjax\")){let h=t.document.head.querySelector(\"script[src*='MathJax.js']:not([data-vivliostyle-scripting])\");if(h){if(s.includes(\"/mathjax@3\"))t.document.head.removeChild(h),(p=(u=t.MathJax)==null?void 0:u.version)!=null&&p.startsWith(\"2.\")&&delete t.MathJax;else if(s.includes(\"/MathJax.js\"))return v(!0)}}for(let h of t.document.head.getElementsByTagName(\"script\"))h.hasAttribute(\"data-vivliostyle-scripting\")&&Yf(h,r)&&t.document.head.removeChild(h);let c=t.document.createElement(\"script\");c.textContent=n,s&&(c.src=s),c.async=i,c.defer=a,c.setAttribute(\"data-vivliostyle-scripting\",\"true\");for(let h of r.attributes)[\"src\",\"async\",\"defer\"].includes(h.name)||c.setAttribute(h.name,h.value);if(V.debug(\"script:\",s),s){let h=Ln(c);return t.document.head.appendChild(c),An([h])}else return t.document.head.appendChild(c),v(!0)}function XC(r,t){var o;let e={},n=i=>{var c;let a=(c=i[\"font-family\"])==null?void 0:c.value;if(a)if(a.values)for(let u of a.values)e[u.stringValue()]=!0;else e[a.stringValue()]=!0;let l=i._marginBoxes;if(l)for(let u of Object.values(l))n(u)},s=i=>{if(i instanceof Es)n(i.style);else if(i instanceof Cn||Array.isArray(i))for(let a of Object.values(i))s(a)};for(let i of Object.values(t.cascade.code))for(let a of Object.values(i!=null?i:{}))s(a);for(let i of r.querySelectorAll(\"[style]\"))(o=i.style)!=null&&o.fontFamily&&(e[i.style.fontFamily]=!0);return Object.keys(e).join(\",\")}function jC(r,t,e){var s;let n=(s=t.document.querySelector(\"[data-vivliostyle-textcontent]\"))!=null?s:t.document.createElement(\"div\");return n.style.position=\"fixed\",n.style.fontSize=\"0\",n.setAttribute(\"data-vivliostyle-textcontent\",\"true\"),n.setAttribute(\"aria-hidden\",\"true\"),n.style.fontFamily=XC(r,e),n.textContent=r.documentElement.textContent,t.document.body.appendChild(n),n}function Zf(r,t,e){if(!Rt)return v(!1);let n=qf(r);if(n.length===0)return v(!1);let s=n.some(u=>!(u.async||u.defer||u.type===\"module\")),o=s?jC(r,t,e):null,i=t.document.fonts,a=t.$,l=!1,c=k(\"loadScripts\");return c.loop(()=>{if(n.length===0)return s?c.sleep(20).thenAsync(()=>{var p,h;return i.status===\"loading\"||t.document.documentElement.classList.contains(\"wf-loading\")||(p=t.FontJSON)!=null&&p.Font&&((h=t.ret)!=null&&h.readyState)&&t.ret.readyState<4?v(!0):v(!1)}):v(!1);let u=n.shift();return za(u,t,{inHead:!0,forceDefer:l}).thenAsync(()=>(!l&&t.$!==a&&(Fs.push(u),l=!0),n.length===0&&s&&(V.debug(\"dispatchEvent: DOMContentLoaded (document)\"),t.document.dispatchEvent(new Event(\"DOMContentLoaded\"))),v(!0)))}).then(()=>{o&&o.remove(),c.finish(!0)}),c.result()}function Qf(r){if(!Rt)return v(!1);let t=k(\"loadScripts\");return t.loop(()=>Fs.length===0?v(!1):za(Fs.shift(),r,{atEnd:!0}).thenReturn(Fs.length>0)).then(()=>{V.debug(\"dispatchEvent: DOMContentLoaded (window)\"),r.dispatchEvent(new Event(\"DOMContentLoaded\")),V.debug(\"dispatchEvent: load (window)\"),r.dispatchEvent(new Event(\"load\")),t.finish(!0)}),t.result()}function np(r){return Rt?Fs.length>0||!!r.document.head.querySelector(\"script[data-vivliostyle-scripting]\"):!1}var Jf=(r,t,e)=>r.replace(/[uU][rR][lL]\\(\\s*\"((\\\\([^0-9a-fA-F]+|[0-9a-fA-F]+\\s*)|[^\"\\r\\n])+)\"/gm,(n,s)=>`url(\"${e.transformURL(s,t)}\"`).replace(/[uU][rR][lL]\\(\\s*'((\\\\([^0-9a-fA-F]+|[0-9a-fA-F]+\\s*)|[^'\\r\\n])+)'/gm,(n,s)=>`url('${e.transformURL(s,t)}'`).replace(/[uU][rR][lL]\\(\\s*((\\\\([^0-9a-fA-F]+|[0-9a-fA-F]+\\s*)|[^\"'\\r\\n\\)\\s])+)/gm,(n,s)=>`url(${e.transformURL(s,t)}`);var KC={};function qC(r){r.addEventListener(\"load\",()=>{r.contentWindow.navigator.epubReadingSystem={name:\"adapt\",version:\"0.1\",layoutStyle:\"paginated\",hasFeature:function(t,e){switch(t){case\"mouse-events\":return!0}return!1}}},!1)}var Di=class Di extends Nn{constructor(e,n,s,o,i,a,l,c,u,p,h,f,g){super();this.flowName=e;this.context=n;this.viewport=s;this.styler=o;this.regionIds=i;this.xmldoc=a;this.docFaces=l;this.footnoteStyle=c;this.stylerProducer=u;this.page=p;this.customRenderer=h;this.fallbackMap=f;this.documentURLTransformer=g;d(this,\"document\");d(this,\"exprContentListener\");d(this,\"nodeContext\",null);d(this,\"viewRoot\",null);d(this,\"isFootnote\",!1);d(this,\"sourceNode\",null);d(this,\"offsetInNode\",0);d(this,\"viewNode\",null);this.document=s.document,this.exprContentListener=o.counterListener.getExprContentListener()}clone(){return new Di(this.flowName,this.context,this.viewport,this.styler,this.regionIds,this.xmldoc,this.docFaces,this.footnoteStyle,this.stylerProducer,this.page,this.customRenderer,this.fallbackMap,this.documentURLTransformer)}createPseudoelementShadow(e,n,s,o,i,a,l,c){let u=this.getPseudoMap(s,this.regionIds,this.isFootnote,this.nodeContext,a);if(!u)return c;let p=[],h=xo.createElementNS(\"http://www.pyroxy.com/ns/shadow\",\"root\"),f=h;for(let m of hf){let E;if(m){if(!u[m]||m==\"footnote-marker\"&&!(n&&this.isFootnote))continue;if(m.match(/^first-/)){let C=o.display;if(!C||C===x.inline)continue;let b=e.firstElementChild;if(b&&he(b.previousSibling)){let y=i.getStyle(b,!1);if(y){let N=de(y,\"display\");if(N!=null&&N.value&&N.value!==x.inline)continue}}}if(m===\"before\"||m===\"after\"){let C=u[m].content;if(!C||!St(C.value))continue}p.push(m),E=xo.createElementNS(\"http://www.w3.org/1999/xhtml\",\"span\"),gi(E,m)}else E=xo.createElementNS(\"http://www.pyroxy.com/ns/shadow\",\"content\");f.appendChild(E),m.match(/^first-/)&&(f=E)}if(!p.length)return c;let g=new fi(e,s,i,a,this.exprContentListener);return new fs(e,h,null,l,c,Et.ROOTLESS,g)}getPseudoMap(e,n,s,o,i){let a=Nt(e,\"_pseudos\");if(!a)return null;let l={};for(let c in a){let u=l[c]={};yo(u,a[c],i),ra(u,i,a[c]),Bu(a[c],n,s,(p,h)=>{yo(u,h,i),Fu(h,f=>{yo(u,f,i)})})}return l}createRefShadow(e,n,s,o,i){let a=k(\"createRefShadow\");return this.xmldoc.store.load(e).then(l=>{let c=l;if(c){let u=c.getElement(e);if(u){let p=this.stylerProducer.getStylerForDoc(c);i=new fs(s,u,c,o,i,n,p)}}a.finish(i)}),a.result()}createShadows(e,n,s,o,i,a,l){let c=k(\"createShadows\"),u=null,p=o.template,h;if(p instanceof Ue||p===x.footnote){let f=p instanceof Ue?p.url:J(\"user-agent.xml#footnote\",Wt);h=this.createRefShadow(f,Et.ROOTLESS,e,l,u)}else h=v(u);return h.then(f=>{let g=null;if(e.namespaceURI==\"http://www.pyroxy.com/ns/shadow\"&&e.localName==\"include\"){let E=e.getAttribute(\"href\"),C=null;E?C=l?l.xmldoc:this.xmldoc:l&&(l.owner.namespaceURI==\"http://www.w3.org/1999/xhtml\"?E=l.owner.getAttribute(\"href\"):E=l.owner.getAttributeNS(\"http://www.w3.org/1999/xlink\",\"href\"),C=l.parentShadow?l.parentShadow.xmldoc:this.xmldoc),E&&(E=J(E,C.url),g=this.createRefShadow(E,Et.ROOTED,e,l,f))}g==null&&(g=v(f));let m=null;g.then(E=>{if(o.display===x.table_cell){let C=J(\"user-agent.xml#table-cell\",Wt);m=this.createRefShadow(C,Et.ROOTLESS,e,l,E)}else m=v(E);m.then(C=>{C=this.createPseudoelementShadow(e,n,s,o,i,a,l,C),c.finish(C)})})}),c.result()}setViewRoot(e,n){this.viewRoot=e,this.isFootnote=n}computeStyle(e,n,s,o){var E;let i=this.context,a=ha(s,i,this.regionIds,this.isFootnote,this.nodeContext),l=!((E=this.nodeContext)!=null&&E.parent);l&&(!a[\"writing-mode\"]&&this.styler.rootStyle[\"writing-mode\"]&&(a[\"writing-mode\"]=this.styler.rootStyle[\"writing-mode\"]),!a.direction&&this.styler.rootStyle.direction&&(a.direction=this.styler.rootStyle.direction));let c=e;e=da(a,i,e);let u=!l&&e!==c;if(n=pa(a,i,n),fa(a,o,e,n,(C,b)=>{let y;u&&(e?/^(min-|max-)?(height|inline-size)$/.test(C)&&(y=i.pageAreaHeight):/^(min-|max-)?(width|inline-size)$/.test(C)&&(y=i.pageAreaWidth));let N=b.evaluate(i,C,y,e);return C==\"font-family\"&&(N=this.docFaces.filterFontFamily(N)),N}),u){let C=o[e?\"height\":\"width\"];(!C||C===x.auto)&&(o[e?\"height\":\"width\"]=x.max_content)}if(si(o.position))return o.position=x.fixed,o.visibility=x.hidden,e;let h=o.position,f=o.float,g=o.display||(this.sourceNode.namespaceURI===\"http://www.w3.org/1999/xhtml\"?x.inline:void 0),m=Bc(g,h,f,this.sourceNode===this.xmldoc.root);return[\"display\",\"position\",\"float\"].forEach(C=>{m[C]&&(o[C]=m[C])}),e}inheritFromSourceParent(e){let n=this.nodeContext.sourceNode,s=[],o=null,i=this.nodeContext.shadowContext,a=-1;for(;n&&n.nodeType==1;){let h=i&&i.root==n;if(!h||i.type==Et.ROOTLESS){let g=(i?i.styler:this.styler).getStyle(n,!1);s.push(g),o=o||Vo(n)}h?(n=i.owner,i=i.parentShadow):(n=n.parentNode,a++)}let l=a===0,c=this.context.queryUnitSize(\"em\",l),u={\"font-size\":new M(new P(c,\"px\"),0)},p=new ta(u,this.context);for(let h=s.length-1;h>=0;--h){let f=s[h],g=[];for(let C in f)Wn(C)&&g.push(C);g.sort(Ol);let m,E;for(let C of g){p.setPropName(C);let b=de(f,C),y=b;U(b.value)||(C===\"font-size\"&&h===s.length-1&&this.context.isRelativeRootFontSize&&this.context.rootFontSize?y=new M(new P(this.context.rootFontSize,\"px\"),b.priority):C===\"line-height\"&&h===s.length-1&&this.context.rootLineHeight&&b.value instanceof P&&(b.value.unit===\"lh\"||b.value.unit===\"rlh\")?y=new M(new P(this.context.rootLineHeight,\"px\"),b.priority):h===0&&b.value instanceof P&&b.value.unit===\"lh\"?y=new M(new P(b.value.num*this.getLineHeightUnitSize(C,m,E),\"px\"),b.priority):bt(C)||(y=b.filterValue(p)),C===\"font-size\"?m=y.value:C===\"line-height\"&&(E=y.value),u[C]=y)}}for(let h in e)Wn(h)||(u[h]=e[h]);return{lang:o,elementStyle:u}}resolveURL(e){return e=J(e,this.xmldoc.url),this.fallbackMap[e]||e}inheritLangAttribute(){this.nodeContext.lang=Vo(this.nodeContext.sourceNode)||this.nodeContext.parent&&this.nodeContext.parent.lang||this.nodeContext.lang}transferPolyfilledInheritedProps(e){let n=Xh().filter(s=>e[s]);if(n.length){let s=this.nodeContext.inheritedProps;if(this.nodeContext.parent){s=this.nodeContext.inheritedProps={};for(let o in this.nodeContext.parent.inheritedProps)s[o]=this.nodeContext.parent.inheritedProps[o]}n.forEach(o=>{let i=e[o];if(i){if(U(i))i===x.initial&&(s[o]=void 0);else if(i instanceof ct)s[o]=i.num;else if(i instanceof Be)s[o]=i.name;else if(i instanceof P){let a=i;switch(a.unit){case\"dpi\":case\"dpcm\":case\"dppx\":s[o]=a.num*$[a.unit];break;default:s[o]=i}}else s[o]=i;[\"widows\",\"orphans\"].includes(o)||delete e[o]}})}}resolveFormattingContext(e,n,s,o,i,a){let l=$e(\"RESOLVE_FORMATTING_CONTEXT\");for(let c=0;c<l.length;c++){let u=l[c](e,n,s,o,i,a);if(u){e.formattingContext=u;return}}}createElementView(e,n){var C,b,y,N;let s=!0,o=k(\"createElementView\"),i=this.sourceNode,a=this.nodeContext.shadowContext?this.nodeContext.shadowContext.styler:this.styler,l=a.getStyle(i,!1);if(!this.nodeContext.shadowContext){let S=this.xmldoc.getElementOffset(i);zn.registerFragmentIndex(S,this.nodeContext.fragmentIndex,0)}let c={};if(!this.nodeContext.parent){let S=this.inheritFromSourceParent(l);l=S.elementStyle,this.nodeContext.lang=S.lang}let u=l.position,p=l.float,h=l[\"float-reference\"],f=p&&!U(p.value)&&p.value!==x.none&&h&&!U(h.value)?Vh(h.value.toString()):null;if(this.nodeContext.parent&&(si(u==null?void 0:u.value)||f&&Dn(f))){let S=this.inheritFromSourceParent(l);l=S.elementStyle,this.nodeContext.lang=S.lang}this.nodeContext.vertical=this.computeStyle(this.nodeContext.vertical,this.nodeContext.direction===\"rtl\",l,c),f&&Dn(f)&&c.display===x.block&&(c.display=x.flow_root),a.processContent(i,c,(b=this.nodeContext.viewNode)!=null?b:(C=this.nodeContext.parent)==null?void 0:C.viewNode),this.transferPolyfilledInheritedProps(c),this.inheritLangAttribute(),c.direction&&(this.nodeContext.direction=c.direction.toString());let g=c[\"flow-into\"];if(g&&g.toString()!=this.flowName)return o.finish(!1),o.result();if(Rt&&i.localName===\"script\"&&i.namespaceURI===\"http://www.w3.org/1999/xhtml\")return za(i,this.viewport.window).thenFinish(o),o.result();let m=c.display;if(U(m)&&(m===x.initial||m===x.unset?m=x.inline:m===x.inherit?m=((y=this.nodeContext.parent)==null?void 0:y.display)&&L((N=this.nodeContext.parent)==null?void 0:N.display):m=null),m===x.none)return o.finish(!1),o.result();let E=this.nodeContext.parent==null;return this.nodeContext.flexContainer=m===x.flex,this.createShadows(i,E,l,c,a,this.context,this.nodeContext.shadowContext).then(S=>{var gp,mp;this.nodeContext.nodeShadow=S;let w=c.position,A=c.float,I=c.clear,_=this.nodeContext.vertical?x.vertical_rl:x.horizontal_tb,Ee=this.nodeContext.parent?this.nodeContext.parent.vertical?x.vertical_rl:x.horizontal_tb:_,Q=Bh(i);this.nodeContext.establishesBFC=Oh(m,w,A,c.overflow,_,Ee,Q),this.nodeContext.containingBlockForAbsolute=Dh(w),this.nodeContext.isInsideBFC()&&A!==x.footnote&&!(f&&Dn(f))&&(A=null,I=null);let re=A instanceof q||A===x.left||A===x.right||A===x.top||A===x.bottom||A===x.inline_start||A===x.inline_end||A===x.block_start||A===x.block_end||A===x.snap_block||A===x.snap_inline||A===x.footnote;A&&(delete c.float,A===x.footnote&&(this.isFootnote?(re=!1,c.display=x.block):c.display=x.inline)),I&&(I===x.inherit&&this.nodeContext.parent&&this.nodeContext.parent.clearSide&&(I=L(this.nodeContext.parent.clearSide)),(I===x.left||I===x.right||I===x.top||I===x.bottom||I===x.inline_start||I===x.inline_end||I===x.block_start||I===x.block_end||I===x.both||I===x.all||I===x.same)&&(delete c.clear,c.display&&c.display!=x.inline&&(this.nodeContext.clearSide=I.toString())));let Te=m===x.list_item&&c[\"ua-list-item-count\"],Ge=c[\"break-inside\"];(re||Ge&&!U(Ge)&&Ge!==x.auto)&&this.nodeContext.breakPenalty++,m&&m!==x.inline&&pn(m)&&this.nodeContext.breakPenalty++,this.nodeContext.inline=!re&&!m||pn(m)||Yr(m),this.nodeContext.display=m?m.toString():\"inline\",this.nodeContext.floatSide=re?A.toString():null,this.nodeContext.floatReference=f||ue.INLINE;let R=c[\"float-min-wrap-block\"];this.nodeContext.floatMinWrapBlock=R&&!U(R)?R:null;let G=this.isInsideNonRootMultiColumn(),B=c[\"column-span\"];if(this.nodeContext.columnSpan=!G&&B&&!U(B)?B:null,!this.nodeContext.inline){let D=c[\"break-after\"];D&&!U(D)&&!(G&&D===x.column)&&(this.nodeContext.breakAfter=D.toString(),Vr[this.nodeContext.breakAfter]&&delete c[\"break-after\"]);let st=c[\"break-before\"];st&&!U(st)&&!(G&&st===x.column)&&(this.nodeContext.fragmentIndex===1&&(this.nodeContext.breakBefore=st.toString()),Vr[this.nodeContext.breakBefore]&&delete c[\"break-before\"]);let vt=c.page,ot=vt&&!U(vt)&&vt.toString();!ot&&!this.nodeContext.parent&&(this.nodeContext.shadowContext||m===x.table_header_group||m===x.table_footer_group)&&(ot=this.styler.cascade.currentPageType),!ot||ot.toLowerCase()===\"auto\"?ot=this.nodeContext.pageType:this.nodeContext.pageType=ot,this.styler.cascade.currentPageType!==ot&&!(!ot&&c.position===x.fixed)&&(this.nodeContext.fragmentIndex===1&&!In(this.nodeContext.breakBefore)&&(this.nodeContext.breakBefore=\"page\"),ot!==this.styler.cascade.previousPageType&&(this.styler.cascade.previousPageType=this.styler.cascade.currentPageType),this.styler.cascade.currentPageType=ot)}this.nodeContext.verticalAlign=c[\"vertical-align\"]&&c[\"vertical-align\"].toString()||\"baseline\",this.nodeContext.captionSide=c[\"caption-side\"]&&c[\"caption-side\"].toString()||\"top\";let z=c[\"border-collapse\"];if(!z||z===L(\"separate\")){let D=c[\"border-spacing\"],st,vt;D&&(D instanceof q?(st=D.values[0],vt=D.values[1]):st=vt=D,st.isNumeric()&&(this.nodeContext.inlineBorderSpacing=Ae(st,this.context)),vt.isNumeric()&&(this.nodeContext.blockBorderSpacing=Ae(vt,this.context)))}let j=c[\"footnote-policy\"];this.nodeContext.footnotePolicy=j&&!U(j)?j:null;let fe=c[\"x-first-pseudo\"];if(fe){let D=this.nodeContext.parent?this.nodeContext.parent.firstPseudo:null;this.nodeContext.firstPseudo=new _r(D,fe.num)}this.nodeContext.inline||this.processAfterIfcontinues(i,l,a,this.context);let qn=c[\"white-space\"];if(qn){let D=Gr(qn.toString());D!==null&&(this.nodeContext.whitespace=D)}let Po=c[\"hyphenate-character\"];Po&&Po instanceof ce&&(this.nodeContext.hyphenateCharacter=Po.str);let dg=c[\"word-break\"],pg=c[\"line-break\"],fp=c[\"overflow-wrap\"];(dg===x.break_all||pg===x.anywhere||fp===x.break_word||fp===x.anywhere)&&(this.nodeContext.breakWord=!0),this.resolveFormattingContext(this.nodeContext,e,m,w,A,E),this.nodeContext.parent&&this.nodeContext.parent.formattingContext&&(e=this.nodeContext.parent.formattingContext.isFirstTime(this.nodeContext,e)),this.nodeContext.inline||(this.nodeContext.repeatOnBreak=this.processRepeatOnBreak(c),this.findAndProcessRepeatingElements(i,a));let Zn=!1,ol=null,ko=[],It=i.namespaceURI,Y=i.localName;if(It==\"http://www.w3.org/1999/xhtml\"?(Y==\"html\"||Y==\"body\"||Y==\"script\"||Y==\"link\"||Y==\"meta\"?Y=\"div\":Y==\"vide_\"?Y=\"video\":Y==\"audi_\"?Y=\"audio\":Y==\"object\"&&(Zn=!!this.customRenderer),i.getAttribute(ga)&&(mp=(gp=l.content)==null?void 0:gp.value)!=null&&mp.url&&(Y=\"img\")):It==\"http://www.idpf.org/2007/ops\"?(Y=\"span\",It=\"http://www.w3.org/1999/xhtml\"):It==\"http://www.pyroxy.com/ns/shadow\"?(It=\"http://www.w3.org/1999/xhtml\",Y=this.nodeContext.inline?\"span\":\"div\"):Zn=!!this.customRenderer,Te)e?Y=\"li\":(Y=\"div\",m=x.block,c.display=m);else if(Y==\"body\"||Y==\"li\")Y=\"div\";else if(Y==\"q\")Y=\"span\";else if(Y==\"a\"){let D=c[\"hyperlink-processing\"];D&&D.toString()!=\"normal\"&&(Y=\"span\")}c.behavior&&c.behavior.toString()!=\"none\"&&this.customRenderer&&(Zn=!0),i.dataset&&i.getAttribute(\"data-math-typeset\")===\"true\"&&(Zn=!0);let il;if(Zn){let D=this.nodeContext.parent?this.nodeContext.parent.viewNode:null;il=this.customRenderer(i,D,c)}else il=v(null);il.then(D=>{if(D)Zn&&(s=D.getAttribute(\"data-adapt-process-children\")==\"true\");else if(c.display===x.none){o.finish(!1);return}else D=this.createElement(It,Y);Y==\"a\"&&D.addEventListener(\"click\",this.page.hrefHandler,!1),ol&&(this.applyPseudoelementStyle(this.nodeContext,\"inner\",ol),D.appendChild(ol)),D.localName==\"iframe\"&&D.namespaceURI==\"http://www.w3.org/1999/xhtml\"&&qC(D);let st=this.nodeContext.inheritedProps[\"image-resolution\"],vt=[],ot=c.width,rl=c.height,hg=i.getAttribute(\"width\"),fg=i.getAttribute(\"height\"),al=ot===x.auto||!ot&&!hg,ll=rl===x.auto||!rl&&!fg,Cp=i.attributes,gg=Cp.length,Gi=null,bp=null;for(let Tt=0;Tt<gg;Tt++){let zt=Cp[Tt],it=zt.namespaceURI,te=zt.localName,pe=zt.nodeValue;if(it){if(it==\"http://www.w3.org/2000/xmlns/\")continue;it==\"http://www.w3.org/1999/xlink\"&&te==\"href\"&&(pe=this.documentURLTransformer.transformURL(this.resolveURL(pe),this.xmldoc.url))}else{if(!Rt&&te.match(/^on/)||te==\"style\")continue;if((te==\"id\"||te==\"name\")&&e){let We=this.documentURLTransformer.transformFragment(pe,this.xmldoc.url);if(Rt&&D.localName!==\"tr\"&&!(D.namespaceURI===\"http://www.w3.org/2000/svg\"&&D.localName!==\"svg\")&&!D.ownerDocument.getElementById(pe)){D.setAttribute(te,pe),D.setAttribute(\"data-vivliostyle-id\",We);let ht=D.ownerDocument.createElement(\"a\");ht.setAttribute(te,We),ht.setAttribute(Mt,\"1\"),ht.style.position=\"absolute\",D.appendChild(ht)}else D.setAttribute(te,We);this.page.registerElementWithId(D,We);continue}if(te==\"src\"||te==\"href\"||te==\"poster\")pe=this.resolveURL(pe),te===\"href\"&&(pe=this.documentURLTransformer.transformURL(pe,this.xmldoc.url));else if(te==\"srcset\")pe=pe.split(\",\").map(We=>this.resolveURL(We.trim())).join(\",\");else if(te===\"data\"&&Zn&&Y===\"object\"&&D.hasAttribute(\"data\"))continue;if(te===\"poster\"&&Y===\"video\"&&It===\"http://www.w3.org/1999/xhtml\"&&al&&ll){let We=new Image,ht=Ln(We,pe);ko.push(ht),vt.push({image:We,element:D,fetcher:ht})}}if(It==\"http://www.w3.org/2000/svg\"&&/^[A-Z\\-]+$/.test(te)&&(te=te.toLowerCase()),this.isSVGUrlAttribute(te)&&(pe=Jf(pe,this.xmldoc.url,this.documentURLTransformer)),it){let We=KC[it];We&&(te=`${We}:${te}`)}if(te==\"src\"&&!it&&(Y==\"img\"||Y==\"input\")&&It==\"http://www.w3.org/1999/xhtml\")Gi=pe;else if(te==\"alt\"&&!it&&Y==\"img\"&&It==\"http://www.w3.org/1999/xhtml\")bp=pe;else if(te==\"href\"&&Y==\"image\"&&It==\"http://www.w3.org/2000/svg\"&&it==\"http://www.w3.org/1999/xlink\")this.page.fetchers.push(Ln(D,pe));else if(it)D.setAttributeNS(it,te,pe);else try{D.setAttribute(te,pe)}catch(We){V.warn(We)}}if(Gi){let Tt=Y===\"input\"?new Image:D,zt=Ln(Tt,Gi,bp);Tt!==D&&(D.src=Gi);let it=()=>{var pe,We;if(c.position===x.fixed)return!0;for(let ht=(pe=this.nodeContext.parent)==null?void 0:pe.viewNode;ht&&ht!==this.viewRoot;ht=ht.parentElement)if(((We=ht.style)==null?void 0:We.position)===\"fixed\")return!0;return!1};!al&&!ll&&!(()=>{let pe=this.nodeContext.vertical?ot:rl;return pe instanceof P&&pe.unit===\"%\"})()&&!it()?this.page.fetchers.push(zt):(al&&ll&&st&&st!==1&&vt.push({image:Tt,element:D,fetcher:zt}),ko.push(zt))}delete c.content;let cl=c[\"list-style-image\"];if(cl&&cl instanceof Ue){let Tt=cl.url;ko.push(Ln(new Image,Tt))}if(this.preprocessElementStyle(c),this.applyComputedStyles(D,c),this.nodeContext.inline)e||(dt(D,\"inline-start\"),ps(D)&&dt(D,\"clone\"));else if(!e)dt(D,\"block-start\"),ps(D)&&dt(D,\"clone\"),Ir(D,\"block-start\");else if(!Xr(c.position)){let Tt=c[\"margin-break\"],zt=this.getBreakTypeAt(this.nodeContext),it=zt!==null,te=zt===\"auto\";(Tt===x.discard&&it||Tt!==x.keep&&te&&!this.nodeContext.floatSide)&&Ir(D,\"block-start\")}Te&&D.setAttribute(\"value\",c[\"ua-list-item-count\"].stringValue()),this.viewNode=D,ko.length?An(ko).then(()=>{st>0&&this.modifyElemDimensionWithImageResolution(vt,st,c,this.nodeContext.vertical),o.finish(s)}):o.timeSlice().then(()=>{o.finish(s)})})}),o.result()}isInsideNonRootMultiColumn(){var e;for(let n=(e=this.nodeContext.parent)==null?void 0:e.viewNode;n;n=n.parentNode){let s=n.nodeType===1?n.style:null;if(!s)break;if(!isNaN(parseFloat(s.columnCount))||!isNaN(parseFloat(s.columnWidth)))return!0;if(s.position===\"absolute\")break}return!1}getBreakTypeAt(e){var s,o,i,a,l;for(let c=e;c&&!c.after;c=c.parent){if(De(c.breakBefore))return c.breakBefore;if(c.fragmentIndex===1&&!c.parent)return c.sourceNode===c.sourceNode.ownerDocument.documentElement?\"page\":null;if((s=c.parent)!=null&&s.floatSide)return null;let u=(o=c.parent)==null?void 0:o.viewNode;if(u){let p=this.viewport.window.getComputedStyle(u),h=parseFloat(p.paddingBlockStart),f=parseFloat(p.borderBlockStartWidth);if(h||f)return null;let g=u==null?void 0:u.firstChild;for(;g&&(he(g,c.parent.whitespace)||!c.floatSide&&co(g));)g=g.nextSibling;if(g&&g!==c.viewNode)return null}}let n=(l=(a=(i=this.context)==null?void 0:i.currentLayoutPosition)==null?void 0:a.flowPositions[this.flowName])==null?void 0:l.startBreakType;return De(n)?n:\"auto\"}processAfterIfcontinues(e,n,s,o){let i=this.getPseudoMap(n,this.regionIds,this.isFootnote,this.nodeContext,o);if(i&&i[\"after-if-continues\"]&&i[\"after-if-continues\"].content){let a=new fi(e,n,s,o,this.exprContentListener);this.nodeContext.afterIfContinues=new ma(e,a)}}isSVGUrlAttribute(e){return Di.SVG_URL_ATTRIBUTES.includes(e.toLowerCase())}modifyElemDimensionWithImageResolution(e,n,s,o){e.forEach(i=>{if(i.fetcher.get().get()===\"load\"){let a=i.image,l=a.width/n,c=a.height/n,u=i.element;if(l>0&&c>0){if(s[\"box-sizing\"]===x.border_box&&(s[\"border-left-style\"]!==x.none&&(l+=Ae(s[\"border-left-width\"],this.context)),s[\"border-right-style\"]!==x.none&&(l+=Ae(s[\"border-right-width\"],this.context)),s[\"border-top-style\"]!==x.none&&(c+=Ae(s[\"border-top-width\"],this.context)),s[\"border-bottom-style\"]!==x.none&&(c+=Ae(s[\"border-bottom-width\"],this.context))),n>1){let p=s[\"max-width\"]||x.none,h=s[\"max-height\"]||x.none;if(p===x.none&&h===x.none)T(u,\"max-width\",`${l}px`);else if(p!==x.none&&h===x.none)T(u,\"width\",`${l}px`);else if(p===x.none&&h!==x.none)T(u,\"height\",`${c}px`);else{p.isNumeric(),h.isNumeric();let f=p,g=h;f.unit!==\"%\"?T(u,\"max-width\",`${Math.min(l,Ae(f,this.context))}px`):g.unit!==\"%\"?T(u,\"max-height\",`${Math.min(c,Ae(g,this.context))}px`):o?T(u,\"height\",`${c}px`):T(u,\"width\",`${l}px`)}}else if(n<1){let p=s[\"min-width\"]||X,h=s[\"min-height\"]||X;p.isNumeric(),p.isNumeric();let f=p,g=h;f.num===0&&g.num===0?T(u,\"min-width\",`${l}px`):f.num!==0&&g.num===0?T(u,\"width\",`${l}px`):f.num===0&&g.num!==0?T(u,\"height\",`${c}px`):f.unit!==\"%\"?T(u,\"min-width\",`${Math.max(l,Ae(f,this.context))}px`):g.unit!==\"%\"?T(u,\"min-height\",`${Math.max(c,Ae(g,this.context))}px`):o?T(u,\"height\",`${c}px`):T(u,\"width\",`${l}px`)}}}})}preprocessElementStyle(e){$e(\"PREPROCESS_ELEMENT_STYLE\").forEach(s=>{s(this.nodeContext,e)})}findAndProcessRepeatingElements(e,n){for(let s=e.firstChild;s;s=s.nextSibling){if(s.nodeType!==1)continue;let o={},i=n.getStyle(s,!1);if(this.computeStyle(this.nodeContext.vertical,this.nodeContext.direction===\"rtl\",i,o),!this.processRepeatOnBreak(o))continue;if(this.nodeContext.formattingContext instanceof Ut&&!this.nodeContext.belongsTo(this.nodeContext.formattingContext))return;let l=this.nodeContext.parent,c=l&&l.formattingContext;this.nodeContext.formattingContext=new Ut(c,this.nodeContext.sourceNode),this.nodeContext.formattingContext.initializeRepetitiveElements(this.nodeContext.vertical);return}}processRepeatOnBreak(e){let n=e[\"repeat-on-break\"];return n!==x.none&&((n===x.auto||U(n))&&(e.display===x.table_header_group?n=x.header:e.display===x.table_footer_group?n=x.footer:n=x.none),n&&n!==x.none)?n.toString():null}createTextNodeView(){let e=k(\"createTextNodeView\");return this.preprocessTextContent().then(()=>{let n=this.offsetInNode||0,s=Pc(this.nodeContext.preprocessedTextContent).substr(n);this.viewNode=document.createTextNode(s),e.finish(!0)}),e.result()}preprocessTextContent(){if(this.nodeContext.preprocessedTextContent!=null)return v(!0);let e,n=e=this.sourceNode.textContent,s=k(\"preprocessTextContent\"),o=$e(\"PREPROCESS_TEXT_CONTENT\"),i=0;return s.loop(()=>i>=o.length?v(!1):o[i++](this.nodeContext,n).thenAsync(a=>(n=a,v(!0)))).then(()=>{this.nodeContext.preprocessedTextContent=Sh(e,n),s.finish(!0)}),s.result()}createNodeView(e,n){let s=k(\"createNodeView\"),o,i=!0;return this.sourceNode.nodeType==1?o=this.createElementView(e,n):this.sourceNode.nodeType==8?(this.viewNode=null,o=v(!0)):o=this.createTextNodeView(),o.then(a=>{var l;if(i=a,this.nodeContext.viewNode=this.viewNode,this.viewNode){let c=(h,f)=>(h==null?void 0:h.nodeType)===1&&vs(h)===f,u=this.nodeContext.parent,p=u?c(this.viewNode,\"after\")&&c(u.viewNode,\"first-letter\")&&((l=u.viewNode)!=null&&l.hasChildNodes())?u.parent.viewNode:u.viewNode:this.viewRoot;p&&(this.nodeContext.inline&&!(this.viewNode.nodeType===3&&he(this.viewNode))&&!p.hasChildNodes()&&Ec(p).includes(\"block-start\")&&dt(p,\"text-start\"),p.appendChild(this.viewNode))}s.finish(i)}),s.result()}setCurrent(e,n,s){return this.nodeContext=e,e?(this.sourceNode=e.sourceNode,this.offsetInNode=e.offsetInNode):(this.sourceNode=null,this.offsetInNode=-1),this.viewNode=null,this.nodeContext?this.createNodeView(n,!!s):v(!0)}processShadowContent(e){if(e.shadowContext==null||e.sourceNode.localName!=\"content\"||e.sourceNode.namespaceURI!=\"http://www.pyroxy.com/ns/shadow\")return e;let n=e.boxOffset,s=e.shadowContext,o=e.parent,i,a,l=s.subShadow||s.parentShadow;s.subShadow?(i=s.root,a=s.type,a==Et.ROOTLESS&&(i=i.firstChild)):(i=s.owner.firstChild,a=Et.ROOTLESS);let c=e.sourceNode.nextSibling;if(c?(e.sourceNode=c,e.resetView()):e.shadowSibling?e=e.shadowSibling:i?e=null:(e=e.parent.modify(),e.after=!0),i){let u=new On(i,o,n);return u.shadowContext=l,u.shadowType=a,u.shadowSibling=e,u}return e.boxOffset=n,e}nextPositionInTree(e){let n=e.boxOffset+1;if(e.after){if(!e.parent)return null;if(e.shadowType!=Et.ROOTED){let s=e.sourceNode.nextSibling;if(s)return e=e.modify(),e.boxOffset=n,e.sourceNode=s,e.resetView(),this.processShadowContent(e)}return e.shadowSibling?(e=e.shadowSibling.modify(),e.boxOffset=n,e):(e=e.parent.modify(),e.boxOffset=n,e.after=!0,e)}else{if(e.nodeShadow){let o=e.nodeShadow.root;if(e.nodeShadow.type==Et.ROOTLESS&&(o=o.firstChild),o){let i=new On(o,e,n);return i.shadowContext=e.nodeShadow,i.shadowType=e.nodeShadow.type,this.processShadowContent(i)}}let s=e.sourceNode.firstChild;if(s)return this.processShadowContent(new On(s,e,n));if(e.sourceNode.nodeType!=1){let o=Pc(e.preprocessedTextContent);n+=o.length-1-e.offsetInNode}return e=e.modify(),e.boxOffset=n,e.after=!0,e}}isTransclusion(e,n,s){let o=de(n,\"hyperlink-processing\");if(!o)return!1;let i=o.evaluate(this.context,\"hyperlink-processing\");return i?i.toString()==s:!1}nextInTree(e,n){let s=this.nextPositionInTree(e);if(!s||s.after)return v(s);let o=k(\"nextInTree\");return this.setCurrent(s,!0,n).then(i=>{(!s.viewNode||!i)&&(s=s.modify(),s.after=!0,s.viewNode||(s.inline=!0)),this.dispatchEvent({type:\"nextInTree\",nodeContext:s}),o.finish(s)}),o.result()}addImageFetchers(e){if(e instanceof ge){let n=e.values;for(let s=0;s<n.length;s++)this.addImageFetchers(n[s])}else if(e instanceof Ue){let n=e.url;this.page.fetchers.push(Ln(new Image,n))}}applyComputedStyles(e,n){var u,p,h;let s=n[\"background-image\"];s&&this.addImageFetchers(s);let o=n.position===x.relative,i=((u=this.nodeContext)==null?void 0:u.parent)===null&&((p=this.sourceNode)==null?void 0:p.parentElement)===null&&!!((h=this.viewRoot)!=null&&h.parentElement),a=Object.keys(n);a.sort(Ol);let l,c;for(let f of a){if(ZC[f])continue;let g=n[f];if(!(!g||g===O&&!bt(f))){if(g=g.visit(new Er(this.xmldoc.url,this.documentURLTransformer)),g instanceof P&&fr(g.unit)&&(g.unit===\"lh\"?g=new P(g.num*this.getLineHeightUnitSize(f,l,c),\"px\"):g=Cr(g,this.context)),f===\"font-size\"?l=g:f===\"line-height\"&&(c=g),wh[f]||o&&Ph[f]){this.page.delayedItems.push(new Bn(e,f,g));continue}i&&this.page.pageAreaElement&&Wn(f)?T(this.page.pageAreaElement.parentElement,f,g.toString()):T(e,f,g.toString())}}}getLineHeightUnitSize(e,n,s){var u,p,h,f;let o=$.lh/$.em,i=((p=(u=this.nodeContext.parent)==null?void 0:u.viewNode)==null?void 0:p.nodeType)===1?this.viewport.window.getComputedStyle(this.nodeContext.parent.viewNode):null,a=i?parseFloat(i.fontSize):this.context.fontSize(),l=i?i.lineHeight===\"normal\"?a*o:parseFloat(i.lineHeight):this.context.rootLineHeight;if(e===\"line-height\"||e===\"font-size\")return l;let c=null;if(s){if(s instanceof et||s instanceof P&&(s.unit===\"em\"||s.unit===\"%\"))c=s instanceof P&&s.unit===\"%\"?s.num/100:s.num;else if(s instanceof P)return s.num*this.context.queryUnitSize(s.unit,!1)}else for(let g=(h=this.nodeContext.parent)==null?void 0:h.viewNode;;g=g.parentNode){if(!g||g.nodeType!==1){c=o;break}let m=(f=g==null?void 0:g.style)==null?void 0:f.lineHeight;if(m){/^[0-9.]+$/.test(m)&&(c=parseFloat(m)),m===\"normal\"&&(c=o);break}}return c!==null?n instanceof P?c*Iu(n,a,this.context).num:c*a:l}applyPseudoelementStyle(e,n,s){if(e.after)return;let o=this.sourceNode,a=(e.shadowContext?e.shadowContext.styler:this.styler).getStyle(o,!1),l=Nt(a,\"_pseudos\");if(!l||(a=l[n],!a))return;let c={};e.vertical=this.computeStyle(e.vertical,e.direction===\"rtl\",a,c);let u=c.content;St(u)&&(u.visit(new un(s,this.context,u,this.exprContentListener)),delete c.content),this.applyComputedStyles(s,c)}peelOff(e,n){let s=k(\"peelOff\"),o=e.firstPseudo,i=e.offsetInNode,a=e.after;if(n>0){let h=e.viewNode.textContent;e.viewNode.textContent=h.substr(0,n),i+=n}else if(!a&&e.viewNode&&i==0){let h=e.viewNode.parentNode;h&&h.removeChild(e.viewNode)}let l=e.boxOffset+n,c=[];for(;e.firstPseudo===o;)c.push(e),e=e.parent;let u=c.pop(),p=u.shadowSibling;return s.loop(()=>{for(;c.length>0;){u=c.pop(),e=new On(u.sourceNode,e,l),c.length==0&&(e.offsetInNode=i,e.after=a),e.shadowType=u.shadowType,e.shadowContext=u.shadowContext,e.nodeShadow=u.nodeShadow,e.shadowSibling=u.shadowSibling?u.shadowSibling:p,p=null;let h=this.setCurrent(e,!1);if(h.isPending())return h}return v(!1)}).then(()=>{s.finish(e)}),s.result()}createElement(e,n){return e==\"http://www.w3.org/1999/xhtml\"?this.document.createElement(n):this.document.createElementNS(e,n)}applyFootnoteStyle(e,n,s){let o={},i=Nt(this.footnoteStyle,\"_pseudos\");if(e=this.computeStyle(e,n,this.footnoteStyle,o),i&&i.before){let a={},l=this.createElement(\"http://www.w3.org/1999/xhtml\",\"span\");gi(l,\"before\"),s.appendChild(l),this.computeStyle(e,n,i.before,a),delete a.content,this.applyComputedStyles(l,a)}return delete o.content,this.applyComputedStyles(s,o),e}processFragmentedBlockEdge(e){var i,a,l;let n=!e.inline&&e.after?e.parent:e,s=!1;if(e.inline&&e.after&&!e.shadowContext&&((i=e.sourceNode.nextSibling)==null?void 0:i.nodeType)===1){let c=e.sourceNode.nextSibling,u=(a=de(this.styler.getStyle(c,!1),\"display\"))==null?void 0:a.value.toString();s=u&&!pn(u)||c.getAttribute(\"data-math-typeset\")===\"true\"&&/^\\s*(\\$\\$|\\\\\\[)/.test(c.textContent)}let o=0;for(let c=n;c;c=c.parent){if(((l=c.viewNode)==null?void 0:l.nodeType)!==1)continue;let u=c.viewNode;if(u.style)if(c.inline){if(dt(u,\"inline-end\"),ps(u)){let p=c.vertical?u.offsetWidth:u.offsetHeight;dt(u,\"clone\"),(c.vertical?u.offsetWidth:u.offsetHeight)>p&&this.fixClonedBoxDecorationOverflow(u)}}else{if(dt(u,\"block-end\"),!o++&&c!==n){let{textAlign:p}=this.viewport.window.getComputedStyle(u);if(p===\"justify\"&&!s){let h=this.createChildAnonymousBlockIfNeeded(u);h?h!==u?Sc(h,[\"block-start\",\"text-start\",\"block-end\",\"text-end\",\"justify\"]):(dt(u,\"text-end\"),dt(u,\"justify\")):dt(u,\"text-end\")}else dt(u,\"text-end\")}ps(u)&&dt(u,\"clone\"),Ir(u,\"block-end\")}}}fixClonedBoxDecorationOverflow(e){let n=this.viewport.window.getComputedStyle(e),s=parseFloat(n.paddingInlineEnd),o=parseFloat(n.borderInlineEndWidth),i=-(s+o);isNaN(i)||(e.style.marginInlineEnd=`${i}px`)}createChildAnonymousBlockIfNeeded(e){let n=i=>{let{display:a,position:l,float:c}=this.viewport.window.getComputedStyle(i);if(i.localName===\"ruby\"||Xt[i.localName])return!1;if(i.localName===\"br\")return!0;if((a===\"inline\"||a===\"contents\")&&i.hasChildNodes()){let u=i.lastElementChild;if(u&&(!u.nextSibling||u.nextSibling===i.lastChild&&he(u.nextSibling))){let p=n(u);if(p||p===null)return p}for(let p=u==null?void 0:u.previousElementSibling;p;p=p.previousElementSibling){let h=n(p);if(h||h===null)return null}return!1}if(a===\"none\"||l===\"absolute\"||l===\"fixed\"||c&&c!==\"none\"||i.hasAttribute(Mt)){let u=i.previousElementSibling;return u&&(u.nextSibling===i||u.nextSibling===i.previousSibling&&he(u.nextSibling))?n(u):!1}return!(!a||pn(a))},s=null;for(let i=e.lastElementChild;i;i=i.previousElementSibling){let a=n(i);if(a){s=i;break}if(a===null)return null}if(!s)return e;if(s===e.lastElementChild&&(!s.nextSibling||s.nextSibling===e.lastChild&&he(s.nextSibling)))return null;let o=e.ownerDocument.createElement(\"span\");o.className=\"viv-anonymous-block\";for(let i=s.nextSibling,a=null;i;i=a)a=i.nextSibling,o.appendChild(i);return e.appendChild(o),o}convertLengthToPx(e,n,s){let o=e.num,i=e.unit;if(Fp(i)){let a=n;for(;a&&a.nodeType!==1;)a=a.parentNode;let l=parseFloat(s.getElementComputedStyle(a)[\"font-size\"]);return this.context,ca(e,l,this.context).num}else{let a=this.context.queryUnitSize(i,!1);return a?o*a:e}}isSameNodePositionStep(e,n){if(e.shadowContext){if(!n.shadowContext)return!1;let s=e.node.nodeType===1?e.node:e.node.parentElement,o=n.node.nodeType===1?n.node:n.node.parentElement;return e.shadowContext.owner===n.shadowContext.owner&&vs(s)===vs(o)}else return e.node===n.node}isSameNodePosition(e,n){return e.offsetInNode===n.offsetInNode&&e.after==n.after&&e.steps.length===n.steps.length&&e.steps.every((s,o)=>{let i=n.steps[o];return this.isSameNodePositionStep(s,i)})}isPseudoelement(e){return!!vs(e)}};d(Di,\"SVG_URL_ATTRIBUTES\",[\"color-profile\",\"clip-path\",\"cursor\",\"filter\",\"marker\",\"marker-start\",\"marker-end\",\"marker-mid\",\"fill\",\"stroke\",\"mask\"]);var Wa=Di,ZC={\"float-min-wrap-block\":!0,\"float-reference\":!0,\"flow-into\":!0,\"flow-linger\":!0,\"flow-options\":!0,\"flow-priority\":!0,\"footnote-policy\":!0,\"margin-break\":!0,page:!0},Ga=null,$a=class{constructor(t){d(this,\"layoutBox\");d(this,\"window\");d(this,\"scaleRatio\");this.layoutBox=t.layoutBox,this.window=t.window,this.scaleRatio=t.scaleRatio}scaleRect(t){return Ga?{left:t.left*this.scaleRatio,top:t.top*this.scaleRatio,right:t.right*this.scaleRatio,bottom:t.bottom*this.scaleRatio,width:t.width*this.scaleRatio,height:t.height*this.scaleRatio}:t}subtractOffsets(t,e){let n=e.left,s=e.top;return{left:t.left-n,top:t.top-s,right:t.right-n,bottom:t.bottom-s,width:t.width,height:t.height}}getRangeClientRects(t){let e=t.getClientRects(),n=this.layoutBox.getBoundingClientRect();return Array.from(e).map(s=>this.scaleRect(this.subtractOffsets(s,n)))}getElementClientRect(t){let n=t.getBoundingClientRect();if(n.left===0&&n.top===0&&n.right===0&&n.bottom===0)return n;let s=this.layoutBox.getBoundingClientRect();return this.scaleRect(this.subtractOffsets(n,s))}getElementComputedStyle(t){return this.window.getComputedStyle(t,null)}adjustLengthValue(t){let e=64*(this.scaleRatio||1);return Math.floor(t*e)/e}},Sn=class{constructor(t,e,n,s,o,i){this.window=t;this.fontSize=e;this.pixelRatio=n;d(this,\"document\");d(this,\"root\");d(this,\"outerZoomBox\");d(this,\"contentContainer\");d(this,\"layoutBox\");d(this,\"width\");d(this,\"height\");d(this,\"scaleRatio\",1);this.document=t.document,this.root=s||this.document.body;let a=this.root.firstElementChild;a||(a=this.document.createElement(\"div\"),a.setAttribute(\"data-vivliostyle-outer-zoom-box\",\"true\"),this.root.appendChild(a));let l=a.firstElementChild;l||(l=this.document.createElement(\"div\"),l.setAttribute(\"data-vivliostyle-spread-container\",\"true\"),a.appendChild(l)),n>0&&CSS.supports(\"zoom\",\"8\")&&(T(this.root,\"--viv-outputPixelRatio\",`${n}`),T(this.root,\"--viv-devicePixelRatio\",`${t.devicePixelRatio}`),this.scaleRatio=n/t.devicePixelRatio,Ga===null&&(Ga=!(\"currentCSSZoom\"in l)),Ga&&T(this.root,\"--viv-scaleRectRatio\",`${this.scaleRatio}`));let c=a.nextElementSibling;c||(c=this.document.createElement(\"div\"),c.setAttribute(\"data-vivliostyle-layout-box\",\"true\"),this.root.appendChild(c)),this.outerZoomBox=a,this.contentContainer=l,this.layoutBox=c,this.width=o||parseFloat(t.getComputedStyle(this.root).width)||this.root.offsetWidth||t.innerWidth,this.height=i||parseFloat(t.getComputedStyle(this.root).height)||this.root.offsetHeight||t.innerHeight;let u={width:794,height:1056},p=!t.outerWidth&&!t.outerHeight||/Headless/.test(navigator.userAgent)||navigator.webdriver&&t.innerWidth===800&&t.innerHeight===600;(!this.width||!o&&p)&&(this.width=u.width),(!this.height||!i&&p)&&(this.height=u.height)}resetZoom(){T(this.outerZoomBox,\"width\",\"\"),T(this.outerZoomBox,\"height\",\"\"),T(this.contentContainer,\"width\",\"\"),T(this.contentContainer,\"height\",\"\"),T(this.contentContainer,\"transform\",\"\")}zoom(t,e,n){T(this.root,\"--viv-outputScale\",`${n}`),T(this.outerZoomBox,\"width\",`${t*n}px`),T(this.outerZoomBox,\"height\",`${e*n}px`),T(this.contentContainer,\"width\",`${t}px`),T(this.contentContainer,\"height\",`${e}px`)}clear(){let t=this.root;for(;t.lastChild;)t.removeChild(t.lastChild)}};var Mi=class{constructor(t,e,n){this.store=t;this.url=e;this.document=n;d(this,\"lang\",null);d(this,\"totalOffset\",-1);d(this,\"root\");d(this,\"body\");d(this,\"head\");d(this,\"last\");d(this,\"lastOffset\",1);d(this,\"idMap\");this.root=n.documentElement;let s=null,o=null;if(this.root.namespaceURI==\"http://www.w3.org/1999/xhtml\"){for(let i=this.root.firstChild;i;i=i.nextSibling){if(i.nodeType!=1)continue;let a=i;if(a.namespaceURI==\"http://www.w3.org/1999/xhtml\")switch(a.localName){case\"head\":o=a;break;case\"body\":s=a;break}}this.lang=this.root.getAttribute(\"lang\")}this.body=s,this.head=o,this.last=this.root,this.last.setAttribute(Vt,\"0\")}doc(){return new Ya([this.document])}getElementOffset(t){let e=t.getAttribute(Vt);if(e)return parseInt(e,10);let n=this.lastOffset,s=this.last;for(;s!=t;){let o=s.firstChild;if(!o){for(;o=s.nextSibling,!o;)if(s=s.parentNode,s==null)throw new Error(\"Internal error\")}s=o,o.nodeType==1?(o.setAttribute(Vt,n.toString()),++n):n+=o.textContent.length}return this.lastOffset=n,this.last=t,n-1}getNodeOffset(t,e,n){let s=0,o=t,i=null;if(o.nodeType==1){if(!n)return this.getElementOffset(o)}else{if(s=e,i=o.previousSibling,!i)return o=o.parentNode,s+=1,this.getElementOffset(o)+s;o=i}for(;;){for(;o.lastChild;)o=o.lastChild;if(o.nodeType==1)break;if(s+=o.textContent.length,i=o.previousSibling,!i){o=o.parentNode;break}o=i}return s+=1,this.getElementOffset(o)+s}getTotalOffset(){return this.totalOffset<0&&(this.totalOffset=this.getNodeOffset(this.root,0,!0)),this.totalOffset}getNodeByOffset(t){let e,n=this.root;for(;;){if(e=this.getElementOffset(n),e>=t)return n;let l=n.children;if(!l)break;let c=gt(l.length,u=>{let p=l[u];return this.getElementOffset(p)>t});if(c==0)break;n=l[c-1]}let s=e+1,o=n,i=o.firstChild||o.nextSibling,a=null;for(;;){if(i){if(i.nodeType==1||(o=i,a=o,s+=i.textContent.length,s>t&&!/^\\s*$/.test(i.textContent)))break}else if(o=o.parentNode,!o)break;i=o.nextSibling}return i&&a&&/^\\s*$/.test(a.textContent)&&(a=i),a||n}buildIdMap(t){let e=t.getAttribute(\"id\");e&&!this.idMap[e]&&(this.idMap[e]=t);let n=t.getAttributeNS(\"http://www.w3.org/XML/1998/namespace\",\"id\");n&&!this.idMap[n]&&(this.idMap[n]=t);for(let s=t.firstElementChild;s;s=s.nextElementSibling)this.buildIdMap(s)}getElement(t){let e=t.match(/([^#]*)#(.+)$/);if(!e||e[1]&&e[1]!=this.url)return null;let n=e[2],s=this.document.getElementById(n);return!s&&this.document.getElementsByName&&(s=this.document.getElementsByName(n)[0]),s||(this.idMap||(this.idMap={},this.buildIdMap(this.document.documentElement)),s=this.idMap[n]),s}},op=(o=>(o.TEXT_HTML=\"text/html\",o.TEXT_XML=\"text/xml\",o.APPLICATION_XML=\"application/xml\",o.APPLICATION_XHTML_XML=\"application/xhtml+xml\",o.IMAGE_SVG_XML=\"image/svg+xml\",o))(op||{});function ja(r,t,e){let n=e||new DOMParser,s;try{s=n.parseFromString(r,t)}catch(o){}if(s){let o=s.documentElement,i=\"parsererror\";if(o.localName===i)return null;for(let a=o.firstElementChild;a;a=a.nextElementSibling)if(a.localName===i)return null}else return null;return s}function QC(r){let t=r.contentType;if(t){let n=Object.keys(op);for(let s=0;s<n.length;s++)if(op[n[s]]===t)return t;if(t.match(/\\+xml$/))return\"application/xml\"}let e=r.url.match(/\\.([^./]+)$/);if(e)switch(e[1]){case\"html\":case\"htm\":return\"text/html\";case\"xhtml\":case\"xht\":return\"application/xhtml+xml\";case\"svg\":case\"svgz\":return\"image/svg+xml\";case\"opf\":case\"xml\":return\"application/xml\"}return null}function rp(r,t){let e=r.responseXML;if(!e){let s=new DOMParser,o=r.responseText;if(o){let i=QC(r);if(e=ja(o,i||\"application/xml\",s),e&&!i){let a=e.documentElement;a.localName.toLowerCase()===\"html\"&&!a.namespaceURI?e=ja(o,\"text/html\",s):a.localName.toLowerCase()===\"svg\"&&e.contentType!==\"image/svg+xml\"&&(e=ja(o,\"image/svg+xml\",s))}e||(e=ja(o,\"text/html\",s))}}let n=e?new Mi(t,r.url,e):null;return v(n)}function eg(){return new ls(rp,\"document\")}var ip=class r{constructor(t){this.fn=t}check(t){return this.fn(t)}withAttribute(t,e){return new r(n=>this.check(n)&&n.nodeType==1&&n.getAttribute(t)==e)}withChild(t,e){return new r(n=>{if(!this.check(n))return!1;let s=new Ya([n]);return s=s.child(t),e&&(s=s.predicate(e)),s.size()>0})}},ap=new ip(r=>!0),Ya=class r{constructor(t){this.nodes=t}asArray(){return this.nodes}size(){return this.nodes.length}predicate(t){let e=[];for(let n of this.nodes)t.check(n)&&e.push(n);return new r(e)}forEachNode(t){let e=[],n=s=>{e.push(s)};for(let s=0;s<this.nodes.length;s++)t(this.nodes[s],n);return new r(e)}forEach(t){let e=[];for(let n=0;n<this.nodes.length;n++)e.push(t(this.nodes[n]));return e}forEachNonNull(t){let e=[];for(let n=0;n<this.nodes.length;n++){let s=t(this.nodes[n]);s!=null&&e.push(s)}return e}child(t){return this.forEachNode((e,n)=>{for(let s=e.firstChild;s;s=s.nextSibling)s.nodeType==1&&s.localName==t&&n(s)})}childElements(){return this.forEachNode((t,e)=>{for(let n=t.firstChild;n;n=n.nextSibling)n.nodeType==1&&e(n)})}attribute(t){return this.forEachNonNull(e=>e.nodeType==1?e.getAttribute(t):null)}textContent(){return this.forEach(t=>t.textContent)}};var JC=new Kt(()=>{let r=k(\"uaStylesheetBase\"),t=Id(),e=J(\"user-agent-base.css\",Wt),n=new bn(null,null,null,null,null,t,!0);return n.startStylesheet(\"UA\"),Qh(n.cascade),Rr(pc,n,e,null,null).thenFinish(r),r.result()},\"uaStylesheetBaseFetcher\");function eb(){return JC.get()}var lp=class{constructor(t,e,n,s,o,i,a,l,c,u){this.store=t;this.rootScope=e;this.pageScope=n;this.cascade=s;this.rootBox=o;this.fontFaces=i;this.footnoteProps=a;this.flowProps=l;this.viewportProps=c;this.pageProps=u;d(this,\"fontDeobfuscator\");d(this,\"validatorSet\");this.fontDeobfuscator=t.fontDeobfuscator,this.validatorSet=t.validatorSet,this.pageScope.defineBuiltIn(\"has-content\",function(p){p=p;let h=this,f=h.currentLayoutPosition,g=f.firstFlowChunkOfFlow(p);return h.matchPageSide(f.startSideOfFlow(p))&&f.hasContent(p,h.lookupOffset)&&!!g&&!h.flowChunkIsAfterParentFlowForcedBreak(g)}),this.pageScope.defineName(\"page-number\",new oe(this.pageScope,function(){let p=this;return p.pageNumberOffset+p.currentLayoutPosition.page},\"page-number\")),this.pageScope.defineName(\"blank-page\",new oe(this.pageScope,function(){let h=this.currentLayoutPosition;return h==null?void 0:h.isBlankPage},\"blank-page\"))}sizeViewport(t,e,n,s){if(this.viewportProps.length){let o=new _s(this.rootScope,t,e,n),i=qh(o,this.viewportProps),a=i.width,l=i.height,c=i[\"text-zoom\"],u=1;if(a&&l||c){let p=$.em;if((c?c.evaluate(o,\"text-zoom\"):null)===x.scale&&(u=p/n,n=p,t*=u,e*=u),a&&l){let f=Ae(a.evaluate(o,\"width\"),o),g=Ae(l.evaluate(o,\"height\"),o);if(f>0&&g>0)return{width:s&&s.spreadView?(f+s.pageBorder)*2:f,height:g,fontSize:n}}}}return{width:t,height:e,fontSize:n}}},wo=class extends _s{constructor(e,n,s,o,i,a,l,c,u,p,h,f,g){super(e.rootScope,o.width,o.height,o.fontSize);this.style=e;this.xmldoc=n;this.viewport=o;this.clientLayout=i;this.fontMapper=a;this.customRenderer=l;this.fallbackMap=c;this.pageNumberOffset=u;this.documentURLTransformer=p;this.counterStore=h;d(this,\"lang\");d(this,\"primaryFlows\",{body:!0});d(this,\"rootPageBoxInstance\",null);d(this,\"styler\",null);d(this,\"stylerMap\",null);d(this,\"currentLayoutPosition\",null);d(this,\"layoutPositionAtPageStart\",null);d(this,\"lookupOffset\",0);d(this,\"faces\");d(this,\"pageBoxInstances\",{});d(this,\"pageManager\",null);d(this,\"rootPageFloatLayoutContext\");d(this,\"pageBreaks\",{});d(this,\"pageProgression\",null);d(this,\"isVersoFirstPage\",!1);d(this,\"blankPageAtStart\",!1);d(this,\"pageSheetSize\",{});d(this,\"pageSheetHeight\",0);d(this,\"pageSheetWidth\",0);this.lang=n.lang||s,this.faces=new Aa(this.style.fontDeobfuscator),this.rootPageFloatLayoutContext=new dn(null,null,null,null,null,null,null),this.pageProgression=f||null,this.isVersoFirstPage=!!g;for(let m in e.flowProps){let E=e.flowProps[m],C=de(E,\"flow-consume\");C&&(C.evaluate(this,\"flow-consume\")==x.all?this.primaryFlows[m]=!0:delete this.primaryFlows[m])}}init(){let e=k(\"StyleInstance.init\"),n=this.counterStore.createCounterListener(this.xmldoc.url),s=this.counterStore.createCounterResolver(this.xmldoc.url,this.style.rootScope,this.style.pageScope);this.styler=new Si(this.xmldoc,this.style.cascade,this.style.rootScope,this,this.primaryFlows,this.style.validatorSet,n,s),s.setStyler(this.styler),this.styler.resetFlowChunkStream(this),this.stylerMap={},this.stylerMap[this.xmldoc.url]=this.styler;let o=this.styler.getTopContainerStyle();this.pageProgression||(this.pageProgression=Jd(o)),this.matchStartPageSide(this.styler.breakBeforeValues[0])||(this.pageNumberOffset===0?this.isVersoFirstPage=!0:this.blankPageAtStart=!0);let i=this.style.rootBox;this.rootPageBoxInstance=new Fa(i);let a=this.style.cascade.createInstance(this,n,s,this.lang);this.styler.cascade.currentPageType=this.styler.cascade.firstPageType,this.rootPageBoxInstance.applyCascadeAndInit(a,o),this.rootPageBoxInstance.resolveAutoSizing(this),this.pageManager=new _a(a,this.style.pageScope,this.rootPageBoxInstance,this,o);let l=[];for(let u of this.style.fontFaces){if(u.condition&&!u.condition.evaluate(this))continue;let p=Df(u.properties,this),h=new Ai(p);l.push(h)}this.fontMapper.findOrLoadFonts(l,this.faces).then(()=>{Zf(this.xmldoc.document,this.viewport.window,this.styler).thenFinish(e)});let c=this.style.pageProps;return c[\"\"]||(c[\"\"]={}),Object.keys(c).forEach(u=>{let p=c[u];this.styler.cascade.applyVarFilter([p],this.styler,null),this.styler.cascade.applyCalcFilter(p,this.styler.context);let h=ep(Oi(p),this);this.pageSheetSize[u]={width:h.pageWidth+h.cropOffset*2,height:h.pageHeight+h.cropOffset*2}}),e.result()}matchStartPageSide(e){let n=this.pageNumberOffset%2==(this.isVersoFirstPage?1:0),s=this.pageProgression==\"ltr\";switch(e){case\"left\":return n!==s;case\"right\":return n===s;case\"recto\":return n;case\"verso\":return!n;default:return!0}}getStylerForDoc(e){let n=this.stylerMap[e.url];if(!n){let s=this.style.store.getStyleForDoc(e),o=new _s(s.rootScope,this.pageWidth(),this.pageHeight(),this.initialFontSize),i=this.counterStore.createCounterListener(e.url),a=this.counterStore.createCounterResolver(e.url,s.rootScope,s.pageScope);n=new Si(e,s.cascade,s.rootScope,o,this.primaryFlows,s.validatorSet,i,a),this.stylerMap[e.url]=n}return n}registerInstance(e,n){this.pageBoxInstances[e]=n}lookupInstance(e){return this.pageBoxInstances[e]}encounteredFlowChunk(e,n){let s=this.currentLayoutPosition;if(s){s.flows[e.flowName]?n=s.flows[e.flowName]:s.flows[e.flowName]=n;let o=s.flowPositions[e.flowName];o||(o=new Hr,s.flowPositions[e.flowName]=o);let i=Rh(e.element),a=new pt(i),l=new Ur(a,e);o.positions.push(l)}}evalSupportsTest(e,n,s){if(s)return e===\"selector\"?this.evalSupportsSelector(n):!1;if(!e)return!1;let o=!0;class i{unknownProperty(p,h){o=!1}invalidPropertyValue(p,h){o=!1}simpleProperty(p,h,f){}}let a=new i,l=Zt(this.style.rootScope,new Oe(n,null),\"\");return l?(this.xmldoc.store.validatorSet.validatePropertyAndHandleShorthand(e,l,!1,a),o):!1}evalSupportsSelector(e){let n=new Ka(null),s=new Oe(e+\"{}\",n);return new Rn(me,s,n,\"\").runParser(Number.POSITIVE_INFINITY,!1,!1,!1,!1)?!n.cascadeParserHandler.invalid:!1}getConsumedOffset(e){let n=Number.POSITIVE_INFINITY;for(let s=0;s<e.positions.length;s++){let o=e.positions[s].chunkPosition.primary,i=o.steps[0].node,a=o.offsetInNode,l=o.after,c=0;for(;i.ownerDocument!=this.xmldoc.document;)c++,i=o.steps[c].node,l=!1,a=0;let u=this.xmldoc.getNodeOffset(i,a,l);u<n&&(n=u)}return n}getPosition(e,n){if(!e)return 0;let s=Number.POSITIVE_INFINITY;for(let o in this.primaryFlows){let i=e.flowPositions[o];if(!n&&(!i||i.positions.length==0)&&this.currentLayoutPosition&&(this.styler.styleUntilFlowIsReached(o),i=this.currentLayoutPosition.flowPositions[o],e!=this.currentLayoutPosition&&i&&(i=i.clone(),e.flowPositions[o]=i)),i){let a=this.getConsumedOffset(i);a<s&&(s=a)}}return s}dumpLocation(e){V.debug(\"Location - page\",this.currentLayoutPosition.page),V.debug(\"  current:\",e),V.debug(\"  lookup:\",this.lookupOffset);for(let n in this.currentLayoutPosition.flowPositions){let s=this.currentLayoutPosition.flowPositions[n];for(let o of s.positions)V.debug(\"  Chunk\",`${n}:`,o.flowChunk.startOffset)}}matchPageSide(e){switch(e){case\"left\":case\"right\":case\"recto\":case\"verso\":return new le(this.style.pageScope,`${e}-page`).evaluate(this);default:return!0}}updateStartSide(e){for(let n in e.flowPositions){let s=e.flowPositions[n];if(s&&s.positions.length>0){let o=s.positions[0].flowChunk;if(this.getConsumedOffset(s)===o.startOffset){let i=s.positions[0].flowChunk.breakBefore,a=s.startBreakType;s.startBreakType=Nc(Ve(a,i))}}}}selectPageMaster(e){let n=this.currentLayoutPosition,s=this.getPosition(n);if(s==Number.POSITIVE_INFINITY)return null;let o=this.rootPageBoxInstance.children,i;for(let a=0;a<o.length;a++){if(i=o[a],i.pageBox.pseudoName===Ha)continue;let l=1;i.pageBox.pseudoName===Ri&&!(this.actualPageWidth&&this.actualPageHeight)&&(l=1/0);let c=i.getProp(this,\"utilization\");c&&c.isNum()&&(l=c.num);let u=this.queryUnitSize(\"em\",!1),p=this.pageWidth()*this.pageHeight(),h=Math.ceil(l*p/(u*u)),f=this.styler.cascade.currentPageType;this.lookupOffset=this.styler.styleUntil(s,h),this.styler.cascade.currentPageType=f,this.updateStartSide(n),this.layoutPositionAtPageStart=n.clone(),this.initLingering(),this.clearScope(this.style.pageScope);let g=i.getProp(this,\"enabled\");if(!g||g===x._true){if(n.page===1&&this.blankPageAtStart){i.style={};let m=e.size;e={},m&&(e.size=m)}return this.pageManager.getPageRulePageMaster(i,e)}}throw new Error(\"No enabled page masters\")}flowChunkIsAfterParentFlowForcedBreak(e){let n=this.layoutPositionAtPageStart.flows,s=n[e.flowName].parentFlowName;if(s){let o=e.startOffset,i=n[s].forcedBreakOffsets;if(!i.length||o<i[0])return!1;let a=gt(i.length,p=>i[p]>o)-1,l=i[a],c=this.layoutPositionAtPageStart.flowPositions[s],u=this.getConsumedOffset(c);return l<u?!1:u<l?!0:!this.matchPageSide(c.startBreakType)}return!1}setFormattingContextToColumn(e,n){let s=this.currentLayoutPosition.flows[n];s.formattingContext||(s.formattingContext=new po(null)),e.flowRootFormattingContext=s.formattingContext}layoutDeferredPageFloats(e){let n=e.pageFloatLayoutContext,s=n.getDeferredPageFloatContinuations(),o=c=>{if(c.floatReference!==ue.PAGE)return!1;let u=this.layoutPositionAtPageStart.flowPositions.body,p=u&&this.getConsumedOffset(u),h=this.xmldoc.getNodeOffset(c.nodePosition.steps[0].node,0,!1);return h!=null&&p!=null&&h>p},i=k(\"layoutDeferredPageFloats\"),a=!1,l=0;return i.loopWithFrame(c=>{if(l===s.length){c.breakLoop();return}let u=s[l++],p=u.float;if(o(p)){c.breakLoop();return}let h=new _t().findByFloat(p),f=h.findPageFloatFragment(p,n);if(f&&f.hasFloat(p)){c.continueLoop();return}else if(n.isForbidden(p)||n.hasPrecedingFloatsDeferredToNext(p)){n.deferPageFloat(u),c.breakLoop();return}e.layoutPageFloatInner(u,h,null,f).then(g=>{if(!g){c.breakLoop();return}let m=n.parent.isInvalidated();if(m){c.breakLoop();return}else n.isInvalidated()&&!m&&(a=!0,n.validate());c.continueLoop()})}).then(()=>{a&&n.invalidate(),i.finish(!0)}),i.result()}getLastAfterPositionIfDeferredFloatsExists(e,n){if(e.pageFloatLayoutContext.getPageFloatContinuationsDeferredToNext().length>0)if(e.lastAfterPosition){let i;return n?(i=n.clone(),i.primary=e.lastAfterPosition):i=new pt(e.lastAfterPosition),i}else return null;else return null}layoutColumn(e,n){let s=this.currentLayoutPosition.flowPositions[n];if(!s||!this.matchPageSide(s.startBreakType))return v(!0);this.setFormattingContextToColumn(e,n),e.init(),this.primaryFlows[n]&&e.bands.length>0&&(e.forceNonfitting=!1);let o=k(\"layoutColumn\");return this.layoutDeferredPageFloats(e).then(()=>{if(e.pageFloatLayoutContext.isInvalidated()){o.finish(!0);return}let i=[],a=[],l=!0;o.loopWithFrame(c=>{if(e.pageFloatLayoutContext.hasContinuingFloatFragmentsInFlow(n)){c.breakLoop();return}for(;s.positions.length-a.length>0;){let u=0;for(;a.includes(u);)u++;let p=s.positions[u];if(p.flowChunk.startOffset>this.lookupOffset||this.flowChunkIsAfterParentFlowForcedBreak(p.flowChunk))break;for(let g=u+1;g<s.positions.length;g++){if(a.includes(g))continue;let m=s.positions[g];if(m.flowChunk.startOffset>this.lookupOffset||this.flowChunkIsAfterParentFlowForcedBreak(m.flowChunk))break;m.flowChunk.isBetter(p.flowChunk)&&(p=m,u=g)}let h=p.flowChunk,f=!0;if(e.layout(p.chunkPosition,l,s.breakAfter).then(g=>{if(e.pageFloatLayoutContext.isInvalidated()){c.breakLoop();return}if(l=!1,p.flowChunk.repeated&&(g===null||h.exclusive)&&i.push(u),h.exclusive){a.push(u),c.breakLoop();return}else{let m=!!g||!!e.pageBreakType,E=this.getLastAfterPositionIfDeferredFloatsExists(e,g);if(e.pageBreakType&&E?(p.chunkPosition=E,s.breakAfter=e.pageBreakType,e.pageBreakType=null):(a.push(u),(g||E)&&(p.chunkPosition=g||E,i.push(u)),s.startBreakType=Nc(e.pageBreakType)),m){c.breakLoop();return}}e.forceNonfitting=!1,f?f=!1:c.continueLoop()}),f){f=!1;return}}c.breakLoop()}).then(()=>{if(!e.pageFloatLayoutContext.isInvalidated()){s.positions=s.positions.filter((u,p)=>i.includes(p)||!a.includes(p)),s.breakAfter===\"column\"&&(s.breakAfter=null),e.saveDistanceToBlockEndFloats();let c=e.pageFloatLayoutContext.getMaxReachedAfterEdge();e.updateMaxReachedAfterEdge(c)}o.finish(!0)})}),o.result()}createLayoutConstraint(e){let n=this.currentLayoutPosition.page-1,s=this.counterStore.createLayoutConstraint(n);return new Ca([s].concat(e.getLayoutConstraints()))}createAndLayoutColumn(e,n,s,o,i,a,l,c,u,p,h,f,g,m){let E=e.vertical?e.isAutoWidth&&e.isRightDependentOnAutoWidth:e.isAutoHeight&&e.isTopDependentOnAutoHeight,C=i.element,b=new dn(c,ue.COLUMN,null,l,null,null,null),y=this.currentLayoutPosition.clone(),N=k(\"createAndLayoutColumn\"),S;return N.loopWithFrame(w=>{let A=this.createLayoutConstraint(b);if(u>1){let I=this.viewport.document.createElement(\"div\");if(T(I,\"position\",\"absolute\"),C.appendChild(I),S=new ws(I,g,this.clientLayout,A,b),S.forceNonfitting=m,S.vertical=i.vertical,S.rtl=i.rtl,S.snapHeight=i.snapHeight,S.snapWidth=i.snapWidth,i.vertical){let _=(i.rtl?u-a-1:a)*(h+p)+i.paddingTop,Ee=parseFloat(C.style.width);S.setHorizontalPosition(i.paddingLeft+Ee-i.width,i.width),S.setVerticalPosition(_,h)}else{let _=(i.rtl?u-a-1:a)*(h+p)+i.paddingLeft;S.setVerticalPosition(i.paddingTop,i.height),S.setHorizontalPosition(_,h)}S.originX=n,S.originY=s}else S=new ws(C,g,this.clientLayout,A,b),S.copyFrom(i);S.exclusions=E?[]:o.concat(),S.innerShape=f,b.setContainer(S),S.width>=0?this.layoutColumn(S,l).then(()=>{b.isInvalidated()||b.finish(),S.pageFloatLayoutContext.isInvalidated()&&!c.isInvalidated()?(S.pageFloatLayoutContext.validate(),this.currentLayoutPosition=y.clone(),S.element!==C&&C.removeChild(S.element),w.continueLoop()):w.breakLoop()}):(b.finish(),w.breakLoop())}).then(()=>{N.finish(S)}),N.result()}setPagePageFloatLayoutContextContainer(e,n,s){(n instanceof Bi||n instanceof Is&&!(n instanceof Vs))&&e.setContainer(s)}getRegionPageFloatLayoutContext(e,n,s,o){n instanceof En;let i=n.getProp(this,\"writing-mode\")||null,a=n.getProp(this,\"direction\")||null;return new dn(e,ue.REGION,s,o,null,i,a)}layoutFlowColumnsWithBalancing(e,n,s,o,i,a,l,c,u){let p=this.currentLayoutPosition.clone(),h=this.getRegionPageFloatLayoutContext(a,n,l,c),f=!0,g=()=>(this.currentLayoutPosition=p.clone(),this.layoutFlowColumns(e,n,s,o,i,a,h,l,c,u,f).thenAsync(m=>m?v({columns:m,position:this.currentLayoutPosition}):v(null)));return g().thenAsync(m=>{if(!m)return v(null);if(u<=1)return v(m.columns);let E=n.getProp(this,\"column-fill\")||x.balance,C=this.currentLayoutPosition.flowPositions[c];let b=wf(u,E,g,h,l,m.columns,C);return b?(f=!1,a.lock(),h.lock(),b.balanceColumns(m).thenAsync(y=>(a.unlock(),a.validate(),h.unlock(),this.currentLayoutPosition=y.position,v(y.columns)))):v(m.columns)})}layoutFlowColumns(e,n,s,o,i,a,l,c,u,p,h){let f=k(\"layoutFlowColumns\"),g=this.currentLayoutPosition.clone(),m=n.getPropAsNumber(this,\"column-gap\"),E=p>1?n.getPropAsNumber(this,\"column-width\"):c.width,C=n.getActiveRegions(this),b=n.getProp(this,\"shape-inside\"),y=Sr(b,0,0,c.width,c.height,this),N=new Wa(u,this,this.viewport,this.styler,C,this.xmldoc,this.faces,this.style.footnoteProps,this,e,this.customRenderer,this.fallbackMap,this.documentURLTransformer),S=0,w=null,A=[];return f.loopWithFrame(I=>{this.createAndLayoutColumn(n,s,o,i,c,S++,u,l,p,m,E,y,N,h).then(_=>{if(a.isInvalidated()){A=null,I.breakLoop();return}if((!!_.pageBreakType&&_.pageBreakType!==\"column\"||S===p)&&!l.isInvalidated()&&l.finish(),l.isInvalidated()){S=0,this.currentLayoutPosition=g.clone(),l.validate(),l.isLocked()?(A=null,I.breakLoop()):I.continueLoop();return}w=_,A[S-1]=w,w.pageBreakType&&w.pageBreakType!=\"column\"&&(S=p,w.pageBreakType!=\"region\"&&(this.pageBreaks[u]=!0)),S<p?I.continueLoop():I.breakLoop()})}).then(()=>{f.finish(A)}),f.result()}layoutContainer(e,n,s,o,i,a,l){n.reset();let c=n.getProp(this,\"enabled\");if(c&&c!==x._true)return v(!0);let u=k(\"layoutContainer\"),h=n.getProp(this,\"wrap-flow\")===x.auto,f=n.getProp(this,\"flow-from\"),g=this.viewport.document.createElement(\"div\"),m=n.getProp(this,\"position\");T(g,\"position\",m?m.name:\"absolute\");let E=n instanceof Vs;n instanceof En?s.appendChild(g):s.insertBefore(g,s.firstChild);let b=new ao(g);b.vertical=n.vertical,b.rtl=n.rtl,b.exclusions=a,n.prepareContainer(this,b,e,this.faces,this.clientLayout),n instanceof Vs&&(b.width<=0||b.height<=0)&&V.warn(\"Negative or zero page area size\"),b.originX=o,b.originY=i,o+=b.left+b.marginLeft+b.borderLeft,i+=b.top+b.marginTop+b.borderTop,this.setPagePageFloatLayoutContextContainer(l,n,b);let y,N=!1;if(!f||!f.isIdent()){let S=n.getProp(this,\"content\");if(S instanceof F&&S.expr instanceof oe&&S.expr.str.startsWith(\"running-element-\"))S.visit(new un(g,this,S,this.counterStore.getExprContentListener()));else if(S&&St(S)){let w=\"span\";S.url&&(w=\"img\");let A=this.viewport.document.createElement(w);S.visit(new un(A,this,S,this.counterStore.getExprContentListener())),g.appendChild(A),w==\"img\"&&n.transferSingleUriContentProps(this,A,this.faces),n.transferContentProps(this,b,e,this.faces),w==\"span\"&&df(A,n.getProp(this,\"text-autospace\"),n.getProp(this,\"text-spacing-trim\"),n.getProp(this,\"hanging-punctuation\"),this.lang,n.vertical)}else n.suppressEmptyBoxGeneration&&(s.removeChild(g),N=!0);N||n.finishContainer(this,b,e,null,1,this.clientLayout,this.faces),y=v(!0)}else if(this.pageBreaks[f.toString()])l.isInvalidated()||n.finishContainer(this,b,e,null,1,this.clientLayout,this.faces),y=v(!0);else{let S=k(\"layoutContainer.inner\"),w=f.toString(),A=n.getPropAsNumber(this,\"column-count\");this.layoutFlowColumnsWithBalancing(e,n,o,i,a,l,b,w,A).then(I=>{if(!l.isInvalidated()){let _=I[0];_.element===g&&(b=_),b.computedBlockSize=Math.max.apply(null,I.map(Q=>Q.computedBlockSize)),n.finishContainer(this,b,e,_,A,this.clientLayout,this.faces);let Ee=this.currentLayoutPosition.flowPositions[w];Ee&&Ee.breakAfter===\"region\"&&(Ee.breakAfter=null)}S.finish(!0)}),y=S.result()}return y.then(()=>{if(l.isInvalidated()){u.finish(!0);return}if(!n.isAutoHeight||Math.floor(b.computedBlockSize)>0){if(!N&&!h){let w=n.getProp(this,\"shape-outside\"),A=b.getOuterShape(w,this);a.push(A)}}else if(n.children.length==0){s.removeChild(g),u.finish(!0);return}let S=E?0:n.children.length-1;u.loop(()=>{for(;S>=0&&S<n.children.length;){let w=n.children[E?S++:S--],A=this.layoutContainer(e,w,g,o,i,a,l);if(A.isPending())return A.thenAsync(()=>v(!l.isInvalidated()));if(l.isInvalidated())break}return v(!1)}).then(()=>{u.finish(!0)})}),u.result()}processLinger(){let e=this.currentLayoutPosition.page;for(let n in this.currentLayoutPosition.flowPositions){let s=this.currentLayoutPosition.flowPositions[n];for(let o=s.positions.length-1;o>=0;o--){let i=s.positions[o];i.flowChunk.startPage>=0&&i.flowChunk.startPage+i.flowChunk.linger-1<=e&&s.positions.splice(o,1)}}}initLingering(){let e=this.currentLayoutPosition.page;for(let n in this.currentLayoutPosition.flowPositions){let s=this.currentLayoutPosition.flowPositions[n];for(let o=s.positions.length-1;o>=0;o--){let i=s.positions[o];i.flowChunk.startPage<0&&i.flowChunk.startOffset<this.lookupOffset&&(i.flowChunk.startPage=e)}}}noMorePrimaryFlows(e){for(let n in this.primaryFlows){let s=e.flowPositions[n];if(s&&s.positions.length>0)return!1}return!0}layoutNextPage(e,n){var g;let s=e.container===e.bleedBox;this.pageBreaks={},n?(this.currentLayoutPosition=n.clone(),this.styler.replayFlowElementsFromOffset(n.highestSeenOffset)):(this.currentLayoutPosition=new zr,this.styler.replayFlowElementsFromOffset(-1)),this.lang&&e.bleedBox.setAttribute(\"lang\",this.lang),n=this.currentLayoutPosition;let o=1e4;if(n.page>o)throw new Error(`Too many pages generated (over ${o} pages)`);n.page++;let i=n.startSideOfFlow(\"body\");n.isBlankPage=In(i)&&this.matchPageSide(i),e.isBlankPage=n.isBlankPage,e.pageType==null&&(e.pageType=(g=e.isBlankPage?this.styler.cascade.previousPageType:this.styler.cascade.currentPageType)!=null?g:\"\",this.styler.cascade.previousPageType=this.styler.cascade.currentPageType),this.clearScope(this.style.pageScope),this.layoutPositionAtPageStart=n.clone();let a=s?{}:this.pageManager.getCascadedPageStyle(e.pageType);this.styler.cascade.applyVarFilter([a],this.styler,null),this.styler.cascade.applyCalcFilter(a,this.styler.context);let l=this.selectPageMaster(a);if(!l)return v(null);let c=0;if(!s){e.setAutoPageWidth(l.pageBox.specified.width.value===rn),e.setAutoPageHeight(l.pageBox.specified.height.value===an),this.counterStore.setCurrentPage(e),this.counterStore.updatePageCounters(a,this);let m=ep(Oi(a),this);this.setPageSizeAndBleed(m,e),jf(a,m,e,this),c=m.bleedOffset+m.bleed}let u=!s&&l.getProp(this,\"writing-mode\")||x.horizontal_tb;this.pageVertical=u!=x.horizontal_tb;let p=l.getProp(this,\"direction\")||x.ltr,h=new dn(this.rootPageFloatLayoutContext,ue.PAGE,null,null,null,u,p),f=k(\"layoutNextPage\");return f.loopWithFrame(m=>{this.layoutContainer(e,l,e.bleedBox,c,c,[],h).then(()=>{h.isInvalidated()||h.finish(),h.isInvalidated()?(this.currentLayoutPosition=this.layoutPositionAtPageStart.clone(),h.validate(),m.continueLoop()):m.breakLoop()})}).then(()=>{if(l.adjustPageLayout(this,e,this.clientLayout),!s){let E=new le(l.pageBox.scope,\"left-page\");e.side=E.evaluate(this)?\"left\":\"right\",this.processLinger(),n=this.currentLayoutPosition,Object.keys(n.flowPositions).forEach(C=>{let b=n.flowPositions[C],y=b.breakAfter;y&&(y===\"page\"||!this.matchPageSide(y))&&(b.breakAfter=null)})}this.currentLayoutPosition=this.layoutPositionAtPageStart=null,n.highestSeenOffset=this.styler.getReachedOffset();let m=this.style.store.getTriggersForDoc(this.xmldoc);e.finish(m,this.clientLayout),this.noMorePrimaryFlows(n)&&(n=null),f.finish(n)}),f.result()}setPageSizeAndBleed(e,n){this.actualPageWidth=e.pageWidth,this.actualPageHeight=e.pageHeight,this.pageSheetWidth=e.pageWidth+e.cropOffset*2,this.pageSheetHeight=e.pageHeight+e.cropOffset*2,n.container.style.width=`${this.pageSheetWidth}px`,n.container.style.height=`${this.pageSheetHeight}px`,n.bleedBox.style.left=`${e.bleedOffset}px`,n.bleedBox.style.right=`${e.bleedOffset}px`,n.bleedBox.style.top=`${e.bleedOffset}px`,n.bleedBox.style.bottom=`${e.bleedOffset}px`,n.bleedBox.style.padding=`${e.bleed}px`}},cp=class r extends bn{constructor(e,n,s,o){super(e.rootScope,e,n,s,o,e.validatorSet,!s);this.masterHandler=e;d(this,\"insideRegion\",!1)}startPageTemplateRule(){}startPageMasterRule(e,n,s){let o=new vo(this.masterHandler.pageScope,e,n,s,this.masterHandler.rootBox,this.condition,this.owner.getBaseSpecificity());this.masterHandler.pushHandler(new Oa(o.scope,this.masterHandler,o,this.validatorSet))}startWhenRule(e){let n=e.expr;this.condition!=null&&(n=Je(this.scope,this.condition,n)),this.masterHandler.pushHandler(new r(this.masterHandler,n,this,this.regionId))}startDefineRule(){this.masterHandler.pushHandler(new ia(this.scope,this.owner))}startFontFaceRule(){let e={};this.masterHandler.fontFaces.push({properties:e,condition:this.condition}),this.masterHandler.pushHandler(new Ns(this.scope,this.owner,null,e,this.masterHandler.validatorSet,\"font-face\"))}startFlowRule(e){let n=this.masterHandler.flowProps[e];n||(n={},this.masterHandler.flowProps[e]=n),this.masterHandler.pushHandler(new Ns(this.scope,this.owner,null,n,this.masterHandler.validatorSet))}startViewportRule(){let e={};this.masterHandler.viewportProps.push(e),this.masterHandler.pushHandler(new Ns(this.scope,this.owner,this.condition,e,this.masterHandler.validatorSet))}startFootnoteRule(e){let n=this.masterHandler.footnoteProps;if(e){let s=bo(n,\"_pseudos\");n=s[e],n||(n={},s[e]=n)}this.masterHandler.pushHandler(new Ns(this.scope,this.owner,null,n,this.masterHandler.validatorSet))}startRegionRule(){this.insideRegion=!0,this.startSelectorRule()}startPageRule(){let e=new Ua(this.masterHandler.pageScope,this.masterHandler,this,this.validatorSet,this.masterHandler.pageProps);this.masterHandler.pushHandler(e),e.startPageRule()}startRuleBody(){if(bn.prototype.startRuleBody.call(this),this.insideRegion){this.insideRegion=!1;let e=`R${this.masterHandler.regionCount++}`;this.special(\"region-id\",L(e)),this.endRule();let n=new r(this.masterHandler,this.condition,this,e);this.masterHandler.pushHandler(n),n.startRuleBody()}}},Ka=class extends wr{constructor(e){super();this.validatorSet=e;d(this,\"rootScope\");d(this,\"pageScope\");d(this,\"rootBox\");d(this,\"cascadeParserHandler\");d(this,\"regionCount\",0);d(this,\"fontFaces\",[]);d(this,\"footnoteProps\",{});d(this,\"flowProps\",{});d(this,\"viewportProps\",[]);d(this,\"pageProps\",{});this.rootScope=new ts(null),this.pageScope=new ts(this.rootScope),this.rootBox=new Ra(this.rootScope),this.cascadeParserHandler=new cp(this,null,null,null),this.slave=this.cascadeParserHandler}};function tb(r,t){return t.parseOPSResource(r)}var qa=class extends ls{constructor(e){super(tb,\"document\");this.fontDeobfuscator=e;d(this,\"styleByKey\",{});d(this,\"styleFetcherByKey\",{});d(this,\"styleByDocURL\",{});d(this,\"triggersByDocURL\",{});d(this,\"validatorSet\",null);d(this,\"styleSheets\",[]);d(this,\"triggerSingleDocumentPreprocessing\",!1)}init(e,n){this.setStyleSheets(e,n);let s=k(\"OPSDocStore.init\");return this.validatorSet=Id(),eb().then(()=>{this.triggerSingleDocumentPreprocessing=!0,s.finish(!0)}),s.result()}getStyleForDoc(e){return this.styleByDocURL[e.url]}getTriggersForDoc(e){return this.triggersByDocURL[e.url]}setStyleSheets(e,n){this.clearStyleSheets(),e&&e.forEach(this.addAuthorStyleSheet,this),n&&n.forEach(this.addUserStyleSheet,this)}clearStyleSheets(){this.styleSheets.splice(0)}addAuthorStyleSheet(e){let n=e.url;n&&(n=J(vn(n),nn)),this.styleSheets.push({url:n,text:e.text,flavor:\"Author\",classes:null,media:null})}addUserStyleSheet(e){let n=e.url;n&&(n=J(vn(n),nn)),this.styleSheets.push({url:n,text:e.text,flavor:\"User\",classes:null,media:null})}parseOPSResource(e){let n=k(\"OPSDocStore.load\"),s=e.url,o=s.endsWith(\"?viv-toc-box\");return rp(e,this).then(i=>{var f;if(!i){n.finish(null);return}if(this.triggerSingleDocumentPreprocessing){let g=$e(\"PREPROCESS_SINGLE_DOCUMENT\");for(let m=0;m<g.length;m++)try{g[m](i.document)}catch(E){V.warn(\"Error during single document preprocessing:\",E)}}let a=[],l=i.document.getElementsByTagNameNS(\"http://www.idpf.org/2007/ops\",\"trigger\");for(let g=0;g<l.length;g++){let m=l[g],E=m.getAttributeNS(\"http://www.w3.org/2001/xml-events\",\"observer\"),C=m.getAttributeNS(\"http://www.w3.org/2001/xml-events\",\"event\"),b=m.getAttribute(\"action\"),y=m.getAttribute(\"ref\");E&&C&&b&&y&&a.push({observer:E,event:C,action:b,ref:y})}this.triggersByDocURL[s]=a;let c=[];if(c.push({url:J(\"user-agent-page.css\",Wt),text:dc,flavor:\"UA\",classes:null,media:null}),o)c.push({url:J(\"user-agent-toc.css\",Wt),text:hc,flavor:\"UA\",classes:null,media:null});else{let g=i.document.querySelectorAll(\"style, link, meta\");for(let m of g){let E=m.namespaceURI,C=m.localName;if(E==\"http://www.w3.org/1999/xhtml\")if(C==\"style\"){let b=m.getAttribute(\"class\"),y=m.getAttribute(\"media\"),N=m.getAttribute(\"title\");c.push({url:s,text:m.textContent,flavor:\"Author\",classes:N?b:null,media:y})}else if(C==\"link\"){let b=m.getAttribute(\"href\"),y=(f=m.getAttribute(\"rel\"))==null?void 0:f.split(/\\s+/),N=m.getAttribute(\"class\"),S=m.getAttribute(\"media\");if(b&&(y!=null&&y.includes(\"stylesheet\"))&&(!y.includes(\"alternate\")||N)){let w=J(b,s),A=m.getAttribute(\"title\");c.push({url:w,text:null,classes:A?N:null,media:S,flavor:\"Author\"})}}else C==\"meta\"&&m.getAttribute(\"name\")==\"viewport\"&&c.push({url:s,text:this.processViewportMeta(m),flavor:\"Author\",classes:null,media:null})}for(let m=0;m<this.styleSheets.length;m++)c.push(this.styleSheets[m])}let u=\"\";for(let g=0;g<c.length;g++)u+=c[g].url,u+=\"^\",c[g].text&&(u+=c[g].text),u+=\"^\";let p=this.styleByKey[u];if(p){this.styleByDocURL[s]=p,n.finish(i);return}let h=this.styleFetcherByKey[u];h||(h=new Kt(()=>{let g=k(\"fetchStylesheet\"),m=0,E=new Ka(this.validatorSet);return g.loop(()=>{if(m<c.length){let C=c[m++];return E.startStylesheet(C.flavor),C.text!==null?Rr(C.text,E,C.url,C.classes,C.media).thenReturn(!0):Cc(C.url,E,C.classes,C.media)}return v(!1)}).then(()=>{let C=E.cascadeParserHandler.finish();p=new lp(this,E.rootScope,E.pageScope,C,E.rootBox,E.fontFaces,E.footnoteProps,E.flowProps,E.viewportProps,E.pageProps),this.styleByKey[u]=p,delete this.styleFetcherByKey[u],g.finish(p)}),g.result()},`FetchStylesheet ${s}`),this.styleFetcherByKey[u]=h,h.start()),h.get().then(g=>{this.styleByDocURL[s]=g,n.finish(i)})}),n.result()}processViewportMeta(e){return\"\"}};var _i=\"\\u25B8\",sg=\"\\u25BE\",nb=\"\\u25B9\";function Qa(r){let t=Array.from(r.querySelectorAll(\"nav[*|type],nav[epub\\\\:type]\"));if(t.length>0||(t=Array.from(r.querySelectorAll(\"[role=doc-toc]\")),t.length>0))return t;let e=\"nav,.toc,#toc,#table-of-contents,#contents,[role=directory]\";for(let n of r.querySelectorAll(e)){if(t.find(o=>o.contains(n)))continue;let s=n;/^h[1-6]$/.test(s.localName)&&(s.previousElementSibling?s=s.nextElementSibling:s=s.parentElement),s&&s.querySelector(\"li a[href]\")&&t.push(s)}return t}function og(r){let t=Qa(r),e=[];for(let n of t)for(let s of n.querySelectorAll(\"li a[href]\"))e.push(s);return e}var Za=class{constructor(t,e,n,s,o,i,a,l,c,u){this.store=t;this.url=e;this.lang=n;this.clientLayout=s;this.fontMapper=o;this.rendererFactory=a;this.fallbackMap=l;this.documentURLTransformer=c;this.counterStore=u;d(this,\"pref\");d(this,\"page\",null);d(this,\"instance\",null);this.pref=hr(i),this.pref.spreadView=!1}setAutoHeight(t,e){if(e--!=0){for(let n=t.firstChild;n;n=n.nextSibling)if(n.nodeType==1){let s=n;Tn(s,\"height\",\"auto\")!=\"auto\"&&(T(s,\"height\",\"auto\"),this.setAutoHeight(s,e)),Tn(s,\"position\",\"static\")==\"absolute\"&&(T(s,\"position\",\"relative\"),this.setAutoHeight(s,e))}}}makeCustomRenderer(t){let e=this.rendererFactory.makeCustomRenderer(t);return(n,s,o)=>{let i=o.behavior;if(i)switch(i.toString()){case\"toc-node-anchor\":o.color=x.inherit,o[\"text-decoration\"]=x.none;break;case\"toc-node\":o.display=x.block,o.margin=X,o.padding=X,o[\"padding-inline-start\"]=new P(1.25,\"em\");break;case\"toc-node-first-child\":o.display=x.inline_block,o.margin=new P(.2,\"em\"),o[\"vertical-align\"]=x.top,o.color=x.inherit,o[\"text-decoration\"]=x.none;break;case\"toc-container\":o.padding=X;break}if(!i||i.toString()!=\"toc-node\"&&i.toString()!=\"toc-container\")return e(n,s,o);let a=n.firstChild;a&&a.nodeType!==1&&he(a)&&n.replaceChild(n.ownerDocument.createComment(a.textContent),a);let l=s.getAttribute(\"data-adapt-class\");if(l==\"toc-node\"){let u=s.firstChild;u.textContent!=_i&&(u.textContent=_i,T(u,\"cursor\",\"pointer\"),u.addEventListener(\"click\",sb,!1),u.setAttribute(\"role\",\"button\"),u.setAttribute(\"aria-expanded\",\"false\"),s.setAttribute(\"aria-expanded\",\"false\"),s.style.height!==\"0px\"&&(u.tabIndex=0))}let c=s.ownerDocument.createElement(\"div\");if(c.setAttribute(\"data-adapt-process-children\",\"true\"),i.toString()==\"toc-node\"){let u=s.ownerDocument.createElement(\"div\");if(u.textContent=nb,T(u,\"margin\",\"0.2em 0 0 -1em\"),T(u,\"margin-inline-start\",\"-1em\"),T(u,\"margin-inline-end\",\"0\"),T(u,\"display\",\"inline-block\"),T(u,\"width\",\"1em\"),T(u,\"text-align\",\"center\"),T(u,\"vertical-align\",\"top\"),T(u,\"cursor\",\"default\"),T(u,\"font-family\",\"Menlo,sans-serif\"),c.appendChild(u),T(c,\"overflow\",\"hidden\"),c.setAttribute(\"data-adapt-class\",\"toc-node\"),c.setAttribute(\"role\",\"treeitem\"),l==\"toc-node\"||l==\"toc-container\"){T(c,\"height\",\"0px\");let p=n.firstElementChild;p&&p.localName===\"a\"&&(p.tabIndex=-1)}else s.setAttribute(\"role\",\"tree\")}else l==\"toc-node\"&&(c.setAttribute(\"data-adapt-class\",\"toc-container\"),c.setAttribute(\"role\",\"group\"),c.setAttribute(\"aria-hidden\",\"true\"));return v(c)}}showTOC(t,e,n,s,o){if(this.page)return v(this.page);let i=k(\"showTOC\"),a=new ro(t,t);this.page=a;let l=wt(this.url)+\"?viv-toc-box\";return this.store.load(l).then(c=>{for(let g of Qa(c.document))g.setAttribute(\"data-vivliostyle-role\",\"doc-toc\");let u=this.store.getStyleForDoc(c),p=u.sizeViewport(n,1e5,o);e=new Sn(e.window,p.fontSize,0,e.root,p.width,p.height);let h=this.makeCustomRenderer(c),f=new wo(u,c,this.lang,e,this.clientLayout,this.fontMapper,h,this.fallbackMap,0,this.documentURLTransformer,this.counterStore);this.instance=f,f.pref=this.pref,f.init().then(()=>{f.layoutNextPage(a,null).then(()=>{this.setAutoHeight(t,2),i.finish(a)})})}),i.result()}hideTOC(){this.page&&(this.page.container.style.visibility=\"hidden\",this.page.container.setAttribute(\"aria-hidden\",\"true\"))}isTOCVisible(){return!!this.page&&this.page.container.style.visibility===\"visible\"}getTOC(){if(!this.page)return[];function t(s){if(!s)return[];let o=s.querySelectorAll(\":scope > [role=treeitem] > a[href]\");return Array.from(o).map(e)}function e(s){let o=new URL(s.href),[,i]=o.hash.match(/^#?(.*)$/),a=s.innerText,l=s.parentElement.querySelector(\"[role=group]\"),c=t(l);return{id:i,title:a,children:c}}let n=this.page.container.querySelector(\"[role=tree]\");return t(n)}};function sb(r){let t=r.target,e=t.textContent==_i;t.textContent=e?sg:_i;let n=t.parentNode;t.setAttribute(\"aria-expanded\",e?\"true\":\"false\"),n.setAttribute(\"aria-expanded\",e?\"true\":\"false\");let s=n.firstChild;for(;s;){if(s.nodeType===1){let o=s,i=o.getAttribute(\"data-adapt-class\");if(i===\"toc-container\"){if(o.setAttribute(\"aria-hidden\",e?\"false\":\"true\"),o.firstChild){s=o.firstChild;continue}}else if(i===\"toc-node\"&&(o.style.height=e?\"auto\":\"0px\",o.children.length>=2&&(o.children[1].tabIndex=e?0:-1),o.children.length>=3&&(o.children[0].tabIndex=e?0:-1,!e))){let a=o.children[0];if(a.textContent==sg){a.textContent=_i,a.setAttribute(\"aria-expanded\",\"false\"),o.setAttribute(\"aria-expanded\",\"false\"),s=o.children[2];continue}}}for(;!s.nextSibling&&s.parentNode!==n;)s=s.parentNode;s=s.nextSibling}r.stopPropagation()}var Hi=class extends qa{constructor(){super(null);d(this,\"plainXMLStore\");d(this,\"jsonStore\");d(this,\"opfByURL\",{});d(this,\"primaryOPFByEPubURL\",{});d(this,\"deobfuscators\",{});d(this,\"documents\",{});this.fontDeobfuscator=this.makeDeobfuscatorFactory(),this.plainXMLStore=eg(),this.jsonStore=nh()}makeDeobfuscatorFactory(){return e=>this.deobfuscators[e]}loadAsPlainXML(e,n,s){return this.plainXMLStore.load(e,n,s)}startLoadingAsPlainXML(e){this.plainXMLStore.fetch(e)}loadAsJSON(e,n,s){return this.jsonStore.load(e,n,s)}loadPubDoc(e){let n=k(\"loadPubDoc\");return cs(e,null,\"HEAD\").then(s=>{if(s.status>=400)this.loadEPUBDoc(e).then(o=>{if(o){n.finish(o);return}V.error(`Failed to fetch a source document from ${e} (${s.status}${s.statusText?\" \"+s.statusText:\"\"})`),n.finish(null)});else if(!s.status&&!s.responseXML&&!s.responseText&&!s.responseBlob&&!s.contentType&&/\\/[^/.]+(?:[#?]|$)/.test(e)&&(e=e.replace(/([#?]|$)/,\"/$1\")),s.contentType==\"application/oebps-package+xml\"||/\\.opf(?:[#?]|$)/.test(e)){let[,o,i]=e.match(/^((?:.*\\/)?)([^/]*)$/);this.loadOPF(o,i).thenFinish(n)}else s.contentType==\"application/ld+json\"||s.contentType==\"application/webpub+json\"||s.contentType==\"application/audiobook+json\"||s.contentType==\"application/json\"||/\\.json(?:ld)?(?:[#?]|$)/.test(e)?this.loadAsJSON(e,!0).then(o=>{if(!o){this.reportLoadError(e),n.finish(null);return}let i=new Bs(this,e);i.initWithWebPubManifest(o,void 0,e).then(()=>{n.finish(i)})}):this.loadWebPub(e).then(o=>{if(o){n.finish(o);return}this.loadEPUBDoc(e).then(i=>{if(i){n.finish(i);return}V.error(`Failed to load ${e}.`),n.finish(null)})})}),n.result()}loadEPUBDoc(e){let n=k(\"loadEPUBDoc\");e.endsWith(\"/\")||(e=e+\"/\"),this.startLoadingAsPlainXML(e+\"META-INF/encryption.xml\");let s=e+\"META-INF/container.xml\";return this.loadAsPlainXML(s).then(o=>{if(o){let i=o.doc().child(\"container\").child(\"rootfiles\").child(\"rootfile\").attribute(\"full-path\");for(let a of i)if(a){this.loadOPF(e,a).thenFinish(n);return}}n.finish(null)}),n.result()}loadOPF(e,n){let s=e+n,o=this.opfByURL[s];if(o)return v(o);let i=k(\"loadOPF\");return this.loadAsPlainXML(s,!0,`Failed to fetch EPUB OPF ${s}`).then(a=>{a?this.loadAsPlainXML(`${e}META-INF/encryption.xml`).then(l=>{o=new Bs(this,e),o.initWithXMLDoc(a,l).then(()=>{this.opfByURL[s]=o,this.primaryOPFByEPubURL[e]=o,i.finish(o)})}):this.reportLoadError(s)}),i.result()}loadWebPub(e){let n=k(\"loadWebPub\");return this.load(e).then(s=>{if(!s)this.reportLoadError(e);else if(s.document.querySelector(\"a[href='META-INF/'],a[href$='/META-INF/']\"))n.finish(null);else{let o=s.document,i=new Bs(this,e),a=o.querySelector(\"link[rel='publication'],link[rel='manifest'][type='application/webpub+json']\");if(a){let l=a.getAttribute(\"href\");if(/^#/.test(l)){let c=Ms(o.getElementById(l.substr(1)).textContent);i.initWithWebPubManifest(c,o).then(()=>{n.finish(i)})}else{let c=J(a.getAttribute(\"href\"),e);this.loadAsJSON(c,!0,`Failed to fetch Publication Manifest ${c}`).then(u=>{i.initWithWebPubManifest(u,o,c).then(()=>{n.finish(i)})})}}else i.initWithWebPubManifest({},o).then(()=>{i.toc&&i.toc.src===s.url&&Qa(o).length===0&&(i.toc=null),n.finish(i)})}}),n.result()}addDocument(e,n){let s=k(\"EPUBDocStore.load\"),o=wt(e);return(this.documents[o]=this.parseOPSResource({status:200,statusText:\"\",url:o,contentType:n.contentType,responseText:null,responseXML:n,responseBlob:null})).thenFinish(s),s.result()}reportLoadError(e){let n=o=>o.replace(/([^:/?#]|^)[/?#].*/,\"$1\"),s=()=>{let o=n(e);return!(o===n(nn)||Object.keys(this.resources).find(a=>this.resources[a]&&n(a)===o)||/\\.(xhtml|xht|xml|opf)$/i.test(e))};e.startsWith(\"data:\")?V.error(`Failed to load ${e}. Invalid data.`):e.startsWith(\"http:\")&&nn.startsWith(\"https:\")?V.error(`Failed to load ${e}. Mixed Content (\"http:\" content on \"https:\" context) is not allowed.`):s()?V.error(`Failed to load ${e}. This may be caused by the server not allowing cross-origin resource sharing (CORS).`):V.error(`Failed to load ${e}. The target resource is invalid.`)}load(e){let n=wt(e),s=this.documents[n];if(s)return s.isPending()?s:v(s.get());{let o=k(\"EPUBDocStore.load\");return s=super.load(n,!0,`Failed to fetch a source document from ${n}`),s.then(i=>{i?o.finish(i):this.reportLoadError(n)}),o.result()}}processViewportMeta(e){let n=e.getAttribute(\"content\");if(!n)return\"\";let s={},o;for(;(o=n.match(/^,?\\s*([-A-Za-z_.][-A-Za-z_0-9.]*)\\s*=\\s*([-+A-Za-z_0-9.]*)\\s*/))!=null;)n=n.substr(o[0].length),s[o[1]]=o[2];let i=s.width-0,a=s.height-0;if(i&&a){let l=!!Object.values(this.primaryOPFByEPubURL).find(c=>c.prePaginated);return`@-epubx-viewport{width:${i}px;height:${a}px;}`+(l?`@page{size:${i}px ${a}px;margin:0;}`:\"@page{margin:0;}\")}return\"\"}},el=class{constructor(){d(this,\"id\",null);d(this,\"src\",\"\");d(this,\"mediaType\",null);d(this,\"title\",null);d(this,\"itemRefElement\",null);d(this,\"spineIndex\",-1);d(this,\"compressedSize\",0);d(this,\"compressed\",null);d(this,\"epage\",0);d(this,\"epageCount\",0);d(this,\"startPage\",null);d(this,\"skipPagesBefore\",null);d(this,\"itemProperties\");this.itemProperties=Np}initWithElement(t,e){this.id=t.getAttribute(\"id\"),this.src=J(t.getAttribute(\"href\"),e),this.mediaType=t.getAttribute(\"media-type\");let n=t.getAttribute(\"properties\");n&&(this.itemProperties=wp(n.split(/\\s+/)))}initWithParam(t){this.spineIndex=t.index,this.id=`item${t.index+1}`,this.src=t.url,this.startPage=t.startPage,this.skipPagesBefore=t.skipPagesBefore}};function ib(r){return r.id}function rb(r){return t=>{let e=k(\"deobfuscator\");return ab(\"SHA-1\",r).then(n=>{let s=t.slice(0,1040),o=t.slice(1040,t.size);eh(s).then(i=>{let a=new DataView(i);for(let l=0;l<a.byteLength;l++){let c=a.getUint8(l);c^=n[l%20],a.setUint8(l,c)}e.finish(gc([a,o]))})}),e.result()}}function ab(r,t){let e=k(\"makeDigest\"),n=e.suspend();return window.crypto.subtle.digest(r,new TextEncoder().encode(t)).then(s=>{n.schedule(new Uint8Array(s))}),e.result()}var Kn={dcterms:\"http://purl.org/dc/terms/\",marc:\"http://id.loc.gov/vocabulary/\",media:\"http://www.idpf.org/epub/vocab/overlays/#\",rendition:\"http://www.idpf.org/vocab/rendition/#\",onix:\"http://www.editeur.org/ONIX/book/codelists/current.html#\",xsd:\"http://www.w3.org/2001/XMLSchema#\",opf:\"http://www.idpf.org/2007/opf\"},Ui=\"http://idpf.org/epub/vocab/package/meta/#\",ve={language:`${Kn.dcterms}language`,title:`${Kn.dcterms}title`,creator:`${Kn.dcterms}creator`,layout:`${Kn.rendition}layout`,titleType:`${Ui}title-type`,displaySeq:`${Ui}display-seq`,alternateScript:`${Ui}alternate-script`,role:`${Ui}role`};function lb(r,t){let e={};return(n,s)=>{var p,h,f,g,m,E;let o,i,a=n.r||e,l=s.r||e;if(r==ve.title&&(o=((p=a[ve.titleType])==null?void 0:p[0].v)==\"main\",i=((h=l[ve.titleType])==null?void 0:h[0].v)==\"main\",o!=i))return o?-1:1;let c=parseInt((f=a[ve.displaySeq])==null?void 0:f[0].v,10);isNaN(c)&&(c=Number.MAX_VALUE);let u=parseInt((g=l[ve.displaySeq])==null?void 0:g[0].v,10);return isNaN(u)&&(u=Number.MAX_VALUE),c!=u?c-u:r!=ve.language&&t&&(o=((m=a[ve.language]||a[ve.alternateScript])==null?void 0:m[0].v)==t,i=((E=l[ve.language]||l[ve.alternateScript])==null?void 0:E[0].v)==t,o!=i)?o?-1:1:n.o-s.o}}function cb(r,t){let e;if(!t)e=Kn;else{e={};for(let h in Kn)e[h]=Kn[h];let p;for(;(p=t.match(/^\\s*([A-Z_a-z\\u007F-\\uFFFF][-.A-Z_a-z0-9\\u007F-\\uFFFF]*):\\s*(\\S+)/))!=null;)t=t.substr(p[0].length),e[p[1]]=p[2]}let n=p=>{if(p){let h=p.match(/^\\s*(([^:]*):)?(\\S+)\\s*$/);if(h){let f=h[2]?e[h[2]]:Ui;if(f)return f+h[3]}}return null},s=1,o=r.childElements().forEachNonNull(p=>{if(p.localName==\"meta\"){let h=n(p.getAttribute(\"property\"));if(h)return{name:h,value:p.textContent,id:p.getAttribute(\"id\"),order:s++,refines:p.getAttribute(\"refines\"),lang:null,scheme:n(p.getAttribute(\"scheme\")),role:null}}else if(p.namespaceURI==\"http://purl.org/dc/elements/1.1/\")return{name:Kn.dcterms+p.localName,order:s++,lang:p.getAttribute(\"xml:lang\"),value:p.textContent,id:p.getAttribute(\"id\"),refines:null,scheme:null,role:p.getAttribute(\"role\")||p.getAttribute(\"opf:role\")};return null}),i=qi(o,p=>p.refines),a=p=>Pp(p,(h,f)=>h.map(g=>{let m={v:g.value,o:g.order};g.scheme&&(m.s=g.scheme);let E=i[`#${g.id}`]||[];if(E.length||g.lang||g.role){g.lang&&E.push({name:ve.language,value:g.lang,lang:null,id:null,refines:g.id,scheme:null,order:g.order,role:null}),g.role&&E.push({name:ve.role,value:g.role,lang:null,id:null,refines:g.id,scheme:null,order:g.order,role:null});let C=qi(E,b=>b.name);m.r=a(C)}return m})),l=a(qi(o,p=>p.refines?null:p.name)),c=null;l[ve.language]&&(c=l[ve.language][0].v);let u=p=>{for(let h in p){let f=p[h];f.sort(lb(h,c));for(let g=0;g<f.length;g++){let m=f[g].r;m&&u(m)}}};return u(l),l}function ub(){let r=window.MathJax;return r?r.Hub:null}var ig={\"application/xhtml+xml\":!0,\"image/jpeg\":!0,\"image/png\":!0,\"image/svg+xml\":!0,\"image/gif\":!0,\"audio/mp3\":!0},up=\"viv-id-\",Bs=class{constructor(t,e){this.store=t;this.pubURL=e;d(this,\"opfXML\",null);d(this,\"encXML\",null);d(this,\"items\",null);d(this,\"spine\",null);d(this,\"itemMap\",null);d(this,\"itemMapByPath\",null);d(this,\"uid\",null);d(this,\"bindings\",{});d(this,\"lang\",null);d(this,\"epageCount\",0);d(this,\"prePaginated\",!1);d(this,\"epageIsRenderedPage\",!0);d(this,\"epageCountCallback\",null);d(this,\"metadata\",{});d(this,\"toc\",null);d(this,\"cover\",null);d(this,\"fallbackMap\",{});d(this,\"pageProgression\",null);d(this,\"documentURLTransformer\");this.documentURLTransformer=this.createDocumentURLTransformer()}createDocumentURLTransformer(){let t=this;class e{transformFragment(s,o){let i=o+(s?`#${s}`:\"\");return up+vl(i,\":\")}transformURL(s,o){let i=s.match(/^([^#]*)#?(.*)$/);if(i){let a=i[1]||o,l=decodeURIComponent(i[2]);if(a&&t.spine.some(c=>c.src===a))return`#${this.transformFragment(l,a)}`}return s}restoreURL(s){s.charAt(0)===\"#\"&&(s=s.substring(1)),s.indexOf(up)===0&&(s=s.substring(up.length));let i=Tp(s,\":\").match(/^([^#]*)#?(.*)$/);return i?[i[1],i[2]]:[]}}return new e}getMetadata(){return this.metadata}getPathFromURL(t){if(t.startsWith(\"data:\"))return t===this.pubURL?\"\":t;if(this.pubURL){let e=J(\"\",this.pubURL);return t===e||t+\"/\"===e?\"\":(e.charAt(e.length-1)!=\"/\"&&(e+=\"/\"),t.substr(0,e.length)==e?decodeURIComponent(t.substr(e.length)):null)}else return t}initWithXMLDoc(t,e){this.opfXML=t,this.encXML=e;let n=t.doc().child(\"package\"),s=n.attribute(\"unique-identifier\")[0];if(s){let c=t.getElement(`${t.url}#${s}`);c&&(this.uid=c.textContent.replace(/[ \\n\\r\\t]/g,\"\"))}let o={};this.items=n.child(\"manifest\").child(\"item\").asArray().map(c=>{let u=new el,p=c;u.initWithElement(p,t.url);let h=p.getAttribute(\"fallback\");return h&&!ig[u.mediaType]&&(o[u.src]=h),!this.toc&&u.itemProperties.nav&&(this.toc=u),!this.cover&&u.itemProperties[\"cover-image\"]&&(this.cover=u),u}),this.itemMap=Tl(this.items,ib),this.itemMapByPath=Tl(this.items,c=>this.getPathFromURL(c.src));for(let c in o){let u=c;for(;;){let p=this.itemMap[o[u]];if(!p)break;if(ig[p.mediaType]){this.fallbackMap[c]=p.src;break}u=p.src}}this.spine=n.child(\"spine\").child(\"itemref\").asArray().map((c,u)=>{let p=c,h=p.getAttribute(\"idref\"),f=this.itemMap[h];return f&&(f.itemRefElement=p,f.spineIndex=u),f});let i=n.child(\"spine\").attribute(\"page-progression-direction\")[0];i&&(this.pageProgression=dl(i));let a=e?e.doc().child(\"encryption\").child(\"EncryptedData\").predicate(ap.withChild(\"EncryptionMethod\",ap.withAttribute(\"Algorithm\",\"http://www.idpf.org/2008/embedding\"))).child(\"CipherData\").child(\"CipherReference\").attribute(\"URI\"):[],l=n.child(\"bindings\").child(\"mediaType\").asArray();for(let c=0;c<l.length;c++){let u=l[c].getAttribute(\"handler\"),p=l[c].getAttribute(\"media-type\");p&&u&&this.itemMap[u]&&(this.bindings[p]=this.itemMap[u].src)}if(this.metadata=cb(n.child(\"metadata\"),n.attribute(\"prefix\")[0]),this.metadata[ve.language]&&(this.lang=this.metadata[ve.language][0].v),this.metadata[ve.layout]&&(this.prePaginated=this.metadata[ve.layout][0].v===\"pre-paginated\"),a.length>0&&this.uid){let c=rb(this.uid);for(let u=0;u<a.length;u++)this.store.deobfuscators[this.pubURL+a[u]]=c}return this.prePaginated&&this.assignAutoPages(),v(!0)}assignAutoPages(){let t=0;for(let e of this.spine){let n=this.prePaginated?1:Math.ceil(e.compressedSize/1024);e.epage=t,e.epageCount=n,t+=n}this.epageCount=t,this.epageCountCallback&&this.epageCountCallback(this.epageCount)}setEPageCountMode(t){this.epageIsRenderedPage=t||this.prePaginated}countEPages(t){if(this.epageCountCallback=t,this.epageIsRenderedPage)return this.prePaginated&&this.epageCount==0&&this.assignAutoPages(),v(!0);let e=0,n=0,s=k(\"countEPages\");return s.loopWithFrame(o=>{if(n===this.spine.length){o.breakLoop();return}let i=this.spine[n++];i.epage=e,this.store.load(i.src).then(a=>{let l=1800,c=a.lang||this.lang;c&&c.match(/^(ja|ko|zh)/)&&(l/=3),i.epageCount=Math.ceil(a.getTotalOffset()/l),e+=i.epageCount,this.epageCount=e,this.epageCountCallback&&this.epageCountCallback(this.epageCount),o.continueLoop()})}).thenFinish(s),s.result()}initWithChapters(t,e){this.itemMap={},this.itemMapByPath={},this.items=[],this.spine=this.items;let n=this.opfXML=new Mi(null,\"\",new DOMParser().parseFromString(\"<spine></spine>\",\"text/xml\"));return t.forEach(s=>{let o=new el;o.initWithParam(s),o.id;let i=n.document.createElement(\"itemref\");i.setAttribute(\"idref\",o.id),n.root.appendChild(i),o.itemRefElement=i,this.itemMap[o.id]=o;let a=this.getPathFromURL(s.url);a==null&&(a=s.url),this.itemMapByPath[a]=o,this.items.push(o)}),e?this.store.addDocument(t[0].url,e):v(null)}initWithWebPubManifest(t,e,n){var h,f,g,m;t.readingProgression&&(this.pageProgression=t.readingProgression),this.metadata===void 0&&(this.metadata={});let s=t.name||((h=t.metadata)==null?void 0:h.title)||(e==null?void 0:e.title);s&&(this.metadata[ve.title]=(Array.isArray(s)?s:[s]).map(E=>{var C;return{v:(C=E.value)!=null?C:E}}));let o=t.author||t.creator||((f=t.metadata)==null?void 0:f.author)||Array.from((g=e==null?void 0:e.querySelectorAll(\"meta[name='author'], meta[name='DC.Creator']\"))!=null?g:[]).map(E=>E.content);o&&o.length!==0&&(this.metadata[ve.creator]=(Array.isArray(o)?o:[o]).map(E=>{var C;return{v:(C=E.name)!=null?C:E}}));let i=t.inLanguage||((m=t.metadata)==null?void 0:m.language)||(e==null?void 0:e.documentElement.lang)||(e==null?void 0:e.documentElement.getAttribute(\"xml:lang\"));i&&(this.metadata[ve.language]=(Array.isArray(i)?i:[i]).map(E=>({v:E})));let a=this.getPathFromURL(this.pubURL);if(!t.readingOrder&&e&&a!==null){t.readingOrder=[encodeURI(a)];for(let E of og(e)){let C=E.getAttribute(\"href\");if(/^(https?:)?\\/\\//.test(C)||/\\.(jpe?g|png|gif|pdf|svg|mml)([#?]|$)/.test(C))continue;let b=wt(J(C,this.pubURL)),y=this.getPathFromURL(b),N=y!==null?encodeURI(y):b;t.readingOrder.indexOf(N)==-1&&t.readingOrder.push(N)}}let l=[],c=0,u=-1;[t.readingOrder,t.resources].forEach(E=>{E instanceof Array&&E.forEach(C=>{let b=E===t.readingOrder,y=typeof C==\"string\"?C:C.url||C.href,N=typeof C==\"string\"?\"\":C.encodingFormat||C.href&&C.type||\"\";if(b||N===\"text/html\"||N===\"application/xhtml+xml\"||!N&&C.rel!==\"stylesheet\"&&/(^|\\/)([^/]+\\.(x?html|htm|xht)|[^/.]*)([#?]|$)/.test(y)){let S=n?n.replace(/\\/[^/]+$/,\"/\"):this.pubURL,w={url:J(vn(y),S),index:c++,startPage:null,skipPagesBefore:null};C.rel===\"contents\"&&u===-1&&(u=w.index),l.push(w)}})});let p=k(\"initWithWebPubManifest\");return this.initWithChapters(l).then(()=>{var C,b;u!==-1&&(this.toc=this.items[u]),this.toc||(this.toc=n?(C=this.items)==null?void 0:C[0]:this.itemMapByPath[a]);let E=(b=t.readingOrder)==null?void 0:b.length;E&&E<this.items.length&&this.items.splice(E),p.finish(!0)}),p.result()}getCFI(t,e){let n=this.spine[t],s=k(\"getCFI\");return this.store.load(n.src).then(o=>{let i=o.getNodeByOffset(e),a=null;if(i){let l=o.getNodeOffset(i,0,!1),c=e-l,u=new Fo;u.prependPathFromNode(i,c,!1,null),n.itemRefElement&&u.prependPathFromNode(n.itemRefElement,0,!1,null),a=u.toString()}s.finish(a)}),s.result()}resolveFragment(t){return cn(\"resolveFragment\",e=>{if(!t){e.finish(null);return}let n=new Fo;n.fromString(t);let s;if(this.opfXML){let o=n.navigate(this.opfXML.document);if(o.node.nodeType!=1||o.after||!o.ref){e.finish(null);return}let i=o.node,a=i.getAttribute(\"idref\");if(i.localName!=\"itemref\"||!a||!this.itemMap[a]){e.finish(null);return}s=this.itemMap[a],n=o.ref}else s=this.spine[0];this.store.load(s.src).then(o=>{let i=n.navigate(o.document),a=o.getNodeOffset(i.node,i.offset,i.after);e.finish({spineIndex:s.spineIndex,offsetInItem:a,pageIndex:-1})})},(e,n)=>{V.warn(n,\"Cannot resolve fragment:\",t),e.finish(null)})}resolveEPage(t){return cn(\"resolveEPage\",e=>{if(t<=0){e.finish({spineIndex:0,offsetInItem:0,pageIndex:-1});return}if(this.epageIsRenderedPage){let o=this.spine.findIndex(l=>l.epage==0&&l.epageCount==0||l.epage<=t&&l.epage+l.epageCount>t);o==-1&&(o=this.spine.length-1);let i=this.spine[o];(!i||i.epageCount==0)&&(i=this.spine[--o]);let a=Math.floor(t-i.epage);e.finish({spineIndex:o,offsetInItem:-1,pageIndex:a});return}let n=gt(this.spine.length,o=>{let i=this.spine[o];return i.epage+i.epageCount>t});n==this.spine.length&&n--;let s=this.spine[n];this.store.load(s.src).then(o=>{t-=s.epage,t>s.epageCount&&(t=s.epageCount);let i=0;if(t>0){let a=o.getTotalOffset();i=Math.round(a*t/s.epageCount),i==a&&i--}e.finish({spineIndex:n,offsetInItem:i,pageIndex:-1})})},(e,n)=>{V.warn(n,\"Cannot resolve epage:\",t),e.finish(null)})}getEPageFromPosition(t){let e=this.spine[t.spineIndex];if(this.epageIsRenderedPage){let s=e.epage+t.pageIndex;return v(s)}if(t.offsetInItem<=0)return v(e.epage);let n=k(\"getEPage\");return this.store.load(e.src).then(s=>{let o=s.getTotalOffset(),i=Math.min(o,t.offsetInItem);n.finish(e.epage+i*e.epageCount/o)}),n.result()}},Ja=(r,t)=>({page:r,position:{spineIndex:r.spineIndex,pageIndex:t,offsetInItem:r.offset}}),tl=class{constructor(t,e,n,s,o){this.opf=t;this.viewport=e;this.fontMapper=n;this.pageSheetSizeReporter=o;d(this,\"spineItems\",[]);d(this,\"spineItemLoadingContinuations\",[]);d(this,\"pref\");d(this,\"clientLayout\");d(this,\"counterStore\");d(this,\"tocAutohide\",!1);d(this,\"tocVisible\",!1);d(this,\"tocView\");this.pref=hr(s),this.clientLayout=new $a(e),this.counterStore=new Nr(t.documentURLTransformer)}getPage(t){let e=this.spineItems[t.spineIndex];return e?e.pages[t.pageIndex]:null}getCurrentPageProgression(t){if(this.opf.pageProgression)return this.opf.pageProgression;{let e=this.spineItems[t?t.spineIndex:0];return e?e.instance.pageProgression:null}}finishPageContainer(t,e,n){e.container.style.display=\"none\",e.container.style.visibility=\"visible\",e.container.style.position=\"\",e.container.style.top=\"\",e.container.style.left=\"\",e.container.setAttribute(\"data-vivliostyle-page-side\",e.side);let s=t.pages[n];if(e.isFirstPage=t.item.spineIndex==0&&n==0,t.pages[n]=e,this.opf.epageIsRenderedPage){if(n==0&&t.item.spineIndex>0){let o=this.opf.spine[t.item.spineIndex-1];t.item.epage=o.epage+o.epageCount}t.item.epageCount=t.pages.length,this.opf.epageCount=this.opf.spine.reduce((o,i)=>o+i.epageCount,0),this.opf.epageCountCallback&&this.opf.epageCountCallback(this.opf.epageCount)}if(s)t.instance.viewport.contentContainer.replaceChild(e.container,s.container),s.dispatchEvent({type:\"replaced\",target:null,currentTarget:null,preventDefault:null,newPage:e});else{let o=null;if(n>0)o=t.pages[n-1].container.nextElementSibling;else for(let i=t.item.spineIndex+1;i<this.spineItems.length;i++){let a=this.spineItems[i];if(a&&a.pages[0]){o=a.pages[0].container;break}}t.instance.viewport.contentContainer.insertBefore(e.container,o)}this.pageSheetSizeReporter({width:t.instance.pageSheetWidth,height:t.instance.pageSheetHeight},t.instance.pageSheetSize,t.item.spineIndex,t.instance.pageNumberOffset+n)}renderSinglePage(t,e){let n=k(\"renderSinglePage\"),s=t.pages[e?e.page:0],o=this.makePage(t,e);return s&&(o.pageType=s.pageType),t.instance.layoutNextPage(o,e).then(i=>{e=i;let a=e?e.page-1:t.layoutPositions.length-1;this.finishPageContainer(t,o,a),this.counterStore.finishPage(o.spineIndex,a);let l=null;if(e){let c=t.layoutPositions[e.page];t.layoutPositions[e.page]=e,c&&t.pages[e.page]&&(e.isSamePosition(c)||(l=this.renderSinglePage(t,e)))}l||(l=v(!0)),l.then(()=>{let c=this.counterStore.getUnresolvedRefsToPage(o),u=0;n.loopWithFrame(p=>{if(u++,u>c.length){p.breakLoop();return}let h=c[u-1];if(h.refs=h.refs.filter(f=>!f.isResolved()),h.refs.length===0){p.continueLoop();return}this.getPageViewItem(h.spineIndex).then(f=>{if(!f){p.continueLoop();return}let{currentPageType:g,previousPageType:m}=f.instance.styler.cascade,E=Object.entries(f.instance.scopes);this.counterStore.pushPageCounters(h.pageCounters),this.counterStore.pushReferencesToSolve(h.refs);let C=f.layoutPositions[h.pageIndex];this.renderSinglePage(f,C).then(b=>{f.instance.styler.cascade.currentPageType=g,f.instance.styler.cascade.previousPageType=m,f.instance.scopes=Object.fromEntries(E),this.counterStore.popPageCounters(),this.counterStore.popReferencesToSolve();let y=b.pageAndPosition.position;y.spineIndex===o.spineIndex&&y.pageIndex===a&&(o=b.pageAndPosition.page),p.continueLoop()})})}).then(()=>{o.container.parentElement||(o=t.pages[a]),o.isLastPage=!e&&t.item.spineIndex===this.opf.spine.length-1,o.isLastPage&&(this.viewport,this.counterStore.finishLastPage(this.viewport)),o.container.setAttribute(\"data-vivliostyle-page-index\",a),o.container.setAttribute(\"data-vivliostyle-spine-index\",o.spineIndex),n.finish({pageAndPosition:Ja(o,a),nextLayoutPosition:e})})})}),n.result()}normalizeSeekPosition(t,e){let n=t.pageIndex,s=-1;if(n<0){s=t.offsetInItem;let o=gt(e.layoutPositions.length,i=>e.instance.getPosition(e.layoutPositions[i],!0)>s);o===e.layoutPositions.length?e.complete?n=e.layoutPositions.length-1:n=Number.POSITIVE_INFINITY:n=o-1}else n===Number.POSITIVE_INFINITY&&t.offsetInItem!==-1&&(s=t.offsetInItem);return{spineIndex:t.spineIndex,pageIndex:n,offsetInItem:s}}findPage(t,e){let n=k(\"findPage\");return this.getPageViewItem(t.spineIndex).then(s=>{if(!s){n.finish(null);return}let o=null,i;n.loopWithFrame(a=>{let l=this.normalizeSeekPosition(t,s);i=l.pageIndex,o=s.pages[i],o?a.breakLoop():s.complete?(i=s.layoutPositions.length-1,o=s.pages[i],a.breakLoop()):e?this.renderPage(l).then(c=>{c&&(o=c.page,i=c.position.pageIndex),a.breakLoop()}):n.sleep(100).then(()=>{a.continueLoop()})}).then(()=>{n.finish(Ja(o,i))})}),n.result()}renderPage(t){let e=k(\"renderPage\");return this.getPageViewItem(t.spineIndex).then(n=>{if(!n){e.finish(null);return}let s=this.normalizeSeekPosition(t,n),o=s.pageIndex,i=s.offsetInItem,a=n.pages[o];if(a){e.finish(Ja(a,o));return}e.loopWithFrame(l=>{if(o<n.layoutPositions.length){l.breakLoop();return}if(n.complete){o=n.layoutPositions.length-1,l.breakLoop();return}let c=n.layoutPositions[n.layoutPositions.length-1];this.renderSinglePage(n,c).then(u=>{let p=u.pageAndPosition.page;if(c=u.nextLayoutPosition,c){if(i>=0&&n.instance.getPosition(c)>i){a=p,o=n.layoutPositions.length-2,l.breakLoop();return}l.continueLoop()}else a=p,o=u.pageAndPosition.position.pageIndex,n.complete=!0,l.breakLoop()})}).then(()=>{a=a||n.pages[o];let l=n.layoutPositions[o];if(a){e.finish(Ja(a,o));return}this.renderSinglePage(n,l).then(c=>{c.nextLayoutPosition||(n.complete=!0),e.finish(c.pageAndPosition)})})}),e.result()}renderAllPages(){let t=k(\"renderAllPages\");return this.renderPagesUpto({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},!1).then(e=>{t.loopWithFrame(n=>{this.spineItems.some(s=>s==null?void 0:s.pages.some(o=>o==null?void 0:o.fetchers.some(i=>!i.arrived)))?t.sleep(100).then(()=>{n.continueLoop()}):n.breakLoop()}).then(()=>{t.finish(e)})}),t.result()}renderPagesUpto(t,e){let n=k(\"renderPagesUpto\");t||(t={spineIndex:0,pageIndex:0,offsetInItem:0});let s=t.spineIndex,o=t.pageIndex,i=0;e&&(i=s);let a;return n.loopWithFrame(l=>{let c={spineIndex:i,pageIndex:i===s?o:Number.POSITIVE_INFINITY,offsetInItem:i===s?t.offsetInItem:-1};this.renderPage(c).then(u=>{a=u,++i>s?l.breakLoop():l.continueLoop()})}).then(()=>{n.finish(a)}),n.result()}firstPage(t,e){return this.findPage({spineIndex:0,pageIndex:0,offsetInItem:-1},e)}lastPage(t,e){return this.findPage({spineIndex:this.opf.spine.length-1,pageIndex:Number.POSITIVE_INFINITY,offsetInItem:-1},e)}nextPage(t,e){let n=t.spineIndex,s=t.pageIndex,o=k(\"nextPage\");return this.getPageViewItem(n).then(i=>{if(!i){o.finish(null);return}if(i.complete&&s==i.layoutPositions.length-1){if(n>=this.opf.spine.length-1){o.finish(null);return}n++,s=0;let a=this.spineItems[n],l=a&&a.pages[0],c=i.pages[i.pages.length-1];l&&c&&l.side==c.side&&(a.pages.forEach(u=>{u.container&&u.container.remove()}),this.spineItems[n]=null,this.spineItemLoadingContinuations[n]=null)}else s++;this.findPage({spineIndex:n,pageIndex:s,offsetInItem:-1},e).thenFinish(o)}),o.result()}previousPage(t,e){let n=t.spineIndex,s=t.pageIndex;if(s==0){if(n==0)return v(null);n--,s=Number.POSITIVE_INFINITY}else s--;return this.findPage({spineIndex:n,pageIndex:s,offsetInItem:-1},e)}isRectoPage(t,e){let n=t.side===\"left\",s=this.getCurrentPageProgression(e)===\"ltr\";return!n&&s||n&&!s}getSpread(t,e){let n=this.getPage(t);if(!n)return v({left:null,right:null});let s=k(\"getSpread\"),o=n.side===\"left\",i;return this.isRectoPage(n,t)?i=this.previousPage(t,e):i=this.nextPage(t,e),i.then(a=>{let l=this.getPage(t),c=a&&a.page;c&&c.side===l.side&&(c=null),o?s.finish({left:l,right:c}):s.finish({left:c,right:l})}),s.result()}nextSpread(t,e){let n=this.getPage(t);if(!n)return v(null);let s=this.isRectoPage(n,t),o=this.nextPage(t,e);return s?o:o.thenAsync(i=>{if(i){if(i.page.side===n.side)return o;let a=this.nextPage(i.position,e);return a.thenAsync(l=>l?a:o)}else return v(null)})}previousSpread(t,e){let n=this.getPage(t);if(!n)return v(null);let s=this.isRectoPage(n,t),o=this.previousPage(t,e),i=n.container.previousElementSibling;return s?o.thenAsync(a=>a?a.page.side===n.side||a.page.container!==i?o:this.previousPage(a.position,e):v(null)):o}navigateToEPage(t,e,n){let s=k(\"navigateToEPage\");return this.opf.resolveEPage(t).then(o=>{o?this.findPage(o,n).thenFinish(s):s.finish(null)}),s.result()}navigateToFragment(t,e,n){let s=k(\"navigateToCFI\");return this.opf.resolveFragment(t).then(o=>{o?this.findPage(o,n).thenFinish(s):s.finish(null)}),s.result()}navigateTo(t,e,n){V.debug(\"Navigate to\",t);let s=this.opf.getPathFromURL(wt(t));if(!s){if(this.opf.opfXML&&t.match(/^#epubcfi\\(/))s=this.opf.getPathFromURL(this.opf.opfXML.url);else if(t.charAt(0)===\"#\"){let a=this.opf.documentURLTransformer.restoreURL(t);this.opf.opfXML?(s=this.opf.getPathFromURL(a[0]),s==null&&(s=a[0])):s=a[0],t=a[0]+(a[1]?`#${a[1]}`:\"\")}if(s==null)return v(null)}let o=this.opf.itemMapByPath[s];if(!o){if(this.opf.opfXML&&s==this.opf.getPathFromURL(this.opf.opfXML.url)){let a=t.indexOf(\"#\");if(a>=0)return this.navigateToFragment(t.substr(a+1),e,n)}return v(null)}let i=k(\"navigateTo\");return this.getPageViewItem(o.spineIndex).then(a=>{if(!a){i.finish(null);return}let l=a.xmldoc.getElement(t);this.findPage({spineIndex:o.spineIndex,pageIndex:-1,offsetInItem:l?a.xmldoc.getElementOffset(l):0},n).thenFinish(i)}),i.result()}makePage(t,e){let n=t.instance.viewport,s=n.document.createElement(\"div\");s.setAttribute(\"data-vivliostyle-page-container\",\"true\"),s.setAttribute(\"role\",\"region\"),s.style.position=\"absolute\",s.style.top=\"0\",s.style.left=\"0\",Qn||(s.style.visibility=\"hidden\"),n.layoutBox.appendChild(s);let o=n.document.createElement(\"div\");o.setAttribute(\"data-vivliostyle-bleed-box\",\"true\"),s.appendChild(o);let i=new ro(s,o);if(i.spineIndex=t.item.spineIndex,i.position=e,i.offset=t.instance.getPosition(e),i.offset===0&&!(t.instance.blankPageAtStart&&t.pages.length===0)){let a=this.opf.documentURLTransformer.transformFragment(\"\",t.item.src);o.setAttribute(\"id\",a),i.registerElementWithId(o,a)}if(n!==this.viewport){let a=Al(this.viewport.width,this.viewport.height,n.width,n.height),l=Zt(null,new Oe(a,null),\"\");i.delayedItems.push(new Bn(s,\"transform\",l))}return i}makeObjectView(t,e,n,s){let o=e.getAttribute(\"data\"),i=null;if(o){o=J(o,t.url);let a=e.getAttribute(\"media-type\");if(!a){let l=this.opf.getPathFromURL(o);if(l){let c=this.opf.itemMapByPath[l];c&&(a=c.mediaType)}}if(a){let l=this.opf.bindings[a];if(l){i=this.viewport.document.createElement(\"iframe\"),i.style.border=\"none\";let c=Sl(o),u=Sl(a),p=new je;p.append(l),p.append(\"?src=\"),p.append(c),p.append(\"&type=\"),p.append(u);for(let g=e.firstChild;g;g=g.nextSibling)if(g.nodeType==1){let m=g;if(m.localName==\"param\"&&m.namespaceURI==\"http://www.w3.org/1999/xhtml\"){let E=m.getAttribute(\"name\"),C=m.getAttribute(\"value\");E&&C&&(p.append(\"&\"),p.append(encodeURIComponent(E)),p.append(\"=\"),p.append(encodeURIComponent(C)))}}i.setAttribute(\"src\",p.toString());let h=e.getAttribute(\"width\");h&&i.setAttribute(\"width\",h);let f=e.getAttribute(\"height\");f&&i.setAttribute(\"height\",f)}}}return i||(i=this.viewport.document.createElement(\"object\"),o&&i.setAttribute(\"data\",o),i.setAttribute(\"data-adapt-process-children\",\"true\")),v(i)}makeMathJaxView(t,e,n,s){let o=ub();if(o){let i=n.ownerDocument,a=i.createElement(\"span\");n.appendChild(a);let l=i.importNode(e,!0);this.resolveURLsInMathML(l,t),a.appendChild(l);let c=o.queue;c.Push([\"Typeset\",o,a]);let u=k(\"makeMathJaxView\"),p=u.suspend();return c.Push(()=>{p.schedule(a)}),u.result()}return v(null)}resolveURLsInMathML(t,e){if(t!=null){if(t.nodeType===1&&t.tagName===\"mglyph\"){let n=Array.from(t.attributes);for(let s of n){if(s.name!==\"src\")continue;let o=J(s.nodeValue,e.url);s.namespaceURI?t.setAttributeNS(s.namespaceURI,s.name,o):t.setAttribute(s.name,o)}}t.firstChild&&this.resolveURLsInMathML(t.firstChild,e),t.nextSibling&&this.resolveURLsInMathML(t.nextSibling,e)}}makeCustomRenderer(t){return(e,n,s)=>e.localName==\"object\"&&e.namespaceURI==\"http://www.w3.org/1999/xhtml\"?this.makeObjectView(t,e,n,s):e.namespaceURI==\"http://www.w3.org/1998/Math/MathML\"?this.makeMathJaxView(t,e,n,s):e.dataset&&e.dataset.mathTypeset==\"true\"?this.makeMathJaxView(t,e,n,s):v(null)}getPageViewItem(t){if(t===-1||t>=this.opf.spine.length)return v(null);let e=this.spineItems[t];if(e)return v(e);let n=k(\"getPageViewItem\"),s=this.spineItemLoadingContinuations[t];if(s){let a=n.suspend();return s.push(a),n.result()}else s=this.spineItemLoadingContinuations[t]=[];let o=this.opf.spine[t],i=this.opf.store;return i.load(o.src).then(a=>{var y;let l=o.itemRefElement.getAttribute(\"properties\");l&&a.root.setAttribute(\"data-vivliostyle-epub-spine-properties\",l),o.title=a.document.title;let c=i.getStyleForDoc(a),u=this.makeCustomRenderer(a),p=this.viewport,h=c.sizeViewport(p.width,p.height,p.fontSize,this.pref);(h.width!=p.width||h.height!=p.height||h.fontSize!=p.fontSize)&&(p=new Sn(p.window,h.fontSize,p.pixelRatio,p.root,h.width,h.height));let f=(y=this.spineItems[0])==null?void 0:y.instance.isVersoFirstPage,g=this.spineItems[t-1],m,E;if(o.startPage!==null)m=o.startPage-1,E=m;else{if(t>0&&(!g||!g.complete))m=o.epage||t,!this.opf.prePaginated&&m%2==(f?1:0)&&m++,E=m;else{m=g?g.instance.pageNumberOffset+g.pages.length:0;let N=this.counterStore.currentPageCounters.page;E=!N||!N.length?m:N[N.length-1]}o.skipPagesBefore!==null&&(m+=o.skipPagesBefore,E+=o.skipPagesBefore)}this.counterStore.forceSetPageCounter(E);let C=new wo(c,a,this.opf.lang,p,this.clientLayout,this.fontMapper,u,this.opf.fallbackMap,m,this.opf.documentURLTransformer,this.counterStore,this.opf.pageProgression,f);C.pref=this.pref;let b=this.opf.metadata&&this.opf.metadata[ve.title];C.pubTitle=b&&b[0]&&b[0].v||\"\",C.docTitle=o.title||\"\",C.init().then(()=>{!this.opf.pageProgression&&C.pageProgression&&(this.opf.pageProgression=C.pageProgression),e={item:o,xmldoc:a,instance:C,layoutPositions:[null],pages:[],complete:!1},this.spineItems[t]=e,n.finish(e),s.forEach(N=>{N.schedule(e)})})}),n.result()}removeRenderedPages(){let t=this.spineItems;for(let e of t)e&&e.pages.splice(0);this.viewport.clear()}hasAutoSizedPages(){let t=this.spineItems;for(let e of t)if(e){let n=e.pages;for(let s of n)if(s.isAutoPageWidth&&s.isAutoPageHeight)return!0}return!1}hasPages(){return this.spineItems.some(t=>t&&t.pages.length>0)}showTOC(t){let e=this.opf,n=e.toc;if(this.tocAutohide=t,!n)return v(null);if(this.tocVisible=!0,this.tocView&&this.tocView.page)return this.tocView.page.container.style.visibility=\"visible\",this.tocView.page.container.setAttribute(\"aria-hidden\",\"false\"),v(this.tocView.page);let s=k(\"showTOC\");this.tocView||(this.tocView=new Za(e.store,n.src,e.lang,this.clientLayout,this.fontMapper,this.pref,this,e.fallbackMap,e.documentURLTransformer,this.counterStore));let o=this.viewport,i=Math.min(344,Math.round(.67*o.width)-16),a=o.height-6,l=o.document.createElement(\"div\");return o.root.appendChild(l),Qn||(l.style.visibility=\"hidden\"),l.style.width=`${i+16}px`,l.style.maxHeight=`${a}px`,l.setAttribute(\"data-vivliostyle-toc-box\",\"true\"),l.setAttribute(\"role\",\"navigation\"),this.tocView.showTOC(l,o,i,a,this.viewport.fontSize).then(c=>{l.style.visibility=\"visible\",l.setAttribute(\"aria-hidden\",\"false\"),s.finish(c)}),s.result()}hideTOC(){this.tocVisible=!1,this.tocView&&this.tocView.hideTOC()}isTOCVisible(){return this.tocVisible&&!!this.tocView&&this.tocView.isTOCVisible()}};var rg=\"data-vivliostyle-viewer-status\",pb=\"data-vivliostyle-spread-view\",dp=(n=>(n.SINGLE_PAGE=\"singlePage\",n.SPREAD=\"spread\",n.AUTO_SPREAD=\"autoSpread\",n))(dp||{}),nl=class{constructor(t,e,n,s){this.window=t;this.viewportElement=e;this.instanceId=n;this.callbackFn=s;d(this,\"fontMapper\");d(this,\"kick\");d(this,\"sendCommand\");d(this,\"resizeListener\");d(this,\"hyperlinkListener\");d(this,\"pageRuleStyleElement\");d(this,\"pageSheetSizeAlreadySet\",!1);d(this,\"renderTask\",null);d(this,\"actions\");d(this,\"readyState\");d(this,\"packageURL\");d(this,\"opf\");d(this,\"touchActive\");d(this,\"touchX\");d(this,\"touchY\");d(this,\"needResize\");d(this,\"resized\");d(this,\"needRefresh\");d(this,\"viewportSize\");d(this,\"currentPage\");d(this,\"currentSpread\");d(this,\"pagePosition\");d(this,\"fontSize\");d(this,\"zoom\");d(this,\"fitToScreen\");d(this,\"pageViewMode\");d(this,\"waitForLoading\");d(this,\"renderAllPages\");d(this,\"pref\");d(this,\"pageSizes\");d(this,\"pixelRatio\");d(this,\"pixelRatioLimit\");d(this,\"viewport\");d(this,\"opfView\");let o=e.ownerDocument,i=(a,l)=>{let c=o.getElementById(a);return c||(c=o.createElement(\"style\"),c.id=a,l&&(c.textContent=l),o.head.appendChild(c)),c};i(\"vivliostyle-viewport-screen-css\",ac),i(\"vivliostyle-viewport-css\",lc),i(\"vivliostyle-polyfill-css\",fc),e.setAttribute(\"data-vivliostyle-viewer-viewport\",!0),Qn&&e.setAttribute(\"data-vivliostyle-debug\",!0),e.setAttribute(rg,\"loading\"),this.fontMapper=new La(o.head,e),this.init(),this.kick=()=>{},this.sendCommand=()=>{},this.resizeListener=()=>{this.needResize=!0,this.resized=!0,this.kick()},this.pageReplacedListener=this.pageReplacedListener.bind(this),this.hyperlinkListener=a=>{},this.pageRuleStyleElement=i(\"vivliostyle-page-rules\"),this.actions={loadPublication:this.loadPublication,loadXML:this.loadXML,configure:this.configure,moveTo:this.moveTo,toc:this.showTOC},this.addLogListeners()}init(){this.readyState=\"loading\",this.packageURL=[],this.opf=null,this.touchActive=!1,this.touchX=0,this.touchY=0,this.needResize=!1,this.resized=!1,this.needRefresh=!1,this.viewportSize=null,this.currentPage=null,this.currentSpread=null,this.pagePosition=null,this.fontSize=16,this.zoom=1,this.fitToScreen=!1,this.pageViewMode=\"singlePage\",this.waitForLoading=!1,this.renderAllPages=!0,this.pref=kl(),this.pageSizes=[],this.pixelRatioLimit=/Chrome/.test(navigator.userAgent)?16:0,this.pixelRatio=Math.min(8,this.pixelRatioLimit)}addLogListeners(){let t=fl;V.addListener(t.DEBUG,e=>{this.callback({t:\"debug\",content:e})}),V.addListener(t.INFO,e=>{this.callback({t:\"info\",content:e})}),V.addListener(t.WARN,e=>{this.callback({t:\"warn\",content:e})}),V.addListener(t.ERROR,e=>{this.callback({t:\"error\",content:e})})}callback(t){t.i=this.instanceId,this.callbackFn(t)}setReadyState(t){this.readyState!==t&&(this.readyState=t,this.viewportElement.setAttribute(rg,t),this.callback({t:\"readystatechange\"}))}loadPublication(t){Ye.registerStartTiming(\"beforeRender\"),this.setReadyState(\"loading\");let e=t.url,n=t.fragment,s=t.authorStyleSheet,o=t.userStyleSheet;this.viewport=null;let i=k(\"loadPublication\");return this.configure(t).then(()=>{let a=new Hi;a.init(s,o).then(()=>{let l=J(vn(e),this.window.location.href);this.packageURL=[l],a.loadPubDoc(l).then(c=>{c?(this.opf=c,this.render(n).then(()=>{i.finish(!0)})):i.finish(!1)})})}),i.result()}loadXML(t){Ye.registerStartTiming(\"beforeRender\"),this.setReadyState(\"loading\");let e=t.url,n=t.document,s=t.fragment,o=t.authorStyleSheet,i=t.userStyleSheet;this.viewport=null;let a=k(\"loadXML\");return this.configure(t).then(()=>{let l=new Hi;l.init(o,i).then(()=>{let c=e.map((u,p)=>({url:J(vn(u.url),this.window.location.href),index:p,startPage:u.startPage,skipPagesBefore:u.skipPagesBefore}));this.packageURL=c.map(u=>u.url),this.opf=new Bs(l,\"\"),this.opf.initWithChapters(c,n).then(()=>{this.render(s).then(()=>{a.finish(!0)})})})}),a.result()}render(t){this.cancelRenderingTask();let e;return t?e=this.opf.resolveFragment(t).thenAsync(n=>(this.pagePosition=n,v(!0))):e=v(!0),e.thenAsync(()=>(Ye.registerEndTiming(\"beforeRender\"),this.resize()))}resolveLength(t){let e=parseFloat(t),n=/[a-z]+$/,s;if(typeof t==\"string\"&&(s=t.match(n))){let o=s[0];if(o===\"em\"||o===\"rem\")return e*this.fontSize;if(o===\"ex\")return e*$.ex*this.fontSize/$.em;let i=$[o];if(i)return e*i}return e}configure(t){if(typeof t.autoresize==\"boolean\"&&(t.autoresize?(this.viewportSize=null,this.window.addEventListener(\"resize\",this.resizeListener,!1),this.needResize=!0):this.window.removeEventListener(\"resize\",this.resizeListener,!1)),typeof t.fontSize==\"number\"){let e=t.fontSize;e>=5&&e<=72&&this.fontSize!=e&&(this.fontSize=e,this.needResize=!0)}if(typeof t.viewport==\"object\"&&t.viewport){let e=t.viewport,n={marginLeft:this.resolveLength(e[\"margin-left\"])||0,marginRight:this.resolveLength(e[\"margin-right\"])||0,marginTop:this.resolveLength(e[\"margin-top\"])||0,marginBottom:this.resolveLength(e[\"margin-bottom\"])||0,width:this.resolveLength(e.width)||0,height:this.resolveLength(e.height)||0};(n.width>=200||n.height>=200)&&(this.window.removeEventListener(\"resize\",this.resizeListener,!1),this.viewportSize=n,this.needResize=!0)}if(typeof t.hyphenate==\"boolean\"&&(this.pref.hyphenate=t.hyphenate,this.needResize=!0),typeof t.horizontal==\"boolean\"&&(this.pref.horizontal=t.horizontal,this.needResize=!0),typeof t.nightMode==\"boolean\"&&(this.pref.nightMode=t.nightMode,this.needResize=!0),typeof t.lineHeight==\"number\"&&(this.pref.lineHeight=t.lineHeight,this.needResize=!0),typeof t.columnWidth==\"number\"&&(this.pref.columnWidth=t.columnWidth,this.needResize=!0),typeof t.fontFamily==\"string\"&&(this.pref.fontFamily=t.fontFamily,this.needResize=!0),typeof t.load==\"boolean\"&&(this.waitForLoading=t.load),typeof t.renderAllPages==\"boolean\"&&(this.renderAllPages=t.renderAllPages),typeof t.userAgentRootURL==\"string\"&&(Cl(t.userAgentRootURL.replace(/resources\\/?$/,\"\")),bl(t.userAgentRootURL)),typeof t.rootURL==\"string\"&&(Cl(t.rootURL),bl(`${nn}resources/`)),typeof t.pageViewMode==\"string\"&&t.pageViewMode!==this.pageViewMode&&(this.pageViewMode=t.pageViewMode,this.needResize=!0),typeof t.pageBorder==\"number\"&&t.pageBorder!==this.pref.pageBorder&&(this.viewport=null,this.pref.pageBorder=t.pageBorder,this.needResize=!0),typeof t.zoom==\"number\"&&t.zoom!==this.zoom&&(this.zoom=t.zoom,this.needRefresh=!0),typeof t.fitToScreen==\"boolean\"&&t.fitToScreen!==this.fitToScreen&&(this.fitToScreen=t.fitToScreen,this.needRefresh=!0),typeof t.defaultPaperSize==\"object\"&&typeof t.defaultPaperSize.width==\"number\"&&typeof t.defaultPaperSize.height==\"number\"&&(this.viewport=null,this.pref.defaultPaperSize=t.defaultPaperSize,this.needResize=!0),typeof t.allowScripts==\"boolean\"&&t.allowScripts!==Rt&&(Kf(t.allowScripts),this.needResize=!0),typeof t.pixelRatio==\"number\"){let e=Math.min(t.pixelRatio,this.pixelRatioLimit);e!==this.pixelRatio&&(this.pixelRatio=e,this.needResize=!0)}return this.configurePlugins(t),v(!0)}configurePlugins(t){$e(\"CONFIGURATION\").forEach(n=>{let s=n(t);this.needResize=s.needResize||this.needResize,this.needRefresh=s.needRefresh||this.needRefresh})}pageReplacedListener(t){let e=this.currentPage,n=this.currentSpread,s=t.target;n?(n.left===s||n.right===s)&&this.showCurrent(t.newPage):e===t.target&&this.showCurrent(t.newPage)}forCurrentPages(t){let e=[];this.currentPage&&e.push(this.currentPage),this.currentSpread&&(e.push(this.currentSpread.left),e.push(this.currentSpread.right)),e.forEach(n=>{n&&t(n)})}removePageListeners(){this.forCurrentPages(t=>{t.removeEventListener(\"hyperlink\",this.hyperlinkListener,!1),t.removeEventListener(\"replaced\",this.pageReplacedListener,!1)})}hidePages(){this.removePageListeners(),this.forCurrentPages(t=>{T(t.container,\"display\",\"none\")}),this.currentPage=null,this.currentSpread=null}showSinglePage(t){t.addEventListener(\"hyperlink\",this.hyperlinkListener,!1),t.addEventListener(\"replaced\",this.pageReplacedListener,!1),T(t.container,\"visibility\",\"visible\"),T(t.container,\"display\",\"block\")}showPage(t){this.hidePages(),this.currentPage=t,t.container.style.marginLeft=\"\",t.container.style.marginRight=\"\",this.showSinglePage(t)}showSpread(t){if(this.hidePages(),this.currentSpread=t,t.left&&t.right){let e=parseFloat(t.left.container.style.width),n=parseFloat(t.right.container.style.width);e&&n&&e!==n&&(e<n?t.left.container.style.marginLeft=`${n-e}px`:t.right.container.style.marginRight=`${e-n}px`)}t.left&&(this.showSinglePage(t.left),t.right?t.left.container.removeAttribute(\"data-vivliostyle-unpaired-page\"):t.left.container.setAttribute(\"data-vivliostyle-unpaired-page\",!0)),t.right&&(this.showSinglePage(t.right),t.left?t.right.container.removeAttribute(\"data-vivliostyle-unpaired-page\"):t.right.container.setAttribute(\"data-vivliostyle-unpaired-page\",!0))}reportPosition(){let t=k(\"reportPosition\");return this.pagePosition,this.opf.getCFI(this.pagePosition.spineIndex,this.pagePosition.offsetInItem).then(e=>{let n=this.currentPage;(this.waitForLoading&&n.fetchers.length>0?An(n.fetchers):v(!0)).then(()=>{this.sendLocationNotification(n,e).thenFinish(t)})}),t.result()}createViewport(){let t=this.viewportElement;if(this.viewportSize){let e=this.viewportSize;return t.style.marginLeft=`${e.marginLeft}px`,t.style.marginRight=`${e.marginRight}px`,t.style.marginTop=`${e.marginTop}px`,t.style.marginBottom=`${e.marginBottom}px`,new Sn(this.window,this.fontSize,this.pixelRatio,t,e.width,e.height)}else return new Sn(this.window,this.fontSize,this.pixelRatio,t)}resolveSpreadView(t,e){switch(this.pageViewMode){case\"singlePage\":return!1;case\"spread\":return!0;case\"autoSpread\":default:return(t.width-this.pref.pageBorder)/t.height>=(e?e.width*2/e.height:1.45)&&(!!e||t.width>800)}}updateSpreadView(t){this.pref.spreadView=t,this.viewportElement.setAttribute(pb,t.toString())}sizeIsGood(){var i;let t=this.createViewport(),e=((i=this.opfView)==null?void 0:i.hasPages())&&!this.opfView.hasAutoSizedPages(),n=this.resolveSpreadView(t,this.resized&&e?this.pageSizes[0]:null);this.resized=!1;let s=this.pref.spreadView!==n;return this.updateSpreadView(n),this.pixelRatio&&this.opfView&&this.pixelRatio/this.window.devicePixelRatio!==this.opfView.clientLayout.scaleRatio||this.viewportSize||!this.viewport||this.viewport.fontSize!=this.fontSize?!1:!s&&t.width==this.viewport.width&&t.height==this.viewport.height||!s&&t.width==this.viewport.width&&t.height!=this.viewport.height&&/Android|iPhone|iPad|iPod/.test(navigator.userAgent)?!0:e?(this.viewport.width=t.width,this.viewport.height=t.height,this.needRefresh=!0,!0):!1}setPageSize(t,e,n,s){this.pageSizes[s]=t,this.setPageSizePageRules(e,n,s),s===0&&this.pageViewMode===\"autoSpread\"&&!this.opfView.hasAutoSizedPages()&&this.updateSpreadView(this.resolveSpreadView(this.viewport,t))}setPageSizePageRules(t,e,n){var o,i;if(this.pageRuleStyleElement&&(!this.pageSheetSizeAlreadySet||this.pageSizes[n].width!==((o=this.pageSizes[n-1])==null?void 0:o.width)||this.pageSizes[n].height!==((i=this.pageSizes[n-1])==null?void 0:i.height))){let c=function(m){let E=m*.75;return Math.ceil(E)};var s=c;let a=Math.max(...this.pageSizes.map(m=>m.width)),l=Math.max(...this.pageSizes.map(m=>m.height)),u=c(a),p=c(l),h=u*((this.pixelRatio||1)-1)+2,f=p*((this.pixelRatio||1)-1)+2,g=`@page {size: ${u}pt ${p}pt; margin: 0 ${-h}pt ${-f}pt 0;}`;this.pageRuleStyleElement.textContent=g,this.pageSheetSizeAlreadySet=!0}}removePageSizePageRules(){this.pageRuleStyleElement&&(this.pageRuleStyleElement.textContent=\"\",this.pageSheetSizeAlreadySet=!1)}reset(){let t=!1,e=!1;this.opfView&&(t=this.opfView.tocVisible,e=this.opfView.tocAutohide,this.opfView.removeRenderedPages()),this.pageSizes=[],this.removePageSizePageRules(),this.viewport=this.createViewport(),this.viewport.resetZoom(),this.opfView=new tl(this.opf,this.viewport,this.fontMapper,this.pref,this.setPageSize.bind(this)),t&&this.sendCommand({a:\"toc\",v:\"show\",autohide:e})}showCurrent(t,e){this.needRefresh=!1,this.removePageListeners();let n=this.resolveSpreadView(this.viewport,t.dimensions);return n!==this.pref.spreadView&&this.updateSpreadView(n),n?this.opfView.getSpread(this.pagePosition,e).thenAsync(s=>!s.left&&!s.right?v(null):s.left&&s.right&&(!this.resolveSpreadView(this.viewport,s.left.dimensions)||!this.resolveSpreadView(this.viewport,s.right.dimensions))?(this.updateSpreadView(!1),this.showPage(t),this.setPageZoom(t),this.currentPage=t,v(null)):(this.showSpread(s),this.setSpreadZoom(s),this.currentPage=t.side===\"left\"?s.left:s.right,v(null))):(this.showPage(t),this.setPageZoom(t),this.currentPage=t,v(null))}setPageZoom(t){let e=this.getAdjustedZoomFactor(t.dimensions);this.viewport.zoom(t.dimensions.width,t.dimensions.height,e)}setSpreadZoom(t){let e=this.getSpreadDimensions(t);this.viewport.zoom(e.width,e.height,this.getAdjustedZoomFactor(e))}getAdjustedZoomFactor(t){return this.fitToScreen?this.calculateZoomFactorToFitInsideViewPort(t):this.zoom}getSpreadDimensions(t){let e=0,n=0;return t.left&&(e+=t.left.dimensions.width,n=t.left.dimensions.height),t.right&&(e+=t.right.dimensions.width,n=Math.max(n,t.right.dimensions.height)),t.left&&t.right&&(e+=this.pref.pageBorder*2,e+=Math.abs(t.left.dimensions.width-t.right.dimensions.width)),{width:e,height:n}}queryZoomFactor(t){if(!this.currentPage)throw new Error(\"no page exists.\");switch(t){case\"fit inside viewport\":{let e;return this.pref.spreadView?(this.currentSpread,e=this.getSpreadDimensions(this.currentSpread)):e=this.currentPage.dimensions,this.calculateZoomFactorToFitInsideViewPort(e)}default:throw new Error(`unknown zoom type: ${t}`)}}calculateZoomFactorToFitInsideViewPort(t){if(!this.viewport)return this.zoom;let e=this.viewport.width/t.width,n=this.viewport.height/t.height;return Math.min(e,n)}cancelRenderingTask(){this.renderTask&&this.renderTask.interrupt(new sl),this.renderTask=null}resize(){if(this.needResize=!1,this.needRefresh=!1,this.sizeIsGood())return v(!0);this.setReadyState(\"loading\"),this.cancelRenderingTask();let t=jo().getScheduler().run(()=>cn(\"resize\",e=>{if(!this.opf){e.finish(!1);return}this.renderTask=t,Ye.registerStartTiming(\"render (resize)\"),this.reset(),this.pagePosition&&(this.pagePosition.pageIndex==0&&this.pagePosition.offsetInItem==0||(this.pagePosition.pageIndex=-1)),this.opf.setEPageCountMode(this.renderAllPages),this.opfView.renderPagesUpto(this.pagePosition,!this.renderAllPages).then(n=>{if(!n){e.finish(!1);return}this.pagePosition=n.position,this.showCurrent(n.page,!0).then(()=>{this.setReadyState(\"interactive\"),this.opf.countEPages(s=>{let o={t:\"nav\",epageCount:s,first:this.currentPage.isFirstPage,last:this.currentPage.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[this.pagePosition.spineIndex].title};(this.currentPage.isFirstPage||this.pagePosition.pageIndex==0&&this.opf.spine[this.pagePosition.spineIndex].epage)&&(o.epage=this.opf.spine[this.pagePosition.spineIndex].epage),this.callback(o)}).then(()=>{this.reportPosition().then(s=>{(this.renderAllPages?this.opfView.renderAllPages():v(null)).then(()=>{this.renderTask===t&&(this.renderTask=null),Ye.registerEndTiming(\"render (resize)\"),Rt&&np(this.window)?Qf(this.window).then(()=>{this.renderAllPages&&this.setReadyState(\"complete\"),this.callback({t:\"loaded\"}),e.finish(s)}):(this.renderAllPages&&this.setReadyState(\"complete\"),this.callback({t:\"loaded\"}),e.finish(s))})})})})})},(e,n)=>{if(n instanceof sl)Ye.registerEndTiming(\"render (resize)\"),V.debug(n.message);else throw n}));return v(!0)}sendLocationNotification(t,e){let n=k(\"sendLocationNotification\"),s={t:\"nav\",first:t.isFirstPage,last:t.isLastPage,metadata:this.opf.metadata,docTitle:this.opf.spine[t.spineIndex].title};return this.opf.getEPageFromPosition(this.pagePosition).then(o=>{s.epage=o,s.epageCount=this.opf.epageCount,e&&(s.cfi=e),this.callback(s),n.finish(!0)}),n.result()}getCurrentPageProgression(){return this.opfView?this.opfView.getCurrentPageProgression(this.pagePosition):null}moveTo(t){var s;let e;if(this.readyState!==\"complete\"&&t.where!==\"next\"&&this.setReadyState(\"loading\"),typeof t.where==\"string\"){let o;switch(t.where){case\"next\":o=this.pref.spreadView?this.opfView.nextSpread:this.opfView.nextPage;break;case\"previous\":o=this.pref.spreadView?this.opfView.previousSpread:this.opfView.previousPage;break;case\"last\":o=this.opfView.lastPage;break;case\"first\":o=this.opfView.firstPage;break;default:return v(!0)}o&&(e=()=>o.call(this.opfView,this.pagePosition,!this.renderAllPages))}else if(typeof t.epage==\"number\"){let o=t.epage;e=()=>this.opfView.navigateToEPage(o,this.pagePosition,!this.renderAllPages)}else if(typeof t.url==\"string\"){let o=t.url;e=()=>this.opfView.navigateTo(o,this.pagePosition,!this.renderAllPages)}else if(typeof((s=t.position)==null?void 0:s.spineIndex)==\"number\"){let o=t.position;e=()=>this.opfView.findPage(o,!this.renderAllPages)}else return v(!0);if(!this.opfView)return v(!0);let n=k(\"moveTo\");return e.call(this.opfView).then(o=>{let i;if(o){this.pagePosition=o.position;let a=k(\"moveTo.showCurrent\");i=a.result(),this.showCurrent(o.page,!this.renderAllPages).then(()=>{this.reportPosition().thenFinish(a)})}else i=v(!0);i.then(a=>{this.readyState===\"loading\"&&this.setReadyState(\"interactive\"),n.finish(a)})}),n.result()}showTOC(t){let e=!!t.autohide,n=t.v,s=this.opfView.isTOCVisible(),o=e!=this.opfView.tocAutohide&&n!=\"hide\";if(s){if(n==\"show\"&&!o)return v(!0)}else if(n==\"hide\")return v(!0);if(s&&n!=\"show\")return this.opfView.hideTOC(),v(!0);{let i=k(\"showTOC\");return this.opfView.showTOC(e).then(a=>{if(a){if(o&&(a.listeners={}),e){let l=()=>{this.opfView.hideTOC()};a.addEventListener(\"hyperlink\",l,!1)}a.addEventListener(\"hyperlink\",this.hyperlinkListener,!1)}i.finish(!0)}),i.result()}}runCommand(t){let e=t.a||\"\";return cn(\"runCommand\",n=>{let s=this.actions[e];s?s.call(this,t).then(()=>{this.callback({t:\"done\",a:e}),n.finish(!0)}):(V.error(\"No such action:\",e),n.finish(!0))},(n,s)=>{V.error(s,\"Error during action:\",e),n.finish(!0)})}initEmbed(t){let e=ag(t),n=null,s=this;Jp(()=>{let o=k(\"commandLoop\"),i=jo().getScheduler();return s.hyperlinkListener=a=>{let l=a,c=l.href.charAt(0)===\"#\"||s.packageURL.some(u=>l.href.substr(0,u.length)==u);if(c){a.preventDefault();let u={t:\"hyperlink\",href:l.href,internal:c};i.run(()=>(s.callback(u),v(!0)))}},o.loopWithFrame(a=>{if(s.needResize)s.resize().then(()=>{a.continueLoop()});else if(s.needRefresh)s.currentPage&&s.showCurrent(s.currentPage,!this.renderAllPages).then(()=>{a.continueLoop()});else if(e){let l=e;e=null,s.runCommand(l).then(()=>{a.continueLoop()})}else{let l=k(\"waitForCommand\");n=l.suspend(this),l.result().then(()=>{a.continueLoop()})}}).thenFinish(o),o.result()}),s.kick=()=>{let o=n;o&&(n=null,o.schedule(!0))},s.sendCommand=o=>e?!1:(e=ag(o),s.kick(),!0),this.window.adapt_command=s.sendCommand}},pp=(t=>(t.FIT_INSIDE_VIEWPORT=\"fit inside viewport\",t))(pp||{}),sl=class r extends Error{constructor(){super();d(this,\"name\",\"RenderingCanceledError\");d(this,\"message\",\"Page rendering has been canceled\");d(this,\"stack\");Object.setPrototypeOf(this,r.prototype),this.stack=new Error().stack}};function ag(r){return typeof r==\"string\"?Ms(r):r}var lg=Jn;function fb(){return{autoResize:!0,fontSize:16,pageBorderWidth:1,renderAllPages:!0,pageViewMode:\"autoSpread\",zoom:1,fitToScreen:!1,defaultPaperSize:void 0,allowScripts:!0,pixelRatio:8}}function cg(r){let t={};return Object.keys(r).forEach(e=>{let n=r[e];switch(e){case\"autoResize\":t.autoresize=n;break;case\"pageBorderWidth\":t.pageBorder=n;break;default:t[e]=n}}),t}var zi=class{constructor(t,e){this.settings=t;d(this,\"initialized\",!1);d(this,\"adaptViewer_\");d(this,\"options\");d(this,\"eventTarget\");d(this,\"readyState\");ul(t.debug),this.adaptViewer_=new nl(t.window||window,t.viewportElement,\"main\",this.dispatcher.bind(this)),this.options=fb(),e&&this.setOptions(e),this.eventTarget=new Nn,Object.defineProperty(this,\"readyState\",{get(){return this.adaptViewer_.readyState}})}setOptions(t){let e=Object.assign({a:\"configure\"},cg(t));this.adaptViewer_.sendCommand(e),Object.assign(this.options,t)}dispatcher(t){let e={type:t.t},n=t;Object.keys(n).forEach(s=>{s!==\"t\"&&(e[s]=n[s])}),this.eventTarget.dispatchEvent(e)}addListener(t,e){this.eventTarget.addEventListener(t,e,!1)}removeListener(t,e){this.eventTarget.removeEventListener(t,e,!1)}loadDocument(t,e,n){if(!t||(Array.isArray(t)?!t[0]||typeof t[0]!=\"string\"&&!t[0].url:typeof t!=\"string\"&&!t.url)){this.eventTarget.dispatchEvent({type:\"error\",content:{error:new Error(\"No URL specified\")}});return}this.loadDocumentOrPublication(t,null,e,n)}loadPublication(t,e,n){if(!t){this.eventTarget.dispatchEvent({type:\"error\",content:{error:new Error(\"No URL specified\")}});return}this.loadDocumentOrPublication(null,t,e,n)}loadDocumentOrPublication(t,e,n,s){let o=n||{};function i(u){if(u)return u.map(p=>({url:p.url||null,text:p.text||null}))}let a=i(o.authorStyleSheet),l=i(o.userStyleSheet);s&&Object.assign(this.options,s);let c=Object.assign({a:t?\"loadXML\":\"loadPublication\",userAgentRootURL:this.settings.userAgentRootURL,url:gb(t)||e,document:o.documentObject,fragment:o.fragment,authorStyleSheet:a,userStyleSheet:l},cg(this.options));this.initialized?this.adaptViewer_.sendCommand(c):(this.initialized=!0,this.adaptViewer_.initEmbed(c))}getCurrentPageProgression(){return this.adaptViewer_.getCurrentPageProgression()}resolveNavigation(t){switch(t){case\"left\":return this.getCurrentPageProgression()===lg.LTR?\"previous\":\"next\";case\"right\":return this.getCurrentPageProgression()===lg.LTR?\"next\":\"previous\";default:return t}}navigateToPage(t,e){t===\"epage\"?this.adaptViewer_.sendCommand({a:\"moveTo\",epage:e}):this.adaptViewer_.sendCommand({a:\"moveTo\",where:this.resolveNavigation(t)})}navigateToInternalUrl(t){this.adaptViewer_.sendCommand({a:\"moveTo\",url:t})}navigateToPosition(t){var e,n;this.adaptViewer_.sendCommand({a:\"moveTo\",position:{spineIndex:t.spineIndex,pageIndex:(e=t.pageIndex)!=null?e:-1,offsetInItem:(n=t.offsetInItem)!=null?n:-1}})}isTOCVisible(){return this.adaptViewer_.opfView&&this.adaptViewer_.opfView.opf&&this.adaptViewer_.opfView.opf.toc?!!this.adaptViewer_.opfView.isTOCVisible():null}showTOC(t,e){let n=t==null?\"toggle\":t?\"show\":\"hide\";this.adaptViewer_.sendCommand({a:\"toc\",v:n,autohide:e})}queryZoomFactor(t){return this.adaptViewer_.queryZoomFactor(t)}getPageSizes(){return this.adaptViewer_.pageSizes}getTOC(){var t,e;return(e=(t=this.adaptViewer_.opfView)==null?void 0:t.tocView)==null?void 0:e.getTOC()}getMetadata(){return this.adaptViewer_.opf.getMetadata()}getCover(){return this.adaptViewer_.opf.cover}};function gb(r){function t(n){return typeof n==\"number\"?n:null}function e(n){return typeof n==\"string\"?{url:n,startPage:null,skipPagesBefore:null}:{url:n.url,startPage:t(n.startPage),skipPagesBefore:t(n.skipPagesBefore)}}return Array.isArray(r)?r.map(e):r?[e(r)]:null}var ug=(a=>(a.PREVIOUS=\"previous\",a.NEXT=\"next\",a.LEFT=\"left\",a.RIGHT=\"right\",a.FIRST=\"first\",a.LAST=\"last\",a.EPAGE=\"epage\",a))(ug||{}),mb=pp,Cb=dp;Ye.forceRegisterEndTiming(\"load_vivliostyle\");var hp=class{constructor(t,{title:e=\"\",printCallback:n=a=>a.print(),errorCallback:s=null,hideIframe:o=!0,removeIframe:i=!0}){d(this,\"htmlDoc\");d(this,\"title\");d(this,\"printCallback\");d(this,\"errorCallback\");d(this,\"hideIframe\");d(this,\"removeIframe\");d(this,\"iframe\");d(this,\"iframeWin\");d(this,\"window\");this.htmlDoc=t,this.title=e,this.printCallback=n,this.errorCallback=s,this.hideIframe=o,this.removeIframe=i}init(){this.iframe=document.createElement(\"iframe\"),this.hideIframe&&(this.iframe.style.width=\"0\",this.iframe.style.height=\"0\",this.iframe.style.borderWidth=\"0\"),this.window=window,this.window.printInstance=this,this.iframe.srcdoc=`\n      <!DOCTYPE html>\n      <html data-vivliostyle-paginated=\"true\">\n        <head>\n          <meta charset='utf-8'/>\n          <meta name='viewport' content='width=device-width, initial-scale=1.0'/>\n          <title>${this.title}</title>\n          <style>\n            html[data-vivliostyle-paginated] {\n              width: 100%;\n              height: 100%;\n            }\n            html[data-vivliostyle-paginated] body,\n            html[data-vivliostyle-paginated] [data-vivliostyle-viewer-viewport] {\n              width: 100% !important;\n              height: 100% !important;\n            }\n            html[data-vivliostyle-paginated],\n            html[data-vivliostyle-paginated] body {\n              margin: 0;\n              padding: 0;\n            }\n          </style>\n          <style id='vivliostyle-page-rules'></style>\n        </head>\n        <body onload='parent.printInstance.runInIframe(window)'>\n          <div id=\"vivliostyle-viewer-viewport\"></div>\n        </body>\n      </html>`,document.body.appendChild(this.iframe)}runInIframe(t){return this.iframeWin=t,this.preparePrint().then(()=>this.browserPrint()).then(()=>this.cleanUp())}preparePrint(){this.iframeWin.document.title=this.title;let t=new Blob([this.htmlDoc],{type:\"text/html\"}),e=URL.createObjectURL(t),n=new zi({viewportElement:this.iframeWin.document.body.firstElementChild,window:this.iframeWin,debug:!0});return new Promise(s=>{n.addListener(\"readystatechange\",()=>{n.readyState===\"complete\"&&s()}),this.errorCallback&&n.addListener(\"error\",o=>{var a,l;let i=(l=(a=o.content.error)==null?void 0:a.toString())!=null?l:o.content.messages.join(`\n`);this.errorCallback(i)}),n.loadDocument({url:e})})}browserPrint(){this.printCallback(this.iframeWin)}cleanUp(){delete this.window.printInstance,this.removeIframe&&this.iframe.parentElement.removeChild(this.iframe)}};function bb(r,t){new hp(r,t).init()}\n//# sourceMappingURL=vivliostyle.js.map\n\n\n//# sourceURL=webpack://vivliostyle-core-sample/./node_modules/@vivliostyle/core/lib/vivliostyle.js?");

/***/ }),

/***/ "./src/main.ts":
/*!*********************!*\
  !*** ./src/main.ts ***!
  \*********************/
/***/ ((__unused_webpack_module, exports, __webpack_require__) => {

eval("\nObject.defineProperty(exports, \"__esModule\", ({ value: true }));\nconst core_1 = __webpack_require__(/*! @vivliostyle/core */ \"./node_modules/@vivliostyle/core/lib/vivliostyle.js\");\nconst viewer = document.getElementById('viewer');\nif (!viewer) {\n    throw new Error('Viewer element not found');\n}\nconst settings = {\n    viewportElement: viewer\n};\nconst options = {\n    autoResize: true,\n    fitToScreen: true,\n    renderAllPages: true,\n    pageViewMode: 'autoSpread'\n};\nconst Viewer = new core_1.CoreViewer(settings, options);\nViewer.loadDocument('publish.html');\ndocument.addEventListener('click', (event) => {\n    var _a;\n    const page = (_a = event.target) === null || _a === void 0 ? void 0 : _a.closest('[data-vivliostyle-spread-container]');\n    if (!page)\n        return; // \n    const rect = page.getBoundingClientRect();\n    const clickX = event.clientX - rect.left;\n    const halfWidth = rect.width / 2;\n    if (clickX < halfWidth) {\n        // \n        Viewer.navigateToPage(core_1.Navigation.NEXT);\n    }\n    else {\n        // \n        Viewer.navigateToPage(core_1.Navigation.PREVIOUS);\n    }\n});\ndocument.onkeydown = (e) => {\n    var _a;\n    if (e.key === 'ArrowRight') {\n        Viewer.navigateToPage(core_1.Navigation.PREVIOUS);\n        console.log(\"LR?\", Viewer.getCurrentPageProgression());\n        console.log((_a = document === null || document === void 0 ? void 0 : document.querySelector(\"[data-vivliostyle-spread-container]\")) === null || _a === void 0 ? void 0 : _a.childElementCount);\n    }\n    else if (e.key === 'ArrowLeft') {\n        Viewer.navigateToPage(core_1.Navigation.NEXT);\n    }\n};\n\n\n//# sourceURL=webpack://vivliostyle-core-sample/./src/main.ts?");

/***/ })

/******/ 	});
/************************************************************************/
/******/ 	// The module cache
/******/ 	var __webpack_module_cache__ = {};
/******/ 	
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/ 		// Check if module is in cache
/******/ 		var cachedModule = __webpack_module_cache__[moduleId];
/******/ 		if (cachedModule !== undefined) {
/******/ 			return cachedModule.exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = __webpack_module_cache__[moduleId] = {
/******/ 			// no module.id needed
/******/ 			// no module.loaded needed
/******/ 			exports: {}
/******/ 		};
/******/ 	
/******/ 		// Execute the module function
/******/ 		__webpack_modules__[moduleId](module, module.exports, __webpack_require__);
/******/ 	
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/ 	
/************************************************************************/
/******/ 	
/******/ 	// startup
/******/ 	// Load entry module and return exports
/******/ 	// This entry module can't be inlined because the eval devtool is used.
/******/ 	var __webpack_exports__ = __webpack_require__("./src/main.ts");
/******/ 	
/******/ })()
;